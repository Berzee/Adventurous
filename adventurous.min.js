/*!
// javascript-astar
// http://github.com/bgrins/javascript-astar
// Freely distributable under the MIT License.
// Implements the astar search algorithm in javascript using a binary heap.
*/
;var astar={init:function(c){for(var a=0,f=c.length;a<f;a++){for(var e=0,b=c[a].length;e<b;e++){var d=c[a][e];d.f=0;d.g=0;d.h=0;d.cost=d.type;d.visited=false;d.closed=false;d.parent=null}}},heap:function(){return new BinaryHeap(function(a){return a.f})},search:function(a,c,f,e,j){astar.init(a);j=j||astar.manhattan;e=!!e;var l=astar.heap();l.push(c);while(l.size()>0){var d=l.pop();if(d===f){var p=d;var h=[];while(p.parent){h.push(p);p=p.parent}return h.reverse()}d.closed=true;var o=astar.neighbors(a,d,e);for(var g=0,m=o.length;g<m;g++){var n=o[g];if(n.closed||n.isWall()){continue}var k=d.g+n.cost;var b=n.visited;if(!b||k<n.g){n.visited=true;n.parent=d;n.h=n.h||j(n.pos,f.pos);n.g=k;n.f=n.g+n.h;if(!b){l.push(n)}else{l.rescoreElement(n)}}}}return[]},manhattan:function(c,a){var d=Math.abs(a.x-c.x);var b=Math.abs(a.y-c.y);return d+b},neighbors:function(d,e,c){var b=[];var a=e.x;var f=e.y;if(d[a-1]&&d[a-1][f]){b.push(d[a-1][f])}if(d[a+1]&&d[a+1][f]){b.push(d[a+1][f])}if(d[a]&&d[a][f-1]){b.push(d[a][f-1])}if(d[a]&&d[a][f+1]){b.push(d[a][f+1])}if(c){if(d[a-1]&&d[a-1][f-1]){b.push(d[a-1][f-1])}if(d[a+1]&&d[a+1][f-1]){b.push(d[a+1][f-1])}if(d[a-1]&&d[a-1][f+1]){b.push(d[a-1][f+1])}if(d[a+1]&&d[a+1][f+1]){b.push(d[a+1][f+1])}}return b}};
/*!
// javascript-astar
// http://github.com/bgrins/javascript-astar
// Freely distributable under the MIT License.
// Includes Binary Heap (with modifications) from Marijn Haverbeke. 
// http://eloquentjavascript.net/appendix2.html
*/
;var GraphNodeType={OPEN:1,WALL:0};function Graph(c){var b=[];for(var a=0;a<c.length;a++){b[a]=[];for(var e=0,d=c[a];e<d.length;e++){b[a][e]=new GraphNode(a,e,d[e])}}this.input=c;this.nodes=b}Graph.prototype.toString=function(){var e="\n";var d=this.nodes;var g,f,h,c;for(var b=0,a=d.length;b<a;b++){g="";f=d[b];for(h=0,c=f.length;h<c;h++){g+=f[h].type+" "}e=e+g+"\n"}return e};function GraphNode(a,c,b){this.data={};this.x=a;this.y=c;this.pos={x:a,y:c};this.type=b}GraphNode.prototype.toString=function(){return"["+this.x+" "+this.y+"]"};GraphNode.prototype.isWall=function(){return this.type==GraphNodeType.WALL};function BinaryHeap(a){this.content=[];this.scoreFunction=a}BinaryHeap.prototype={push:function(a){this.content.push(a);this.sinkDown(this.content.length-1)},pop:function(){var a=this.content[0];var b=this.content.pop();if(this.content.length>0){this.content[0]=b;this.bubbleUp(0)}return a},remove:function(c){var b=this.content.indexOf(c);var a=this.content.pop();if(b!==this.content.length-1){this.content[b]=a;if(this.scoreFunction(a)<this.scoreFunction(c)){this.sinkDown(b)}else{this.bubbleUp(b)}}},size:function(){return this.content.length},rescoreElement:function(a){this.sinkDown(this.content.indexOf(a))},sinkDown:function(d){var a=this.content[d];while(d>0){var c=((d+1)>>1)-1,b=this.content[c];if(this.scoreFunction(a)<this.scoreFunction(b)){this.content[c]=a;this.content[d]=b;d=c}else{break}}},bubbleUp:function(b){var a=this.content.length,f=this.content[b],h=this.scoreFunction(f);while(true){var e=(b+1)<<1,j=e-1;var c=null;if(j<a){var i=this.content[j],k=this.scoreFunction(i);if(k<h){c=j}}if(e<a){var g=this.content[e],d=this.scoreFunction(g);if(d<(c===null?h:k)){c=e}}if(c!==null){this.content[b]=this.content[c];this.content[c]=f;b=c}else{break}}}};(function(){var b=this;var e=e||{};e.WEBGL_RENDERER=0;e.CANVAS_RENDERER=1;e.VERSION="v1.6.1";e.blendModes={NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16};e.scaleModes={DEFAULT:0,LINEAR:0,NEAREST:1};e._UID=0;if(typeof(Float32Array)!="undefined"){e.Float32Array=Float32Array;e.Uint16Array=Uint16Array}else{e.Float32Array=Array;e.Uint16Array=Array}e.INTERACTION_FREQUENCY=30;e.AUTO_PREVENT_DEFAULT=true;e.RAD_TO_DEG=180/Math.PI;e.DEG_TO_RAD=Math.PI/180;e.dontSayHello=false;e.sayHello=function(g){if(e.dontSayHello){return}if(navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var f=["%c %c %c Pixi.js "+e.VERSION+" - "+g+"  %c  %c  http://www.pixijs.com/  %c %c ♥%c♥%c♥ ","background: #ff66a5","background: #ff66a5","color: #ff66a5; background: #030307;","background: #ff66a5","background: #ffc3dc","background: #ff66a5","color: #ff2424; background: #fff","color: #ff2424; background: #fff","color: #ff2424; background: #fff"];console.log.apply(console,f)}else{if(window.console){console.log("Pixi.js "+e.VERSION+" - http://www.pixijs.com/")}}e.dontSayHello=true};e.Point=function(f,g){this.x=f||0;this.y=g||0};e.Point.prototype.clone=function(){return new e.Point(this.x,this.y)};e.Point.prototype.set=function(f,g){this.x=f||0;this.y=g||((g!==0)?this.x:0)};e.Point.prototype.constructor=e.Point;e.Rectangle=function(g,i,h,f){this.x=g||0;this.y=i||0;this.width=h||0;this.height=f||0};e.Rectangle.prototype.clone=function(){return new e.Rectangle(this.x,this.y,this.width,this.height)};e.Rectangle.prototype.contains=function(f,i){if(this.width<=0||this.height<=0){return false}var g=this.x;if(f>=g&&f<=g+this.width){var h=this.y;if(i>=h&&i<=h+this.height){return true}}return false};e.Rectangle.prototype.constructor=e.Rectangle;e.EmptyRectangle=new e.Rectangle(0,0,0,0);e.Polygon=function(h){if(!(h instanceof Array)){h=Array.prototype.slice.call(arguments)}if(typeof h[0]==="number"){var j=[];for(var g=0,f=h.length;g<f;g+=2){j.push(new e.Point(h[g],h[g+1]))}h=j}this.points=h};e.Polygon.prototype.clone=function(){var g=[];for(var f=0;f<this.points.length;f++){g.push(this.points[f].clone())}return new e.Polygon(g)};e.Polygon.prototype.contains=function(q,p){var h=false;for(var m=0,l=this.points.length-1;m<this.points.length;l=m++){var o=this.points[m].x,k=this.points[m].y,n=this.points[l].x,g=this.points[l].y,f=((k>p)!==(g>p))&&(q<(n-o)*(p-k)/(g-k)+o);if(f){h=!h}}return h};e.Polygon.prototype.constructor=e.Polygon;e.Circle=function(g,h,f){this.x=g||0;this.y=h||0;this.radius=f||0};e.Circle.prototype.clone=function(){return new e.Circle(this.x,this.y,this.radius)};e.Circle.prototype.contains=function(f,j){if(this.radius<=0){return false}var i=(this.x-f),h=(this.y-j),g=this.radius*this.radius;i*=i;h*=h;return(i+h<=g)};e.Circle.prototype.getBounds=function(){return new e.Rectangle(this.x-this.radius,this.y-this.radius,this.width,this.height)};e.Circle.prototype.constructor=e.Circle;e.Ellipse=function(g,i,h,f){this.x=g||0;this.y=i||0;this.width=h||0;this.height=f||0};e.Ellipse.prototype.clone=function(){return new e.Ellipse(this.x,this.y,this.width,this.height)};e.Ellipse.prototype.contains=function(g,i){if(this.width<=0||this.height<=0){return false}var h=((g-this.x)/this.width),f=((i-this.y)/this.height);h*=h;f*=f;return(h+f<=1)};e.Ellipse.prototype.getBounds=function(){return new e.Rectangle(this.x-this.width,this.y-this.height,this.width,this.height)};e.Ellipse.prototype.constructor=e.Ellipse;e.Matrix=function(){this.a=1;this.b=0;this.c=0;this.d=1;this.tx=0;this.ty=0};e.Matrix.prototype.fromArray=function(f){this.a=f[0];this.b=f[1];this.c=f[3];this.d=f[4];this.tx=f[2];this.ty=f[5]};e.Matrix.prototype.toArray=function(f){if(!this.array){this.array=new Float32Array(9)}var g=this.array;if(f){g[0]=this.a;g[1]=this.c;g[2]=0;g[3]=this.b;g[4]=this.d;g[5]=0;g[6]=this.tx;g[7]=this.ty;g[8]=1}else{g[0]=this.a;g[1]=this.b;g[2]=this.tx;g[3]=this.c;g[4]=this.d;g[5]=this.ty;g[6]=0;g[7]=0;g[8]=1}return g};e.identityMatrix=new e.Matrix();e.determineMatrixArrayType=function(){return(typeof Float32Array!=="undefined")?Float32Array:Array};e.Matrix2=e.determineMatrixArrayType();e.DisplayObject=function(){this.position=new e.Point();this.scale=new e.Point(1,1);this.pivot=new e.Point(0,0);this.rotation=0;this.alpha=1;this.visible=true;this.hitArea=null;this.buttonMode=false;this.renderable=false;this.parent=null;this.stage=null;this.worldAlpha=1;this._interactive=false;this.defaultCursor="pointer";this.worldTransform=new e.Matrix();this.color=[];this.dynamic=true;this._sr=0;this._cr=1;this.filterArea=null;this._bounds=new e.Rectangle(0,0,1,1);this._currentBounds=null;this._mask=null;this._cacheAsBitmap=false;this._cacheIsDirty=false};e.DisplayObject.prototype.constructor=e.DisplayObject;e.DisplayObject.prototype.setInteractive=function(f){this.interactive=f};Object.defineProperty(e.DisplayObject.prototype,"interactive",{get:function(){return this._interactive},set:function(f){this._interactive=f;if(this.stage){this.stage.dirty=true}}});Object.defineProperty(e.DisplayObject.prototype,"worldVisible",{get:function(){var f=this;do{if(!f.visible){return false}f=f.parent}while(f);return true}});Object.defineProperty(e.DisplayObject.prototype,"mask",{get:function(){return this._mask},set:function(f){if(this._mask){this._mask.isMask=false}this._mask=f;if(this._mask){this._mask.isMask=true}}});Object.defineProperty(e.DisplayObject.prototype,"filters",{get:function(){return this._filters},set:function(k){if(k){var h=[];for(var g=0;g<k.length;g++){var l=k[g].passes;for(var f=0;f<l.length;f++){h.push(l[f])}}this._filterBlock={target:this,filterPasses:h}}this._filters=k}});Object.defineProperty(e.DisplayObject.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(f){if(this._cacheAsBitmap===f){return}if(f){this._generateCachedSprite()}else{this._destroyCachedSprite()}this._cacheAsBitmap=f}});e.DisplayObject.prototype.updateTransform=function(){if(this.rotation!==this.rotationCache){this.rotationCache=this.rotation;this._sr=Math.sin(this.rotation);this._cr=Math.cos(this.rotation)}var i=this.parent.worldTransform;var f=this.worldTransform;var p=this.pivot.x;var o=this.pivot.y;var l=this._cr*this.scale.x,k=-this._sr*this.scale.y,s=this._sr*this.scale.x,r=this._cr*this.scale.y,j=this.position.x-l*p-o*k,q=this.position.y-r*o-p*s,n=i.a,m=i.b,h=i.c,g=i.d;f.a=n*l+m*s;f.b=n*k+m*r;f.tx=n*j+m*q+i.tx;f.c=h*l+g*s;f.d=h*k+g*r;f.ty=h*j+g*q+i.ty;this.worldAlpha=this.alpha*this.parent.worldAlpha};e.DisplayObject.prototype.getBounds=function(f){f=f;return e.EmptyRectangle};e.DisplayObject.prototype.getLocalBounds=function(){return this.getBounds(e.identityMatrix)};e.DisplayObject.prototype.setStageReference=function(f){this.stage=f;if(this._interactive){this.stage.dirty=true}};e.DisplayObject.prototype.generateTexture=function(h){var g=this.getLocalBounds();var f=new e.RenderTexture(g.width|0,g.height|0,h);f.render(this,new e.Point(-g.x,-g.y));return f};e.DisplayObject.prototype.updateCache=function(){this._generateCachedSprite()};e.DisplayObject.prototype._renderCachedSprite=function(f){this._cachedSprite.worldAlpha=this.worldAlpha;if(f.gl){e.Sprite.prototype._renderWebGL.call(this._cachedSprite,f)}else{e.Sprite.prototype._renderCanvas.call(this._cachedSprite,f)}};e.DisplayObject.prototype._generateCachedSprite=function(){this._cacheAsBitmap=false;var h=this.getLocalBounds();if(!this._cachedSprite){var f=new e.RenderTexture(h.width|0,h.height|0);this._cachedSprite=new e.Sprite(f);this._cachedSprite.worldTransform=this.worldTransform}else{this._cachedSprite.texture.resize(h.width|0,h.height|0)}var g=this._filters;this._filters=null;this._cachedSprite.filters=g;this._cachedSprite.texture.render(this,new e.Point(-h.x,-h.y));this._cachedSprite.anchor.x=-(h.x/h.width);this._cachedSprite.anchor.y=-(h.y/h.height);this._filters=g;this._cacheAsBitmap=true};e.DisplayObject.prototype._destroyCachedSprite=function(){if(!this._cachedSprite){return}this._cachedSprite.texture.destroy(true);this._cachedSprite=null};e.DisplayObject.prototype._renderWebGL=function(f){f=f};e.DisplayObject.prototype._renderCanvas=function(f){f=f};Object.defineProperty(e.DisplayObject.prototype,"x",{get:function(){return this.position.x},set:function(f){this.position.x=f}});Object.defineProperty(e.DisplayObject.prototype,"y",{get:function(){return this.position.y},set:function(f){this.position.y=f}});e.DisplayObjectContainer=function(){e.DisplayObject.call(this);this.children=[]};e.DisplayObjectContainer.prototype=Object.create(e.DisplayObject.prototype);e.DisplayObjectContainer.prototype.constructor=e.DisplayObjectContainer;Object.defineProperty(e.DisplayObjectContainer.prototype,"width",{get:function(){return this.scale.x*this.getLocalBounds().width},set:function(g){var f=this.getLocalBounds().width;if(f!==0){this.scale.x=g/(f/this.scale.x)}else{this.scale.x=1}this._width=g}});Object.defineProperty(e.DisplayObjectContainer.prototype,"height",{get:function(){return this.scale.y*this.getLocalBounds().height},set:function(g){var f=this.getLocalBounds().height;if(f!==0){this.scale.y=g/(f/this.scale.y)}else{this.scale.y=1}this._height=g}});e.DisplayObjectContainer.prototype.addChild=function(f){return this.addChildAt(f,this.children.length)};e.DisplayObjectContainer.prototype.addChildAt=function(g,f){if(f>=0&&f<=this.children.length){if(g.parent){g.parent.removeChild(g)}g.parent=this;this.children.splice(f,0,g);if(this.stage){g.setStageReference(this.stage)}return g}else{throw new Error(g+" The index "+f+" supplied is out of bounds "+this.children.length)}};e.DisplayObjectContainer.prototype.swapChildren=function(i,f){if(i===f){return}var h=this.children.indexOf(i);var g=this.children.indexOf(f);if(h<0||g<0){throw new Error("swapChildren: Both the supplied DisplayObjects must be a child of the caller.")}this.children[h]=f;this.children[g]=i};e.DisplayObjectContainer.prototype.getChildAt=function(f){if(f>=0&&f<this.children.length){return this.children[f]}else{throw new Error("Supplied index does not exist in the child list, or the supplied DisplayObject must be a child of the caller")}};e.DisplayObjectContainer.prototype.removeChild=function(f){return this.removeChildAt(this.children.indexOf(f))};e.DisplayObjectContainer.prototype.removeChildAt=function(f){var g=this.getChildAt(f);if(this.stage){g.removeStageReference()}g.parent=undefined;this.children.splice(f,1);return g};e.DisplayObjectContainer.prototype.removeChildren=function(k,l){var j=k||0;var f=typeof l==="number"?l:this.children.length;var g=f-j;if(g>0&&g<=f){var m=this.children.splice(j,g);for(var h=0;h<m.length;h++){var n=m[h];if(this.stage){n.removeStageReference()}n.parent=undefined}return m}else{throw new Error("Range Error, numeric values are outside the acceptable range")}};e.DisplayObjectContainer.prototype.updateTransform=function(){if(!this.visible){return}e.DisplayObject.prototype.updateTransform.call(this);if(this._cacheAsBitmap){return}for(var g=0,f=this.children.length;g<f;g++){this.children[g].updateTransform()}};e.DisplayObjectContainer.prototype.getBounds=function(s){if(this.children.length===0){return e.EmptyRectangle}if(s){var r=this.worldTransform;this.worldTransform=s;this.updateTransform();this.worldTransform=r}var n=Infinity;var m=Infinity;var h=-Infinity;var g=-Infinity;var o;var u;var t;var k=false;for(var q=0,p=this.children.length;q<p;q++){var l=this.children[q];if(!l.visible){continue}k=true;o=this.children[q].getBounds(s);n=n<o.x?n:o.x;m=m<o.y?m:o.y;u=o.width+o.x;t=o.height+o.y;h=h>u?h:u;g=g>t?g:t}if(!k){return e.EmptyRectangle}var f=this._bounds;f.x=n;f.y=m;f.width=h-n;f.height=g-m;return f};e.DisplayObjectContainer.prototype.getLocalBounds=function(){var f=this.worldTransform;this.worldTransform=e.identityMatrix;for(var h=0,g=this.children.length;h<g;h++){this.children[h].updateTransform()}var k=this.getBounds();this.worldTransform=f;return k};e.DisplayObjectContainer.prototype.setStageReference=function(g){this.stage=g;if(this._interactive){this.stage.dirty=true}for(var h=0,f=this.children.length;h<f;h++){var k=this.children[h];k.setStageReference(g)}};e.DisplayObjectContainer.prototype.removeStageReference=function(){for(var g=0,f=this.children.length;g<f;g++){var h=this.children[g];h.removeStageReference()}if(this._interactive){this.stage.dirty=true}this.stage=null};e.DisplayObjectContainer.prototype._renderWebGL=function(h){if(!this.visible||this.alpha<=0){return}if(this._cacheAsBitmap){this._renderCachedSprite(h);return}var g,f;if(this._mask||this._filters){if(this._filters){h.spriteBatch.flush();h.filterManager.pushFilter(this._filterBlock)}if(this._mask){h.spriteBatch.stop();h.maskManager.pushMask(this.mask,h);h.spriteBatch.start()}for(g=0,f=this.children.length;g<f;g++){this.children[g]._renderWebGL(h)}h.spriteBatch.stop();if(this._mask){h.maskManager.popMask(this._mask,h)}if(this._filters){h.filterManager.popFilter()}h.spriteBatch.start()}else{for(g=0,f=this.children.length;g<f;g++){this.children[g]._renderWebGL(h)}}};e.DisplayObjectContainer.prototype._renderCanvas=function(h){if(this.visible===false||this.alpha===0){return}if(this._cacheAsBitmap){this._renderCachedSprite(h);return}if(this._mask){h.maskManager.pushMask(this._mask,h.context)}for(var g=0,f=this.children.length;g<f;g++){var k=this.children[g];k._renderCanvas(h)}if(this._mask){h.maskManager.popMask(h.context)}};e.Sprite=function(f){e.DisplayObjectContainer.call(this);this.anchor=new e.Point();this.texture=f;this._width=0;this._height=0;this.tint=16777215;this.blendMode=e.blendModes.NORMAL;if(f.baseTexture.hasLoaded){this.onTextureUpdate()}else{this.onTextureUpdateBind=this.onTextureUpdate.bind(this);this.texture.addEventListener("update",this.onTextureUpdateBind)}this.renderable=true};e.Sprite.prototype=Object.create(e.DisplayObjectContainer.prototype);e.Sprite.prototype.constructor=e.Sprite;Object.defineProperty(e.Sprite.prototype,"width",{get:function(){return this.scale.x*this.texture.frame.width},set:function(f){this.scale.x=f/this.texture.frame.width;this._width=f}});Object.defineProperty(e.Sprite.prototype,"height",{get:function(){return this.scale.y*this.texture.frame.height},set:function(f){this.scale.y=f/this.texture.frame.height;this._height=f}});e.Sprite.prototype.setTexture=function(f){this.texture=f;this.cachedTint=16777215};e.Sprite.prototype.onTextureUpdate=function(){if(this._width){this.scale.x=this._width/this.texture.frame.width}if(this._height){this.scale.y=this._height/this.texture.frame.height}};e.Sprite.prototype.getBounds=function(s){var p=this.texture.frame.width;var o=this.texture.frame.height;var n=p*(1-this.anchor.x);var m=p*-this.anchor.x;var l=o*(1-this.anchor.y);var k=o*-this.anchor.y;var q=s||this.worldTransform;var E=q.a;var C=q.c;var B=q.b;var z=q.d;var F=q.tx;var D=q.ty;var v=E*m+B*k+F;var i=z*k+C*m+D;var u=E*n+B*k+F;var h=z*k+C*n+D;var t=E*n+B*l+F;var g=z*l+C*n+D;var r=E*m+B*l+F;var f=z*l+C*m+D;var y=-Infinity;var w=-Infinity;var A=Infinity;var x=Infinity;A=v<A?v:A;A=u<A?u:A;A=t<A?t:A;A=r<A?r:A;x=i<x?i:x;x=h<x?h:x;x=g<x?g:x;x=f<x?f:x;y=v>y?v:y;y=u>y?u:y;y=t>y?t:y;y=r>y?r:y;w=i>w?i:w;w=h>w?h:w;w=g>w?g:w;w=f>w?f:w;var j=this._bounds;j.x=A;j.width=y-A;j.y=x;j.height=w-x;this._currentBounds=j;return j};e.Sprite.prototype._renderWebGL=function(k){if(!this.visible||this.alpha<=0){return}var h,g;if(this._mask||this._filters){var f=k.spriteBatch;if(this._filters){f.flush();k.filterManager.pushFilter(this._filterBlock)}if(this._mask){f.stop();k.maskManager.pushMask(this.mask,k);f.start()}f.render(this);for(h=0,g=this.children.length;h<g;h++){this.children[h]._renderWebGL(k)}f.stop();if(this._mask){k.maskManager.popMask(this._mask,k)}if(this._filters){k.filterManager.popFilter()}f.start()}else{k.spriteBatch.render(this);for(h=0,g=this.children.length;h<g;h++){this.children[h]._renderWebGL(k)}}};e.Sprite.prototype._renderCanvas=function(l){if(this.visible===false||this.alpha===0){return}if(this.blendMode!==l.currentBlendMode){l.currentBlendMode=this.blendMode;l.context.globalCompositeOperation=e.blendModesCanvas[l.currentBlendMode]}if(this._mask){l.maskManager.pushMask(this._mask,l.context)}if(this.texture.valid){l.context.globalAlpha=this.worldAlpha;if(l.roundPixels){l.context.setTransform(this.worldTransform.a,this.worldTransform.c,this.worldTransform.b,this.worldTransform.d,this.worldTransform.tx|0,this.worldTransform.ty|0)}else{l.context.setTransform(this.worldTransform.a,this.worldTransform.c,this.worldTransform.b,this.worldTransform.d,this.worldTransform.tx,this.worldTransform.ty)}if(l.smoothProperty&&l.scaleMode!==this.texture.baseTexture.scaleMode){l.scaleMode=this.texture.baseTexture.scaleMode;l.context[l.smoothProperty]=(l.scaleMode===e.scaleModes.LINEAR)}var g=(this.texture.trim)?this.texture.trim.x-this.anchor.x*this.texture.trim.width:this.anchor.x*-this.texture.frame.width;var f=(this.texture.trim)?this.texture.trim.y-this.anchor.y*this.texture.trim.height:this.anchor.y*-this.texture.frame.height;if(this.tint!==16777215){if(this.cachedTint!==this.tint){this.cachedTint=this.tint;this.tintedTexture=e.CanvasTinter.getTintedTexture(this,this.tint)}l.context.drawImage(this.tintedTexture,0,0,this.texture.crop.width,this.texture.crop.height,g,f,this.texture.crop.width,this.texture.crop.height)}else{l.context.drawImage(this.texture.baseTexture.source,this.texture.crop.x,this.texture.crop.y,this.texture.crop.width,this.texture.crop.height,g,f,this.texture.crop.width,this.texture.crop.height)}}for(var k=0,h=this.children.length;k<h;k++){this.children[k]._renderCanvas(l)}if(this._mask){l.maskManager.popMask(l.context)}};e.Sprite.fromFrame=function(g){var f=e.TextureCache[g];if(!f){throw new Error('The frameId "'+g+'" does not exist in the texture cache'+this)}return new e.Sprite(f)};e.Sprite.fromImage=function(g,f,h){var i=e.Texture.fromImage(g,f,h);return new e.Sprite(i)};e.SpriteBatch=function(f){e.DisplayObjectContainer.call(this);this.textureThing=f;this.ready=false};e.SpriteBatch.prototype=Object.create(e.DisplayObjectContainer.prototype);e.SpriteBatch.constructor=e.SpriteBatch;e.SpriteBatch.prototype.initWebGL=function(f){this.fastSpriteBatch=new e.WebGLFastSpriteBatch(f);this.ready=true};e.SpriteBatch.prototype.updateTransform=function(){e.DisplayObject.prototype.updateTransform.call(this)};e.SpriteBatch.prototype._renderWebGL=function(f){if(!this.visible||this.alpha<=0||!this.children.length){return}if(!this.ready){this.initWebGL(f.gl)}f.spriteBatch.stop();f.shaderManager.setShader(f.shaderManager.fastShader);this.fastSpriteBatch.begin(this,f);this.fastSpriteBatch.render(this);f.spriteBatch.start()};e.SpriteBatch.prototype._renderCanvas=function(o){var f=o.context;f.globalAlpha=this.worldAlpha;e.DisplayObject.prototype.updateTransform.call(this);var j=this.worldTransform;var n=true;for(var k=0;k<this.children.length;k++){var g=this.children[k];if(!g.visible){continue}var m=g.texture;var h=m.frame;f.globalAlpha=this.worldAlpha*g.alpha;if(g.rotation%(Math.PI*2)===0){if(n){f.setTransform(j.a,j.c,j.b,j.d,j.tx,j.ty);n=false}f.drawImage(m.baseTexture.source,h.x,h.y,h.width,h.height,((g.anchor.x)*(-h.width*g.scale.x)+g.position.x+0.5)|0,((g.anchor.y)*(-h.height*g.scale.y)+g.position.y+0.5)|0,h.width*g.scale.x,h.height*g.scale.y)}else{if(!n){n=true}e.DisplayObject.prototype.updateTransform.call(g);var l=g.worldTransform;if(o.roundPixels){f.setTransform(l.a,l.c,l.b,l.d,l.tx|0,l.ty|0)}else{f.setTransform(l.a,l.c,l.b,l.d,l.tx,l.ty)}f.drawImage(m.baseTexture.source,h.x,h.y,h.width,h.height,((g.anchor.x)*(-h.width)+0.5)|0,((g.anchor.y)*(-h.height)+0.5)|0,h.width,h.height)}}};e.AbstractFilter=function(g,f){this.passes=[this];this.shaders=[];this.dirty=true;this.padding=0;this.uniforms=f||{};this.fragmentSrc=g||[]};e.FilterBlock=function(){this.visible=true;this.renderable=true};e.Text=function(g,f){this.canvas=document.createElement("canvas");this.context=this.canvas.getContext("2d");e.Sprite.call(this,e.Texture.fromCanvas(this.canvas));this.setText(g);this.setStyle(f)};e.Text.prototype=Object.create(e.Sprite.prototype);e.Text.prototype.constructor=e.Text;Object.defineProperty(e.Text.prototype,"width",{get:function(){if(this.dirty){this.updateText();this.dirty=false}return this.scale.x*this.texture.frame.width},set:function(f){this.scale.x=f/this.texture.frame.width;this._width=f}});Object.defineProperty(e.Text.prototype,"height",{get:function(){if(this.dirty){this.updateText();this.dirty=false}return this.scale.y*this.texture.frame.height},set:function(f){this.scale.y=f/this.texture.frame.height;this._height=f}});e.Text.prototype.setStyle=function(f){f=f||{};f.font=f.font||"bold 20pt Arial";f.fill=f.fill||"black";f.align=f.align||"left";f.stroke=f.stroke||"black";f.strokeThickness=f.strokeThickness||0;f.wordWrap=f.wordWrap||false;f.wordWrapWidth=f.wordWrapWidth||100;f.wordWrapWidth=f.wordWrapWidth||100;f.dropShadow=f.dropShadow||false;f.dropShadowAngle=f.dropShadowAngle||Math.PI/6;f.dropShadowDistance=f.dropShadowDistance||4;f.dropShadowColor=f.dropShadowColor||"black";this.style=f;this.dirty=true};e.Text.prototype.setText=function(f){this.text=f.toString()||" ";this.dirty=true};e.Text.prototype.updateText=function(){this.context.font=this.style.font;var l=this.text;if(this.style.wordWrap){l=this.wordWrap(this.text)}var r=l.split(/(?:\r\n|\r|\n)/);var k=[];var s=0;for(var m=0;m<r.length;m++){var n=this.context.measureText(r[m]).width;k[m]=n;s=Math.max(s,n)}var h=s+this.style.strokeThickness;if(this.style.dropShadow){h+=this.style.dropShadowDistance}this.canvas.width=h+this.context.lineWidth;var p=this.determineFontHeight("font: "+this.style.font+";")+this.style.strokeThickness;var q=p*r.length;if(this.style.dropShadow){q+=this.style.dropShadowDistance}this.canvas.height=q;if(navigator.isCocoonJS){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}this.context.font=this.style.font;this.context.strokeStyle=this.style.stroke;this.context.lineWidth=this.style.strokeThickness;this.context.textBaseline="top";var j;var g;if(this.style.dropShadow){this.context.fillStyle=this.style.dropShadowColor;var o=Math.sin(this.style.dropShadowAngle)*this.style.dropShadowDistance;var f=Math.cos(this.style.dropShadowAngle)*this.style.dropShadowDistance;for(m=0;m<r.length;m++){j=this.style.strokeThickness/2;g=this.style.strokeThickness/2+m*p;if(this.style.align==="right"){j+=s-k[m]}else{if(this.style.align==="center"){j+=(s-k[m])/2}}if(this.style.fill){this.context.fillText(r[m],j+o,g+f)}}}this.context.fillStyle=this.style.fill;for(m=0;m<r.length;m++){j=this.style.strokeThickness/2;g=this.style.strokeThickness/2+m*p;if(this.style.align==="right"){j+=s-k[m]}else{if(this.style.align==="center"){j+=(s-k[m])/2}}if(this.style.stroke&&this.style.strokeThickness){this.context.strokeText(r[m],j,g)}if(this.style.fill){this.context.fillText(r[m],j,g)}}this.updateTexture()};e.Text.prototype.updateTexture=function(){this.texture.baseTexture.width=this.canvas.width;this.texture.baseTexture.height=this.canvas.height;this.texture.crop.width=this.texture.frame.width=this.canvas.width;this.texture.crop.height=this.texture.frame.height=this.canvas.height;this._width=this.canvas.width;this._height=this.canvas.height;this.requiresUpdate=true};e.Text.prototype._renderWebGL=function(f){if(this.requiresUpdate){this.requiresUpdate=false;e.updateWebGLTexture(this.texture.baseTexture,f.gl)}e.Sprite.prototype._renderWebGL.call(this,f)};e.Text.prototype.updateTransform=function(){if(this.dirty){this.updateText();this.dirty=false}e.Sprite.prototype.updateTransform.call(this)};e.Text.prototype.determineFontHeight=function(j){var g=e.Text.heightCache[j];if(!g){var f=document.getElementsByTagName("body")[0];var i=document.createElement("div");var h=document.createTextNode("M");i.appendChild(h);i.setAttribute("style",j+";position:absolute;top:0;left:0");f.appendChild(i);g=i.offsetHeight;e.Text.heightCache[j]=g;f.removeChild(i)}return g};e.Text.prototype.wordWrap=function(m){var p="";var o=m.split("\n");for(var h=0;h<o.length;h++){var g=this.style.wordWrapWidth;var l=o[h].split(" ");for(var f=0;f<l.length;f++){var n=this.context.measureText(l[f]).width;var k=n+this.context.measureText(" ").width;if(f===0||k>g){if(f>0){p+="\n"}p+=l[f];g=this.style.wordWrapWidth-n}else{g-=k;p+=" "+l[f]}}if(h<o.length-1){p+="\n"}}return p};e.Text.prototype.destroy=function(f){this.context=null;this.canvas=null;this.texture.destroy(f===undefined?true:f)};e.Text.heightCache={};e.BitmapText=function(g,f){e.DisplayObjectContainer.call(this);this._pool=[];this.setText(g);this.setStyle(f);this.updateText();this.dirty=false};e.BitmapText.prototype=Object.create(e.DisplayObjectContainer.prototype);e.BitmapText.prototype.constructor=e.BitmapText;e.BitmapText.prototype.setText=function(f){this.text=f||" ";this.dirty=true};e.BitmapText.prototype.setStyle=function(g){g=g||{};g.align=g.align||"left";this.style=g;var f=g.font.split(" ");this.fontName=f[f.length-1];this.fontSize=f.length>=2?parseInt(f[f.length-2],10):e.BitmapText.fonts[this.fontName].size;this.dirty=true;this.tint=g.tint};e.BitmapText.prototype.updateText=function(){var u=e.BitmapText.fonts[this.fontName];var l=new e.Point();var m=null;var p=[];var q=0;var x=[];var o=0;var v=this.fontSize/u.size;for(var s=0;s<this.text.length;s++){var g=this.text.charCodeAt(s);if(/(?:\r\n|\r|\n)/.test(this.text.charAt(s))){x.push(l.x);q=Math.max(q,l.x);o++;l.x=0;l.y+=u.lineHeight;m=null;continue}var f=u.chars[g];if(!f){continue}if(m&&f[m]){l.x+=f.kerning[m]}p.push({texture:f.texture,line:o,charCode:g,position:new e.Point(l.x+f.xOffset,l.y+f.yOffset)});l.x+=f.xAdvance;m=g}x.push(l.x);q=Math.max(q,l.x);var r=[];for(s=0;s<=o;s++){var w=0;if(this.style.align==="right"){w=q-x[s]}else{if(this.style.align==="center"){w=(q-x[s])/2}}r.push(w)}var h=this.children.length;var j=p.length;var n=this.tint||16777215;for(s=0;s<j;s++){var t=s<h?this.children[s]:this._pool.pop();if(t){t.setTexture(p[s].texture)}else{t=new e.Sprite(p[s].texture)}t.position.x=(p[s].position.x+r[p[s].line])*v;t.position.y=p[s].position.y*v;t.scale.x=t.scale.y=v;t.tint=n;if(!t.parent){this.addChild(t)}}while(this.children.length>j){var k=this.getChildAt(this.children.length-1);this._pool.push(k);this.removeChild(k)}this.textWidth=q*v;this.textHeight=(l.y+u.lineHeight)*v};e.BitmapText.prototype.updateTransform=function(){if(this.dirty){this.updateText();this.dirty=false}e.DisplayObjectContainer.prototype.updateTransform.call(this)};e.BitmapText.fonts={};e.Stage=function(f){e.DisplayObjectContainer.call(this);this.worldTransform=new e.Matrix();this.interactive=true;this.interactionManager=new e.InteractionManager(this);this.dirty=true;this.stage=this;this.stage.hitArea=new e.Rectangle(0,0,100000,100000);this.setBackgroundColor(f)};e.Stage.prototype=Object.create(e.DisplayObjectContainer.prototype);e.Stage.prototype.constructor=e.Stage;e.Stage.prototype.setInteractionDelegate=function(f){this.interactionManager.setTargetDomElement(f)};e.Stage.prototype.updateTransform=function(){this.worldAlpha=1;for(var g=0,f=this.children.length;g<f;g++){this.children[g].updateTransform()}if(this.dirty){this.dirty=false;this.interactionManager.dirty=true}if(this.interactive){this.interactionManager.update()}};e.Stage.prototype.setBackgroundColor=function(f){this.backgroundColor=f||0;this.backgroundColorSplit=e.hex2rgb(this.backgroundColor);var g=this.backgroundColor.toString(16);g="000000".substr(0,6-g.length)+g;this.backgroundColorString="#"+g};e.Stage.prototype.getMousePosition=function(){return this.interactionManager.mouse.global};var c=0;var d=["ms","moz","webkit","o"];for(var a=0;a<d.length&&!window.requestAnimationFrame;++a){window.requestAnimationFrame=window[d[a]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[d[a]+"CancelAnimationFrame"]||window[d[a]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame){window.requestAnimationFrame=function(i){var f=new Date().getTime();var g=Math.max(0,16-(f-c));var h=window.setTimeout(function(){i(f+g)},g);c=f+g;return h}}if(!window.cancelAnimationFrame){window.cancelAnimationFrame=function(f){clearTimeout(f)}}window.requestAnimFrame=window.requestAnimationFrame;e.hex2rgb=function(f){return[(f>>16&255)/255,(f>>8&255)/255,(f&255)/255]};e.rgb2hex=function(f){return((f[0]*255<<16)+(f[1]*255<<8)+f[2]*255)};if(typeof Function.prototype.bind!=="function"){Function.prototype.bind=(function(){var f=Array.prototype.slice;return function(g){var j=this,k=f.call(arguments,1);if(typeof j!=="function"){throw new TypeError()}function h(){var l=k.concat(f.call(arguments));j.apply(this instanceof h?this:g,l)}h.prototype=(function i(l){if(l){i.prototype=l}if(!(this instanceof i)){return new i()}})(j.prototype);return h}})()}e.AjaxRequest=function(){var f=["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.3.0","Microsoft.XMLHTTP"];if(window.ActiveXObject){for(var g=0;g<f.length;g++){try{return new window.ActiveXObject(f[g])}catch(h){}}}else{if(window.XMLHttpRequest){return new window.XMLHttpRequest()}else{return false}}};e.canUseNewCanvasBlendModes=function(){var f=document.createElement("canvas");f.width=1;f.height=1;var g=f.getContext("2d");g.fillStyle="#000";g.fillRect(0,0,1,1);g.globalCompositeOperation="multiply";g.fillStyle="#fff";g.fillRect(0,0,1,1);return g.getImageData(0,0,1,1).data[0]===0};e.getNextPowerOfTwo=function(g){if(g>0&&(g&(g-1))===0){return g}else{var f=1;while(f<g){f<<=1}return f}};e.EventTarget=function(){var f={};this.addEventListener=this.on=function(g,h){if(f[g]===undefined){f[g]=[]}if(f[g].indexOf(h)===-1){f[g].unshift(h)}};this.dispatchEvent=this.emit=function(h){if(!f[h.type]||!f[h.type].length){return}for(var g=f[h.type].length-1;g>=0;g--){f[h.type][g](h)}};this.removeEventListener=this.off=function(h,i){if(f[h]===undefined){return}var g=f[h].indexOf(i);if(g!==-1){f[h].splice(g,1)}};this.removeAllEventListeners=function(h){var g=f[h];if(g){g.length=0}}};e.PolyK={};e.PolyK.Triangulate=function(o){var B=true;var q=o.length>>1;if(q<3){return[]}var y=[];var m=[];for(var w=0;w<q;w++){m.push(w)}w=0;var t=q;while(t>3){var u=m[(w+0)%t];var s=m[(w+1)%t];var r=m[(w+2)%t];var l=o[2*u],h=o[2*u+1];var z=o[2*s],x=o[2*s+1];var g=o[2*r],f=o[2*r+1];var k=false;if(e.PolyK._convex(l,h,z,x,g,f,B)){k=true;for(var v=0;v<t;v++){var A=m[v];if(A===u||A===s||A===r){continue}if(e.PolyK._PointInTriangle(o[2*A],o[2*A+1],l,h,z,x,g,f)){k=false;break}}}if(k){y.push(u,s,r);m.splice((w+1)%t,1);t--;w=0}else{if(w++>3*t){if(B){y=[];m=[];for(w=0;w<q;w++){m.push(w)}w=0;t=q;B=false}else{window.console.log("PIXI Warning: shape too complex to fill");return[]}}}}y.push(m[0],m[1],m[2]);return y};e.PolyK._PointInTriangle=function(t,s,p,o,C,B,l,j){var i=l-p;var h=j-o;var n=C-p;var m=B-o;var A=t-p;var y=s-o;var z=i*i+h*h;var x=i*n+h*m;var w=i*A+h*y;var g=n*n+m*m;var f=n*A+m*y;var k=1/(z*g-x*x);var r=(g*w-x*f)*k;var q=(z*f-x*w)*k;return(r>=0)&&(q>=0)&&(r+q<1)};e.PolyK._convex=function(i,h,k,j,f,l,g){return((h-j)*(f-k)+(k-i)*(l-j)>=0)===g};e.initDefaultShaders=function(){};e.CompileVertexShader=function(g,f){return e._CompileShader(g,f,g.VERTEX_SHADER)};e.CompileFragmentShader=function(g,f){return e._CompileShader(g,f,g.FRAGMENT_SHADER)};e._CompileShader=function(j,i,h){var g=i.join("\n");var f=j.createShader(h);j.shaderSource(f,g);j.compileShader(f);if(!j.getShaderParameter(f,j.COMPILE_STATUS)){window.console.log(j.getShaderInfoLog(f));return null}return f};e.compileProgram=function(j,f,h){var g=e.CompileFragmentShader(j,h);var i=e.CompileVertexShader(j,f);var k=j.createProgram();j.attachShader(k,i);j.attachShader(k,g);j.linkProgram(k);if(!j.getProgramParameter(k,j.LINK_STATUS)){window.console.log("Could not initialise shaders")}return k};e.PixiShader=function(f){this._UID=e._UID++;this.gl=f;this.program=null;this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"];this.textureCount=0;this.attributes=[];this.init()};e.PixiShader.prototype.init=function(){var h=this.gl;var f=e.compileProgram(h,this.vertexSrc||e.PixiShader.defaultVertexSrc,this.fragmentSrc);h.useProgram(f);this.uSampler=h.getUniformLocation(f,"uSampler");this.projectionVector=h.getUniformLocation(f,"projectionVector");this.offsetVector=h.getUniformLocation(f,"offsetVector");this.dimensions=h.getUniformLocation(f,"dimensions");this.aVertexPosition=h.getAttribLocation(f,"aVertexPosition");this.aTextureCoord=h.getAttribLocation(f,"aTextureCoord");this.colorAttribute=h.getAttribLocation(f,"aColor");if(this.colorAttribute===-1){this.colorAttribute=2}this.attributes=[this.aVertexPosition,this.aTextureCoord,this.colorAttribute];for(var g in this.uniforms){this.uniforms[g].uniformLocation=h.getUniformLocation(f,g)}this.initUniforms();this.program=f};e.PixiShader.prototype.initUniforms=function(){this.textureCount=1;var i=this.gl;var f;for(var g in this.uniforms){f=this.uniforms[g];var h=f.type;if(h==="sampler2D"){f._init=false;if(f.value!==null){this.initSampler2D(f)}}else{if(h==="mat2"||h==="mat3"||h==="mat4"){f.glMatrix=true;f.glValueLength=1;if(h==="mat2"){f.glFunc=i.uniformMatrix2fv}else{if(h==="mat3"){f.glFunc=i.uniformMatrix3fv}else{if(h==="mat4"){f.glFunc=i.uniformMatrix4fv}}}}else{f.glFunc=i["uniform"+h];if(h==="2f"||h==="2i"){f.glValueLength=2}else{if(h==="3f"||h==="3i"){f.glValueLength=3}else{if(h==="4f"||h==="4i"){f.glValueLength=4}else{f.glValueLength=1}}}}}}};e.PixiShader.prototype.initSampler2D=function(h){if(!h.value||!h.value.baseTexture||!h.value.baseTexture.hasLoaded){return}var m=this.gl;m.activeTexture(m["TEXTURE"+this.textureCount]);m.bindTexture(m.TEXTURE_2D,h.value.baseTexture._glTextures[m.id]);if(h.textureData){var k=h.textureData;var o=(k.magFilter)?k.magFilter:m.LINEAR;var g=(k.minFilter)?k.minFilter:m.LINEAR;var l=(k.wrapS)?k.wrapS:m.CLAMP_TO_EDGE;var j=(k.wrapT)?k.wrapT:m.CLAMP_TO_EDGE;var n=(k.luminance)?m.LUMINANCE:m.RGBA;if(k.repeat){l=m.REPEAT;j=m.REPEAT}m.pixelStorei(m.UNPACK_FLIP_Y_WEBGL,!!k.flipY);if(k.width){var f=(k.width)?k.width:512;var p=(k.height)?k.height:2;var i=(k.border)?k.border:0;m.texImage2D(m.TEXTURE_2D,0,n,f,p,i,n,m.UNSIGNED_BYTE,null)}else{m.texImage2D(m.TEXTURE_2D,0,n,m.RGBA,m.UNSIGNED_BYTE,h.value.baseTexture.source)}m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,o);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,g);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,l);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,j)}m.uniform1i(h.uniformLocation,this.textureCount);h._init=true;this.textureCount++};e.PixiShader.prototype.syncUniforms=function(){this.textureCount=1;var f;var h=this.gl;for(var g in this.uniforms){f=this.uniforms[g];if(f.glValueLength===1){if(f.glMatrix===true){f.glFunc.call(h,f.uniformLocation,f.transpose,f.value)}else{f.glFunc.call(h,f.uniformLocation,f.value)}}else{if(f.glValueLength===2){f.glFunc.call(h,f.uniformLocation,f.value.x,f.value.y)}else{if(f.glValueLength===3){f.glFunc.call(h,f.uniformLocation,f.value.x,f.value.y,f.value.z)}else{if(f.glValueLength===4){f.glFunc.call(h,f.uniformLocation,f.value.x,f.value.y,f.value.z,f.value.w)}else{if(f.type==="sampler2D"){if(f._init){h.activeTexture(h["TEXTURE"+this.textureCount]);h.bindTexture(h.TEXTURE_2D,f.value.baseTexture._glTextures[h.id]||e.createWebGLTexture(f.value.baseTexture,h));h.uniform1i(f.uniformLocation,this.textureCount);this.textureCount++}else{this.initSampler2D(f)}}}}}}}};e.PixiShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.uniforms=null;this.gl=null;this.attributes=null};e.PixiShader.defaultVertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec2 aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","varying vec4 vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   gl_Position = vec4( ((aVertexPosition + offsetVector) / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vec3 color = mod(vec3(aColor.y/65536.0, aColor.y/256.0, aColor.y), 256.0) / 256.0;","   vColor = vec4(color * aColor.x, aColor.x);","}"];e.PixiFastShader=function(f){this._UID=e._UID++;this.gl=f;this.program=null;this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying float vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"];this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aPositionCoord;","attribute vec2 aScale;","attribute float aRotation;","attribute vec2 aTextureCoord;","attribute float aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform mat3 uMatrix;","varying vec2 vTextureCoord;","varying float vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   vec2 v;","   vec2 sv = aVertexPosition * aScale;","   v.x = (sv.x) * cos(aRotation) - (sv.y) * sin(aRotation);","   v.y = (sv.x) * sin(aRotation) + (sv.y) * cos(aRotation);","   v = ( uMatrix * vec3(v + aPositionCoord , 1.0) ).xy ;","   gl_Position = vec4( ( v / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = aColor;","}"];this.textureCount=0;this.init()};e.PixiFastShader.prototype.init=function(){var g=this.gl;var f=e.compileProgram(g,this.vertexSrc,this.fragmentSrc);g.useProgram(f);this.uSampler=g.getUniformLocation(f,"uSampler");this.projectionVector=g.getUniformLocation(f,"projectionVector");this.offsetVector=g.getUniformLocation(f,"offsetVector");this.dimensions=g.getUniformLocation(f,"dimensions");this.uMatrix=g.getUniformLocation(f,"uMatrix");this.aVertexPosition=g.getAttribLocation(f,"aVertexPosition");this.aPositionCoord=g.getAttribLocation(f,"aPositionCoord");this.aScale=g.getAttribLocation(f,"aScale");this.aRotation=g.getAttribLocation(f,"aRotation");this.aTextureCoord=g.getAttribLocation(f,"aTextureCoord");this.colorAttribute=g.getAttribLocation(f,"aColor");if(this.colorAttribute===-1){this.colorAttribute=2}this.attributes=[this.aVertexPosition,this.aPositionCoord,this.aScale,this.aRotation,this.aTextureCoord,this.colorAttribute];this.program=f};e.PixiFastShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.uniforms=null;this.gl=null;this.attributes=null};e.StripShader=function(f){this._UID=e._UID++;this.gl=f;this.program=null;this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","uniform float alpha;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y));","}"];this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","}"];this.init()};e.StripShader.prototype.init=function(){var g=this.gl;var f=e.compileProgram(g,this.vertexSrc,this.fragmentSrc);g.useProgram(f);this.uSampler=g.getUniformLocation(f,"uSampler");this.projectionVector=g.getUniformLocation(f,"projectionVector");this.offsetVector=g.getUniformLocation(f,"offsetVector");this.colorAttribute=g.getAttribLocation(f,"aColor");this.aVertexPosition=g.getAttribLocation(f,"aVertexPosition");this.aTextureCoord=g.getAttribLocation(f,"aTextureCoord");this.attributes=[this.aVertexPosition,this.aTextureCoord];this.translationMatrix=g.getUniformLocation(f,"translationMatrix");this.alpha=g.getUniformLocation(f,"alpha");this.program=f};e.PrimitiveShader=function(f){this._UID=e._UID++;this.gl=f;this.program=null;this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"];this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec4 aColor;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform float alpha;","uniform vec3 tint;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","   vColor = aColor * vec4(tint * alpha, alpha);","}"];this.init()};e.PrimitiveShader.prototype.init=function(){var g=this.gl;var f=e.compileProgram(g,this.vertexSrc,this.fragmentSrc);g.useProgram(f);this.projectionVector=g.getUniformLocation(f,"projectionVector");this.offsetVector=g.getUniformLocation(f,"offsetVector");this.tintColor=g.getUniformLocation(f,"tint");this.aVertexPosition=g.getAttribLocation(f,"aVertexPosition");this.colorAttribute=g.getAttribLocation(f,"aColor");this.attributes=[this.aVertexPosition,this.colorAttribute];this.translationMatrix=g.getUniformLocation(f,"translationMatrix");this.alpha=g.getUniformLocation(f,"alpha");this.program=f};e.PrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.uniforms=null;this.gl=null;this.attribute=null};e.ComplexPrimitiveShader=function(f){this._UID=e._UID++;this.gl=f;this.program=null;this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"];this.vertexSrc=["attribute vec2 aVertexPosition;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform vec3 tint;","uniform float alpha;","uniform vec3 color;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","   vColor = vec4(color * alpha * tint, alpha);","}"];this.init()};e.ComplexPrimitiveShader.prototype.init=function(){var g=this.gl;var f=e.compileProgram(g,this.vertexSrc,this.fragmentSrc);g.useProgram(f);this.projectionVector=g.getUniformLocation(f,"projectionVector");this.offsetVector=g.getUniformLocation(f,"offsetVector");this.tintColor=g.getUniformLocation(f,"tint");this.color=g.getUniformLocation(f,"color");this.aVertexPosition=g.getAttribLocation(f,"aVertexPosition");this.attributes=[this.aVertexPosition,this.colorAttribute];this.translationMatrix=g.getUniformLocation(f,"translationMatrix");this.alpha=g.getUniformLocation(f,"alpha");this.program=f};e.ComplexPrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.uniforms=null;this.gl=null;this.attribute=null};e.WebGLGraphics=function(){};e.WebGLGraphics.renderGraphics=function(n,o){var h=o.gl;var l=o.projection,f=o.offset,k=o.shaderManager.primitiveShader,j;if(n.dirty){e.WebGLGraphics.updateGraphics(n,h)}var m=n._webGL[h.id];for(var g=0;g<m.data.length;g++){if(m.data[g].mode===1){j=m.data[g];o.stencilManager.pushStencil(n,j,o);h.drawElements(h.TRIANGLE_FAN,4,h.UNSIGNED_SHORT,(j.indices.length-4)*2);o.stencilManager.popStencil(n,j,o);this.last=j.mode}else{j=m.data[g];o.shaderManager.setShader(k);k=o.shaderManager.primitiveShader;h.uniformMatrix3fv(k.translationMatrix,false,n.worldTransform.toArray(true));h.uniform2f(k.projectionVector,l.x,-l.y);h.uniform2f(k.offsetVector,-f.x,-f.y);h.uniform3fv(k.tintColor,e.hex2rgb(n.tint));h.uniform1f(k.alpha,n.worldAlpha);h.bindBuffer(h.ARRAY_BUFFER,j.buffer);h.vertexAttribPointer(k.aVertexPosition,2,h.FLOAT,false,4*6,0);h.vertexAttribPointer(k.colorAttribute,4,h.FLOAT,false,4*6,2*4);h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,j.indexBuffer);h.drawElements(h.TRIANGLE_STRIP,j.indices.length,h.UNSIGNED_SHORT,0)}}};e.WebGLGraphics.updateGraphics=function(f,l){var j=f._webGL[l.id];if(!j){j=f._webGL[l.id]={lastIndex:0,data:[],gl:l}}f.dirty=false;var g;if(f.clearDirty){f.clearDirty=false;for(g=0;g<j.data.length;g++){var m=j.data[g];m.reset();e.WebGLGraphics.graphicsDataPool.push(m)}j.data=[];j.lastIndex=0}var k;for(g=j.lastIndex;g<f.graphicsData.length;g++){var h=f.graphicsData[g];if(h.type===e.Graphics.POLY){if(h.fill){if(h.points.length>6){if(h.points.length>5*2){k=e.WebGLGraphics.switchMode(j,1);e.WebGLGraphics.buildComplexPoly(h,k)}else{k=e.WebGLGraphics.switchMode(j,0);e.WebGLGraphics.buildPoly(h,k)}}}if(h.lineWidth>0){k=e.WebGLGraphics.switchMode(j,0);e.WebGLGraphics.buildLine(h,k)}}else{k=e.WebGLGraphics.switchMode(j,0);if(h.type===e.Graphics.RECT){e.WebGLGraphics.buildRectangle(h,k)}else{if(h.type===e.Graphics.CIRC||h.type===e.Graphics.ELIP){e.WebGLGraphics.buildCircle(h,k)}else{if(h.type===e.Graphics.RREC){e.WebGLGraphics.buildRoundedRectangle(h,k)}}}}j.lastIndex++}for(g=0;g<j.data.length;g++){k=j.data[g];if(k.dirty){k.upload()}}};e.WebGLGraphics.switchMode=function(g,f){var h;if(!g.data.length){h=e.WebGLGraphics.graphicsDataPool.pop()||new e.WebGLGraphicsData(g.gl);h.mode=f;g.data.push(h)}else{h=g.data[g.data.length-1];if(h.mode!==f||f===1){h=e.WebGLGraphics.graphicsDataPool.pop()||new e.WebGLGraphicsData(g.gl);h.mode=f;g.data.push(h)}}h.dirty=true;return h};e.WebGLGraphics.buildRectangle=function(w,l){var j=w.points;var s=j[0];var q=j[1];var h=j[2];var v=j[3];if(w.fill){var k=e.hex2rgb(w.fillColor);var i=w.fillAlpha;var f=k[0]*i;var m=k[1]*i;var p=k[2]*i;var t=l.points;var u=l.indices;var o=t.length/6;t.push(s,q);t.push(f,m,p,i);t.push(s+h,q);t.push(f,m,p,i);t.push(s,q+v);t.push(f,m,p,i);t.push(s+h,q+v);t.push(f,m,p,i);u.push(o,o,o+1,o+2,o+3,o+3)}if(w.lineWidth){var n=w.points;w.points=[s,q,s+h,q,s+h,q+v,s,q+v,s,q];e.WebGLGraphics.buildLine(w,l);w.points=n}};e.WebGLGraphics.buildRoundedRectangle=function(o,D){var z=o.points;var n=z[0];var m=z[1];var t=z[2];var s=z[3];var h=z[4];var p=[];p.push(n,m+h);p=p.concat(e.WebGLGraphics.quadraticBezierCurve(n,m+s-h,n,m+s,n+h,m+s));p=p.concat(e.WebGLGraphics.quadraticBezierCurve(n+t-h,m+s,n+t,m+s,n+t,m+s-h));p=p.concat(e.WebGLGraphics.quadraticBezierCurve(n+t,m+h,n+t,m,n+t-h,m));p=p.concat(e.WebGLGraphics.quadraticBezierCurve(n+h,m,n,m,n,m+h));if(o.fill){var v=e.hex2rgb(o.fillColor);var j=o.fillAlpha;var q=v[0]*j;var A=v[1]*j;var B=v[2]*j;var C=D.points;var k=D.indices;var f=C.length/6;var u=e.PolyK.Triangulate(p);var w=0;for(w=0;w<u.length;w+=3){k.push(u[w]+f);k.push(u[w]+f);k.push(u[w+1]+f);k.push(u[w+2]+f);k.push(u[w+2]+f)}for(w=0;w<p.length;w++){C.push(p[w],p[++w],q,A,B,j)}}if(o.lineWidth){var l=o.points;o.points=p;e.WebGLGraphics.buildLine(o,D);o.points=l}};e.WebGLGraphics.quadraticBezierCurve=function(v,r,t,o,w,s){var g,p,A,m,u,q,h=20,z=[];function f(n,j,i){var x=j-n;return n+(x*i)}var k=0;for(var l=0;l<=h;l++){k=l/h;g=f(v,t,k);p=f(r,o,k);A=f(t,w,k);m=f(o,s,k);u=f(g,A,k);q=f(p,m,k);z.push(u,q)}return z};e.WebGLGraphics.buildCircle=function(o,C){var k=o.points;var n=k[0];var m=k[1];var t=k[2];var s=k[3];var p=40;var z=(Math.PI*2)/p;var v=0;if(o.fill){var u=e.hex2rgb(o.fillColor);var h=o.fillAlpha;var q=u[0]*h;var w=u[1]*h;var A=u[2]*h;var B=C.points;var j=C.indices;var f=B.length/6;j.push(f);for(v=0;v<p+1;v++){B.push(n,m,q,w,A,h);B.push(n+Math.sin(z*v)*t,m+Math.cos(z*v)*s,q,w,A,h);j.push(f++,f++)}j.push(f-1)}if(o.lineWidth){var l=o.points;o.points=[];for(v=0;v<p+1;v++){o.points.push(n+Math.sin(z*v)*t,m+Math.cos(z*v)*s)}e.WebGLGraphics.buildLine(o,C);o.points=l}};e.WebGLGraphics.buildLine=function(V,F){var R=0;var I=V.points;if(I.length===0){return}if(V.lineWidth%2){for(R=0;R<I.length;R++){I[R]+=0.5}}var w=new e.Point(I[0],I[1]);var o=new e.Point(I[I.length-2],I[I.length-1]);if(w.x===o.x&&w.y===o.y){I=I.slice();I.pop();I.pop();o=new e.Point(I[I.length-2],I[I.length-1]);var y=o.x+(w.x-o.x)*0.5;var v=o.y+(w.y-o.y)*0.5;I.unshift(y,v);I.push(y,v)}var S=F.points;var m=F.indices;var x=I.length/2;var u=I.length;var U=S.length/6;var f=V.lineWidth/2;var H=e.hex2rgb(V.lineColor);var Q=V.lineAlpha;var N=H[0]*Q;var T=H[1]*Q;var W=H[2]*Q;var t,s,K,J,C,B,l,k;var M,L,A,z,j,h;var P,G,q,O,E,p;var X,D,n;K=I[0];J=I[1];C=I[2];B=I[3];M=-(J-B);L=K-C;n=Math.sqrt(M*M+L*L);M/=n;L/=n;M*=f;L*=f;S.push(K-M,J-L,N,T,W,Q);S.push(K+M,J+L,N,T,W,Q);for(R=1;R<x-1;R++){K=I[(R-1)*2];J=I[(R-1)*2+1];C=I[(R)*2];B=I[(R)*2+1];l=I[(R+1)*2];k=I[(R+1)*2+1];M=-(J-B);L=K-C;n=Math.sqrt(M*M+L*L);M/=n;L/=n;M*=f;L*=f;A=-(B-k);z=C-l;n=Math.sqrt(A*A+z*z);A/=n;z/=n;A*=f;z*=f;P=(-L+J)-(-L+B);G=(-M+C)-(-M+K);q=(-M+K)*(-L+B)-(-M+C)*(-L+J);O=(-z+k)-(-z+B);E=(-A+C)-(-A+l);p=(-A+l)*(-z+B)-(-A+C)*(-z+k);X=P*E-O*G;if(Math.abs(X)<0.1){X+=10.1;S.push(C-M,B-L,N,T,W,Q);S.push(C+M,B+L,N,T,W,Q);continue}t=(G*p-E*q)/X;s=(O*q-P*p)/X;D=(t-C)*(t-C)+(s-B)+(s-B);if(D>140*140){j=M-A;h=L-z;n=Math.sqrt(j*j+h*h);j/=n;h/=n;j*=f;h*=f;S.push(C-j,B-h);S.push(N,T,W,Q);S.push(C+j,B+h);S.push(N,T,W,Q);S.push(C-j,B-h);S.push(N,T,W,Q);u++}else{S.push(t,s);S.push(N,T,W,Q);S.push(C-(t-C),B-(s-B));S.push(N,T,W,Q)}}K=I[(x-2)*2];J=I[(x-2)*2+1];C=I[(x-1)*2];B=I[(x-1)*2+1];M=-(J-B);L=K-C;n=Math.sqrt(M*M+L*L);M/=n;L/=n;M*=f;L*=f;S.push(C-M,B-L);S.push(N,T,W,Q);S.push(C+M,B+L);S.push(N,T,W,Q);m.push(U);for(R=0;R<u;R++){m.push(U++)}m.push(U-1)};e.WebGLGraphics.buildComplexPoly=function(r,m){var p=r.points.slice();if(p.length<6){return}var q=m.indices;m.points=p;m.alpha=r.fillAlpha;m.color=e.hex2rgb(r.fillColor);var k=Infinity;var g=-Infinity;var j=Infinity;var f=-Infinity;var o,n;for(var l=0;l<p.length;l+=2){o=p[l];n=p[l+1];k=o<k?o:k;g=o>g?o:g;j=n<j?n:j;f=n>f?n:f}p.push(k,j,g,j,g,f,k,f);var h=p.length/2;for(l=0;l<h;l++){q.push(l)}};e.WebGLGraphics.buildPoly=function(v,n){var t=v.points;if(t.length<6){return}var s=n.points;var u=n.indices;var h=t.length/2;var l=e.hex2rgb(v.fillColor);var k=v.fillAlpha;var f=l[0]*k;var o=l[1]*k;var q=l[2]*k;var j=e.PolyK.Triangulate(t);var p=s.length/6;var m=0;for(m=0;m<j.length;m+=3){u.push(j[m]+p);u.push(j[m]+p);u.push(j[m+1]+p);u.push(j[m+2]+p);u.push(j[m+2]+p)}for(m=0;m<h;m++){s.push(t[m*2],t[m*2+1],f,o,q,k)}};e.WebGLGraphics.graphicsDataPool=[];e.WebGLGraphicsData=function(f){this.gl=f;this.color=[0,0,0];this.points=[];this.indices=[];this.lastIndex=0;this.buffer=f.createBuffer();this.indexBuffer=f.createBuffer();this.mode=1;this.alpha=1;this.dirty=true};e.WebGLGraphicsData.prototype.reset=function(){this.points=[];this.indices=[];this.lastIndex=0};e.WebGLGraphicsData.prototype.upload=function(){var f=this.gl;this.glPoints=new Float32Array(this.points);f.bindBuffer(f.ARRAY_BUFFER,this.buffer);f.bufferData(f.ARRAY_BUFFER,this.glPoints,f.STATIC_DRAW);this.glIndicies=new Uint16Array(this.indices);f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,this.indexBuffer);f.bufferData(f.ELEMENT_ARRAY_BUFFER,this.glIndicies,f.STATIC_DRAW);this.dirty=false};e.glContexts=[];e.WebGLRenderer=function(j,f,h,l,g,i){if(!e.defaultRenderer){e.sayHello("webGL");e.defaultRenderer=this}this.type=e.WEBGL_RENDERER;this.transparent=!!l;this.preserveDrawingBuffer=i;this.width=j||800;this.height=f||600;this.view=h||document.createElement("canvas");this.view.width=this.width;this.view.height=this.height;this.contextLost=this.handleContextLost.bind(this);this.contextRestoredLost=this.handleContextRestored.bind(this);this.view.addEventListener("webglcontextlost",this.contextLost,false);this.view.addEventListener("webglcontextrestored",this.contextRestoredLost,false);this.options={alpha:this.transparent,antialias:!!g,premultipliedAlpha:!!l,stencil:true,preserveDrawingBuffer:i};var k=null;["experimental-webgl","webgl"].forEach(function(m){try{k=k||this.view.getContext(m,this.options)}catch(n){}},this);if(!k){throw new Error("This browser does not support webGL. Try using the canvas renderer"+this)}this.gl=k;this.glContextId=k.id=e.WebGLRenderer.glContextId++;e.glContexts[this.glContextId]=k;if(!e.blendModesWebGL){e.blendModesWebGL=[];e.blendModesWebGL[e.blendModes.NORMAL]=[k.ONE,k.ONE_MINUS_SRC_ALPHA];e.blendModesWebGL[e.blendModes.ADD]=[k.SRC_ALPHA,k.DST_ALPHA];e.blendModesWebGL[e.blendModes.MULTIPLY]=[k.DST_COLOR,k.ONE_MINUS_SRC_ALPHA];e.blendModesWebGL[e.blendModes.SCREEN]=[k.SRC_ALPHA,k.ONE];e.blendModesWebGL[e.blendModes.OVERLAY]=[k.ONE,k.ONE_MINUS_SRC_ALPHA];e.blendModesWebGL[e.blendModes.DARKEN]=[k.ONE,k.ONE_MINUS_SRC_ALPHA];e.blendModesWebGL[e.blendModes.LIGHTEN]=[k.ONE,k.ONE_MINUS_SRC_ALPHA];e.blendModesWebGL[e.blendModes.COLOR_DODGE]=[k.ONE,k.ONE_MINUS_SRC_ALPHA];e.blendModesWebGL[e.blendModes.COLOR_BURN]=[k.ONE,k.ONE_MINUS_SRC_ALPHA];e.blendModesWebGL[e.blendModes.HARD_LIGHT]=[k.ONE,k.ONE_MINUS_SRC_ALPHA];e.blendModesWebGL[e.blendModes.SOFT_LIGHT]=[k.ONE,k.ONE_MINUS_SRC_ALPHA];e.blendModesWebGL[e.blendModes.DIFFERENCE]=[k.ONE,k.ONE_MINUS_SRC_ALPHA];e.blendModesWebGL[e.blendModes.EXCLUSION]=[k.ONE,k.ONE_MINUS_SRC_ALPHA];e.blendModesWebGL[e.blendModes.HUE]=[k.ONE,k.ONE_MINUS_SRC_ALPHA];e.blendModesWebGL[e.blendModes.SATURATION]=[k.ONE,k.ONE_MINUS_SRC_ALPHA];e.blendModesWebGL[e.blendModes.COLOR]=[k.ONE,k.ONE_MINUS_SRC_ALPHA];e.blendModesWebGL[e.blendModes.LUMINOSITY]=[k.ONE,k.ONE_MINUS_SRC_ALPHA]}this.projection=new e.Point();this.projection.x=this.width/2;this.projection.y=-this.height/2;this.offset=new e.Point(0,0);this.resize(this.width,this.height);this.contextLost=false;this.shaderManager=new e.WebGLShaderManager(k);this.spriteBatch=new e.WebGLSpriteBatch(k);this.maskManager=new e.WebGLMaskManager(k);this.filterManager=new e.WebGLFilterManager(k,this.transparent);this.stencilManager=new e.WebGLStencilManager(k);this.blendModeManager=new e.WebGLBlendModeManager(k);this.renderSession={};this.renderSession.gl=this.gl;this.renderSession.drawCount=0;this.renderSession.shaderManager=this.shaderManager;this.renderSession.maskManager=this.maskManager;this.renderSession.filterManager=this.filterManager;this.renderSession.blendModeManager=this.blendModeManager;this.renderSession.spriteBatch=this.spriteBatch;this.renderSession.stencilManager=this.stencilManager;this.renderSession.renderer=this;k.useProgram(this.shaderManager.defaultShader.program);k.disable(k.DEPTH_TEST);k.disable(k.CULL_FACE);k.enable(k.BLEND);k.colorMask(true,true,true,this.transparent)};e.WebGLRenderer.prototype.constructor=e.WebGLRenderer;e.WebGLRenderer.prototype.render=function(f){if(this.contextLost){return}if(this.__stage!==f){if(f.interactive){f.interactionManager.removeEvents()}this.__stage=f}e.WebGLRenderer.updateTextures();f.updateTransform();if(f._interactive){if(!f._interactiveEventsAdded){f._interactiveEventsAdded=true;f.interactionManager.setTarget(this)}}var g=this.gl;g.viewport(0,0,this.width,this.height);g.bindFramebuffer(g.FRAMEBUFFER,null);if(this.transparent){g.clearColor(0,0,0,0)}else{g.clearColor(f.backgroundColorSplit[0],f.backgroundColorSplit[1],f.backgroundColorSplit[2],1)}g.clear(g.COLOR_BUFFER_BIT);this.renderDisplayObject(f,this.projection);if(f.interactive){if(!f._interactiveEventsAdded){f._interactiveEventsAdded=true;f.interactionManager.setTarget(this)}}else{if(f._interactiveEventsAdded){f._interactiveEventsAdded=false;f.interactionManager.setTarget(this)}}};e.WebGLRenderer.prototype.renderDisplayObject=function(h,f,g){this.renderSession.blendModeManager.setBlendMode(e.blendModes.NORMAL);this.renderSession.drawCount=0;this.renderSession.currentBlendMode=9999;this.renderSession.projection=f;this.renderSession.offset=this.offset;this.spriteBatch.begin(this.renderSession);this.filterManager.begin(this.renderSession,g);h._renderWebGL(this.renderSession);this.spriteBatch.end()};e.WebGLRenderer.updateTextures=function(){var f=0;for(f=0;f<e.Texture.frameUpdates.length;f++){e.WebGLRenderer.updateTextureFrame(e.Texture.frameUpdates[f])}for(f=0;f<e.texturesToDestroy.length;f++){e.WebGLRenderer.destroyTexture(e.texturesToDestroy[f])}e.texturesToUpdate.length=0;e.texturesToDestroy.length=0;e.Texture.frameUpdates.length=0};e.WebGLRenderer.destroyTexture=function(h){for(var g=h._glTextures.length-1;g>=0;g--){var f=h._glTextures[g];var j=e.glContexts[g];if(j&&f){j.deleteTexture(f)}}h._glTextures.length=0};e.WebGLRenderer.updateTextureFrame=function(f){f._updateWebGLuvs()};e.WebGLRenderer.prototype.resize=function(g,f){this.width=g;this.height=f;this.view.width=g;this.view.height=f;this.gl.viewport(0,0,this.width,this.height);this.projection.x=this.width/2;this.projection.y=-this.height/2};e.createWebGLTexture=function(f,g){if(f.hasLoaded){f._glTextures[g.id]=g.createTexture();g.bindTexture(g.TEXTURE_2D,f._glTextures[g.id]);g.pixelStorei(g.UNPACK_PREMULTIPLY_ALPHA_WEBGL,f.premultipliedAlpha);g.texImage2D(g.TEXTURE_2D,0,g.RGBA,g.RGBA,g.UNSIGNED_BYTE,f.source);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,f.scaleMode===e.scaleModes.LINEAR?g.LINEAR:g.NEAREST);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,f.scaleMode===e.scaleModes.LINEAR?g.LINEAR:g.NEAREST);if(!f._powerOf2){g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,g.CLAMP_TO_EDGE);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,g.CLAMP_TO_EDGE)}else{g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,g.REPEAT);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,g.REPEAT)}g.bindTexture(g.TEXTURE_2D,null);f._dirty[g.id]=false}return f._glTextures[g.id]};e.updateWebGLTexture=function(f,g){if(f._glTextures[g.id]){g.bindTexture(g.TEXTURE_2D,f._glTextures[g.id]);g.pixelStorei(g.UNPACK_PREMULTIPLY_ALPHA_WEBGL,f.premultipliedAlpha);g.texImage2D(g.TEXTURE_2D,0,g.RGBA,g.RGBA,g.UNSIGNED_BYTE,f.source);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,f.scaleMode===e.scaleModes.LINEAR?g.LINEAR:g.NEAREST);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,f.scaleMode===e.scaleModes.LINEAR?g.LINEAR:g.NEAREST);if(!f._powerOf2){g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,g.CLAMP_TO_EDGE);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,g.CLAMP_TO_EDGE)}else{g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,g.REPEAT);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,g.REPEAT)}f._dirty[g.id]=false}};e.WebGLRenderer.prototype.handleContextLost=function(f){f.preventDefault();this.contextLost=true};e.WebGLRenderer.prototype.handleContextRestored=function(){try{this.gl=this.view.getContext("experimental-webgl",this.options)}catch(i){try{this.gl=this.view.getContext("webgl",this.options)}catch(h){throw new Error(" This browser does not support webGL. Try using the canvas renderer"+this)}}var j=this.gl;j.id=e.WebGLRenderer.glContextId++;this.shaderManager.setContext(j);this.spriteBatch.setContext(j);this.primitiveBatch.setContext(j);this.maskManager.setContext(j);this.filterManager.setContext(j);this.renderSession.gl=this.gl;j.disable(j.DEPTH_TEST);j.disable(j.CULL_FACE);j.enable(j.BLEND);j.colorMask(true,true,true,this.transparent);this.gl.viewport(0,0,this.width,this.height);for(var f in e.TextureCache){var g=e.TextureCache[f].baseTexture;g._glTextures=[]}this.contextLost=false};e.WebGLRenderer.prototype.destroy=function(){this.view.removeEventListener("webglcontextlost",this.contextLost);this.view.removeEventListener("webglcontextrestored",this.contextRestoredLost);e.glContexts[this.glContextId]=null;this.projection=null;this.offset=null;this.shaderManager.destroy();this.spriteBatch.destroy();this.primitiveBatch.destroy();this.maskManager.destroy();this.filterManager.destroy();this.shaderManager=null;this.spriteBatch=null;this.maskManager=null;this.filterManager=null;this.gl=null;this.renderSession=null};e.WebGLRenderer.glContextId=0;e.WebGLBlendModeManager=function(f){this.gl=f;this.currentBlendMode=99999};e.WebGLBlendModeManager.prototype.setBlendMode=function(f){if(this.currentBlendMode===f){return false}this.currentBlendMode=f;var g=e.blendModesWebGL[this.currentBlendMode];this.gl.blendFunc(g[0],g[1]);return true};e.WebGLBlendModeManager.prototype.destroy=function(){this.gl=null};e.WebGLMaskManager=function(f){this.maskStack=[];this.maskPosition=0;this.setContext(f);this.reverse=false;this.count=0};e.WebGLMaskManager.prototype.setContext=function(f){this.gl=f};e.WebGLMaskManager.prototype.pushMask=function(g,f){var h=f.gl;if(g.dirty){e.WebGLGraphics.updateGraphics(g,h)}if(!g._webGL[h.id].data.length){return}f.stencilManager.pushStencil(g,g._webGL[h.id].data[0],f)};e.WebGLMaskManager.prototype.popMask=function(g,f){var h=this.gl;f.stencilManager.popStencil(g,g._webGL[h.id].data[0],f)};e.WebGLMaskManager.prototype.destroy=function(){this.maskStack=null;this.gl=null};e.WebGLStencilManager=function(f){this.stencilStack=[];this.setContext(f);this.reverse=true;this.count=0};e.WebGLStencilManager.prototype.setContext=function(f){this.gl=f};e.WebGLStencilManager.prototype.pushStencil=function(f,i,g){var h=this.gl;this.bindGraphics(f,i,g);if(this.stencilStack.length===0){h.enable(h.STENCIL_TEST);h.clear(h.STENCIL_BUFFER_BIT);this.reverse=true;this.count=0}this.stencilStack.push(i);var j=this.count;h.colorMask(false,false,false,false);h.stencilFunc(h.ALWAYS,0,255);h.stencilOp(h.KEEP,h.KEEP,h.INVERT);if(i.mode===1){h.drawElements(h.TRIANGLE_FAN,i.indices.length-4,h.UNSIGNED_SHORT,0);if(this.reverse){h.stencilFunc(h.EQUAL,255-j,255);h.stencilOp(h.KEEP,h.KEEP,h.DECR)}else{h.stencilFunc(h.EQUAL,j,255);h.stencilOp(h.KEEP,h.KEEP,h.INCR)}h.drawElements(h.TRIANGLE_FAN,4,h.UNSIGNED_SHORT,(i.indices.length-4)*2);if(this.reverse){h.stencilFunc(h.EQUAL,255-(j+1),255)}else{h.stencilFunc(h.EQUAL,j+1,255)}this.reverse=!this.reverse}else{if(!this.reverse){h.stencilFunc(h.EQUAL,255-j,255);h.stencilOp(h.KEEP,h.KEEP,h.DECR)}else{h.stencilFunc(h.EQUAL,j,255);h.stencilOp(h.KEEP,h.KEEP,h.INCR)}h.drawElements(h.TRIANGLE_STRIP,i.indices.length,h.UNSIGNED_SHORT,0);if(!this.reverse){h.stencilFunc(h.EQUAL,255-(j+1),255)}else{h.stencilFunc(h.EQUAL,j+1,255)}}h.colorMask(true,true,true,true);h.stencilOp(h.KEEP,h.KEEP,h.KEEP);this.count++};e.WebGLStencilManager.prototype.bindGraphics=function(g,l,i){this._currentGraphics=g;var k=this.gl;var f=i.projection,j=i.offset,h;if(l.mode===1){h=i.shaderManager.complexPrimativeShader;i.shaderManager.setShader(h);k.uniformMatrix3fv(h.translationMatrix,false,g.worldTransform.toArray(true));k.uniform2f(h.projectionVector,f.x,-f.y);k.uniform2f(h.offsetVector,-j.x,-j.y);k.uniform3fv(h.tintColor,e.hex2rgb(g.tint));k.uniform3fv(h.color,l.color);k.uniform1f(h.alpha,g.worldAlpha*l.alpha);k.bindBuffer(k.ARRAY_BUFFER,l.buffer);k.vertexAttribPointer(h.aVertexPosition,2,k.FLOAT,false,4*2,0);k.bindBuffer(k.ELEMENT_ARRAY_BUFFER,l.indexBuffer)}else{h=i.shaderManager.primitiveShader;i.shaderManager.setShader(h);k.uniformMatrix3fv(h.translationMatrix,false,g.worldTransform.toArray(true));k.uniform2f(h.projectionVector,f.x,-f.y);k.uniform2f(h.offsetVector,-j.x,-j.y);k.uniform3fv(h.tintColor,e.hex2rgb(g.tint));k.uniform1f(h.alpha,g.worldAlpha);k.bindBuffer(k.ARRAY_BUFFER,l.buffer);k.vertexAttribPointer(h.aVertexPosition,2,k.FLOAT,false,4*6,0);k.vertexAttribPointer(h.colorAttribute,4,k.FLOAT,false,4*6,2*4);k.bindBuffer(k.ELEMENT_ARRAY_BUFFER,l.indexBuffer)}};e.WebGLStencilManager.prototype.popStencil=function(f,i,g){var h=this.gl;this.stencilStack.pop();this.count--;if(this.stencilStack.length===0){h.disable(h.STENCIL_TEST)}else{var j=this.count;this.bindGraphics(f,i,g);h.colorMask(false,false,false,false);if(i.mode===1){this.reverse=!this.reverse;if(this.reverse){h.stencilFunc(h.EQUAL,255-(j+1),255);h.stencilOp(h.KEEP,h.KEEP,h.INCR)}else{h.stencilFunc(h.EQUAL,j+1,255);h.stencilOp(h.KEEP,h.KEEP,h.DECR)}h.drawElements(h.TRIANGLE_FAN,4,h.UNSIGNED_SHORT,(i.indices.length-4)*2);h.stencilFunc(h.ALWAYS,0,255);h.stencilOp(h.KEEP,h.KEEP,h.INVERT);h.drawElements(h.TRIANGLE_FAN,i.indices.length-4,h.UNSIGNED_SHORT,0);if(!this.reverse){h.stencilFunc(h.EQUAL,255-(j),255)}else{h.stencilFunc(h.EQUAL,j,255)}}else{if(!this.reverse){h.stencilFunc(h.EQUAL,255-(j+1),255);h.stencilOp(h.KEEP,h.KEEP,h.INCR)}else{h.stencilFunc(h.EQUAL,j+1,255);h.stencilOp(h.KEEP,h.KEEP,h.DECR)}h.drawElements(h.TRIANGLE_STRIP,i.indices.length,h.UNSIGNED_SHORT,0);if(!this.reverse){h.stencilFunc(h.EQUAL,255-(j),255)}else{h.stencilFunc(h.EQUAL,j,255)}}h.colorMask(true,true,true,true);h.stencilOp(h.KEEP,h.KEEP,h.KEEP)}};e.WebGLStencilManager.prototype.destroy=function(){this.maskStack=null;this.gl=null};e.WebGLShaderManager=function(g){this.maxAttibs=10;this.attribState=[];this.tempAttribState=[];this.shaderMap=[];for(var f=0;f<this.maxAttibs;f++){this.attribState[f]=false}this.setContext(g)};e.WebGLShaderManager.prototype.setContext=function(f){this.gl=f;this.primitiveShader=new e.PrimitiveShader(f);this.complexPrimativeShader=new e.ComplexPrimitiveShader(f);this.defaultShader=new e.PixiShader(f);this.fastShader=new e.PixiFastShader(f);this.stripShader=new e.StripShader(f);this.setShader(this.defaultShader)};e.WebGLShaderManager.prototype.setAttribs=function(j){var g;for(g=0;g<this.tempAttribState.length;g++){this.tempAttribState[g]=false}for(g=0;g<j.length;g++){var f=j[g];this.tempAttribState[f]=true}var h=this.gl;for(g=0;g<this.attribState.length;g++){if(this.attribState[g]!==this.tempAttribState[g]){this.attribState[g]=this.tempAttribState[g];if(this.tempAttribState[g]){h.enableVertexAttribArray(g)}else{h.disableVertexAttribArray(g)}}}};e.WebGLShaderManager.prototype.setShader=function(f){if(this._currentId===f._UID){return false}this._currentId=f._UID;this.currentShader=f;this.gl.useProgram(f.program);this.setAttribs(f.attributes);return true};e.WebGLShaderManager.prototype.destroy=function(){this.attribState=null;this.tempAttribState=null;this.primitiveShader.destroy();this.defaultShader.destroy();this.fastShader.destroy();this.stripShader.destroy();this.gl=null};e.WebGLSpriteBatch=function(l){this.vertSize=6;this.size=2000;var f=this.size*4*this.vertSize;var k=this.size*6;this.vertices=new Float32Array(f);this.indices=new Uint16Array(k);this.lastIndexCount=0;for(var h=0,g=0;h<k;h+=6,g+=4){this.indices[h+0]=g+0;this.indices[h+1]=g+1;this.indices[h+2]=g+2;this.indices[h+3]=g+0;this.indices[h+4]=g+2;this.indices[h+5]=g+3}this.drawing=false;this.currentBatchSize=0;this.currentBaseTexture=null;this.setContext(l);this.dirty=true;this.textures=[];this.blendModes=[]};e.WebGLSpriteBatch.prototype.setContext=function(f){this.gl=f;this.vertexBuffer=f.createBuffer();this.indexBuffer=f.createBuffer();f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,this.indexBuffer);f.bufferData(f.ELEMENT_ARRAY_BUFFER,this.indices,f.STATIC_DRAW);f.bindBuffer(f.ARRAY_BUFFER,this.vertexBuffer);f.bufferData(f.ARRAY_BUFFER,this.vertices,f.DYNAMIC_DRAW);this.currentBlendMode=99999};e.WebGLSpriteBatch.prototype.begin=function(f){this.renderSession=f;this.shader=this.renderSession.shaderManager.defaultShader;this.start()};e.WebGLSpriteBatch.prototype.end=function(){this.flush()};e.WebGLSpriteBatch.prototype.render=function(r){var q=r.texture;if(this.currentBatchSize>=this.size){this.flush();this.currentBaseTexture=q.baseTexture}var n=q._uvs;if(!n){return}var i=r.worldAlpha;var k=r.tint;var g=this.vertices;var h=r.anchor.x;var f=r.anchor.y;var p,o,m,l;if(q.trim){var t=q.trim;o=t.x-h*t.width;p=o+q.crop.width;l=t.y-f*t.height;m=l+q.crop.height}else{p=(q.frame.width)*(1-h);o=(q.frame.width)*-h;m=q.frame.height*(1-f);l=q.frame.height*-f}var j=this.currentBatchSize*4*this.vertSize;var s=r.worldTransform;var z=s.a;var x=s.c;var v=s.b;var u=s.d;var y=s.tx;var w=s.ty;g[j++]=z*o+v*l+y;g[j++]=u*l+x*o+w;g[j++]=n.x0;g[j++]=n.y0;g[j++]=i;g[j++]=k;g[j++]=z*p+v*l+y;g[j++]=u*l+x*p+w;g[j++]=n.x1;g[j++]=n.y1;g[j++]=i;g[j++]=k;g[j++]=z*p+v*m+y;g[j++]=u*m+x*p+w;g[j++]=n.x2;g[j++]=n.y2;g[j++]=i;g[j++]=k;g[j++]=z*o+v*m+y;g[j++]=u*m+x*o+w;g[j++]=n.x3;g[j++]=n.y3;g[j++]=i;g[j++]=k;this.textures[this.currentBatchSize]=r.texture.baseTexture;this.blendModes[this.currentBatchSize]=r.blendMode;this.currentBatchSize++};e.WebGLSpriteBatch.prototype.renderTilingSprite=function(h){var r=h.tilingTexture;if(this.currentBatchSize>=this.size){this.flush();this.currentBaseTexture=r.baseTexture}if(!h._uvs){h._uvs=new e.TextureUvs()}var o=h._uvs;h.tilePosition.x%=r.baseTexture.width*h.tileScaleOffset.x;h.tilePosition.y%=r.baseTexture.height*h.tileScaleOffset.y;var w=h.tilePosition.x/(r.baseTexture.width*h.tileScaleOffset.x);var v=h.tilePosition.y/(r.baseTexture.height*h.tileScaleOffset.y);var C=(h.width/r.baseTexture.width)/(h.tileScale.x*h.tileScaleOffset.x);var z=(h.height/r.baseTexture.height)/(h.tileScale.y*h.tileScaleOffset.y);o.x0=0-w;o.y0=0-v;o.x1=(1*C)-w;o.y1=0-v;o.x2=(1*C)-w;o.y2=(1*z)-v;o.x3=0-w;o.y3=(1*z)-v;var j=h.worldAlpha;var l=h.tint;var g=this.vertices;var t=h.width;var s=h.height;var i=h.anchor.x;var f=h.anchor.y;var q=t*(1-i);var p=t*-i;var n=s*(1-f);var m=s*-f;var k=this.currentBatchSize*4*this.vertSize;var u=h.worldTransform;var E=u.a;var B=u.c;var y=u.b;var x=u.d;var D=u.tx;var A=u.ty;g[k++]=E*p+y*m+D;g[k++]=x*m+B*p+A;g[k++]=o.x0;g[k++]=o.y0;g[k++]=j;g[k++]=l;g[k++]=(E*q+y*m+D);g[k++]=x*m+B*q+A;g[k++]=o.x1;g[k++]=o.y1;g[k++]=j;g[k++]=l;g[k++]=E*q+y*n+D;g[k++]=x*n+B*q+A;g[k++]=o.x2;g[k++]=o.y2;g[k++]=j;g[k++]=l;g[k++]=E*p+y*n+D;g[k++]=x*n+B*p+A;g[k++]=o.x3;g[k++]=o.y3;g[k++]=j;g[k++]=l;this.textures[this.currentBatchSize]=r.baseTexture;this.blendModes[this.currentBatchSize]=h.blendMode;this.currentBatchSize++};e.WebGLSpriteBatch.prototype.flush=function(){if(this.currentBatchSize===0){return}var n=this.gl;this.renderSession.shaderManager.setShader(this.renderSession.shaderManager.defaultShader);if(this.dirty){this.dirty=false;n.activeTexture(n.TEXTURE0);n.bindBuffer(n.ARRAY_BUFFER,this.vertexBuffer);n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var q=this.renderSession.projection;n.uniform2f(this.shader.projectionVector,q.x,q.y);var f=this.vertSize*4;n.vertexAttribPointer(this.shader.aVertexPosition,2,n.FLOAT,false,f,0);n.vertexAttribPointer(this.shader.aTextureCoord,2,n.FLOAT,false,f,2*4);n.vertexAttribPointer(this.shader.colorAttribute,2,n.FLOAT,false,f,4*4)}if(this.currentBatchSize>(this.size*0.5)){n.bufferSubData(n.ARRAY_BUFFER,0,this.vertices)}else{var r=this.vertices.subarray(0,this.currentBatchSize*4*this.vertSize);n.bufferSubData(n.ARRAY_BUFFER,0,r)}var s,k;var p=0;var g=0;var o=null;var h=this.renderSession.blendModeManager.currentBlendMode;for(var m=0,l=this.currentBatchSize;m<l;m++){s=this.textures[m];k=this.blendModes[m];if(o!==s||h!==k){this.renderBatch(o,p,g);g=m;p=0;o=s;h=k;this.renderSession.blendModeManager.setBlendMode(h)}p++}this.renderBatch(o,p,g);this.currentBatchSize=0};e.WebGLSpriteBatch.prototype.renderBatch=function(g,f,i){if(f===0){return}var h=this.gl;h.bindTexture(h.TEXTURE_2D,g._glTextures[h.id]||e.createWebGLTexture(g,h));if(g._dirty[h.id]){e.updateWebGLTexture(this.currentBaseTexture,h)}h.drawElements(h.TRIANGLES,f*6,h.UNSIGNED_SHORT,i*6*2);this.renderSession.drawCount++};e.WebGLSpriteBatch.prototype.stop=function(){this.flush()};e.WebGLSpriteBatch.prototype.start=function(){this.dirty=true};e.WebGLSpriteBatch.prototype.destroy=function(){this.vertices=null;this.indices=null;this.gl.deleteBuffer(this.vertexBuffer);this.gl.deleteBuffer(this.indexBuffer);this.currentBaseTexture=null;this.gl=null};e.WebGLFastSpriteBatch=function(l){this.vertSize=10;this.maxSize=6000;this.size=this.maxSize;var f=this.size*4*this.vertSize;var k=this.maxSize*6;this.vertices=new Float32Array(f);this.indices=new Uint16Array(k);this.vertexBuffer=null;this.indexBuffer=null;this.lastIndexCount=0;for(var h=0,g=0;h<k;h+=6,g+=4){this.indices[h+0]=g+0;this.indices[h+1]=g+1;this.indices[h+2]=g+2;this.indices[h+3]=g+0;this.indices[h+4]=g+2;this.indices[h+5]=g+3}this.drawing=false;this.currentBatchSize=0;this.currentBaseTexture=null;this.currentBlendMode=0;this.renderSession=null;this.shader=null;this.matrix=null;this.setContext(l)};e.WebGLFastSpriteBatch.prototype.setContext=function(f){this.gl=f;this.vertexBuffer=f.createBuffer();this.indexBuffer=f.createBuffer();f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,this.indexBuffer);f.bufferData(f.ELEMENT_ARRAY_BUFFER,this.indices,f.STATIC_DRAW);f.bindBuffer(f.ARRAY_BUFFER,this.vertexBuffer);f.bufferData(f.ARRAY_BUFFER,this.vertices,f.DYNAMIC_DRAW)};e.WebGLFastSpriteBatch.prototype.begin=function(f,g){this.renderSession=g;this.shader=this.renderSession.shaderManager.fastShader;this.matrix=f.worldTransform.toArray(true);this.start()};e.WebGLFastSpriteBatch.prototype.end=function(){this.flush()};e.WebGLFastSpriteBatch.prototype.render=function(f){var l=f.children;var k=l[0];if(!k.texture._uvs){return}this.currentBaseTexture=k.texture.baseTexture;if(k.blendMode!==this.renderSession.blendModeManager.currentBlendMode){this.flush();this.renderSession.blendModeManager.setBlendMode(k.blendMode)}for(var h=0,g=l.length;h<g;h++){this.renderSprite(l[h])}this.flush()};e.WebGLFastSpriteBatch.prototype.renderSprite=function(o){if(!o.visible){return}if(o.texture.baseTexture!==this.currentBaseTexture){this.flush();this.currentBaseTexture=o.texture.baseTexture;if(!o.texture._uvs){return}}var i,g=this.vertices,f,p,k,j,n,m,l;i=o.texture._uvs;f=o.texture.frame.width;p=o.texture.frame.height;if(o.texture.trim){var h=o.texture.trim;j=h.x-o.anchor.x*h.width;k=j+o.texture.crop.width;m=h.y-o.anchor.y*h.height;n=m+o.texture.crop.height}else{k=(o.texture.frame.width)*(1-o.anchor.x);j=(o.texture.frame.width)*-o.anchor.x;n=o.texture.frame.height*(1-o.anchor.y);m=o.texture.frame.height*-o.anchor.y}l=this.currentBatchSize*4*this.vertSize;g[l++]=j;g[l++]=m;g[l++]=o.position.x;g[l++]=o.position.y;g[l++]=o.scale.x;g[l++]=o.scale.y;g[l++]=o.rotation;g[l++]=i.x0;g[l++]=i.y1;g[l++]=o.alpha;g[l++]=k;g[l++]=m;g[l++]=o.position.x;g[l++]=o.position.y;g[l++]=o.scale.x;g[l++]=o.scale.y;g[l++]=o.rotation;g[l++]=i.x1;g[l++]=i.y1;g[l++]=o.alpha;g[l++]=k;g[l++]=n;g[l++]=o.position.x;g[l++]=o.position.y;g[l++]=o.scale.x;g[l++]=o.scale.y;g[l++]=o.rotation;g[l++]=i.x2;g[l++]=i.y2;g[l++]=o.alpha;g[l++]=j;g[l++]=n;g[l++]=o.position.x;g[l++]=o.position.y;g[l++]=o.scale.x;g[l++]=o.scale.y;g[l++]=o.rotation;g[l++]=i.x3;g[l++]=i.y3;g[l++]=o.alpha;this.currentBatchSize++;if(this.currentBatchSize>=this.size){this.flush()}};e.WebGLFastSpriteBatch.prototype.flush=function(){if(this.currentBatchSize===0){return}var g=this.gl;if(!this.currentBaseTexture._glTextures[g.id]){e.createWebGLTexture(this.currentBaseTexture,g)}g.bindTexture(g.TEXTURE_2D,this.currentBaseTexture._glTextures[g.id]);if(this.currentBatchSize>(this.size*0.5)){g.bufferSubData(g.ARRAY_BUFFER,0,this.vertices)}else{var f=this.vertices.subarray(0,this.currentBatchSize*4*this.vertSize);g.bufferSubData(g.ARRAY_BUFFER,0,f)}g.drawElements(g.TRIANGLES,this.currentBatchSize*6,g.UNSIGNED_SHORT,0);this.currentBatchSize=0;this.renderSession.drawCount++};e.WebGLFastSpriteBatch.prototype.stop=function(){this.flush()};e.WebGLFastSpriteBatch.prototype.start=function(){var h=this.gl;h.activeTexture(h.TEXTURE0);h.bindBuffer(h.ARRAY_BUFFER,this.vertexBuffer);h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var f=this.renderSession.projection;h.uniform2f(this.shader.projectionVector,f.x,f.y);h.uniformMatrix3fv(this.shader.uMatrix,false,this.matrix);var g=this.vertSize*4;h.vertexAttribPointer(this.shader.aVertexPosition,2,h.FLOAT,false,g,0);h.vertexAttribPointer(this.shader.aPositionCoord,2,h.FLOAT,false,g,2*4);h.vertexAttribPointer(this.shader.aScale,2,h.FLOAT,false,g,4*4);h.vertexAttribPointer(this.shader.aRotation,1,h.FLOAT,false,g,6*4);h.vertexAttribPointer(this.shader.aTextureCoord,2,h.FLOAT,false,g,7*4);h.vertexAttribPointer(this.shader.colorAttribute,1,h.FLOAT,false,g,9*4)};e.WebGLFilterManager=function(g,f){this.transparent=f;this.filterStack=[];this.offsetX=0;this.offsetY=0;this.setContext(g)};e.WebGLFilterManager.prototype.setContext=function(f){this.gl=f;this.texturePool=[];this.initShaderBuffers()};e.WebGLFilterManager.prototype.begin=function(h,g){this.renderSession=h;this.defaultShader=h.shaderManager.defaultShader;var f=this.renderSession.projection;this.width=f.x*2;this.height=-f.y*2;this.buffer=g};e.WebGLFilterManager.prototype.pushFilter=function(g){var m=this.gl;var f=this.renderSession.projection;var l=this.renderSession.offset;g._filterArea=g.target.filterArea||g.target.getBounds();this.filterStack.push(g);var h=g.filterPasses[0];this.offsetX+=g._filterArea.x;this.offsetY+=g._filterArea.y;var i=this.texturePool.pop();if(!i){i=new e.FilterTexture(this.gl,this.width,this.height)}else{i.resize(this.width,this.height)}m.bindTexture(m.TEXTURE_2D,i.texture);var j=g._filterArea;var k=h.padding;j.x-=k;j.y-=k;j.width+=k*2;j.height+=k*2;if(j.x<0){j.x=0}if(j.width>this.width){j.width=this.width}if(j.y<0){j.y=0}if(j.height>this.height){j.height=this.height}m.bindFramebuffer(m.FRAMEBUFFER,i.frameBuffer);m.viewport(0,0,j.width,j.height);f.x=j.width/2;f.y=-j.height/2;l.x=-j.x;l.y=-j.y;this.renderSession.shaderManager.setShader(this.defaultShader);m.uniform2f(this.defaultShader.projectionVector,j.width/2,-j.height/2);m.uniform2f(this.defaultShader.offsetVector,-j.x,-j.y);m.colorMask(true,true,true,true);m.clearColor(0,0,0,0);m.clear(m.COLOR_BUFFER_BIT);g._glFilterTexture=i};e.WebGLFilterManager.prototype.popFilter=function(){var s=this.gl;var p=this.filterStack.pop();var A=p._filterArea;var n=p._glFilterTexture;var B=this.renderSession.projection;var j=this.renderSession.offset;if(p.filterPasses.length>1){s.viewport(0,0,A.width,A.height);s.bindBuffer(s.ARRAY_BUFFER,this.vertexBuffer);this.vertexArray[0]=0;this.vertexArray[1]=A.height;this.vertexArray[2]=A.width;this.vertexArray[3]=A.height;this.vertexArray[4]=0;this.vertexArray[5]=0;this.vertexArray[6]=A.width;this.vertexArray[7]=0;s.bufferSubData(s.ARRAY_BUFFER,0,this.vertexArray);s.bindBuffer(s.ARRAY_BUFFER,this.uvBuffer);this.uvArray[2]=A.width/this.width;this.uvArray[5]=A.height/this.height;this.uvArray[6]=A.width/this.width;this.uvArray[7]=A.height/this.height;s.bufferSubData(s.ARRAY_BUFFER,0,this.uvArray);var u=n;var g=this.texturePool.pop();if(!g){g=new e.FilterTexture(this.gl,this.width,this.height)}g.resize(this.width,this.height);s.bindFramebuffer(s.FRAMEBUFFER,g.frameBuffer);s.clear(s.COLOR_BUFFER_BIT);s.disable(s.BLEND);for(var t=0;t<p.filterPasses.length-1;t++){var h=p.filterPasses[t];s.bindFramebuffer(s.FRAMEBUFFER,g.frameBuffer);s.activeTexture(s.TEXTURE0);s.bindTexture(s.TEXTURE_2D,u.texture);this.applyFilterPass(h,A,A.width,A.height);var z=u;u=g;g=z}s.enable(s.BLEND);n=u;this.texturePool.push(g)}var m=p.filterPasses[p.filterPasses.length-1];this.offsetX-=A.x;this.offsetY-=A.y;var q=this.width;var o=this.height;var w=0;var v=0;var r=this.buffer;if(this.filterStack.length===0){s.colorMask(true,true,true,true)}else{var f=this.filterStack[this.filterStack.length-1];A=f._filterArea;q=A.width;o=A.height;w=A.x;v=A.y;r=f._glFilterTexture.frameBuffer}B.x=q/2;B.y=-o/2;j.x=w;j.y=v;A=p._filterArea;var l=A.x-w;var k=A.y-v;s.bindBuffer(s.ARRAY_BUFFER,this.vertexBuffer);this.vertexArray[0]=l;this.vertexArray[1]=k+A.height;this.vertexArray[2]=l+A.width;this.vertexArray[3]=k+A.height;this.vertexArray[4]=l;this.vertexArray[5]=k;this.vertexArray[6]=l+A.width;this.vertexArray[7]=k;s.bufferSubData(s.ARRAY_BUFFER,0,this.vertexArray);s.bindBuffer(s.ARRAY_BUFFER,this.uvBuffer);this.uvArray[2]=A.width/this.width;this.uvArray[5]=A.height/this.height;this.uvArray[6]=A.width/this.width;this.uvArray[7]=A.height/this.height;s.bufferSubData(s.ARRAY_BUFFER,0,this.uvArray);s.viewport(0,0,q,o);s.bindFramebuffer(s.FRAMEBUFFER,r);s.activeTexture(s.TEXTURE0);s.bindTexture(s.TEXTURE_2D,n.texture);this.applyFilterPass(m,A,q,o);this.renderSession.shaderManager.setShader(this.defaultShader);s.uniform2f(this.defaultShader.projectionVector,q/2,-o/2);s.uniform2f(this.defaultShader.offsetVector,-w,-v);this.texturePool.push(n);p._glFilterTexture=null};e.WebGLFilterManager.prototype.applyFilterPass=function(h,j,g,f){var k=this.gl;var i=h.shaders[k.id];if(!i){i=new e.PixiShader(k);i.fragmentSrc=h.fragmentSrc;i.uniforms=h.uniforms;i.init();h.shaders[k.id]=i}this.renderSession.shaderManager.setShader(i);k.uniform2f(i.projectionVector,g/2,-f/2);k.uniform2f(i.offsetVector,0,0);if(h.uniforms.dimensions){h.uniforms.dimensions.value[0]=this.width;h.uniforms.dimensions.value[1]=this.height;h.uniforms.dimensions.value[2]=this.vertexArray[0];h.uniforms.dimensions.value[3]=this.vertexArray[5]}i.syncUniforms();k.bindBuffer(k.ARRAY_BUFFER,this.vertexBuffer);k.vertexAttribPointer(i.aVertexPosition,2,k.FLOAT,false,0,0);k.bindBuffer(k.ARRAY_BUFFER,this.uvBuffer);k.vertexAttribPointer(i.aTextureCoord,2,k.FLOAT,false,0,0);k.bindBuffer(k.ARRAY_BUFFER,this.colorBuffer);k.vertexAttribPointer(i.colorAttribute,2,k.FLOAT,false,0,0);k.bindBuffer(k.ELEMENT_ARRAY_BUFFER,this.indexBuffer);k.drawElements(k.TRIANGLES,6,k.UNSIGNED_SHORT,0);this.renderSession.drawCount++};e.WebGLFilterManager.prototype.initShaderBuffers=function(){var f=this.gl;this.vertexBuffer=f.createBuffer();this.uvBuffer=f.createBuffer();this.colorBuffer=f.createBuffer();this.indexBuffer=f.createBuffer();this.vertexArray=new Float32Array([0,0,1,0,0,1,1,1]);f.bindBuffer(f.ARRAY_BUFFER,this.vertexBuffer);f.bufferData(f.ARRAY_BUFFER,this.vertexArray,f.STATIC_DRAW);this.uvArray=new Float32Array([0,0,1,0,0,1,1,1]);f.bindBuffer(f.ARRAY_BUFFER,this.uvBuffer);f.bufferData(f.ARRAY_BUFFER,this.uvArray,f.STATIC_DRAW);this.colorArray=new Float32Array([1,16777215,1,16777215,1,16777215,1,16777215]);f.bindBuffer(f.ARRAY_BUFFER,this.colorBuffer);f.bufferData(f.ARRAY_BUFFER,this.colorArray,f.STATIC_DRAW);f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,this.indexBuffer);f.bufferData(f.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,1,3,2]),f.STATIC_DRAW)};e.WebGLFilterManager.prototype.destroy=function(){var g=this.gl;this.filterStack=null;this.offsetX=0;this.offsetY=0;for(var f=0;f<this.texturePool.length;f++){this.texturePool[f].destroy()}this.texturePool=null;g.deleteBuffer(this.vertexBuffer);g.deleteBuffer(this.uvBuffer);g.deleteBuffer(this.colorBuffer);g.deleteBuffer(this.indexBuffer)};e.FilterTexture=function(i,h,f,g){this.gl=i;this.frameBuffer=i.createFramebuffer();this.texture=i.createTexture();g=g||e.scaleModes.DEFAULT;i.bindTexture(i.TEXTURE_2D,this.texture);i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,g===e.scaleModes.LINEAR?i.LINEAR:i.NEAREST);i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,g===e.scaleModes.LINEAR?i.LINEAR:i.NEAREST);i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE);i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE);i.bindFramebuffer(i.FRAMEBUFFER,this.framebuffer);i.bindFramebuffer(i.FRAMEBUFFER,this.frameBuffer);i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,this.texture,0);this.renderBuffer=i.createRenderbuffer();i.bindRenderbuffer(i.RENDERBUFFER,this.renderBuffer);i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,this.renderBuffer);this.resize(h,f)};e.FilterTexture.prototype.clear=function(){var f=this.gl;f.clearColor(0,0,0,0);f.clear(f.COLOR_BUFFER_BIT)};e.FilterTexture.prototype.resize=function(g,f){if(this.width===g&&this.height===f){return}this.width=g;this.height=f;var h=this.gl;h.bindTexture(h.TEXTURE_2D,this.texture);h.texImage2D(h.TEXTURE_2D,0,h.RGBA,g,f,0,h.RGBA,h.UNSIGNED_BYTE,null);h.bindRenderbuffer(h.RENDERBUFFER,this.renderBuffer);h.renderbufferStorage(h.RENDERBUFFER,h.DEPTH_STENCIL,g,f)};e.FilterTexture.prototype.destroy=function(){var f=this.gl;f.deleteFramebuffer(this.frameBuffer);f.deleteTexture(this.texture);this.frameBuffer=null;this.texture=null};e.CanvasMaskManager=function(){};e.CanvasMaskManager.prototype.pushMask=function(i,h){h.save();var f=i.alpha;var g=i.worldTransform;h.setTransform(g.a,g.c,g.b,g.d,g.tx,g.ty);e.CanvasGraphics.renderGraphicsMask(i,h);h.clip();i.worldAlpha=f};e.CanvasMaskManager.prototype.popMask=function(f){f.restore()};e.CanvasTinter=function(){};e.CanvasTinter.getTintedTexture=function(i,f){var k=i.texture;f=e.CanvasTinter.roundColor(f);var j="#"+("00000"+(f|0).toString(16)).substr(-6);k.tintCache=k.tintCache||{};if(k.tintCache[j]){return k.tintCache[j]}var g=e.CanvasTinter.canvas||document.createElement("canvas");e.CanvasTinter.tintMethod(k,f,g);if(e.CanvasTinter.convertTintToImage){var h=new Image();h.src=g.toDataURL();k.tintCache[j]=h}else{k.tintCache[j]=g;e.CanvasTinter.canvas=null}return g};e.CanvasTinter.tintWithMultiply=function(i,f,g){var h=g.getContext("2d");var j=i.frame;g.width=j.width;g.height=j.height;h.fillStyle="#"+("00000"+(f|0).toString(16)).substr(-6);h.fillRect(0,0,j.width,j.height);h.globalCompositeOperation="multiply";h.drawImage(i.baseTexture.source,j.x,j.y,j.width,j.height,0,0,j.width,j.height);h.globalCompositeOperation="destination-atop";h.drawImage(i.baseTexture.source,j.x,j.y,j.width,j.height,0,0,j.width,j.height)};e.CanvasTinter.tintWithOverlay=function(i,f,g){var h=g.getContext("2d");var j=i.frame;g.width=j.width;g.height=j.height;h.globalCompositeOperation="copy";h.fillStyle="#"+("00000"+(f|0).toString(16)).substr(-6);h.fillRect(0,0,j.width,j.height);h.globalCompositeOperation="destination-atop";h.drawImage(i.baseTexture.source,j.x,j.y,j.width,j.height,0,0,j.width,j.height)};e.CanvasTinter.tintWithPerPixel=function(q,n,l){var j=l.getContext("2d");var k=q.frame;l.width=k.width;l.height=k.height;j.globalCompositeOperation="copy";j.drawImage(q.baseTexture.source,k.x,k.y,k.width,k.height,0,0,k.width,k.height);var h=e.hex2rgb(n);var f=h[0],p=h[1],s=h[2];var t=j.getImageData(0,0,k.width,k.height);var m=t.data;for(var o=0;o<m.length;o+=4){m[o+0]*=f;m[o+1]*=p;m[o+2]*=s}j.putImageData(t,0,0)};e.CanvasTinter.roundColor=function(f){var g=e.CanvasTinter.cacheStepsPerColorChannel;var h=e.hex2rgb(f);h[0]=Math.min(255,(h[0]/g)*g);h[1]=Math.min(255,(h[1]/g)*g);h[2]=Math.min(255,(h[2]/g)*g);return e.rgb2hex(h)};e.CanvasTinter.cacheStepsPerColorChannel=8;e.CanvasTinter.convertTintToImage=false;e.CanvasTinter.canUseMultiply=e.canUseNewCanvasBlendModes();e.CanvasTinter.tintMethod=e.CanvasTinter.canUseMultiply?e.CanvasTinter.tintWithMultiply:e.CanvasTinter.tintWithPerPixel;e.CanvasRenderer=function(h,f,g,i){if(!e.defaultRenderer){e.sayHello("Canvas");e.defaultRenderer=this}this.type=e.CANVAS_RENDERER;this.clearBeforeRender=true;this.transparent=!!i;if(!e.blendModesCanvas){e.blendModesCanvas=[];if(e.canUseNewCanvasBlendModes()){e.blendModesCanvas[e.blendModes.NORMAL]="source-over";e.blendModesCanvas[e.blendModes.ADD]="lighter";e.blendModesCanvas[e.blendModes.MULTIPLY]="multiply";e.blendModesCanvas[e.blendModes.SCREEN]="screen";e.blendModesCanvas[e.blendModes.OVERLAY]="overlay";e.blendModesCanvas[e.blendModes.DARKEN]="darken";e.blendModesCanvas[e.blendModes.LIGHTEN]="lighten";e.blendModesCanvas[e.blendModes.COLOR_DODGE]="color-dodge";e.blendModesCanvas[e.blendModes.COLOR_BURN]="color-burn";e.blendModesCanvas[e.blendModes.HARD_LIGHT]="hard-light";e.blendModesCanvas[e.blendModes.SOFT_LIGHT]="soft-light";e.blendModesCanvas[e.blendModes.DIFFERENCE]="difference";e.blendModesCanvas[e.blendModes.EXCLUSION]="exclusion";e.blendModesCanvas[e.blendModes.HUE]="hue";e.blendModesCanvas[e.blendModes.SATURATION]="saturation";e.blendModesCanvas[e.blendModes.COLOR]="color";e.blendModesCanvas[e.blendModes.LUMINOSITY]="luminosity"}else{e.blendModesCanvas[e.blendModes.NORMAL]="source-over";e.blendModesCanvas[e.blendModes.ADD]="lighter";e.blendModesCanvas[e.blendModes.MULTIPLY]="source-over";e.blendModesCanvas[e.blendModes.SCREEN]="source-over";e.blendModesCanvas[e.blendModes.OVERLAY]="source-over";e.blendModesCanvas[e.blendModes.DARKEN]="source-over";e.blendModesCanvas[e.blendModes.LIGHTEN]="source-over";e.blendModesCanvas[e.blendModes.COLOR_DODGE]="source-over";e.blendModesCanvas[e.blendModes.COLOR_BURN]="source-over";e.blendModesCanvas[e.blendModes.HARD_LIGHT]="source-over";e.blendModesCanvas[e.blendModes.SOFT_LIGHT]="source-over";e.blendModesCanvas[e.blendModes.DIFFERENCE]="source-over";e.blendModesCanvas[e.blendModes.EXCLUSION]="source-over";e.blendModesCanvas[e.blendModes.HUE]="source-over";e.blendModesCanvas[e.blendModes.SATURATION]="source-over";e.blendModesCanvas[e.blendModes.COLOR]="source-over";e.blendModesCanvas[e.blendModes.LUMINOSITY]="source-over"}}this.width=h||800;this.height=f||600;this.view=g||document.createElement("canvas");this.context=this.view.getContext("2d",{alpha:this.transparent});this.refresh=true;this.view.width=this.width;this.view.height=this.height;this.count=0;this.maskManager=new e.CanvasMaskManager();this.renderSession={context:this.context,maskManager:this.maskManager,scaleMode:null,smoothProperty:null,roundPixels:false};if("imageSmoothingEnabled" in this.context){this.renderSession.smoothProperty="imageSmoothingEnabled"}else{if("webkitImageSmoothingEnabled" in this.context){this.renderSession.smoothProperty="webkitImageSmoothingEnabled"}else{if("mozImageSmoothingEnabled" in this.context){this.renderSession.smoothProperty="mozImageSmoothingEnabled"}else{if("oImageSmoothingEnabled" in this.context){this.renderSession.smoothProperty="oImageSmoothingEnabled"}}}}};e.CanvasRenderer.prototype.constructor=e.CanvasRenderer;e.CanvasRenderer.prototype.render=function(f){e.texturesToUpdate.length=0;e.texturesToDestroy.length=0;f.updateTransform();this.context.setTransform(1,0,0,1,0,0);this.context.globalAlpha=1;if(navigator.isCocoonJS&&this.view.screencanvas){this.context.fillStyle="black";this.context.clear()}if(!this.transparent&&this.clearBeforeRender){this.context.fillStyle=f.backgroundColorString;this.context.fillRect(0,0,this.width,this.height)}else{if(this.transparent&&this.clearBeforeRender){this.context.clearRect(0,0,this.width,this.height)}}this.renderDisplayObject(f);if(f.interactive){if(!f._interactiveEventsAdded){f._interactiveEventsAdded=true;f.interactionManager.setTarget(this)}}if(e.Texture.frameUpdates.length>0){e.Texture.frameUpdates.length=0}};e.CanvasRenderer.prototype.resize=function(g,f){this.width=g;this.height=f;this.view.width=g;this.view.height=f};e.CanvasRenderer.prototype.renderDisplayObject=function(g,f){this.renderSession.context=f||this.context;g._renderCanvas(this.renderSession)};e.CanvasRenderer.prototype.renderStripFlat=function(g){var h=this.context;var k=g.verticies;var l=k.length/2;this.count++;h.beginPath();for(var n=1;n<l-2;n++){var o=n*2;var m=k[o],j=k[o+2],f=k[o+4];var r=k[o+1],q=k[o+3],p=k[o+5];h.moveTo(m,r);h.lineTo(j,q);h.lineTo(f,p)}h.fillStyle="#FF0000";h.fill();h.closePath()};e.CanvasRenderer.prototype.renderStrip=function(x){var k=this.context;var j=x.verticies;var w=x.uvs;var o=j.length/2;this.count++;for(var y=1;y<o-2;y++){var q=y*2;var E=j[q],D=j[q+2],B=j[q+4];var n=j[q+1],m=j[q+3],h=j[q+5];var C=w[q]*x.texture.width,A=w[q+2]*x.texture.width,z=w[q+4]*x.texture.width;var l=w[q+1]*x.texture.height,g=w[q+3]*x.texture.height,f=w[q+5]*x.texture.height;k.save();k.beginPath();k.moveTo(E,n);k.lineTo(D,m);k.lineTo(B,h);k.closePath();k.clip();var F=C*g+l*z+A*f-g*z-l*A-C*f;var v=E*g+l*B+D*f-g*B-l*D-E*f;var u=C*D+E*z+A*B-D*z-E*A-C*B;var t=C*g*B+l*D*z+E*A*f-E*g*z-l*A*B-C*D*f;var s=n*g+l*h+m*f-g*h-l*m-n*f;var r=C*m+n*z+A*h-m*z-n*A-C*h;var p=C*g*h+l*m*z+n*A*f-n*g*z-l*A*h-C*m*f;k.transform(v/F,s/F,u/F,r/F,t/F,p/F);k.drawImage(x.texture.baseTexture.source,0,0);k.restore()}};e.CanvasBuffer=function(g,f){this.width=g;this.height=f;this.canvas=document.createElement("canvas");this.context=this.canvas.getContext("2d");this.canvas.width=g;this.canvas.height=f};e.CanvasBuffer.prototype.clear=function(){this.context.clearRect(0,0,this.width,this.height)};e.CanvasBuffer.prototype.resize=function(g,f){this.width=this.canvas.width=g;this.height=this.canvas.height=f};e.CanvasGraphics=function(){};e.CanvasGraphics.renderGraphics=function(I,g){var C=I.worldAlpha;var D="";for(var G=0;G<I.graphicsData.length;G++){var K=I.graphicsData[G];var F=K.points;g.strokeStyle=D="#"+("00000"+(K.lineColor|0).toString(16)).substr(-6);g.lineWidth=K.lineWidth;if(K.type===e.Graphics.POLY){g.beginPath();g.moveTo(F[0],F[1]);for(var E=1;E<F.length/2;E++){g.lineTo(F[E*2],F[E*2+1])}if(F[0]===F[F.length-2]&&F[1]===F[F.length-1]){g.closePath()}if(K.fill){g.globalAlpha=K.fillAlpha*C;g.fillStyle=D="#"+("00000"+(K.fillColor|0).toString(16)).substr(-6);g.fill()}if(K.lineWidth){g.globalAlpha=K.lineAlpha*C;g.stroke()}}else{if(K.type===e.Graphics.RECT){if(K.fillColor||K.fillColor===0){g.globalAlpha=K.fillAlpha*C;g.fillStyle=D="#"+("00000"+(K.fillColor|0).toString(16)).substr(-6);g.fillRect(F[0],F[1],F[2],F[3])}if(K.lineWidth){g.globalAlpha=K.lineAlpha*C;g.strokeRect(F[0],F[1],F[2],F[3])}}else{if(K.type===e.Graphics.CIRC){g.beginPath();g.arc(F[0],F[1],F[2],0,2*Math.PI);g.closePath();if(K.fill){g.globalAlpha=K.fillAlpha*C;g.fillStyle=D="#"+("00000"+(K.fillColor|0).toString(16)).substr(-6);g.fill()}if(K.lineWidth){g.globalAlpha=K.lineAlpha*C;g.stroke()}}else{if(K.type===e.Graphics.ELIP){var t=K.points;var s=t[2]*2;var H=t[3]*2;var r=t[0]-s/2;var q=t[1]-H/2;g.beginPath();var u=0.5522848,n=(s/2)*u,l=(H/2)*u,B=r+s,f=q+H,v=r+s/2,J=q+H/2;g.moveTo(r,J);g.bezierCurveTo(r,J-l,v-n,q,v,q);g.bezierCurveTo(v+n,q,B,J-l,B,J);g.bezierCurveTo(B,J+l,v+n,f,v,f);g.bezierCurveTo(v-n,f,r,J+l,r,J);g.closePath();if(K.fill){g.globalAlpha=K.fillAlpha*C;g.fillStyle=D="#"+("00000"+(K.fillColor|0).toString(16)).substr(-6);g.fill()}if(K.lineWidth){g.globalAlpha=K.lineAlpha*C;g.stroke()}}else{if(K.type===e.Graphics.RREC){var o=F[0];var m=F[1];var A=F[2];var z=F[3];var k=F[4];var p=Math.min(A,z)/2|0;k=k>p?p:k;g.beginPath();g.moveTo(o,m+k);g.lineTo(o,m+z-k);g.quadraticCurveTo(o,m+z,o+k,m+z);g.lineTo(o+A-k,m+z);g.quadraticCurveTo(o+A,m+z,o+A,m+z-k);g.lineTo(o+A,m+k);g.quadraticCurveTo(o+A,m,o+A-k,m);g.lineTo(o+k,m);g.quadraticCurveTo(o,m,o,m+k);g.closePath();if(K.fillColor||K.fillColor===0){g.globalAlpha=K.fillAlpha*C;g.fillStyle=D="#"+("00000"+(K.fillColor|0).toString(16)).substr(-6);g.fill()}if(K.lineWidth){g.globalAlpha=K.lineAlpha*C;g.stroke()}}}}}}}};e.CanvasGraphics.renderGraphicsMask=function(H,g){var F=H.graphicsData.length;if(F===0){return}if(F>1){F=1;window.console.log("Pixi.js warning: masks in canvas can only mask using the first path in the graphics object")}for(var E=0;E<1;E++){var J=H.graphicsData[E];var D=J.points;if(J.type===e.Graphics.POLY){g.beginPath();g.moveTo(D[0],D[1]);for(var C=1;C<D.length/2;C++){g.lineTo(D[C*2],D[C*2+1])}if(D[0]===D[D.length-2]&&D[1]===D[D.length-1]){g.closePath()}}else{if(J.type===e.Graphics.RECT){g.beginPath();g.rect(D[0],D[1],D[2],D[3]);g.closePath()}else{if(J.type===e.Graphics.CIRC){g.beginPath();g.arc(D[0],D[1],D[2],0,2*Math.PI);g.closePath()}else{if(J.type===e.Graphics.ELIP){var t=J.points;var s=t[2]*2;var G=t[3]*2;var r=t[0]-s/2;var q=t[1]-G/2;g.beginPath();var u=0.5522848,n=(s/2)*u,l=(G/2)*u,B=r+s,f=q+G,v=r+s/2,I=q+G/2;g.moveTo(r,I);g.bezierCurveTo(r,I-l,v-n,q,v,q);g.bezierCurveTo(v+n,q,B,I-l,B,I);g.bezierCurveTo(B,I+l,v+n,f,v,f);g.bezierCurveTo(v-n,f,r,I+l,r,I);g.closePath()}else{if(J.type===e.Graphics.RREC){var o=D[0];var m=D[1];var A=D[2];var z=D[3];var k=D[4];var p=Math.min(A,z)/2|0;k=k>p?p:k;g.beginPath();g.moveTo(o,m+k);g.lineTo(o,m+z-k);g.quadraticCurveTo(o,m+z,o+k,m+z);g.lineTo(o+A-k,m+z);g.quadraticCurveTo(o+A,m+z,o+A,m+z-k);g.lineTo(o+A,m+k);g.quadraticCurveTo(o+A,m,o+A-k,m);g.lineTo(o+k,m);g.quadraticCurveTo(o,m,o,m+k);g.closePath()}}}}}}};e.Graphics=function(){e.DisplayObjectContainer.call(this);this.renderable=true;this.fillAlpha=1;this.lineWidth=0;this.lineColor="black";this.graphicsData=[];this.tint=16777215;this.blendMode=e.blendModes.NORMAL;this.currentPath={points:[]};this._webGL=[];this.isMask=false;this.bounds=null;this.boundsPadding=10;this.dirty=true};e.Graphics.prototype=Object.create(e.DisplayObjectContainer.prototype);e.Graphics.prototype.constructor=e.Graphics;Object.defineProperty(e.Graphics.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(f){this._cacheAsBitmap=f;if(this._cacheAsBitmap){this._generateCachedSprite()}else{this.destroyCachedSprite();this.dirty=true}}});e.Graphics.prototype.lineStyle=function(f,g,h){if(!this.currentPath.points.length){this.graphicsData.pop()}this.lineWidth=f||0;this.lineColor=g||0;this.lineAlpha=(arguments.length<3)?1:h;this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[],type:e.Graphics.POLY};this.graphicsData.push(this.currentPath);return this};e.Graphics.prototype.moveTo=function(f,g){if(!this.currentPath.points.length){this.graphicsData.pop()}this.currentPath=this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[],type:e.Graphics.POLY};this.currentPath.points.push(f,g);this.graphicsData.push(this.currentPath);return this};e.Graphics.prototype.lineTo=function(f,g){this.currentPath.points.push(f,g);this.dirty=true;return this};e.Graphics.prototype.quadraticCurveTo=function(q,l,s,p){if(this.currentPath.points.length===0){this.moveTo(0,0)}var f,m,g=20,t=this.currentPath.points;if(t.length===0){this.moveTo(0,0)}var r=t[t.length-2];var o=t[t.length-1];var h=0;for(var k=1;k<=g;k++){h=k/g;f=r+((q-r)*h);m=o+((l-o)*h);t.push(f+(((q+((s-q)*h))-f)*h),m+(((l+((p-l)*h))-m)*h))}this.dirty=true;return this};e.Graphics.prototype.bezierCurveTo=function(v,r,u,m,x,t){if(this.currentPath.points.length===0){this.moveTo(0,0)}var k=20,g,h,f,q,p,y=this.currentPath.points;var w=y[y.length-2];var s=y[y.length-1];var l=0;for(var o=1;o<k;o++){l=o/k;g=(1-l);h=g*g;f=h*g;q=l*l;p=q*l;y.push(f*w+3*h*l*v+3*g*q*u+p*x,f*s+3*h*l*r+3*g*q*m+p*t)}this.dirty=true;return this};e.Graphics.prototype.arcTo=function(B,l,A,j,m){if(this.currentPath.points.length===0){this.moveTo(B,l)}var y=this.currentPath.points;var t=y[y.length-2];var r=y[y.length-1];var G=r-l;var o=t-B;var F=j-l;var n=A-B;var z=Math.abs(G*n-o*F);if(z<1e-8||m===0){y.push(B,l)}else{var E=G*G+o*o;var v=F*F+n*n;var g=G*F+o*n;var q=m*Math.sqrt(E)/z;var p=m*Math.sqrt(v)/z;var h=q*g/E;var f=p*g/v;var k=q*n+p*o;var i=q*F+p*G;var u=o*(p+h);var s=G*(p+h);var D=n*(q+f);var C=F*(q+f);var x=Math.atan2(s-i,u-k);var w=Math.atan2(C-i,D-k);this.arc(k+B,i+l,m,x,w,o*F>n*G)}this.dirty=true;return this};e.Graphics.prototype.arc=function(h,g,j,u,r,f){var A=h+Math.cos(u)*j;var y=g+Math.sin(u)*j;var x=this.currentPath.points;if(x.length!==0&&x[x.length-2]!==A||x[x.length-1]!==y){this.moveTo(A,y);x=this.currentPath.points}if(u===r){return this}if(!f&&r<=u){r+=Math.PI*2}else{if(f&&u<=r){u+=Math.PI*2}}var n=f?(u-r)*-1:(r-u);var q=(Math.abs(n)/(Math.PI*2))*40;if(n===0){return this}var k=n/(q*2);var p=k*2;var t=Math.cos(k);var v=Math.sin(k);var C=q-1;var l=(C%1)/C;for(var w=0;w<=C;w++){var o=w+l*w;var z=((k)+u+(p*o));var B=Math.cos(z);var m=-Math.sin(z);x.push(((t*B)+(v*m))*j+h,((t*-m)+(v*B))*j+g)}this.dirty=true;return this};e.Graphics.prototype.drawPath=function(f){if(!this.currentPath.points.length){this.graphicsData.pop()}this.currentPath=this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[],type:e.Graphics.POLY};this.graphicsData.push(this.currentPath);this.currentPath.points=this.currentPath.points.concat(f);this.dirty=true;return this};e.Graphics.prototype.beginFill=function(f,g){this.filling=true;this.fillColor=f||0;this.fillAlpha=(arguments.length<2)?1:g;return this};e.Graphics.prototype.endFill=function(){this.filling=false;this.fillColor=null;this.fillAlpha=1;return this};e.Graphics.prototype.drawRect=function(g,i,h,f){if(!this.currentPath.points.length){this.graphicsData.pop()}this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[g,i,h,f],type:e.Graphics.RECT};this.graphicsData.push(this.currentPath);this.dirty=true;return this};e.Graphics.prototype.drawRoundedRect=function(h,j,i,g,f){if(!this.currentPath.points.length){this.graphicsData.pop()}this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[h,j,i,g,f],type:e.Graphics.RREC};this.graphicsData.push(this.currentPath);this.dirty=true;return this};e.Graphics.prototype.drawCircle=function(g,h,f){if(!this.currentPath.points.length){this.graphicsData.pop()}this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[g,h,f,f],type:e.Graphics.CIRC};this.graphicsData.push(this.currentPath);this.dirty=true;return this};e.Graphics.prototype.drawEllipse=function(g,i,h,f){if(!this.currentPath.points.length){this.graphicsData.pop()}this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[g,i,h,f],type:e.Graphics.ELIP};this.graphicsData.push(this.currentPath);this.dirty=true;return this};e.Graphics.prototype.clear=function(){this.lineWidth=0;this.filling=false;this.dirty=true;this.clearDirty=true;this.graphicsData=[];this.bounds=null;return this};e.Graphics.prototype.generateTexture=function(){var h=this.getBounds();var f=new e.CanvasBuffer(h.width,h.height);var g=e.Texture.fromCanvas(f.canvas);f.context.translate(-h.x,-h.y);e.CanvasGraphics.renderGraphics(this,f.context);return g};e.Graphics.prototype._renderWebGL=function(h){if(this.visible===false||this.alpha===0||this.isMask===true){return}if(this._cacheAsBitmap){if(this.dirty){this._generateCachedSprite();e.updateWebGLTexture(this._cachedSprite.texture.baseTexture,h.gl);this.dirty=false}this._cachedSprite.alpha=this.alpha;e.Sprite.prototype._renderWebGL.call(this._cachedSprite,h);return}else{h.spriteBatch.stop();h.blendModeManager.setBlendMode(this.blendMode);if(this._mask){h.maskManager.pushMask(this._mask,h)}if(this._filters){h.filterManager.pushFilter(this._filterBlock)}if(this.blendMode!==h.spriteBatch.currentBlendMode){h.spriteBatch.currentBlendMode=this.blendMode;var k=e.blendModesWebGL[h.spriteBatch.currentBlendMode];h.spriteBatch.gl.blendFunc(k[0],k[1])}e.WebGLGraphics.renderGraphics(this,h);if(this.children.length){h.spriteBatch.start();for(var g=0,f=this.children.length;g<f;g++){this.children[g]._renderWebGL(h)}h.spriteBatch.stop()}if(this._filters){h.filterManager.popFilter()}if(this._mask){h.maskManager.popMask(this.mask,h)}h.drawCount++;h.spriteBatch.start()}};e.Graphics.prototype._renderCanvas=function(l){if(this.visible===false||this.alpha===0||this.isMask===true){return}var k=l.context;var g=this.worldTransform;if(this.blendMode!==l.currentBlendMode){l.currentBlendMode=this.blendMode;k.globalCompositeOperation=e.blendModesCanvas[l.currentBlendMode]}if(this._mask){l.maskManager.pushMask(this._mask,l.context)}k.setTransform(g.a,g.c,g.b,g.d,g.tx,g.ty);e.CanvasGraphics.renderGraphics(this,k);for(var h=0,f=this.children.length;h<f;h++){this.children[h]._renderCanvas(l)}if(this._mask){l.maskManager.popMask(l.context)}};e.Graphics.prototype.getBounds=function(q){if(!this.bounds){this.updateBounds()}var n=this.bounds.x;var m=this.bounds.width+this.bounds.x;var l=this.bounds.y;var k=this.bounds.height+this.bounds.y;var o=q||this.worldTransform;var C=o.a;var A=o.c;var z=o.b;var x=o.d;var D=o.tx;var B=o.ty;var t=C*m+z*k+D;var i=x*k+A*m+B;var s=C*n+z*k+D;var h=x*k+A*n+B;var r=C*n+z*l+D;var g=x*l+A*n+B;var p=C*m+z*l+D;var f=x*l+A*m+B;var w=t;var u=i;var y=t;var v=i;y=s<y?s:y;y=r<y?r:y;y=p<y?p:y;v=h<v?h:v;v=g<v?g:v;v=f<v?f:v;w=s>w?s:w;w=r>w?r:w;w=p>w?p:w;u=h>u?h:u;u=g>u?g:u;u=f>u?f:u;var j=this._bounds;j.x=y;j.width=w-y;j.y=v;j.height=u-v;return j};e.Graphics.prototype.updateBounds=function(){var l=Infinity;var g=-Infinity;var k=Infinity;var f=-Infinity;var z,u,s,v,p;for(var o=0;o<this.graphicsData.length;o++){var n=this.graphicsData[o];var r=n.type;var q=n.lineWidth;z=n.points;if(r===e.Graphics.RECT){u=z[0]-q/2;s=z[1]-q/2;v=z[2]+q;p=z[3]+q;l=u<l?u:l;g=u+v>g?u+v:g;k=s<k?u:k;f=s+p>f?s+p:f}else{if(r===e.Graphics.CIRC||r===e.Graphics.ELIP){u=z[0];s=z[1];v=z[2]+q/2;p=z[3]+q/2;l=u-v<l?u-v:l;g=u+v>g?u+v:g;k=s-p<k?s-p:k;f=s+p>f?s+p:f}else{for(var m=0;m<z.length;m+=2){u=z[m];s=z[m+1];l=u-q<l?u-q:l;g=u+q>g?u+q:g;k=s-q<k?s-q:k;f=s+q>f?s+q:f}}}}var t=this.boundsPadding;this.bounds=new e.Rectangle(l-t,k-t,(g-l)+t*2,(f-k)+t*2)};e.Graphics.prototype._generateCachedSprite=function(){var h=this.getLocalBounds();if(!this._cachedSprite){var f=new e.CanvasBuffer(h.width,h.height);var g=e.Texture.fromCanvas(f.canvas);this._cachedSprite=new e.Sprite(g);this._cachedSprite.buffer=f;this._cachedSprite.worldTransform=this.worldTransform}else{this._cachedSprite.buffer.resize(h.width,h.height)}this._cachedSprite.anchor.x=-(h.x/h.width);this._cachedSprite.anchor.y=-(h.y/h.height);this._cachedSprite.buffer.context.translate(-h.x,-h.y);e.CanvasGraphics.renderGraphics(this,this._cachedSprite.buffer.context);this._cachedSprite.alpha=this.alpha};e.Graphics.prototype.destroyCachedSprite=function(){this._cachedSprite.texture.destroy(true);this._cachedSprite=null};e.Graphics.POLY=0;e.Graphics.RECT=1;e.Graphics.CIRC=2;e.Graphics.ELIP=3;e.Graphics.RREC=4;e.Strip=function(f){e.DisplayObjectContainer.call(this);this.texture=f;this.uvs=new e.Float32Array([0,1,1,1,1,0,0,1]);this.verticies=new e.Float32Array([0,0,100,0,100,100,0,100]);this.colors=new e.Float32Array([1,1,1,1]);this.indices=new e.Uint16Array([0,1,2,3]);this.dirty=true};e.Strip.prototype=Object.create(e.DisplayObjectContainer.prototype);e.Strip.prototype.constructor=e.Strip;e.Strip.prototype._renderWebGL=function(f){if(!this.visible||this.alpha<=0){return}f.spriteBatch.stop();if(!this._vertexBuffer){this._initWebGL(f)}f.shaderManager.setShader(f.shaderManager.stripShader);this._renderStrip(f);f.spriteBatch.start()};e.Strip.prototype._initWebGL=function(f){var g=f.gl;this._vertexBuffer=g.createBuffer();this._indexBuffer=g.createBuffer();this._uvBuffer=g.createBuffer();this._colorBuffer=g.createBuffer();g.bindBuffer(g.ARRAY_BUFFER,this._vertexBuffer);g.bufferData(g.ARRAY_BUFFER,this.verticies,g.DYNAMIC_DRAW);g.bindBuffer(g.ARRAY_BUFFER,this._uvBuffer);g.bufferData(g.ARRAY_BUFFER,this.uvs,g.STATIC_DRAW);g.bindBuffer(g.ARRAY_BUFFER,this._colorBuffer);g.bufferData(g.ARRAY_BUFFER,this.colors,g.STATIC_DRAW);g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,this._indexBuffer);g.bufferData(g.ELEMENT_ARRAY_BUFFER,this.indices,g.STATIC_DRAW)};e.Strip.prototype._renderStrip=function(h){var j=h.gl;var f=h.projection,i=h.offset,g=h.shaderManager.stripShader;j.blendFunc(j.ONE,j.ONE_MINUS_SRC_ALPHA);j.uniformMatrix3fv(g.translationMatrix,false,this.worldTransform.toArray(true));j.uniform2f(g.projectionVector,f.x,-f.y);j.uniform2f(g.offsetVector,-i.x,-i.y);j.uniform1f(g.alpha,1);if(!this.dirty){j.bindBuffer(j.ARRAY_BUFFER,this._vertexBuffer);j.bufferSubData(j.ARRAY_BUFFER,0,this.verticies);j.vertexAttribPointer(g.aVertexPosition,2,j.FLOAT,false,0,0);j.bindBuffer(j.ARRAY_BUFFER,this._uvBuffer);j.vertexAttribPointer(g.aTextureCoord,2,j.FLOAT,false,0,0);j.activeTexture(j.TEXTURE0);j.bindTexture(j.TEXTURE_2D,this.texture.baseTexture._glTextures[j.id]||e.createWebGLTexture(this.texture.baseTexture,j));j.bindBuffer(j.ELEMENT_ARRAY_BUFFER,this._indexBuffer)}else{this.dirty=false;j.bindBuffer(j.ARRAY_BUFFER,this._vertexBuffer);j.bufferData(j.ARRAY_BUFFER,this.verticies,j.STATIC_DRAW);j.vertexAttribPointer(g.aVertexPosition,2,j.FLOAT,false,0,0);j.bindBuffer(j.ARRAY_BUFFER,this._uvBuffer);j.bufferData(j.ARRAY_BUFFER,this.uvs,j.STATIC_DRAW);j.vertexAttribPointer(g.aTextureCoord,2,j.FLOAT,false,0,0);j.activeTexture(j.TEXTURE0);j.bindTexture(j.TEXTURE_2D,this.texture.baseTexture._glTextures[j.id]||e.createWebGLTexture(this.texture.baseTexture,j));j.bindBuffer(j.ELEMENT_ARRAY_BUFFER,this._indexBuffer);j.bufferData(j.ELEMENT_ARRAY_BUFFER,this.indices,j.STATIC_DRAW)}j.drawElements(j.TRIANGLE_STRIP,this.indices.length,j.UNSIGNED_SHORT,0)};e.Strip.prototype._renderCanvas=function(p){var k=p.context;var A=this.worldTransform;if(p.roundPixels){k.setTransform(A.a,A.c,A.b,A.d,A.tx|0,A.ty|0)}else{k.setTransform(A.a,A.c,A.b,A.d,A.tx,A.ty)}var C=this;var j=C.verticies;var z=C.uvs;var o=j.length/2;this.count++;for(var G=0;G<o-2;G++){var r=G*2;var L=j[r],K=j[r+2],I=j[r+4];var n=j[r+1],m=j[r+3],h=j[r+5];if(true){var x=(L+K+I)/3;var v=(n+m+h)/3;var E=L-x;var D=n-v;var B=Math.sqrt(E*E+D*D);L=x+(E/B)*(B+3);n=v+(D/B)*(B+3);E=K-x;D=m-v;B=Math.sqrt(E*E+D*D);K=x+(E/B)*(B+3);m=v+(D/B)*(B+3);E=I-x;D=h-v;B=Math.sqrt(E*E+D*D);I=x+(E/B)*(B+3);h=v+(D/B)*(B+3)}var J=z[r]*C.texture.width,H=z[r+2]*C.texture.width,F=z[r+4]*C.texture.width;var l=z[r+1]*C.texture.height,g=z[r+3]*C.texture.height,f=z[r+5]*C.texture.height;k.save();k.beginPath();k.moveTo(L,n);k.lineTo(K,m);k.lineTo(I,h);k.closePath();k.clip();var M=J*g+l*F+H*f-g*F-l*H-J*f;var y=L*g+l*I+K*f-g*I-l*K-L*f;var w=J*K+L*F+H*I-K*F-L*H-J*I;var u=J*g*I+l*K*F+L*H*f-L*g*F-l*H*I-J*K*f;var t=n*g+l*h+m*f-g*h-l*m-n*f;var s=J*m+n*F+H*h-m*F-n*H-J*h;var q=J*g*h+l*m*F+n*H*f-n*g*F-l*H*h-J*m*f;k.transform(y/M,t/M,w/M,s/M,u/M,q/M);k.drawImage(C.texture.baseTexture.source,0,0);k.restore()}};e.Strip.prototype.onTextureUpdate=function(){this.updateFrame=true};e.Rope=function(g,f){e.Strip.call(this,g);this.points=f;this.verticies=new e.Float32Array(f.length*4);this.uvs=new e.Float32Array(f.length*4);this.colors=new e.Float32Array(f.length*2);this.indices=new e.Uint16Array(f.length*2);this.refresh()};e.Rope.prototype=Object.create(e.Strip.prototype);e.Rope.prototype.constructor=e.Rope;e.Rope.prototype.refresh=function(){var o=this.points;if(o.length<1){return}var g=this.uvs;var m=o[0];var p=this.indices;var f=this.colors;this.count-=0.2;g[0]=0;g[1]=0;g[2]=0;g[3]=1;f[0]=1;f[1]=1;p[0]=0;p[1]=1;var l=o.length,n,k,j;for(var h=1;h<l;h++){n=o[h];k=h*4;j=h/(l-1);if(h%2){g[k]=j;g[k+1]=0;g[k+2]=j;g[k+3]=1}else{g[k]=j;g[k+1]=0;g[k+2]=j;g[k+3]=1}k=h*2;f[k]=1;f[k+1]=1;k=h*2;p[k]=k;p[k+1]=k+1;m=n}};e.Rope.prototype.updateTransform=function(){var r=this.points;if(r.length<1){return}var p=r[0];var n;var g={x:0,y:0};this.count-=0.2;var f=this.verticies;var o=r.length,q,l,m,h,k;for(var j=0;j<o;j++){q=r[j];l=j*4;if(j<r.length-1){n=r[j+1]}else{n=q}g.y=-(n.x-p.x);g.x=n.y-p.y;m=(1-(j/(o-1)))*10;if(m>1){m=1}h=Math.sqrt(g.x*g.x+g.y*g.y);k=this.texture.height/2;g.x/=h;g.y/=h;g.x*=k;g.y*=k;f[l]=q.x+g.x;f[l+1]=q.y+g.y;f[l+2]=q.x-g.x;f[l+3]=q.y-g.y;p=q}e.DisplayObjectContainer.prototype.updateTransform.call(this)};e.Rope.prototype.setTexture=function(f){this.texture=f};e.TilingSprite=function(h,g,f){e.Sprite.call(this,h);this._width=g||100;this._height=f||100;this.tileScale=new e.Point(1,1);this.tileScaleOffset=new e.Point(1,1);this.tilePosition=new e.Point(0,0);this.renderable=true;this.tint=16777215;this.blendMode=e.blendModes.NORMAL};e.TilingSprite.prototype=Object.create(e.Sprite.prototype);e.TilingSprite.prototype.constructor=e.TilingSprite;Object.defineProperty(e.TilingSprite.prototype,"width",{get:function(){return this._width},set:function(f){this._width=f}});Object.defineProperty(e.TilingSprite.prototype,"height",{get:function(){return this._height},set:function(f){this._height=f}});e.TilingSprite.prototype.setTexture=function(f){if(this.texture===f){return}this.texture=f;this.refreshTexture=true;this.cachedTint=16777215};e.TilingSprite.prototype._renderWebGL=function(h){if(this.visible===false||this.alpha===0){return}var g,f;if(this._mask){h.spriteBatch.stop();h.maskManager.pushMask(this.mask,h);h.spriteBatch.start()}if(this._filters){h.spriteBatch.flush();h.filterManager.pushFilter(this._filterBlock)}if(!this.tilingTexture||this.refreshTexture){this.generateTilingTexture(true);if(this.tilingTexture&&this.tilingTexture.needsUpdate){e.updateWebGLTexture(this.tilingTexture.baseTexture,h.gl);this.tilingTexture.needsUpdate=false}}else{h.spriteBatch.renderTilingSprite(this)}for(g=0,f=this.children.length;g<f;g++){this.children[g]._renderWebGL(h)}h.spriteBatch.stop();if(this._filters){h.filterManager.popFilter()}if(this._mask){h.maskManager.popMask(h)}h.spriteBatch.start()};e.TilingSprite.prototype._renderCanvas=function(n){if(this.visible===false||this.alpha===0){return}var m=n.context;if(this._mask){n.maskManager.pushMask(this._mask,m)}m.globalAlpha=this.worldAlpha;var k=this.worldTransform;var l,h;m.setTransform(k.a,k.c,k.b,k.d,k.tx,k.ty);if(!this.__tilePattern||this.refreshTexture){this.generateTilingTexture(false);if(this.tilingTexture){this.__tilePattern=m.createPattern(this.tilingTexture.baseTexture.source,"repeat")}else{return}}if(this.blendMode!==n.currentBlendMode){n.currentBlendMode=this.blendMode;m.globalCompositeOperation=e.blendModesCanvas[n.currentBlendMode]}var f=this.tilePosition;var g=this.tileScale;f.x%=this.tilingTexture.baseTexture.width;f.y%=this.tilingTexture.baseTexture.height;m.scale(g.x,g.y);m.translate(f.x,f.y);m.fillStyle=this.__tilePattern;m.fillRect(-f.x+(this.anchor.x*-this._width),-f.y+(this.anchor.y*-this._height),this._width/g.x,this._height/g.y);m.scale(1/g.x,1/g.y);m.translate(-f.x,-f.y);if(this._mask){n.maskManager.popMask(n.context)}for(l=0,h=this.children.length;l<h;l++){this.children[l]._renderCanvas(n)}};e.TilingSprite.prototype.getBounds=function(){var p=this._width;var o=this._height;var n=p*(1-this.anchor.x);var m=p*-this.anchor.x;var l=o*(1-this.anchor.y);var k=o*-this.anchor.y;var q=this.worldTransform;var D=q.a;var B=q.c;var A=q.b;var y=q.d;var E=q.tx;var C=q.ty;var u=D*m+A*k+E;var i=y*k+B*m+C;var t=D*n+A*k+E;var h=y*k+B*n+C;var s=D*n+A*l+E;var g=y*l+B*n+C;var r=D*m+A*l+E;var f=y*l+B*m+C;var x=-Infinity;var v=-Infinity;var z=Infinity;var w=Infinity;z=u<z?u:z;z=t<z?t:z;z=s<z?s:z;z=r<z?r:z;w=i<w?i:w;w=h<w?h:w;w=g<w?g:w;w=f<w?f:w;x=u>x?u:x;x=t>x?t:x;x=s>x?s:x;x=r>x?r:x;v=i>v?i:v;v=h>v?h:v;v=g>v?g:v;v=f>v?f:v;var j=this._bounds;j.x=z;j.width=x-z;j.y=w;j.height=v-w;this._currentBounds=j;return j};e.TilingSprite.prototype.onTextureUpdate=function(){};e.TilingSprite.prototype.generateTilingTexture=function(h){if(!this.texture.baseTexture.hasLoaded){return}var l=this.texture;var m=l.frame;var k,g;var f=m.width!==l.baseTexture.width||m.height!==l.baseTexture.height;var j=false;if(!h){if(f){k=m.width;g=m.height;j=true}}else{k=e.getNextPowerOfTwo(m.width);g=e.getNextPowerOfTwo(m.height);if(m.width!==k||m.height!==g){j=true}}if(j){var i;if(this.tilingTexture&&this.tilingTexture.isTiling){i=this.tilingTexture.canvasBuffer;i.resize(k,g);this.tilingTexture.baseTexture.width=k;this.tilingTexture.baseTexture.height=g;this.tilingTexture.needsUpdate=true}else{i=new e.CanvasBuffer(k,g);this.tilingTexture=e.Texture.fromCanvas(i.canvas);this.tilingTexture.canvasBuffer=i;this.tilingTexture.isTiling=true}i.context.drawImage(l.baseTexture.source,l.crop.x,l.crop.y,l.crop.width,l.crop.height,0,0,k,g);this.tileScaleOffset.x=m.width/k;this.tileScaleOffset.y=m.height/g}else{if(this.tilingTexture&&this.tilingTexture.isTiling){this.tilingTexture.destroy(true)}this.tileScaleOffset.x=1;this.tileScaleOffset.y=1;this.tilingTexture=l}this.refreshTexture=false;this.tilingTexture.baseTexture._powerOf2=true};e.BaseTextureCache={};e.texturesToUpdate=[];e.texturesToDestroy=[];e.BaseTextureCacheIdGenerator=0;e.BaseTexture=function(h,g){e.EventTarget.call(this);this.width=100;this.height=100;this.scaleMode=g||e.scaleModes.DEFAULT;this.hasLoaded=false;this.source=h;this.id=e.BaseTextureCacheIdGenerator++;this.premultipliedAlpha=true;this._glTextures=[];this._dirty=[];if(!h){return}if((this.source.complete||this.source.getContext)&&this.source.width&&this.source.height){this.hasLoaded=true;this.width=this.source.width;this.height=this.source.height;e.texturesToUpdate.push(this)}else{var f=this;this.source.onload=function(){f.hasLoaded=true;f.width=f.source.width;f.height=f.source.height;for(var j=0;j<f._glTextures.length;j++){f._dirty[j]=true}f.dispatchEvent({type:"loaded",content:f})};this.source.onerror=function(){f.dispatchEvent({type:"error",content:f})}}this.imageUrl=null;this._powerOf2=false};e.BaseTexture.prototype.constructor=e.BaseTexture;e.BaseTexture.prototype.destroy=function(){if(this.imageUrl){delete e.BaseTextureCache[this.imageUrl];delete e.TextureCache[this.imageUrl];this.imageUrl=null;this.source.src=null}else{if(this.source&&this.source._pixiId){delete e.BaseTextureCache[this.source._pixiId]}}this.source=null;e.texturesToDestroy.push(this)};e.BaseTexture.prototype.updateSourceImage=function(f){this.hasLoaded=false;this.source.src=null;this.source.src=f};e.BaseTexture.fromImage=function(g,f,h){var i=e.BaseTextureCache[g];if(f===undefined&&g.indexOf("data:")===-1){f=true}if(!i){var j=new Image();if(f){j.crossOrigin=""}j.src=g;i=new e.BaseTexture(j,h);i.imageUrl=g;e.BaseTextureCache[g]=i}return i};e.BaseTexture.fromCanvas=function(f,g){if(!f._pixiId){f._pixiId="canvas_"+e.TextureCacheIdGenerator++}var h=e.BaseTextureCache[f._pixiId];if(!h){h=new e.BaseTexture(f,g);e.BaseTextureCache[f._pixiId]=h}return h};e.TextureCache={};e.FrameCache={};e.TextureCacheIdGenerator=0;e.Texture=function(g,h){e.EventTarget.call(this);this.noFrame=false;if(!h){this.noFrame=true;h=new e.Rectangle(0,0,1,1)}if(g instanceof e.Texture){g=g.baseTexture}this.baseTexture=g;this.frame=h;this.trim=null;this.valid=false;this.scope=this;this._uvs=null;this.width=0;this.height=0;this.crop=new e.Rectangle(0,0,1,1);if(g.hasLoaded){if(this.noFrame){h=new e.Rectangle(0,0,g.width,g.height)}this.setFrame(h)}else{var f=this;g.addEventListener("loaded",function(){f.onBaseTextureLoaded()})}};e.Texture.prototype.constructor=e.Texture;e.Texture.prototype.onBaseTextureLoaded=function(){var f=this.baseTexture;f.removeEventListener("loaded",this.onLoaded);if(this.noFrame){this.frame=new e.Rectangle(0,0,f.width,f.height)}this.setFrame(this.frame);this.scope.dispatchEvent({type:"update",content:this})};e.Texture.prototype.destroy=function(f){if(f){this.baseTexture.destroy()}this.valid=false};e.Texture.prototype.setFrame=function(f){this.noFrame=false;this.frame=f;this.width=f.width;this.height=f.height;this.crop.x=f.x;this.crop.y=f.y;this.crop.width=f.width;this.crop.height=f.height;if(!this.trim&&(f.x+f.width>this.baseTexture.width||f.y+f.height>this.baseTexture.height)){throw new Error("Texture Error: frame does not fit inside the base Texture dimensions "+this)}this.valid=f&&f.width&&f.height&&this.baseTexture.source&&this.baseTexture.hasLoaded;if(this.trim){this.width=this.trim.width;this.height=this.trim.height;this.frame.width=this.trim.width;this.frame.height=this.trim.height}if(this.valid){e.Texture.frameUpdates.push(this)}};e.Texture.prototype._updateWebGLuvs=function(){if(!this._uvs){this._uvs=new e.TextureUvs()}var h=this.crop;var f=this.baseTexture.width;var g=this.baseTexture.height;this._uvs.x0=h.x/f;this._uvs.y0=h.y/g;this._uvs.x1=(h.x+h.width)/f;this._uvs.y1=h.y/g;this._uvs.x2=(h.x+h.width)/f;this._uvs.y2=(h.y+h.height)/g;this._uvs.x3=h.x/f;this._uvs.y3=(h.y+h.height)/g};e.Texture.fromImage=function(g,f,h){var i=e.TextureCache[g];if(!i){i=new e.Texture(e.BaseTexture.fromImage(g,f,h));e.TextureCache[g]=i}return i};e.Texture.fromFrame=function(g){var f=e.TextureCache[g];if(!f){throw new Error('The frameId "'+g+'" does not exist in the texture cache ')}return f};e.Texture.fromCanvas=function(f,g){var h=e.BaseTexture.fromCanvas(f,g);return new e.Texture(h)};e.Texture.addTextureToCache=function(f,g){e.TextureCache[g]=f};e.Texture.removeTextureFromCache=function(g){var f=e.TextureCache[g];delete e.TextureCache[g];delete e.BaseTextureCache[g];return f};e.Texture.frameUpdates=[];e.TextureUvs=function(){this.x0=0;this.y0=0;this.x1=0;this.y1=0;this.x2=0;this.y2=0;this.x3=0;this.y3=0};e.RenderTexture=function(h,f,i,g){e.EventTarget.call(this);this.width=h||100;this.height=f||100;this.frame=new e.Rectangle(0,0,this.width,this.height);this.crop=new e.Rectangle(0,0,this.width,this.height);this.baseTexture=new e.BaseTexture();this.baseTexture.width=this.width;this.baseTexture.height=this.height;this.baseTexture._glTextures=[];this.baseTexture.scaleMode=g||e.scaleModes.DEFAULT;this.baseTexture.hasLoaded=true;this.renderer=i||e.defaultRenderer;if(this.renderer.type===e.WEBGL_RENDERER){var j=this.renderer.gl;this.textureBuffer=new e.FilterTexture(j,this.width,this.height,this.baseTexture.scaleMode);this.baseTexture._glTextures[j.id]=this.textureBuffer.texture;this.render=this.renderWebGL;this.projection=new e.Point(this.width/2,-this.height/2)}else{this.render=this.renderCanvas;this.textureBuffer=new e.CanvasBuffer(this.width,this.height);this.baseTexture.source=this.textureBuffer.canvas}this.valid=true;e.Texture.frameUpdates.push(this)};e.RenderTexture.prototype=Object.create(e.Texture.prototype);e.RenderTexture.prototype.constructor=e.RenderTexture;e.RenderTexture.prototype.resize=function(h,f,g){if(h===this.width&&f===this.height){return}this.width=this.frame.width=this.crop.width=h;this.height=this.frame.height=this.crop.height=f;if(g){this.baseTexture.width=this.width;this.baseTexture.height=this.height}if(this.renderer.type===e.WEBGL_RENDERER){this.projection.x=this.width/2;this.projection.y=-this.height/2}this.textureBuffer.resize(this.width,this.height)};e.RenderTexture.prototype.clear=function(){if(this.renderer.type===e.WEBGL_RENDERER){this.renderer.gl.bindFramebuffer(this.renderer.gl.FRAMEBUFFER,this.textureBuffer.frameBuffer)}this.textureBuffer.clear()};e.RenderTexture.prototype.renderWebGL=function(o,g,f){var n=this.renderer.gl;n.colorMask(true,true,true,true);n.viewport(0,0,this.width,this.height);n.bindFramebuffer(n.FRAMEBUFFER,this.textureBuffer.frameBuffer);if(f){this.textureBuffer.clear()}var l=o.children;var m=o.worldTransform;o.worldTransform=e.RenderTexture.tempMatrix;o.worldTransform.d=-1;o.worldTransform.ty=this.projection.y*-2;if(g){o.worldTransform.tx=g.x;o.worldTransform.ty-=g.y}for(var k=0,h=l.length;k<h;k++){l[k].updateTransform()}e.WebGLRenderer.updateTextures();this.renderer.spriteBatch.dirty=true;this.renderer.renderDisplayObject(o,this.projection,this.textureBuffer.frameBuffer);o.worldTransform=m;this.renderer.spriteBatch.dirty=true};e.RenderTexture.prototype.renderCanvas=function(o,g,f){var m=o.children;var n=o.worldTransform;o.worldTransform=e.RenderTexture.tempMatrix;if(g){o.worldTransform.tx=g.x;o.worldTransform.ty=g.y}else{o.worldTransform.tx=0;o.worldTransform.ty=0}for(var l=0,h=m.length;l<h;l++){m[l].updateTransform()}if(f){this.textureBuffer.clear()}var k=this.textureBuffer.context;this.renderer.renderDisplayObject(o,k);k.setTransform(1,0,0,1,0,0);o.worldTransform=n};e.RenderTexture.tempMatrix=new e.Matrix();if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=e}exports.PIXI=e}else{if(typeof define!=="undefined"&&define.amd){define("PIXI",(function(){return b.PIXI=e})())}else{b.PIXI=e}}}).call(this);(function(){var a=this;var b=b||{VERSION:"2.0.7",GAMES:[],AUTO:0,CANVAS:1,WEBGL:2,HEADLESS:3,NONE:0,LEFT:1,RIGHT:2,UP:3,DOWN:4,SPRITE:0,BUTTON:1,IMAGE:2,GRAPHICS:3,TEXT:4,TILESPRITE:5,BITMAPTEXT:6,GROUP:7,RENDERTEXTURE:8,TILEMAP:9,TILEMAPLAYER:10,EMITTER:11,POLYGON:12,BITMAPDATA:13,CANVAS_FILTER:14,WEBGL_FILTER:15,ELLIPSE:16,SPRITEBATCH:17,RETROFONT:18,POINTER:19,blendModes:{NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16},scaleModes:{DEFAULT:0,LINEAR:0,NEAREST:1}};PIXI.InteractionManager=PIXI.InteractionManager||function(){};PIXI.dontSayHello=true;b.Utils={getProperty:function(j,k){var h=k.split("."),f=h.pop(),d=h.length,e=1,g=h[0];while(e<d&&(j=j[g])){g=h[e];e++}if(j){return j[f]}else{return null}},setProperty:function(k,m,g){var j=m.split("."),f=j.pop(),d=j.length,e=1,h=j[0];while(e<d&&(k=k[h])){h=j[e];e++}if(k){k[f]=g}return k},transposeArray:function(g){var d=new Array(g[0].length);for(var f=0;f<g[0].length;f++){d[f]=new Array(g.length-1);for(var e=g.length-1;e>-1;e--){d[f][e]=g[e][f]}}return d},rotateArray:function(d,f){if(typeof f!=="string"){f=((f%360)+360)%360}if(f===90||f===-270||f==="rotateLeft"){d=b.Utils.transposeArray(d);d=d.reverse()}else{if(f===-90||f===270||f==="rotateRight"){d=d.reverse();d=b.Utils.transposeArray(d)}else{if(Math.abs(f)===180||f==="rotate180"){for(var e=0;e<d.length;e++){d[e].reverse()}d=d.reverse()}}}return d},parseDimension:function(e,h){var g=0;var d=0;if(typeof e==="string"){if(e.substr(-1)==="%"){g=parseInt(e,10)/100;if(h===0){d=window.innerWidth*g}else{d=window.innerHeight*g}}else{d=parseInt(e,10)}}else{d=e}return d},shuffle:function(g){for(var f=g.length-1;f>0;f--){var e=Math.floor(Math.random()*(f+1));var d=g[f];g[f]=g[e];g[e]=d}return g},pad:function(j,d,i,e){if(typeof(d)=="undefined"){var d=0}if(typeof(i)=="undefined"){var i=" "}if(typeof(e)=="undefined"){var e=3}var g=0;if(d+1>=j.length){switch(e){case 1:j=new Array(d+1-j.length).join(i)+j;break;case 3:var f=Math.ceil((g=d-j.length)/2);var h=g-f;j=new Array(h+1).join(i)+j+new Array(f+1).join(i);break;default:j=j+new Array(d+1-j.length).join(i);break}}return j},isPlainObject:function(f){if(typeof(f)!=="object"||f.nodeType||f===f.window){return false}try{if(f.constructor&&!({}).hasOwnProperty.call(f.constructor.prototype,"isPrototypeOf")){return false}}catch(d){return false}return true},extend:function(){var n,f,d,e,k,l,j=arguments[0]||{},h=1,g=arguments.length,m=false;if(typeof j==="boolean"){m=j;j=arguments[1]||{};h=2}if(g===h){j=this;--h}for(;h<g;h++){if((n=arguments[h])!=null){for(f in n){d=j[f];e=n[f];if(j===e){continue}if(m&&e&&(b.Utils.isPlainObject(e)||(k=Array.isArray(e)))){if(k){k=false;l=d&&Array.isArray(d)?d:[]}else{l=d&&b.Utils.isPlainObject(d)?d:{}}j[f]=b.Utils.extend(m,l,e)}else{if(e!==undefined){j[f]=e}}}}}return j},mixin:function(h,g){if(!h||typeof(h)!=="object"){return g}for(var d in h){var f=h[d];if(f.childNodes||f.cloneNode){continue}var e=typeof(h[d]);if(!h[d]||e!=="object"){g[d]=h[d]}else{if(typeof(g[d])===e){g[d]=b.Utils.mixin(h[d],g[d])}else{g[d]=b.Utils.mixin(h[d],new f.constructor())}}}return g}};if(typeof Function.prototype.bind!="function"){Function.prototype.bind=(function(){var d=Array.prototype.slice;return function(e){var h=this,i=d.call(arguments,1);if(typeof h!="function"){throw new TypeError()}function f(){var j=i.concat(d.call(arguments));h.apply(this instanceof f?this:e,j)}f.prototype=(function g(j){if(j){g.prototype=j}if(!(this instanceof g)){return new g}})(h.prototype);return f}})()}if(!Array.isArray){Array.isArray=function(d){return Object.prototype.toString.call(d)=="[object Array]"}}if(!Array.prototype.forEach){Array.prototype.forEach=function(f){if(this===void 0||this===null){throw new TypeError()}var h=Object(this);var d=h.length>>>0;if(typeof f!=="function"){throw new TypeError()}var e=arguments.length>=2?arguments[1]:void 0;for(var g=0;g<d;g++){if(g in h){f.call(e,h[g],g,h)}}}}if(typeof window.Uint32Array!=="function"){var c=function(d){var e=new Array();window[d]=function(f){if(typeof(f)==="number"){Array.call(this,f);this.length=f;for(var g=0;g<this.length;g++){this[g]=0}}else{Array.call(this,f.length);this.length=f.length;for(var g=0;g<this.length;g++){this[g]=f[g]}}};window[d].prototype=e;window[d].constructor=window[d]};c("Uint32Array");c("Int16Array")}if(!window.console){window.console={};window.console.log=window.console.assert=function(){};window.console.warn=window.console.assert=function(){}}b.Circle=function(d,f,e){d=d||0;f=f||0;e=e||0;this.x=d;this.y=f;this._diameter=e;if(e>0){this._radius=e*0.5}else{this._radius=0}};b.Circle.prototype={circumference:function(){return 2*(Math.PI*this._radius)},setTo:function(d,f,e){this.x=d;this.y=f;this._diameter=e;this._radius=e*0.5;return this},copyFrom:function(d){return this.setTo(d.x,d.y,d.diameter)},copyTo:function(d){d.x=this.x;d.y=this.y;d.diameter=this._diameter;return d},distance:function(e,d){if(typeof d==="undefined"){d=false}if(d){return b.Math.distanceRounded(this.x,this.y,e.x,e.y)}else{return b.Math.distance(this.x,this.y,e.x,e.y)}},clone:function(d){if(typeof d==="undefined"){d=new b.Circle(this.x,this.y,this.diameter)}else{d.setTo(this.x,this.y,this.diameter)}return d},contains:function(d,e){return b.Circle.contains(this,d,e)},circumferencePoint:function(f,e,d){return b.Circle.circumferencePoint(this,f,e,d)},offset:function(e,d){this.x+=e;this.y+=d;return this},offsetPoint:function(d){return this.offset(d.x,d.y)},toString:function(){return"[{Phaser.Circle (x="+this.x+" y="+this.y+" diameter="+this.diameter+" radius="+this.radius+")}]"}};b.Circle.prototype.constructor=b.Circle;Object.defineProperty(b.Circle.prototype,"diameter",{get:function(){return this._diameter},set:function(d){if(d>0){this._diameter=d;this._radius=d*0.5}}});Object.defineProperty(b.Circle.prototype,"radius",{get:function(){return this._radius},set:function(d){if(d>0){this._radius=d;this._diameter=d*2}}});Object.defineProperty(b.Circle.prototype,"left",{get:function(){return this.x-this._radius},set:function(d){if(d>this.x){this._radius=0;this._diameter=0}else{this.radius=this.x-d}}});Object.defineProperty(b.Circle.prototype,"right",{get:function(){return this.x+this._radius},set:function(d){if(d<this.x){this._radius=0;this._diameter=0}else{this.radius=d-this.x}}});Object.defineProperty(b.Circle.prototype,"top",{get:function(){return this.y-this._radius},set:function(d){if(d>this.y){this._radius=0;this._diameter=0}else{this.radius=this.y-d}}});Object.defineProperty(b.Circle.prototype,"bottom",{get:function(){return this.y+this._radius},set:function(d){if(d<this.y){this._radius=0;this._diameter=0}else{this.radius=d-this.y}}});Object.defineProperty(b.Circle.prototype,"area",{get:function(){if(this._radius>0){return Math.PI*this._radius*this._radius}else{return 0}}});Object.defineProperty(b.Circle.prototype,"empty",{get:function(){return(this._diameter===0)},set:function(d){if(d===true){this.setTo(0,0,0)}}});b.Circle.contains=function(f,d,h){if(f.radius>0&&d>=f.left&&d<=f.right&&h>=f.top&&h<=f.bottom){var g=(f.x-d)*(f.x-d);var e=(f.y-h)*(f.y-h);return(g+e)<=(f.radius*f.radius)}else{return false}};b.Circle.equals=function(e,d){return(e.x==d.x&&e.y==d.y&&e.diameter==d.diameter)};b.Circle.intersects=function(e,d){return(b.Math.distance(e.x,e.y,d.x,d.y)<=(e.radius+d.radius))};b.Circle.circumferencePoint=function(d,g,f,e){if(typeof f==="undefined"){f=false}if(typeof e==="undefined"){e=new b.Point()}if(f===true){g=b.Math.degToRad(g)}e.x=d.x+d.radius*Math.cos(g);e.y=d.y+d.radius*Math.sin(g);return e};b.Circle.intersectsRectangle=function(n,e){var h=Math.abs(n.x-e.x-e.halfWidth);var m=e.halfWidth+n.radius;if(h>m){return false}var g=Math.abs(n.y-e.y-e.halfHeight);var k=e.halfHeight+n.radius;if(g>k){return false}if(h<=e.halfWidth||g<=e.halfHeight){return true}var i=h-e.halfWidth;var f=g-e.halfHeight;var l=i*i;var d=f*f;var j=n.radius*n.radius;return l+d<=j};PIXI.Circle=b.Circle;b.Point=function(d,e){d=d||0;e=e||0;this.x=d;this.y=e};b.Point.prototype={copyFrom:function(d){return this.setTo(d.x,d.y)},invert:function(){return this.setTo(this.y,this.x)},setTo:function(d,e){this.x=d||0;this.y=e||((e!==0)?this.x:0);return this},set:function(d,e){this.x=d||0;this.y=e||((e!==0)?this.x:0);return this},add:function(d,e){this.x+=d;this.y+=e;return this},subtract:function(d,e){this.x-=d;this.y-=e;return this},multiply:function(d,e){this.x*=d;this.y*=e;return this},divide:function(d,e){this.x/=d;this.y/=e;return this},clampX:function(e,d){this.x=b.Math.clamp(this.x,e,d);return this},clampY:function(e,d){this.y=b.Math.clamp(this.y,e,d);return this},clamp:function(e,d){this.x=b.Math.clamp(this.x,e,d);this.y=b.Math.clamp(this.y,e,d);return this},clone:function(d){if(typeof d==="undefined"){d=new b.Point(this.x,this.y)}else{d.setTo(this.x,this.y)}return d},copyTo:function(d){d.x=this.x;d.y=this.y;return d},distance:function(e,d){return b.Point.distance(this,e,d)},equals:function(d){return(d.x===this.x&&d.y===this.y)},angle:function(d,e){if(typeof e==="undefined"){e=false}if(e){return b.Math.radToDeg(Math.atan2(d.y-this.y,d.x-this.x))}else{return Math.atan2(d.y-this.y,d.x-this.x)}},angleSq:function(d){return this.subtract(d).angle(d.subtract(this))},rotate:function(d,h,f,e,g){return b.Point.rotate(this,d,h,f,e,g)},getMagnitude:function(){return Math.sqrt((this.x*this.x)+(this.y*this.y))},getMagnitudeSq:function(){return(this.x*this.x)+(this.y*this.y)},setMagnitude:function(d){return this.normalize().multiply(d,d)},normalize:function(){if(!this.isZero()){var d=this.getMagnitude();this.x/=d;this.y/=d}return this},isZero:function(){return(this.x===0&&this.y===0)},dot:function(d){return((this.x*d.x)+(this.y*d.y))},cross:function(d){return((this.x*d.y)-(this.y*d.x))},perp:function(){return this.setTo(-this.y,this.x)},rperp:function(){return this.setTo(this.y,-this.x)},normalRightHand:function(){return this.setTo(this.y*-1,this.x)},toString:function(){return"[{Point (x="+this.x+" y="+this.y+")}]"}};b.Point.prototype.constructor=b.Point;b.Point.add=function(e,d,f){if(typeof f==="undefined"){f=new b.Point()}f.x=e.x+d.x;f.y=e.y+d.y;return f};b.Point.subtract=function(e,d,f){if(typeof f==="undefined"){f=new b.Point()}f.x=e.x-d.x;f.y=e.y-d.y;return f};b.Point.multiply=function(e,d,f){if(typeof f==="undefined"){f=new b.Point()}f.x=e.x*d.x;f.y=e.y*d.y;return f};b.Point.divide=function(e,d,f){if(typeof f==="undefined"){f=new b.Point()}f.x=e.x/d.x;f.y=e.y/d.y;return f};b.Point.equals=function(e,d){return(e.x===d.x&&e.y===d.y)};b.Point.angle=function(e,d){return Math.atan2(e.y-d.y,e.x-d.x)};b.Point.angleSq=function(e,d){return e.subtract(d).angle(d.subtract(e))};b.Point.negative=function(d,e){if(typeof e==="undefined"){e=new b.Point()}return e.setTo(-d.x,-d.y)};b.Point.multiplyAdd=function(e,d,g,f){if(typeof f==="undefined"){f=new b.Point()}return f.setTo(e.x+d.x*g,e.y+d.y*g)};b.Point.interpolate=function(e,d,h,g){if(typeof g==="undefined"){g=new b.Point()}return g.setTo(e.x+(d.x-e.x)*h,e.y+(d.y-e.y)*h)};b.Point.perp=function(d,e){if(typeof e==="undefined"){e=new b.Point()}return e.setTo(-d.y,d.x)};b.Point.rperp=function(d,e){if(typeof e==="undefined"){e=new b.Point()}return e.setTo(d.y,-d.x)};b.Point.distance=function(e,d,f){if(typeof f==="undefined"){f=false}if(f){return b.Math.distanceRounded(e.x,e.y,d.x,d.y)}else{return b.Math.distance(e.x,e.y,d.x,d.y)}};b.Point.project=function(e,d,f){if(typeof f==="undefined"){f=new b.Point()}var g=e.dot(d)/d.getMagnitudeSq();if(g!==0){f.setTo(g*d.x,g*d.y)}return f};b.Point.projectUnit=function(e,d,f){if(typeof f==="undefined"){f=new b.Point()}var g=e.dot(d);if(g!==0){f.setTo(g*d.x,g*d.y)}return f};b.Point.normalRightHand=function(d,e){if(typeof e==="undefined"){e=new b.Point()}return e.setTo(d.y*-1,d.x)};b.Point.normalize=function(e,f){if(typeof f==="undefined"){f=new b.Point()}var d=e.getMagnitude();if(d!==0){f.setTo(e.x/d,e.y/d)}return f};b.Point.rotate=function(e,d,i,g,f,h){f=f||false;h=h||null;if(f){g=b.Math.degToRad(g)}if(h===null){h=Math.sqrt(((d-e.x)*(d-e.x))+((i-e.y)*(i-e.y)))}return e.setTo(d+h*Math.cos(g),i+h*Math.sin(g))};b.Point.centroid=function(f,d){if(typeof d==="undefined"){d=new b.Point()}if(Object.prototype.toString.call(f)!=="[object Array]"){throw new Error("Phaser.Point. Parameter 'points' must be an array")}var g=f.length;if(g<1){throw new Error("Phaser.Point. Parameter 'points' array must not be empty")}if(g===1){d.copyFrom(f[0]);return d}for(var e=0;e<g;e++){b.Point.add(d,f[e],d)}d.divide(g,g);return d};PIXI.Point=b.Point;b.Rectangle=function(e,g,f,d){e=e||0;g=g||0;f=f||0;d=d||0;this.x=e;this.y=g;this.width=f;this.height=d};b.Rectangle.prototype={offset:function(e,d){this.x+=e;this.y+=d;return this},offsetPoint:function(d){return this.offset(d.x,d.y)},setTo:function(e,g,f,d){this.x=e;this.y=g;this.width=f;this.height=d;return this},floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y)},floorAll:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.width=Math.floor(this.width);this.height=Math.floor(this.height)},copyFrom:function(d){return this.setTo(d.x,d.y,d.width,d.height)},copyTo:function(d){d.x=this.x;d.y=this.y;d.width=this.width;d.height=this.height;return d},inflate:function(e,d){return b.Rectangle.inflate(this,e,d)},size:function(d){return b.Rectangle.size(this,d)},clone:function(d){return b.Rectangle.clone(this,d)},contains:function(d,e){return b.Rectangle.contains(this,d,e)},containsRect:function(d){return b.Rectangle.containsRect(this,d)},equals:function(d){return b.Rectangle.equals(this,d)},intersection:function(d,e){return b.Rectangle.intersection(this,d,e)},intersects:function(d,e){return b.Rectangle.intersects(this,d,e)},intersectsRaw:function(h,f,g,e,d){return b.Rectangle.intersectsRaw(this,h,f,g,e,d)},union:function(d,e){return b.Rectangle.union(this,d,e)},toString:function(){return"[{Rectangle (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+" empty="+this.empty+")}]"}};Object.defineProperty(b.Rectangle.prototype,"halfWidth",{get:function(){return Math.round(this.width/2)}});Object.defineProperty(b.Rectangle.prototype,"halfHeight",{get:function(){return Math.round(this.height/2)}});Object.defineProperty(b.Rectangle.prototype,"bottom",{get:function(){return this.y+this.height},set:function(d){if(d<=this.y){this.height=0}else{this.height=(this.y-d)}}});Object.defineProperty(b.Rectangle.prototype,"bottomRight",{get:function(){return new b.Point(this.right,this.bottom)},set:function(d){this.right=d.x;this.bottom=d.y}});Object.defineProperty(b.Rectangle.prototype,"left",{get:function(){return this.x},set:function(d){if(d>=this.right){this.width=0}else{this.width=this.right-d}this.x=d}});Object.defineProperty(b.Rectangle.prototype,"right",{get:function(){return this.x+this.width},set:function(d){if(d<=this.x){this.width=0}else{this.width=d-this.x}}});Object.defineProperty(b.Rectangle.prototype,"volume",{get:function(){return this.width*this.height}});Object.defineProperty(b.Rectangle.prototype,"perimeter",{get:function(){return(this.width*2)+(this.height*2)}});Object.defineProperty(b.Rectangle.prototype,"centerX",{get:function(){return this.x+this.halfWidth},set:function(d){this.x=d-this.halfWidth}});Object.defineProperty(b.Rectangle.prototype,"centerY",{get:function(){return this.y+this.halfHeight},set:function(d){this.y=d-this.halfHeight}});Object.defineProperty(b.Rectangle.prototype,"randomX",{get:function(){return this.x+(Math.random()*this.width)}});Object.defineProperty(b.Rectangle.prototype,"randomY",{get:function(){return this.y+(Math.random()*this.height)}});Object.defineProperty(b.Rectangle.prototype,"top",{get:function(){return this.y},set:function(d){if(d>=this.bottom){this.height=0;this.y=d}else{this.height=(this.bottom-d)}}});Object.defineProperty(b.Rectangle.prototype,"topLeft",{get:function(){return new b.Point(this.x,this.y)},set:function(d){this.x=d.x;this.y=d.y}});Object.defineProperty(b.Rectangle.prototype,"empty",{get:function(){return(!this.width||!this.height)},set:function(d){if(d===true){this.setTo(0,0,0,0)}}});b.Rectangle.prototype.constructor=b.Rectangle;b.Rectangle.inflate=function(e,f,d){e.x-=f;e.width+=2*f;e.y-=d;e.height+=2*d;return e};b.Rectangle.inflatePoint=function(e,d){return b.Rectangle.inflate(e,d.x,d.y)};b.Rectangle.size=function(d,e){if(typeof e==="undefined"||e===null){e=new b.Point(d.width,d.height)}else{e.setTo(d.width,d.height)}return e};b.Rectangle.clone=function(d,e){if(typeof e==="undefined"||e===null){e=new b.Rectangle(d.x,d.y,d.width,d.height)}else{e.setTo(d.x,d.y,d.width,d.height)}return e};b.Rectangle.contains=function(e,d,f){if(e.width<=0||e.height<=0){return false}return(d>=e.x&&d<=e.right&&f>=e.y&&f<=e.bottom)};b.Rectangle.containsRaw=function(g,f,h,e,d,i){return(d>=g&&d<=(g+h)&&i>=f&&i<=(f+e))};b.Rectangle.containsPoint=function(e,d){return b.Rectangle.contains(e,d.x,d.y)};b.Rectangle.containsRect=function(e,d){if(e.volume>d.volume){return false}return(e.x>=d.x&&e.y>=d.y&&e.right<=d.right&&e.bottom<=d.bottom)};b.Rectangle.equals=function(e,d){return(e.x==d.x&&e.y==d.y&&e.width==d.width&&e.height==d.height)};b.Rectangle.intersection=function(e,d,f){if(typeof f==="undefined"){f=new b.Rectangle()}if(b.Rectangle.intersects(e,d)){f.x=Math.max(e.x,d.x);f.y=Math.max(e.y,d.y);f.width=Math.min(e.right,d.right)-f.x;f.height=Math.min(e.bottom,d.bottom)-f.y}return f};b.Rectangle.intersects=function(e,d){if(e.width<=0||e.height<=0||d.width<=0||d.height<=0){return false}return !(e.right<d.x||e.bottom<d.y||e.x>d.right||e.y>d.bottom)};b.Rectangle.intersectsRaw=function(d,i,g,h,f,e){if(typeof e==="undefined"){e=0}return !(i>d.right+e||g<d.left-e||h>d.bottom+e||f<d.top-e)};b.Rectangle.union=function(e,d,f){if(typeof f==="undefined"){f=new b.Rectangle()}return f.setTo(Math.min(e.x,d.x),Math.min(e.y,d.y),Math.max(e.right,d.right)-Math.min(e.left,d.left),Math.max(e.bottom,d.bottom)-Math.min(e.top,d.top))};PIXI.Rectangle=b.Rectangle;PIXI.EmptyRectangle=new b.Rectangle(0,0,0,0);b.Line=function(e,g,d,f){e=e||0;g=g||0;d=d||0;f=f||0;this.start=new b.Point(e,g);this.end=new b.Point(d,f)};b.Line.prototype={setTo:function(e,g,d,f){this.start.setTo(e,g);this.end.setTo(d,f);return this},fromSprite:function(e,f,d){if(typeof d==="undefined"){d=false}if(d){return this.setTo(e.center.x,e.center.y,f.center.x,f.center.y)}else{return this.setTo(e.x,e.y,f.x,f.y)}},intersects:function(e,f,d){return b.Line.intersectsPoints(this.start,this.end,e.start,e.end,f,d)},pointOnLine:function(d,e){return((d-this.start.x)*(this.end.y-this.start.y)===(this.end.x-this.start.x)*(e-this.start.y))},pointOnSegment:function(e,i){var f=Math.min(this.start.x,this.end.x);var h=Math.max(this.start.x,this.end.x);var d=Math.min(this.start.y,this.end.y);var g=Math.max(this.start.y,this.end.y);return(this.pointOnLine(e,i)&&(e>=f&&e<=h)&&(i>=d&&i<=g))},coordinatesOnLine:function(j,h){if(typeof j==="undefined"){j=1}if(typeof h==="undefined"){h=[]}var e=Math.round(this.start.x);var o=Math.round(this.start.y);var d=Math.round(this.end.x);var m=Math.round(this.end.y);var q=Math.abs(d-e);var p=Math.abs(m-o);var n=(e<d)?1:-1;var l=(o<m)?1:-1;var f=q-p;h.push([e,o]);var g=1;while(!((e==d)&&(o==m))){var k=f<<1;if(k>-p){f-=p;e+=n}if(k<q){f+=q;o+=l}if(g%j===0){h.push([e,o])}g++}return h}};Object.defineProperty(b.Line.prototype,"length",{get:function(){return Math.sqrt((this.end.x-this.start.x)*(this.end.x-this.start.x)+(this.end.y-this.start.y)*(this.end.y-this.start.y))}});Object.defineProperty(b.Line.prototype,"angle",{get:function(){return Math.atan2(this.end.y-this.start.y,this.end.x-this.start.x)}});Object.defineProperty(b.Line.prototype,"slope",{get:function(){return(this.end.y-this.start.y)/(this.end.x-this.start.x)}});Object.defineProperty(b.Line.prototype,"perpSlope",{get:function(){return -((this.end.x-this.start.x)/(this.end.y-this.start.y))}});Object.defineProperty(b.Line.prototype,"x",{get:function(){return Math.min(this.start.x,this.end.x)}});Object.defineProperty(b.Line.prototype,"y",{get:function(){return Math.min(this.start.y,this.end.y)}});Object.defineProperty(b.Line.prototype,"left",{get:function(){return Math.min(this.start.x,this.end.x)}});Object.defineProperty(b.Line.prototype,"right",{get:function(){return Math.max(this.start.x,this.end.x)}});Object.defineProperty(b.Line.prototype,"top",{get:function(){return Math.min(this.start.y,this.end.y)}});Object.defineProperty(b.Line.prototype,"bottom",{get:function(){return Math.max(this.start.y,this.end.y)}});Object.defineProperty(b.Line.prototype,"width",{get:function(){return Math.abs(this.start.x-this.end.x)}});Object.defineProperty(b.Line.prototype,"height",{get:function(){return Math.abs(this.start.y-this.end.y)}});b.Line.intersectsPoints=function(s,q,n,m,o,u){if(typeof o==="undefined"){o=true}if(typeof u==="undefined"){u=new b.Point()}var i=q.y-s.y;var h=m.y-n.y;var r=s.x-q.x;var p=n.x-m.x;var k=(q.x*s.y)-(s.x*q.y);var j=(m.x*n.y)-(n.x*m.y);var l=(i*p)-(h*r);if(l===0){return null}u.x=((r*j)-(p*k))/l;u.y=((h*k)-(i*j))/l;if(o){var t=((m.y-n.y)*(q.x-s.x)-(m.x-n.x)*(q.y-s.y));var g=(((m.x-n.x)*(s.y-n.y))-(m.y-n.y)*(s.x-n.x))/t;var d=(((q.x-s.x)*(s.y-n.y))-((q.y-s.y)*(s.x-n.x)))/t;if(g>=0&&g<=1&&d>=0&&d<=1){return u}else{return null}}return u};b.Line.intersects=function(f,e,g,d){return b.Line.intersectsPoints(f.start,f.end,e.start,e.end,g,d)};b.Ellipse=function(e,g,f,d){this.type=b.ELLIPSE;e=e||0;g=g||0;f=f||0;d=d||0;this.x=e;this.y=g;this.width=f;this.height=d};b.Ellipse.prototype={setTo:function(e,g,f,d){this.x=e;this.y=g;this.width=f;this.height=d;return this},copyFrom:function(d){return this.setTo(d.x,d.y,d.width,d.height)},copyTo:function(d){d.x=this.x;d.y=this.y;d.width=this.width;d.height=this.height;return d},clone:function(d){if(typeof d==="undefined"){d=new b.Ellipse(this.x,this.y,this.width,this.height)}else{d.setTo(this.x,this.y,this.width,this.height)}return d},contains:function(d,e){return b.Ellipse.contains(this,d,e)},toString:function(){return"[{Phaser.Ellipse (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+")}]"}};b.Ellipse.prototype.constructor=b.Ellipse;Object.defineProperty(b.Ellipse.prototype,"left",{get:function(){return this.x},set:function(d){this.x=d}});Object.defineProperty(b.Ellipse.prototype,"right",{get:function(){return this.x+this.width},set:function(d){if(d<this.x){this.width=0}else{this.width=this.x+d}}});Object.defineProperty(b.Ellipse.prototype,"top",{get:function(){return this.y},set:function(d){this.y=d}});Object.defineProperty(b.Ellipse.prototype,"bottom",{get:function(){return this.y+this.height},set:function(d){if(d<this.y){this.height=0}else{this.height=this.y+d}}});Object.defineProperty(b.Ellipse.prototype,"empty",{get:function(){return(this.width===0||this.height===0)},set:function(d){if(d===true){this.setTo(0,0,0,0)}}});b.Ellipse.contains=function(g,e,h){if(g.width<=0||g.height<=0){return false}var f=((e-g.x)/g.width)-0.5;var d=((h-g.y)/g.height)-0.5;f*=f;d*=d;return(f+d<0.25)};b.Ellipse.prototype.getBounds=function(){return new b.Rectangle(this.x,this.y,this.width,this.height)};PIXI.Ellipse=b.Ellipse;b.Polygon=function(f){this.type=b.POLYGON;if(!(f instanceof Array)){f=Array.prototype.slice.call(arguments)}if(typeof f[0]==="number"){var g=[];for(var e=0,d=f.length;e<d;e+=2){g.push(new b.Point(f[e],f[e+1]))}f=g}this._points=f};b.Polygon.prototype={clone:function(){var e=[];for(var d=0;d<this.points.length;d++){e.push(this.points[d].clone())}return new b.Polygon(e)},contains:function(o,n){var f=false;for(var k=0,h=this.points.length-1;k<this.points.length;h=k++){var m=this.points[k].x;var g=this.points[k].y;var l=this.points[h].x;var e=this.points[h].y;var d=((g>n)!==(e>n))&&(o<(l-m)*(n-g)/(e-g)+m);if(d){f=!f}}return f}};b.Polygon.prototype.constructor=b.Polygon;Object.defineProperty(b.Polygon.prototype,"points",{get:function(){return this._points},set:function(f){if(!(f instanceof Array)){f=Array.prototype.slice.call(arguments)}if(typeof f[0]==="number"){var g=[];for(var e=0,d=f.length;e<d;e+=2){g.push(new b.Point(f[e],f[e+1]))}f=g}this._points=f}});Object.defineProperty(b.Polygon.prototype,"area",{get:function(){var k;var j;var d;var f;var e;var h=Number.MAX_VALUE;var g=0;for(e=0;e<this.points.length;e++){if(this.points[e].y<h){h=this.points[e].y}}for(e=0;e<this.points.length;e++){k=this.points[e];if(e===this.points.length-1){j=this.points[0]}else{j=this.points[e+1]}d=((k.y-h)+(j.y-h))/2;f=k.x-j.x;g+=d*f}return g}});PIXI.Polygon=b.Polygon;b.Camera=function(f,i,e,h,g,d){this.game=f;this.world=f.world;this.id=0;this.view=new b.Rectangle(e,h,g,d);this.screenView=new b.Rectangle(e,h,g,d);this.bounds=new b.Rectangle(e,h,g,d);this.deadzone=null;this.visible=true;this.atLimit={x:false,y:false};this.target=null;this._edge=0;this.displayObject=null;this.scale=null};b.Camera.FOLLOW_LOCKON=0;b.Camera.FOLLOW_PLATFORMER=1;b.Camera.FOLLOW_TOPDOWN=2;b.Camera.FOLLOW_TOPDOWN_TIGHT=3;b.Camera.prototype={follow:function(i,f){if(typeof f==="undefined"){f=b.Camera.FOLLOW_LOCKON}this.target=i;var g;switch(f){case b.Camera.FOLLOW_PLATFORMER:var d=this.width/8;var e=this.height/3;this.deadzone=new b.Rectangle((this.width-d)/2,(this.height-e)/2-e*0.25,d,e);break;case b.Camera.FOLLOW_TOPDOWN:g=Math.max(this.width,this.height)/4;this.deadzone=new b.Rectangle((this.width-g)/2,(this.height-g)/2,g,g);break;case b.Camera.FOLLOW_TOPDOWN_TIGHT:g=Math.max(this.width,this.height)/8;this.deadzone=new b.Rectangle((this.width-g)/2,(this.height-g)/2,g,g);break;case b.Camera.FOLLOW_LOCKON:this.deadzone=null;break;default:this.deadzone=null;break}},unfollow:function(){this.target=null},focusOn:function(d){this.setPosition(Math.round(d.x-this.view.halfWidth),Math.round(d.y-this.view.halfHeight))},focusOnXY:function(d,e){this.setPosition(Math.round(d-this.view.halfWidth),Math.round(e-this.view.halfHeight))},update:function(){if(this.target){this.updateTarget()}if(this.bounds){this.checkBounds()}this.displayObject.position.x=-this.view.x;this.displayObject.position.y=-this.view.y},updateTarget:function(){if(this.deadzone){this._edge=this.target.x-this.view.x;if(this._edge<this.deadzone.left){this.view.x=this.target.x-this.deadzone.left}else{if(this._edge>this.deadzone.right){this.view.x=this.target.x-this.deadzone.right}}this._edge=this.target.y-this.view.y;if(this._edge<this.deadzone.top){this.view.y=this.target.y-this.deadzone.top}else{if(this._edge>this.deadzone.bottom){this.view.y=this.target.y-this.deadzone.bottom}}}else{this.view.x=this.target.x-this.view.halfWidth;this.view.y=this.target.y-this.view.halfHeight}},setBoundsToWorld:function(){this.bounds.setTo(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height)},checkBounds:function(){this.atLimit.x=false;this.atLimit.y=false;if(this.view.x<=this.bounds.x){this.atLimit.x=true;this.view.x=this.bounds.x}if(this.view.right>=this.bounds.right){this.atLimit.x=true;this.view.x=this.bounds.right-this.width}if(this.view.y<=this.bounds.top){this.atLimit.y=true;this.view.y=this.bounds.top}if(this.view.bottom>=this.bounds.bottom){this.atLimit.y=true;this.view.y=this.bounds.bottom-this.height}this.view.floor()},setPosition:function(d,e){this.view.x=d;this.view.y=e;if(this.bounds){this.checkBounds()}},setSize:function(e,d){this.view.width=e;this.view.height=d},reset:function(){this.target=null;this.view.x=0;this.view.y=0}};b.Camera.prototype.constructor=b.Camera;Object.defineProperty(b.Camera.prototype,"x",{get:function(){return this.view.x},set:function(d){this.view.x=d;if(this.bounds){this.checkBounds()}}});Object.defineProperty(b.Camera.prototype,"y",{get:function(){return this.view.y},set:function(d){this.view.y=d;if(this.bounds){this.checkBounds()}}});Object.defineProperty(b.Camera.prototype,"width",{get:function(){return this.view.width},set:function(d){this.view.width=d}});Object.defineProperty(b.Camera.prototype,"height",{get:function(){return this.view.height},set:function(d){this.view.height=d}});b.State=function(){this.game=null;this.add=null;this.make=null;this.camera=null;this.cache=null;this.input=null;this.load=null;this.math=null;this.sound=null;this.scale=null;this.stage=null;this.time=null;this.tweens=null;this.world=null;this.particles=null;this.physics=null;this.rnd=null};b.State.prototype={preload:function(){},loadUpdate:function(){},loadRender:function(){},create:function(){},update:function(){},render:function(){},paused:function(){},pauseUpdate:function(){},shutdown:function(){}};b.State.prototype.constructor=b.State;b.StateManager=function(e,d){this.game=e;this.states={};this._pendingState=null;if(typeof d!=="undefined"&&d!==null){this._pendingState=d}this._clearWorld=false;this._clearCache=false;this._created=false;this._args=[];this.current="";this.onInitCallback=null;this.onPreloadCallback=null;this.onCreateCallback=null;this.onUpdateCallback=null;this.onRenderCallback=null;this.onPreRenderCallback=null;this.onLoadUpdateCallback=null;this.onLoadRenderCallback=null;this.onPausedCallback=null;this.onResumedCallback=null;this.onPauseUpdateCallback=null;this.onShutDownCallback=null};b.StateManager.prototype={boot:function(){this.game.onPause.add(this.pause,this);this.game.onResume.add(this.resume,this);this.game.load.onLoadComplete.add(this.loadComplete,this);if(this._pendingState!==null){if(typeof this._pendingState==="string"){this.start(this._pendingState,false,false)}else{this.add("default",this._pendingState,true)}}},add:function(e,f,d){if(typeof d==="undefined"){d=false}var g;if(f instanceof b.State){g=f}else{if(typeof f==="object"){g=f;g.game=this.game}else{if(typeof f==="function"){g=new f(this.game)}}}this.states[e]=g;if(d){if(this.game.isBooted){this.start(e)}else{this._pendingState=e}}return g},remove:function(d){if(this.current===d){this.callbackContext=null;this.onInitCallback=null;this.onShutDownCallback=null;this.onPreloadCallback=null;this.onLoadRenderCallback=null;this.onLoadUpdateCallback=null;this.onCreateCallback=null;this.onUpdateCallback=null;this.onRenderCallback=null;this.onPausedCallback=null;this.onResumedCallback=null;this.onPauseUpdateCallback=null}delete this.states[d]},start:function(e,d,f){if(typeof d==="undefined"){d=true}if(typeof f==="undefined"){f=false}if(this.checkState(e)){this._pendingState=e;this._clearWorld=d;this._clearCache=f;if(arguments.length>3){this._args=Array.prototype.splice.call(arguments,3)}}},restart:function(d,e){if(typeof d==="undefined"){d=true}if(typeof e==="undefined"){e=false}this._pendingState=this.current;this._clearWorld=d;this._clearCache=e;if(arguments.length>2){this._args=Array.prototype.splice.call(arguments,2)}},dummy:function(){},preUpdate:function(){if(this._pendingState&&this.game.isBooted){if(this.current){if(this.onShutDownCallback){this.onShutDownCallback.call(this.callbackContext,this.game)}this.game.tweens.removeAll();this.game.camera.reset();this.game.input.reset(true);this.game.physics.clear();this.game.time.removeAll();if(this._clearWorld){this.game.world.shutdown();if(this._clearCache===true){this.game.cache.destroy()}}}this.setCurrentState(this._pendingState);if(this.onPreloadCallback){this.game.load.reset();this.onPreloadCallback.call(this.callbackContext,this.game);if(this.game.load.totalQueuedFiles()===0&&this.game.load.totalQueuedPacks()===0){this.loadComplete()}else{this.game.load.start()}}else{this.loadComplete()}if(this.current===this._pendingState){this._pendingState=null}}},checkState:function(d){if(this.states[d]){var e=false;if(this.states[d]["preload"]){e=true}if(this.states[d]["create"]){e=true}if(this.states[d]["update"]){e=true}if(this.states[d]["render"]){e=true}if(e===false){console.warn("Invalid Phaser State object given. Must contain at least a one of the required functions: preload, create, update or render");return false}return true}else{console.warn("Phaser.StateManager - No state found with the key: "+d);return false}},link:function(d){this.states[d].game=this.game;this.states[d].add=this.game.add;this.states[d].make=this.game.make;this.states[d].camera=this.game.camera;this.states[d].cache=this.game.cache;this.states[d].input=this.game.input;this.states[d].load=this.game.load;this.states[d].math=this.game.math;this.states[d].sound=this.game.sound;this.states[d].scale=this.game.scale;this.states[d].state=this;this.states[d].stage=this.game.stage;this.states[d].time=this.game.time;this.states[d].tweens=this.game.tweens;this.states[d].world=this.game.world;this.states[d].particles=this.game.particles;this.states[d].rnd=this.game.rnd;this.states[d].physics=this.game.physics},setCurrentState:function(d){this.callbackContext=this.states[d];this.link(d);this.onInitCallback=this.states[d]["init"]||this.dummy;this.onPreloadCallback=this.states[d]["preload"]||null;this.onLoadRenderCallback=this.states[d]["loadRender"]||null;this.onLoadUpdateCallback=this.states[d]["loadUpdate"]||null;this.onCreateCallback=this.states[d]["create"]||null;this.onUpdateCallback=this.states[d]["update"]||null;this.onPreRenderCallback=this.states[d]["preRender"]||null;this.onRenderCallback=this.states[d]["render"]||null;this.onPausedCallback=this.states[d]["paused"]||null;this.onResumedCallback=this.states[d]["resumed"]||null;this.onPauseUpdateCallback=this.states[d]["pauseUpdate"]||null;this.onShutDownCallback=this.states[d]["shutdown"]||this.dummy;this.current=d;this._created=false;this.onInitCallback.apply(this.callbackContext,this._args);this._args=[]},getCurrentState:function(){return this.states[this.current]},loadComplete:function(){if(this._created===false&&this.onCreateCallback){this._created=true;this.onCreateCallback.call(this.callbackContext,this.game)}else{this._created=true}},pause:function(){if(this._created&&this.onPausedCallback){this.onPausedCallback.call(this.callbackContext,this.game)}},resume:function(){if(this._created&&this.onResumedCallback){this.onResumedCallback.call(this.callbackContext,this.game)}},update:function(){if(this._created&&this.onUpdateCallback){this.onUpdateCallback.call(this.callbackContext,this.game)}else{if(this.onLoadUpdateCallback){this.onLoadUpdateCallback.call(this.callbackContext,this.game)}}},pauseUpdate:function(){if(this._created&&this.onPauseUpdateCallback){this.onPauseUpdateCallback.call(this.callbackContext,this.game)}else{if(this.onLoadUpdateCallback){this.onLoadUpdateCallback.call(this.callbackContext,this.game)}}},preRender:function(){if(this.onPreRenderCallback){this.onPreRenderCallback.call(this.callbackContext,this.game)}},render:function(){if(this._created&&this.onRenderCallback){if(this.game.renderType===b.CANVAS){this.game.context.save();this.game.context.setTransform(1,0,0,1,0,0)}this.onRenderCallback.call(this.callbackContext,this.game);if(this.game.renderType===b.CANVAS){this.game.context.restore()}}else{if(this.onLoadRenderCallback){this.onLoadRenderCallback.call(this.callbackContext,this.game)}}},destroy:function(){this.callbackContext=null;this.onInitCallback=null;this.onShutDownCallback=null;this.onPreloadCallback=null;this.onLoadRenderCallback=null;this.onLoadUpdateCallback=null;this.onCreateCallback=null;this.onUpdateCallback=null;this.onRenderCallback=null;this.onPausedCallback=null;this.onResumedCallback=null;this.onPauseUpdateCallback=null;this.game=null;this.states={};this._pendingState=null}};b.StateManager.prototype.constructor=b.StateManager;b.LinkedList=function(){this.next=null;this.prev=null;this.first=null;this.last=null;this.total=0};b.LinkedList.prototype={add:function(d){if(this.total===0&&this.first===null&&this.last===null){this.first=d;this.last=d;this.next=d;d.prev=this;this.total++;return d}this.last.next=d;d.prev=this.last;this.last=d;this.total++;return d},reset:function(){this.first=null;this.last=null;this.next=null;this.prev=null;this.total=0},remove:function(d){if(this.total===1){this.reset();d.next=d.prev=null;return}if(d===this.first){this.first=this.first.next}else{if(d===this.last){this.last=this.last.prev}}if(d.prev){d.prev.next=d.next}if(d.next){d.next.prev=d.prev}d.next=d.prev=null;if(this.first===null){this.last=null}this.total--},callAll:function(e){if(!this.first||!this.last){return}var d=this.first;do{if(d&&d[e]){d[e].call(d)}d=d.next}while(d!=this.last.next)}};b.LinkedList.prototype.constructor=b.LinkedList;b.ArrayList=function(){this.total=0;this.position=0;this.list=[]};b.ArrayList.prototype={add:function(d){if(!this.exists(d)){this.list.push(d);this.total++}return d},getIndex:function(d){return this.list.indexOf(d)},exists:function(d){return(this.list.indexOf(d)>-1)},reset:function(){this.list.length=0;this.total=0},remove:function(e){var d=this.list.indexOf(e);if(d>-1){this.list.splice(d,1);this.total--;return e}},setAll:function(e,f){var d=this.list.length;while(d--){if(this.list[d]&&this.list[d][e]){this.list[d][e]=f}}},callAll:function(f){var d=Array.prototype.splice.call(arguments,1);var e=this.list.length;while(e--){if(this.list[e]&&this.list[e][f]){this.list[e][f].apply(this.list[e],d)}}}};Object.defineProperty(b.ArrayList.prototype,"first",{get:function(){this.position=0;if(this.total>0){return this.list[0]}else{return null}}});Object.defineProperty(b.ArrayList.prototype,"next",{get:function(){if(this.position<this.total){this.position++;return this.list[this.position]}else{return null}}});b.ArrayList.prototype.constructor=b.ArrayList;b.Signal=function(){this._bindings=[];this._prevParams=null;var d=this;this.dispatch=function(){b.Signal.prototype.dispatch.apply(d,arguments)}};b.Signal.prototype={memorize:false,_shouldPropagate:true,active:true,validateListener:function(d,e){if(typeof d!=="function"){throw new Error("Phaser.Signal: listener is a required param of {fn}() and should be a Function.".replace("{fn}",e))}},_registerListener:function(h,f,g,e){var d=this._indexOfListener(h,g);var i;if(d!==-1){i=this._bindings[d];if(i.isOnce()!==f){throw new Error("You cannot add"+(f?"":"Once")+"() then add"+(!f?"":"Once")+"() the same listener without removing the relationship first.")}}else{i=new b.SignalBinding(this,h,f,g,e);this._addBinding(i)}if(this.memorize&&this._prevParams){i.execute(this._prevParams)}return i},_addBinding:function(d){var e=this._bindings.length;do{e--}while(this._bindings[e]&&d._priority<=this._bindings[e]._priority);this._bindings.splice(e+1,0,d)},_indexOfListener:function(e,d){var g=this._bindings.length;var f;while(g--){f=this._bindings[g];if(f._listener===e&&f.context===d){return g}}return -1},has:function(e,d){return this._indexOfListener(e,d)!==-1},add:function(f,e,d){this.validateListener(f,"add");return this._registerListener(f,false,e,d)},addOnce:function(f,e,d){this.validateListener(f,"addOnce");return this._registerListener(f,true,e,d)},remove:function(f,e){this.validateListener(f,"remove");var d=this._indexOfListener(f,e);if(d!==-1){this._bindings[d]._destroy();this._bindings.splice(d,1)}return f},removeAll:function(d){if(typeof d==="undefined"){d=null}var e=this._bindings.length;while(e--){if(d){if(this._bindings[e].context===d){this._bindings[e]._destroy();this._bindings.splice(e,1)}}else{this._bindings[e]._destroy()}}this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=false},dispatch:function(){if(!this.active){return}var d=Array.prototype.slice.call(arguments);var f=this._bindings.length;var e;if(this.memorize){this._prevParams=d}if(!f){return}e=this._bindings.slice();this._shouldPropagate=true;do{f--}while(e[f]&&this._shouldPropagate&&e[f].execute(d)!==false)},forget:function(){this._prevParams=null},dispose:function(){this.removeAll();delete this._bindings;delete this._prevParams},toString:function(){return"[Phaser.Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};b.Signal.prototype.constructor=b.Signal;b.SignalBinding=function(h,g,e,f,d){this._listener=g;this._isOnce=e;this.context=f;this._signal=h;this._priority=d||0};b.SignalBinding.prototype={active:true,params:null,execute:function(d){var f,e;if(this.active&&!!this._listener){e=this.params?this.params.concat(d):d;f=this._listener.apply(this.context,e);if(this._isOnce){this.detach()}}return f},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return(!!this._signal&&!!this._listener)},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal;delete this._listener;delete this.context},toString:function(){return"[Phaser.SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}};b.SignalBinding.prototype.constructor=b.SignalBinding;b.Filter=function(e,d,f){this.game=e;this.type=b.WEBGL_FILTER;this.passes=[this];this.shaders=[];this.dirty=true;this.padding=0;this.uniforms={time:{type:"1f",value:0},resolution:{type:"2f",value:{x:256,y:256}},mouse:{type:"2f",value:{x:0,y:0}}};this.fragmentSrc=f||[]};b.Filter.prototype={init:function(){},setResolution:function(e,d){this.uniforms.resolution.value.x=e;this.uniforms.resolution.value.y=d},update:function(d){if(typeof d!=="undefined"){if(d.x>0){this.uniforms.mouse.x=d.x.toFixed(2)}if(d.y>0){this.uniforms.mouse.y=d.y.toFixed(2)}}this.uniforms.time.value=this.game.time.totalElapsedSeconds()},destroy:function(){this.game=null}};b.Filter.prototype.constructor=b.Filter;Object.defineProperty(b.Filter.prototype,"width",{get:function(){return this.uniforms.resolution.value.x},set:function(d){this.uniforms.resolution.value.x=d}});Object.defineProperty(b.Filter.prototype,"height",{get:function(){return this.uniforms.resolution.value.y},set:function(d){this.uniforms.resolution.value.y=d}});b.Plugin=function(d,e){if(typeof e==="undefined"){e=null}this.game=d;this.parent=e;this.active=false;this.visible=false;this.hasPreUpdate=false;this.hasUpdate=false;this.hasPostUpdate=false;this.hasRender=false;this.hasPostRender=false};b.Plugin.prototype={preUpdate:function(){},update:function(){},render:function(){},postRender:function(){},destroy:function(){this.game=null;this.parent=null;this.active=false;this.visible=false}};b.Plugin.prototype.constructor=b.Plugin;b.PluginManager=function(d){this.game=d;this.plugins=[];this._len=0;this._i=0};b.PluginManager.prototype={add:function(f){var e=Array.prototype.splice.call(arguments,1);var d=false;if(typeof f==="function"){f=new f(this.game,this)}else{f.game=this.game;f.parent=this}if(typeof f.preUpdate==="function"){f.hasPreUpdate=true;d=true}if(typeof f.update==="function"){f.hasUpdate=true;d=true}if(typeof f.postUpdate==="function"){f.hasPostUpdate=true;d=true}if(typeof f.render==="function"){f.hasRender=true;d=true}if(typeof f.postRender==="function"){f.hasPostRender=true;d=true}if(d){if(f.hasPreUpdate||f.hasUpdate||f.hasPostUpdate){f.active=true}if(f.hasRender||f.hasPostRender){f.visible=true}this._len=this.plugins.push(f);if(typeof f.init==="function"){f.init.apply(f,e)}return f}else{return null}},remove:function(d){this._i=this._len;while(this._i--){if(this.plugins[this._i]===d){d.destroy();this.plugins.splice(this._i,1);this._len--;return}}},removeAll:function(){this._i=this._len;while(this._i--){this.plugins[this._i].destroy()}this.plugins.length=0;this._len=0},preUpdate:function(){this._i=this._len;while(this._i--){if(this.plugins[this._i].active&&this.plugins[this._i].hasPreUpdate){this.plugins[this._i].preUpdate()}}},update:function(){this._i=this._len;while(this._i--){if(this.plugins[this._i].active&&this.plugins[this._i].hasUpdate){this.plugins[this._i].update()}}},postUpdate:function(){this._i=this._len;while(this._i--){if(this.plugins[this._i].active&&this.plugins[this._i].hasPostUpdate){this.plugins[this._i].postUpdate()}}},render:function(){this._i=this._len;while(this._i--){if(this.plugins[this._i].visible&&this.plugins[this._i].hasRender){this.plugins[this._i].render()}}},postRender:function(){this._i=this._len;while(this._i--){if(this.plugins[this._i].visible&&this.plugins[this._i].hasPostRender){this.plugins[this._i].postRender()}}},destroy:function(){this.removeAll();this.game=null}};b.PluginManager.prototype.constructor=b.PluginManager;b.Stage=function(e,f,d){this.game=e;this.offset=new b.Point();this.bounds=new b.Rectangle(0,0,f,d);PIXI.Stage.call(this,0);this.name="_stage_root";this.interactive=false;this.disableVisibilityChange=false;this.checkOffsetInterval=2500;this.exists=true;this.currentRenderOrderID=0;this._hiddenVar="hidden";this._nextOffsetCheck=0;this._backgroundColor=0;if(e.config){this.parseConfig(e.config)}};b.Stage.prototype=Object.create(PIXI.Stage.prototype);b.Stage.prototype.constructor=b.Stage;b.Stage.prototype.preUpdate=function(){this.currentRenderOrderID=0;var d=this.children.length;for(var e=0;e<d;e++){this.children[e].preUpdate()}};b.Stage.prototype.update=function(){var d=this.children.length;while(d--){this.children[d].update()}};b.Stage.prototype.postUpdate=function(){if(this.game.world.camera.target){this.game.world.camera.target.postUpdate();this.game.world.camera.update();var d=this.children.length;while(d--){if(this.children[d]!==this.game.world.camera.target){this.children[d].postUpdate()}}}else{this.game.world.camera.update();var d=this.children.length;while(d--){this.children[d].postUpdate()}}if(this.checkOffsetInterval!==false){if(this.game.time.now>this._nextOffsetCheck){b.Canvas.getOffset(this.game.canvas,this.offset);this.bounds.x=this.offset.x;this.bounds.y=this.offset.y;this._nextOffsetCheck=this.game.time.now+this.checkOffsetInterval}}};b.Stage.prototype.parseConfig=function(d){if(d.checkOffsetInterval){this.checkOffsetInterval=d.checkOffsetInterval}if(d.disableVisibilityChange){this.disableVisibilityChange=d.disableVisibilityChange}if(d.fullScreenScaleMode){this.fullScreenScaleMode=d.fullScreenScaleMode}if(d.scaleMode){this.scaleMode=d.scaleMode}if(d.backgroundColor){this.backgroundColor=d.backgroundColor}};b.Stage.prototype.boot=function(){b.Canvas.getOffset(this.game.canvas,this.offset);this.bounds.setTo(this.offset.x,this.offset.y,this.game.width,this.game.height);var d=this;this._onChange=function(e){return d.visibilityChange(e)};b.Canvas.setUserSelect(this.game.canvas,"none");b.Canvas.setTouchAction(this.game.canvas,"none");this.checkVisibility()};b.Stage.prototype.checkVisibility=function(){if(document.webkitHidden!==undefined){this._hiddenVar="webkitvisibilitychange"}else{if(document.mozHidden!==undefined){this._hiddenVar="mozvisibilitychange"}else{if(document.msHidden!==undefined){this._hiddenVar="msvisibilitychange"}else{if(document.hidden!==undefined){this._hiddenVar="visibilitychange"}else{this._hiddenVar=null}}}}if(this._hiddenVar){document.addEventListener(this._hiddenVar,this._onChange,false)}window.onpagehide=this._onChange;window.onpageshow=this._onChange;window.onblur=this._onChange;window.onfocus=this._onChange};b.Stage.prototype.visibilityChange=function(d){if(d.type==="pagehide"||d.type==="blur"||d.type==="pageshow"||d.type==="focus"){if(d.type==="pagehide"||d.type==="blur"){this.game.focusLoss(d)}else{if(d.type==="pageshow"||d.type==="focus"){this.game.focusGain(d)}}return}if(this.disableVisibilityChange){return}if(document.hidden||document.mozHidden||document.msHidden||document.webkitHidden){this.game.gamePaused(d)}else{this.game.gameResumed(d)}};b.Stage.prototype.setBackgroundColor=function(d){if(typeof d==="string"){var e=b.Color.hexToColor(d);this._backgroundColor=b.Color.getColor(e.r,e.g,e.b)}else{var e=b.Color.getRGB(d);this._backgroundColor=d}this.backgroundColorSplit=[e.r/255,e.g/255,e.b/255];this.backgroundColorString=b.Color.RGBtoString(e.r,e.g,e.b,255,"#")};Object.defineProperty(b.Stage.prototype,"backgroundColor",{get:function(){return this._backgroundColor},set:function(d){if(!this.game.transparent){this.setBackgroundColor(d)}}});Object.defineProperty(b.Stage.prototype,"smoothed",{get:function(){return !PIXI.scaleModes.LINEAR},set:function(d){if(d){PIXI.scaleModes.LINEAR=0}else{PIXI.scaleModes.LINEAR=1}}});b.Group=function(e,h,f,d,i,g){if(typeof d==="undefined"){d=false}if(typeof i==="undefined"){i=false}if(typeof g==="undefined"){g=b.Physics.ARCADE}this.game=e;if(typeof h==="undefined"){h=e.world}this.name=f||"group";PIXI.DisplayObjectContainer.call(this);if(d){this.game.stage.addChild(this)}else{if(h){h.addChild(this)}}this.z=0;this.type=b.GROUP;this.alive=true;this.exists=true;this.classType=b.Sprite;this.scale=new b.Point(1,1);this.cursor=null;this.cameraOffset=new b.Point();this.enableBody=i;this.enableBodyDebug=false;this.physicsBodyType=g;this._sortProperty="z";this._cache=[0,0,0,0,1,0,1,0,0,0]};b.Group.prototype=Object.create(PIXI.DisplayObjectContainer.prototype);b.Group.prototype.constructor=b.Group;b.Group.RETURN_NONE=0;b.Group.RETURN_TOTAL=1;b.Group.RETURN_CHILD=2;b.Group.SORT_ASCENDING=-1;b.Group.SORT_DESCENDING=1;b.Group.prototype.add=function(e,d){if(typeof d==="undefined"){d=false}if(e.parent!==this){if(this.enableBody){this.game.physics.enable(e,this.physicsBodyType)}this.addChild(e);e.z=this.children.length;if(!d&&e.events){e.events.onAddedToGroup.dispatch(e,this)}if(this.cursor===null){this.cursor=e}}return e};b.Group.prototype.addAt=function(f,e,d){if(typeof d==="undefined"){d=false}if(f.parent!==this){if(this.enableBody){this.game.physics.enable(f,this.physicsBodyType)}this.addChildAt(f,e);this.updateZ();if(!d&&f.events){f.events.onAddedToGroup.dispatch(f,this)}if(this.cursor===null){this.cursor=f}}return f};b.Group.prototype.getAt=function(d){if(d<0||d>=this.children.length){return -1}else{return this.getChildAt(d)}};b.Group.prototype.create=function(d,i,e,g,f){if(typeof f==="undefined"){f=true}var h=new this.classType(this.game,d,i,e,g);if(this.enableBody){this.game.physics.enable(h,this.physicsBodyType,this.enableBodyDebug)}h.exists=f;h.visible=f;h.alive=f;this.addChild(h);h.z=this.children.length;if(h.events){h.events.onAddedToGroup.dispatch(h,this)}if(this.cursor===null){this.cursor=h}return h};b.Group.prototype.createMultiple=function(g,e,h,f){if(typeof f==="undefined"){f=false}for(var d=0;d<g;d++){this.create(0,0,e,h,f)}};b.Group.prototype.updateZ=function(){var d=this.children.length;while(d--){this.children[d].z=d}};b.Group.prototype.resetCursor=function(d){if(typeof d==="undefined"){d=0}if(d>this.children.length-1){d=0}if(this.cursor){this._cache[8]=d;this.cursor=this.children[this._cache[8]];return this.cursor}};b.Group.prototype.next=function(){if(this.cursor){if(this._cache[8]>=this.children.length-1){this._cache[8]=0}else{this._cache[8]++}this.cursor=this.children[this._cache[8]];return this.cursor}};b.Group.prototype.previous=function(){if(this.cursor){if(this._cache[8]===0){this._cache[8]=this.children.length-1}else{this._cache[8]--}this.cursor=this.children[this._cache[8]];return this.cursor}};b.Group.prototype.swap=function(f,e){var d=this.swapChildren(f,e);if(d){this.updateZ()}return d};b.Group.prototype.bringToTop=function(d){if(d.parent===this&&this.getIndex(d)<this.children.length){this.remove(d,false,true);this.add(d,true)}return d};b.Group.prototype.sendToBack=function(d){if(d.parent===this&&this.getIndex(d)>0){this.remove(d,false,true);this.addAt(d,0,true)}return d};b.Group.prototype.moveUp=function(f){if(f.parent===this&&this.getIndex(f)<this.children.length-1){var e=this.getIndex(f);var d=this.getAt(e+1);if(d){this.swap(f,d)}}return f};b.Group.prototype.moveDown=function(f){if(f.parent===this&&this.getIndex(f)>0){var e=this.getIndex(f);var d=this.getAt(e-1);if(d){this.swap(f,d)}}return f};b.Group.prototype.xy=function(e,d,f){if(e<0||e>this.children.length){return -1}else{this.getChildAt(e).x=d;this.getChildAt(e).y=f}};b.Group.prototype.reverse=function(){this.children.reverse();this.updateZ()};b.Group.prototype.getIndex=function(d){return this.children.indexOf(d)};b.Group.prototype.replace=function(g,d){var f=this.getIndex(g);if(f!==-1){if(d.parent!==undefined){d.events.onRemovedFromGroup.dispatch(d,this);d.parent.removeChild(d);if(d.parent instanceof b.Group){d.parent.updateZ()}}var e=g;this.remove(e);this.addAt(d,f);return e}};b.Group.prototype.hasProperty=function(f,e){var d=e.length;if(d===1&&e[0] in f){return true}else{if(d===2&&e[0] in f&&e[1] in f[e[0]]){return true}else{if(d===3&&e[0] in f&&e[1] in f[e[0]]&&e[2] in f[e[0]][e[1]]){return true}else{if(d===4&&e[0] in f&&e[1] in f[e[0]]&&e[2] in f[e[0]][e[1]]&&e[3] in f[e[0]][e[1]][e[2]]){return true}}}}return false};b.Group.prototype.setProperty=function(i,f,h,e,g){if(typeof g==="undefined"){g=false}e=e||0;if(!this.hasProperty(i,f)&&(!g||e>0)){return false}var d=f.length;if(d===1){if(e===0){i[f[0]]=h}else{if(e==1){i[f[0]]+=h}else{if(e==2){i[f[0]]-=h}else{if(e==3){i[f[0]]*=h}else{if(e==4){i[f[0]]/=h}}}}}}else{if(d===2){if(e===0){i[f[0]][f[1]]=h}else{if(e==1){i[f[0]][f[1]]+=h}else{if(e==2){i[f[0]][f[1]]-=h}else{if(e==3){i[f[0]][f[1]]*=h}else{if(e==4){i[f[0]][f[1]]/=h}}}}}}else{if(d===3){if(e===0){i[f[0]][f[1]][f[2]]=h}else{if(e==1){i[f[0]][f[1]][f[2]]+=h}else{if(e==2){i[f[0]][f[1]][f[2]]-=h}else{if(e==3){i[f[0]][f[1]][f[2]]*=h}else{if(e==4){i[f[0]][f[1]][f[2]]/=h}}}}}}else{if(d===4){if(e===0){i[f[0]][f[1]][f[2]][f[3]]=h}else{if(e==1){i[f[0]][f[1]][f[2]][f[3]]+=h}else{if(e==2){i[f[0]][f[1]][f[2]][f[3]]-=h}else{if(e==3){i[f[0]][f[1]][f[2]][f[3]]*=h}else{if(e==4){i[f[0]][f[1]][f[2]][f[3]]/=h}}}}}}}}}return true};b.Group.prototype.checkProperty=function(g,d,f,e){if(typeof e==="undefined"){e=false}if(!b.Utils.getProperty(g,d)&&e){return false}if(b.Utils.getProperty(g,d)!==f){return false}return true};b.Group.prototype.set=function(j,f,h,e,i,d,g){if(typeof g==="undefined"){g=false}f=f.split(".");if(typeof e==="undefined"){e=false}if(typeof i==="undefined"){i=false}if((e===false||(e&&j.alive))&&(i===false||(i&&j.visible))){return this.setProperty(j,f,h,d,g)}};b.Group.prototype.setAll=function(h,k,f,l,e,j){if(typeof f==="undefined"){f=false}if(typeof l==="undefined"){l=false}if(typeof j==="undefined"){j=false}h=h.split(".");e=e||0;for(var g=0,d=this.children.length;g<d;g++){if((!f||(f&&this.children[g].alive))&&(!l||(l&&this.children[g].visible))){this.setProperty(this.children[g],h,k,e,j)}}};b.Group.prototype.setAllChildren=function(h,k,f,l,e,j){if(typeof f==="undefined"){f=false}if(typeof l==="undefined"){l=false}if(typeof j==="undefined"){j=false}e=e||0;for(var g=0,d=this.children.length;g<d;g++){if((!f||(f&&this.children[g].alive))&&(!l||(l&&this.children[g].visible))){if(this.children[g] instanceof b.Group){this.children[g].setAllChildren(h,k,f,l,e,j)}else{this.setProperty(this.children[g],h.split("."),k,e,j)}}}};b.Group.prototype.checkAll=function(g,j,e,k,h){if(typeof e==="undefined"){e=false}if(typeof k==="undefined"){k=false}if(typeof h==="undefined"){h=false}for(var f=0,d=this.children.length;f<d;f++){if((!e||(e&&this.children[f].alive))&&(!k||(k&&this.children[f].visible))){if(!this.checkProperty(this.children[f],g,j,h)){return false}}}return true};b.Group.prototype.addAll=function(f,e,d,g){this.setAll(f,e,d,g,1)};b.Group.prototype.subAll=function(f,e,d,g){this.setAll(f,e,d,g,2)};b.Group.prototype.multiplyAll=function(f,e,d,g){this.setAll(f,e,d,g,3)};b.Group.prototype.divideAll=function(f,e,d,g){this.setAll(f,e,d,g,4)};b.Group.prototype.callAllExists=function(h,g){var e=Array.prototype.splice.call(arguments,2);for(var f=0,d=this.children.length;f<d;f++){if(this.children[f].exists===g&&this.children[f][h]){this.children[f][h].apply(this.children[f],e)}}};b.Group.prototype.callbackFromArray=function(f,e,d){if(d==1){if(f[e[0]]){return f[e[0]]}}else{if(d==2){if(f[e[0]][e[1]]){return f[e[0]][e[1]]}}else{if(d==3){if(f[e[0]][e[1]][e[2]]){return f[e[0]][e[1]][e[2]]}}else{if(d==4){if(f[e[0]][e[1]][e[2]][e[3]]){return f[e[0]][e[1]][e[2]][e[3]]}}else{if(f[e]){return f[e]}}}}}return false};b.Group.prototype.callAll=function(d,e){if(typeof d==="undefined"){return}d=d.split(".");var h=d.length;if(typeof e==="undefined"||e===null||e===""){e=null}else{if(typeof e==="string"){e=e.split(".");var f=e.length}}var l=Array.prototype.splice.call(arguments,2);var m=null;var g=null;for(var j=0,k=this.children.length;j<k;j++){m=this.callbackFromArray(this.children[j],d,h);if(e&&m){g=this.callbackFromArray(this.children[j],e,f);if(m){m.apply(g,l)}}else{if(m){m.apply(this.children[j],l)}}}};b.Group.prototype.preUpdate=function(){if(!this.exists||!this.parent.exists){this.renderOrderID=-1;return false}var d=this.children.length;while(d--){this.children[d].preUpdate()}return true};b.Group.prototype.update=function(){var d=this.children.length;while(d--){this.children[d].update()}};b.Group.prototype.postUpdate=function(){if(this._cache[7]===1){this.x=this.game.camera.view.x+this.cameraOffset.x;this.y=this.game.camera.view.y+this.cameraOffset.y}var d=this.children.length;while(d--){this.children[d].postUpdate()}};b.Group.prototype.forEach=function(j,e,h){if(typeof h==="undefined"){h=false}var f=Array.prototype.splice.call(arguments,3);f.unshift(null);for(var g=0,d=this.children.length;g<d;g++){if(!h||(h&&this.children[g].exists)){f[0]=this.children[g];j.apply(e,f)}}};b.Group.prototype.forEachExists=function(f,d){var e=Array.prototype.splice.call(arguments,2);e.unshift(null);this.iterate("exists",true,b.Group.RETURN_TOTAL,f,d,e)};b.Group.prototype.forEachAlive=function(f,d){var e=Array.prototype.splice.call(arguments,2);e.unshift(null);this.iterate("alive",true,b.Group.RETURN_TOTAL,f,d,e)};b.Group.prototype.forEachDead=function(f,d){var e=Array.prototype.splice.call(arguments,2);e.unshift(null);this.iterate("alive",false,b.Group.RETURN_TOTAL,f,d,e)};b.Group.prototype.sort=function(e,d){if(this.children.length<2){return}if(typeof e==="undefined"){e="z"}if(typeof d==="undefined"){d=b.Group.SORT_ASCENDING}this._sortProperty=e;if(d===b.Group.SORT_ASCENDING){this.children.sort(this.ascendingSortHandler.bind(this))}else{this.children.sort(this.descendingSortHandler.bind(this))}this.updateZ()};b.Group.prototype.customSort=function(d,e){if(this.children.length<2){return}this.children.sort(d.bind(e));this.updateZ()};b.Group.prototype.ascendingSortHandler=function(e,d){if(e[this._sortProperty]<d[this._sortProperty]){return -1}else{if(e[this._sortProperty]>d[this._sortProperty]){return 1}else{if(e.z<d.z){return -1}else{return 1}}}};b.Group.prototype.descendingSortHandler=function(e,d){if(e[this._sortProperty]<d[this._sortProperty]){return 1}else{if(e[this._sortProperty]>d[this._sortProperty]){return -1}else{return 0}}};b.Group.prototype.iterate=function(l,k,g,m,d,h){if(g===b.Group.RETURN_TOTAL&&this.children.length===0){return 0}if(typeof m==="undefined"){m=false}var j=0;for(var e=0,f=this.children.length;e<f;e++){if(this.children[e][l]===k){j++;if(m){h[0]=this.children[e];m.apply(d,h)}if(g===b.Group.RETURN_CHILD){return this.children[e]}}}if(g===b.Group.RETURN_TOTAL){return j}else{if(g===b.Group.RETURN_CHILD){return null}}};b.Group.prototype.getFirstExists=function(d){if(typeof d!=="boolean"){d=true}return this.iterate("exists",d,b.Group.RETURN_CHILD)};b.Group.prototype.getFirstAlive=function(){return this.iterate("alive",true,b.Group.RETURN_CHILD)};b.Group.prototype.getFirstDead=function(){return this.iterate("alive",false,b.Group.RETURN_CHILD)};b.Group.prototype.getTop=function(){if(this.children.length>0){return this.children[this.children.length-1]}};b.Group.prototype.getBottom=function(){if(this.children.length>0){return this.children[0]}};b.Group.prototype.countLiving=function(){return this.iterate("alive",true,b.Group.RETURN_TOTAL)};b.Group.prototype.countDead=function(){return this.iterate("alive",false,b.Group.RETURN_TOTAL)};b.Group.prototype.getRandom=function(e,d){if(this.children.length===0){return null}e=e||0;d=d||this.children.length;return this.game.math.getRandom(this.children,e,d)};b.Group.prototype.remove=function(g,e,d){if(typeof e==="undefined"){e=false}if(typeof d==="undefined"){d=false}if(this.children.length===0||this.children.indexOf(g)===-1){return false}if(!d&&g.events&&!g.destroyPhase){g.events.onRemovedFromGroup.dispatch(g,this)}var f=this.removeChild(g);this.updateZ();if(this.cursor===g){this.next()}if(e&&f){f.destroy(true)}return true};b.Group.prototype.removeAll=function(e,d){if(typeof e==="undefined"){e=false}if(typeof d==="undefined"){d=false}if(this.children.length===0){return}do{if(!d&&this.children[0].events){this.children[0].events.onRemovedFromGroup.dispatch(this.children[0],this)}var f=this.removeChild(this.children[0]);if(e&&f){f.destroy(true)}}while(this.children.length>0);this.cursor=null};b.Group.prototype.removeBetween=function(j,g,f,d){if(typeof g==="undefined"){g=this.children.length}if(typeof f==="undefined"){f=false}if(typeof d==="undefined"){d=false}if(this.children.length===0){return}if(j>g||j<0||g>this.children.length){return false}var e=g;while(e>=j){if(!d&&this.children[e].events){this.children[e].events.onRemovedFromGroup.dispatch(this.children[e],this)}var h=this.removeChild(this.children[e]);if(f&&h){h.destroy(true)}if(this.cursor===this.children[e]){this.cursor=null}e--}this.updateZ()};b.Group.prototype.destroy=function(e,d){if(this.game===null){return}if(typeof e==="undefined"){e=true}if(typeof d==="undefined"){d=false}this.removeAll(e);this.cursor=null;this.filters=null;if(!d){if(this.parent){this.parent.removeChild(this)}this.game=null;this.exists=false}};Object.defineProperty(b.Group.prototype,"total",{get:function(){return this.iterate("exists",true,b.Group.RETURN_TOTAL)}});Object.defineProperty(b.Group.prototype,"length",{get:function(){return this.children.length}});Object.defineProperty(b.Group.prototype,"angle",{get:function(){return b.Math.radToDeg(this.rotation)},set:function(d){this.rotation=b.Math.degToRad(d)}});Object.defineProperty(b.Group.prototype,"fixedToCamera",{get:function(){return !!this._cache[7]},set:function(d){if(d){this._cache[7]=1;this.cameraOffset.set(this.x,this.y)}else{this._cache[7]=0}}});b.World=function(d){b.Group.call(this,d,null,"__world",false);this.bounds=new b.Rectangle(0,0,d.width,d.height);this.camera=null};b.World.prototype=Object.create(b.Group.prototype);b.World.prototype.constructor=b.World;b.World.prototype.boot=function(){this.camera=new b.Camera(this.game,0,0,0,this.game.width,this.game.height);this.camera.displayObject=this;this.camera.scale=this.scale;this.game.camera=this.camera;this.game.stage.addChild(this)};b.World.prototype.setBounds=function(e,g,f,d){if(f<this.game.width){f=this.game.width}if(d<this.game.height){d=this.game.height}this.bounds.setTo(e,g,f,d);if(this.camera.bounds){this.camera.bounds.setTo(e,g,f,d)}this.game.physics.setBoundsToWorld()};b.World.prototype.shutdown=function(){this.destroy(true,true)};b.World.prototype.wrap=function(g,h,e,d,f){if(typeof h==="undefined"){h=0}if(typeof e==="undefined"){e=false}if(typeof d==="undefined"){d=true}if(typeof f==="undefined"){f=true}if(!e){if(d&&g.x+h<this.bounds.x){g.x=this.bounds.right+h}else{if(d&&g.x-h>this.bounds.right){g.x=this.bounds.left-h}}if(f&&g.y+h<this.bounds.top){g.y=this.bounds.bottom+h}else{if(f&&g.y-h>this.bounds.bottom){g.y=this.bounds.top-h}}}else{g.getBounds();if(d){if((g.x+g._currentBounds.width)<this.bounds.x){g.x=this.bounds.right}else{if(g.x>this.bounds.right){g.x=this.bounds.left}}}if(f){if((g.y+g._currentBounds.height)<this.bounds.top){g.y=this.bounds.bottom}else{if(g.y>this.bounds.bottom){g.y=this.bounds.top}}}}};Object.defineProperty(b.World.prototype,"width",{get:function(){return this.bounds.width},set:function(d){this.bounds.width=d}});Object.defineProperty(b.World.prototype,"height",{get:function(){return this.bounds.height},set:function(d){this.bounds.height=d}});Object.defineProperty(b.World.prototype,"centerX",{get:function(){return this.bounds.halfWidth}});Object.defineProperty(b.World.prototype,"centerY",{get:function(){return this.bounds.halfHeight}});Object.defineProperty(b.World.prototype,"randomX",{get:function(){if(this.bounds.x<0){return this.game.rnd.integerInRange(this.bounds.x,(this.bounds.width-Math.abs(this.bounds.x)))}else{return this.game.rnd.integerInRange(this.bounds.x,this.bounds.width)}}});Object.defineProperty(b.World.prototype,"randomY",{get:function(){if(this.bounds.y<0){return this.game.rnd.integerInRange(this.bounds.y,(this.bounds.height-Math.abs(this.bounds.y)))}else{return this.game.rnd.integerInRange(this.bounds.y,this.bounds.height)}}});b.ScaleManager=function(e,f,d){this.game=e;this.width=f;this.height=d;this.minWidth=null;this.maxWidth=null;this.minHeight=null;this.maxHeight=null;this.forceLandscape=false;this.forcePortrait=false;this.incorrectOrientation=false;this.pageAlignHorizontally=false;this.pageAlignVertically=false;this.maxIterations=5;this.orientationSprite=null;this.enterLandscape=new b.Signal();this.enterPortrait=new b.Signal();this.enterIncorrectOrientation=new b.Signal();this.leaveIncorrectOrientation=new b.Signal();this.hasResized=new b.Signal();this.fullScreenTarget=this.game.canvas;this.enterFullScreen=new b.Signal();this.leaveFullScreen=new b.Signal();this.orientation=0;if(window.orientation){this.orientation=window.orientation}else{if(window.outerWidth>window.outerHeight){this.orientation=90}}this.scaleFactor=new b.Point(1,1);this.scaleFactorInversed=new b.Point(1,1);this.margin=new b.Point(0,0);this.bounds=new b.Rectangle(0,0,f,d);this.aspectRatio=0;this.sourceAspectRatio=f/d;this.event=null;this.scaleMode=b.ScaleManager.NO_SCALE;this.fullScreenScaleMode=b.ScaleManager.NO_SCALE;this._startHeight=0;this._width=0;this._height=0;this._check=null;var g=this;window.addEventListener("orientationchange",function(h){return g.checkOrientation(h)},false);window.addEventListener("resize",function(h){return g.checkResize(h)},false);if(!this.game.device.cocoonJS){document.addEventListener("webkitfullscreenchange",function(h){return g.fullScreenChange(h)},false);document.addEventListener("mozfullscreenchange",function(h){return g.fullScreenChange(h)},false);document.addEventListener("fullscreenchange",function(h){return g.fullScreenChange(h)},false)}};b.ScaleManager.EXACT_FIT=0;b.ScaleManager.NO_SCALE=1;b.ScaleManager.SHOW_ALL=2;b.ScaleManager.prototype={startFullScreen:function(d){if(this.isFullScreen||!this.game.device.fullscreen){return}if(typeof d!=="undefined"&&this.game.renderType===b.CANVAS){this.game.stage.smoothed=d}this._width=this.width;this._height=this.height;if(this.game.device.fullscreenKeyboard){this.fullScreenTarget[this.game.device.requestFullscreen](Element.ALLOW_KEYBOARD_INPUT)}else{this.fullScreenTarget[this.game.device.requestFullscreen]()}},stopFullScreen:function(){document[this.game.device.cancelFullscreen]()},fullScreenChange:function(d){this.event=d;if(this.isFullScreen){if(this.fullScreenScaleMode===b.ScaleManager.EXACT_FIT){this.fullScreenTarget.style.width="100%";this.fullScreenTarget.style.height="100%";this.width=window.outerWidth;this.height=window.outerHeight;this.game.input.scale.setTo(this.game.width/this.width,this.game.height/this.height);this.aspectRatio=this.width/this.height;this.scaleFactor.x=this.game.width/this.width;this.scaleFactor.y=this.game.height/this.height;this.checkResize()}else{if(this.fullScreenScaleMode===b.ScaleManager.SHOW_ALL){this.setShowAll();this.refresh()}}this.enterFullScreen.dispatch(this.width,this.height)}else{this.fullScreenTarget.style.width=this.game.width+"px";this.fullScreenTarget.style.height=this.game.height+"px";this.width=this._width;this.height=this._height;this.game.input.scale.setTo(this.game.width/this.width,this.game.height/this.height);this.aspectRatio=this.width/this.height;this.scaleFactor.x=this.game.width/this.width;this.scaleFactor.y=this.game.height/this.height;this.leaveFullScreen.dispatch(this.width,this.height)}},forceOrientation:function(e,d,f){if(typeof d==="undefined"){d=false}this.forceLandscape=e;this.forcePortrait=d;if(typeof f!=="undefined"){if(f===null||this.game.cache.checkImageKey(f)===false){f="__default"}this.orientationSprite=new b.Image(this.game,this.game.width/2,this.game.height/2,f);this.orientationSprite.anchor.set(0.5);this.checkOrientationState();if(this.incorrectOrientation){this.orientationSprite.visible=true;this.game.world.visible=false}else{this.orientationSprite.visible=false;this.game.world.visible=true}this.game.stage.addChild(this.orientationSprite)}},checkOrientationState:function(){if(this.incorrectOrientation){if((this.forceLandscape&&window.innerWidth>window.innerHeight)||(this.forcePortrait&&window.innerHeight>window.innerWidth)){this.incorrectOrientation=false;this.leaveIncorrectOrientation.dispatch();if(this.orientationSprite){this.orientationSprite.visible=false;this.game.world.visible=true}if(this.scaleMode!==b.ScaleManager.NO_SCALE){this.refresh()}}}else{if((this.forceLandscape&&window.innerWidth<window.innerHeight)||(this.forcePortrait&&window.innerHeight<window.innerWidth)){this.incorrectOrientation=true;this.enterIncorrectOrientation.dispatch();if(this.orientationSprite&&this.orientationSprite.visible===false){this.orientationSprite.visible=true;this.game.world.visible=false}if(this.scaleMode!==b.ScaleManager.NO_SCALE){this.refresh()}}}},checkOrientation:function(d){this.event=d;this.orientation=window.orientation;if(this.isLandscape){this.enterLandscape.dispatch(this.orientation,true,false)}else{this.enterPortrait.dispatch(this.orientation,false,true)}if(this.scaleMode!==b.ScaleManager.NO_SCALE){this.refresh()}},checkResize:function(d){this.event=d;if(window.outerWidth>window.outerHeight){this.orientation=90}else{this.orientation=0}if(this.isLandscape){this.enterLandscape.dispatch(this.orientation,true,false)}else{this.enterPortrait.dispatch(this.orientation,false,true)}if(this.scaleMode!==b.ScaleManager.NO_SCALE){this.refresh()}this.checkOrientationState()},refresh:function(){if(!this.game.device.iPad&&!this.game.device.webApp&&!this.game.device.desktop){if(this.game.device.android&&!this.game.device.chrome){window.scrollTo(0,1)}else{window.scrollTo(0,0)}}if(this._check===null&&this.maxIterations>0){this._iterations=this.maxIterations;var d=this;this._check=window.setInterval(function(){return d.setScreenSize()},10);this.setScreenSize()}},setScreenSize:function(d){if(typeof d==="undefined"){d=false}if(!this.game.device.iPad&&!this.game.device.webApp&&!this.game.device.desktop){if(this.game.device.android&&!this.game.device.chrome){window.scrollTo(0,1)}else{window.scrollTo(0,0)}}this._iterations--;if(d||window.innerHeight>this._startHeight||this._iterations<0){document.documentElement.style.minHeight=window.innerHeight+"px";if(this.incorrectOrientation){this.setMaximum()}else{if(!this.isFullScreen){if(this.scaleMode===b.ScaleManager.EXACT_FIT){this.setExactFit()}else{if(this.scaleMode===b.ScaleManager.SHOW_ALL){this.setShowAll()}}}else{if(this.fullScreenScaleMode===b.ScaleManager.EXACT_FIT){this.setExactFit()}else{if(this.fullScreenScaleMode===b.ScaleManager.SHOW_ALL){this.setShowAll()}}}}this.setSize();clearInterval(this._check);this._check=null}},setSize:function(){if(!this.incorrectOrientation){if(this.maxWidth&&this.width>this.maxWidth){this.width=this.maxWidth}if(this.maxHeight&&this.height>this.maxHeight){this.height=this.maxHeight}if(this.minWidth&&this.width<this.minWidth){this.width=this.minWidth}if(this.minHeight&&this.height<this.minHeight){this.height=this.minHeight}}this.game.canvas.style.width=this.width+"px";this.game.canvas.style.height=this.height+"px";this.game.input.scale.setTo(this.game.width/this.width,this.game.height/this.height);if(this.pageAlignHorizontally){if(this.width<window.innerWidth&&!this.incorrectOrientation){this.margin.x=Math.round((window.innerWidth-this.width)/2);this.game.canvas.style.marginLeft=this.margin.x+"px"}else{this.margin.x=0;this.game.canvas.style.marginLeft="0px"}}if(this.pageAlignVertically){if(this.height<window.innerHeight&&!this.incorrectOrientation){this.margin.y=Math.round((window.innerHeight-this.height)/2);this.game.canvas.style.marginTop=this.margin.y+"px"}else{this.margin.y=0;this.game.canvas.style.marginTop="0px"}}b.Canvas.getOffset(this.game.canvas,this.game.stage.offset);this.bounds.setTo(this.game.stage.offset.x,this.game.stage.offset.y,this.width,this.height);this.aspectRatio=this.width/this.height;this.scaleFactor.x=this.game.width/this.width;this.scaleFactor.y=this.game.height/this.height;this.scaleFactorInversed.x=this.width/this.game.width;this.scaleFactorInversed.y=this.height/this.game.height;this.hasResized.dispatch(this.width,this.height);this.checkOrientationState()},setMaximum:function(){this.width=window.innerWidth;this.height=window.innerHeight},setShowAll:function(){var d=Math.min((window.innerHeight/this.game.height),(window.innerWidth/this.game.width));this.width=Math.round(this.game.width*d);this.height=Math.round(this.game.height*d)},setExactFit:function(){var d=window.innerWidth;var e=window.innerHeight;if(this.maxWidth&&d>this.maxWidth){this.width=this.maxWidth}else{this.width=d}if(this.maxHeight&&e>this.maxHeight){this.height=this.maxHeight}else{this.height=e}}};b.ScaleManager.prototype.constructor=b.ScaleManager;Object.defineProperty(b.ScaleManager.prototype,"isFullScreen",{get:function(){return(document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement)}});Object.defineProperty(b.ScaleManager.prototype,"isPortrait",{get:function(){return(this.orientation===0||this.orientation===180)}});Object.defineProperty(b.ScaleManager.prototype,"isLandscape",{get:function(){return(this.orientation===90||this.orientation===-90)}});b.Game=function(e,j,h,i,d,l,k,g){this.id=b.GAMES.push(this)-1;this.config=null;this.physicsConfig=g;this.parent="";this.width=800;this.height=600;this.transparent=false;this.antialias=true;this.preserveDrawingBuffer=false;this.renderer=null;this.renderType=b.AUTO;this.state=null;this.isBooted=false;this.isRunning=false;this.raf=null;this.add=null;this.make=null;this.cache=null;this.input=null;this.load=null;this.math=null;this.net=null;this.scale=null;this.sound=null;this.stage=null;this.time=null;this.tweens=null;this.world=null;this.physics=null;this.rnd=null;this.device=null;this.camera=null;this.canvas=null;this.context=null;this.debug=null;this.particles=null;this.stepping=false;this.pendingStep=false;this.stepCount=0;this.onPause=null;this.onResume=null;this.onBlur=null;this.onFocus=null;this._paused=false;this._codePaused=false;if(arguments.length===1&&typeof arguments[0]==="object"){this.parseConfig(arguments[0])}else{this.config={enableDebug:true};if(typeof e!=="undefined"){this.width=e}if(typeof j!=="undefined"){this.height=j}if(typeof h!=="undefined"){this.renderer=h;this.renderType=h}if(typeof i!=="undefined"){this.parent=i}if(typeof l!=="undefined"){this.transparent=l}if(typeof k!=="undefined"){this.antialias=k}this.rnd=new b.RandomDataGenerator([(Date.now()*Math.random()).toString()]);this.state=new b.StateManager(this,d)}var f=this;this._onBoot=function(){return f.boot()};if(document.readyState==="complete"||document.readyState==="interactive"){window.setTimeout(this._onBoot,0)}else{document.addEventListener("DOMContentLoaded",this._onBoot,false);window.addEventListener("load",this._onBoot,false)}return this};b.Game.prototype={parseConfig:function(e){this.config=e;if(e.width){this.width=b.Utils.parseDimension(e.width,0)}if(e.height){this.height=b.Utils.parseDimension(e.height,1)}if(e.renderer){this.renderer=e.renderer;this.renderType=e.renderer}if(e.parent){this.parent=e.parent}if(e.transparent){this.transparent=e.transparent}if(e.antialias){this.antialias=e.antialias}if(e.preserveDrawingBuffer){this.preserveDrawingBuffer=e.preserveDrawingBuffer}if(e.physicsConfig){this.physicsConfig=e.physicsConfig}var d=[(Date.now()*Math.random()).toString()];if(e.seed){d=e.seed}this.rnd=new b.RandomDataGenerator(d);var f=null;if(e.state){f=e.state}this.state=new b.StateManager(this,f)},boot:function(){if(this.isBooted){return}if(!document.body){window.setTimeout(this._onBoot,20)}else{document.removeEventListener("DOMContentLoaded",this._onBoot);window.removeEventListener("load",this._onBoot);this.onPause=new b.Signal();this.onResume=new b.Signal();this.onBlur=new b.Signal();this.onFocus=new b.Signal();this.isBooted=true;this.device=new b.Device(this);this.math=b.Math;this.stage=new b.Stage(this,this.width,this.height);this.setUpRenderer();this.scale=new b.ScaleManager(this,this.width,this.height);this.device.checkFullScreenSupport();this.world=new b.World(this);this.add=new b.GameObjectFactory(this);this.make=new b.GameObjectCreator(this);this.cache=new b.Cache(this);this.load=new b.Loader(this);this.time=new b.Time(this);this.tweens=new b.TweenManager(this);this.input=new b.Input(this);this.sound=new b.SoundManager(this);this.physics=new b.Physics(this,this.physicsConfig);this.particles=new b.Particles(this);this.plugins=new b.PluginManager(this);this.net=new b.Net(this);this.time.boot();this.stage.boot();this.world.boot();this.input.boot();this.sound.boot();this.state.boot();if(this.config.enableDebug){this.debug=new b.Utils.Debug(this);this.debug.boot()}this.showDebugHeader();this.isRunning=true;if(this.config&&this.config.forceSetTimeOut){this.raf=new b.RequestAnimationFrame(this,this.config.forceSetTimeOut)}else{this.raf=new b.RequestAnimationFrame(this,false)}this.raf.start()}},showDebugHeader:function(){var e=b.VERSION;var h="Canvas";var d="HTML Audio";var j=1;if(this.renderType===b.WEBGL){h="WebGL";j++}else{if(this.renderType==b.HEADLESS){h="Headless"}}if(this.device.webAudio){d="WebAudio";j++}if(this.device.chrome){var f=["%c %c %c Phaser v"+e+" | Pixi.js "+PIXI.VERSION+" | "+h+" | "+d+"  %c %c  http://phaser.io  %c %c \u2665%c\u2665%c\u2665 ","background: #0cf300","background: #00bc17","color: #ffffff; background: #00711f;","background: #00bc17","background: #0cf300","background: #00bc17"];for(var g=0;g<3;g++){if(g<j){f.push("color: #ff2424; background: #fff")}else{f.push("color: #959595; background: #fff")}}console.log.apply(console,f)}else{if(window.console){console.log("Phaser v"+e+" | Pixi.js "+PIXI.VERSION+" | "+h+" | "+d+" | http://phaser.io")}}},setUpRenderer:function(){if(this.device.trident){this.renderType=b.CANVAS}if(this.config.canvasID){this.canvas=b.Canvas.create(this.width,this.height,this.config.canvasID)}else{this.canvas=b.Canvas.create(this.width,this.height)}if(this.config.canvasStyle){this.canvas.style=this.config.canvasStyle}else{this.canvas.style["-webkit-full-screen"]="width: 100%; height: 100%"}if(this.device.cocoonJS){this.canvas.screencanvas=true}if(this.renderType===b.HEADLESS||this.renderType===b.CANVAS||(this.renderType===b.AUTO&&this.device.webGL===false)){if(this.device.canvas){if(this.renderType===b.AUTO){this.renderType=b.CANVAS}this.renderer=new PIXI.CanvasRenderer(this.width,this.height,this.canvas,this.transparent);this.context=this.renderer.context}else{throw new Error("Phaser.Game - cannot create Canvas or WebGL context, aborting.")}}else{this.renderType=b.WEBGL;this.renderer=new PIXI.WebGLRenderer(this.width,this.height,this.canvas,this.transparent,this.antialias,this.preserveDrawingBuffer);this.context=null}if(this.renderType!==b.HEADLESS){this.stage.smoothed=this.antialias;b.Canvas.addToDOM(this.canvas,this.parent,false);b.Canvas.setTouchAction(this.canvas)}},update:function(d){this.time.update(d);if(!this._paused&&!this.pendingStep){if(this.stepping){this.pendingStep=true}if(this.config.enableDebug){this.debug.preUpdate()}this.physics.preUpdate();this.state.preUpdate();this.plugins.preUpdate();this.stage.preUpdate();this.state.update();this.stage.update();this.tweens.update();this.sound.update();this.input.update();this.physics.update();this.particles.update();this.plugins.update();this.stage.postUpdate();this.plugins.postUpdate()}else{this.state.pauseUpdate();if(this.config.enableDebug){this.debug.preUpdate()}}if(this.renderType!=b.HEADLESS){this.state.preRender();this.renderer.render(this.stage);this.plugins.render();this.state.render();this.plugins.postRender();if(this.device.cocoonJS&&this.renderType===b.CANVAS&&this.stage.currentRenderOrderID===1){this.context.fillRect(0,0,0,0)}}},enableStep:function(){this.stepping=true;this.pendingStep=false;this.stepCount=0},disableStep:function(){this.stepping=false;this.pendingStep=false},step:function(){this.pendingStep=false;this.stepCount++},destroy:function(){this.raf.stop();this.input.destroy();this.state.destroy();this.physics.destroy();this.state=null;this.cache=null;this.input=null;this.load=null;this.sound=null;this.stage=null;this.time=null;this.world=null;this.isBooted=false},gamePaused:function(d){if(!this._paused){this._paused=true;this.time.gamePaused();this.sound.setMute();this.onPause.dispatch(d)}},gameResumed:function(d){if(this._paused&&!this._codePaused){this._paused=false;this.time.gameResumed();this.input.reset();this.sound.unsetMute();this.onResume.dispatch(d)}},focusLoss:function(d){this.onBlur.dispatch(d);if(!this.stage.disableVisibilityChange){this.gamePaused(d)}},focusGain:function(d){this.onFocus.dispatch(d);if(!this.stage.disableVisibilityChange){this.gameResumed(d)}}};b.Game.prototype.constructor=b.Game;Object.defineProperty(b.Game.prototype,"paused",{get:function(){return this._paused},set:function(d){if(d===true){if(this._paused===false){this._paused=true;this.sound.setMute();this.time.gamePaused();this.onPause.dispatch(this)}this._codePaused=true}else{if(this._paused){this._paused=false;this.input.reset();this.sound.unsetMute();this.time.gameResumed();this.onResume.dispatch(this)}this._codePaused=false}}});b.Input=function(d){this.game=d;this.hitCanvas=null;this.hitContext=null;this.moveCallbacks=[];this.moveCallback=null;this.moveCallbackContext=this;this.pollRate=0;this.disabled=false;this.multiInputOverride=b.Input.MOUSE_TOUCH_COMBINE;this.position=null;this.speed=null;this.circle=null;this.scale=null;this.maxPointers=10;this.currentPointers=0;this.tapRate=200;this.doubleTapRate=300;this.holdRate=2000;this.justPressedRate=200;this.justReleasedRate=200;this.recordPointerHistory=false;this.recordRate=100;this.recordLimit=100;this.pointer1=null;this.pointer2=null;this.pointer3=null;this.pointer4=null;this.pointer5=null;this.pointer6=null;this.pointer7=null;this.pointer8=null;this.pointer9=null;this.pointer10=null;this.activePointer=null;this.mousePointer=null;this.mouse=null;this.keyboard=null;this.touch=null;this.mspointer=null;this.gamepad=null;this.resetLocked=false;this.onDown=null;this.onUp=null;this.onTap=null;this.onHold=null;this.minPriorityID=0;this.interactiveItems=new b.ArrayList();this._localPoint=new b.Point();this._pollCounter=0;this._oldPosition=null;this._x=0;this._y=0};b.Input.MOUSE_OVERRIDES_TOUCH=0;b.Input.TOUCH_OVERRIDES_MOUSE=1;b.Input.MOUSE_TOUCH_COMBINE=2;b.Input.prototype={boot:function(){this.mousePointer=new b.Pointer(this.game,0);this.pointer1=new b.Pointer(this.game,1);this.pointer2=new b.Pointer(this.game,2);this.mouse=new b.Mouse(this.game);this.keyboard=new b.Keyboard(this.game);this.touch=new b.Touch(this.game);this.mspointer=new b.MSPointer(this.game);this.gamepad=new b.Gamepad(this.game);this.onDown=new b.Signal();this.onUp=new b.Signal();this.onTap=new b.Signal();this.onHold=new b.Signal();this.scale=new b.Point(1,1);this.speed=new b.Point();this.position=new b.Point();this._oldPosition=new b.Point();this.circle=new b.Circle(0,0,44);this.activePointer=this.mousePointer;this.currentPointers=0;this.hitCanvas=document.createElement("canvas");this.hitCanvas.width=1;this.hitCanvas.height=1;this.hitContext=this.hitCanvas.getContext("2d");this.mouse.start();this.keyboard.start();this.touch.start();this.mspointer.start();this.mousePointer.active=true},destroy:function(){this.mouse.stop();this.keyboard.stop();this.touch.stop();this.mspointer.stop();this.gamepad.stop();this.moveCallbacks=[];this.moveCallback=null},setMoveCallback:function(e,d){this.moveCallback=e;this.moveCallbackContext=d},addMoveCallback:function(e,d){return this.moveCallbacks.push({callback:e,context:d})-1},deleteMoveCallback:function(d){if(this.moveCallbacks[d]){this.moveCallbacks.splice(d,1)}},addPointer:function(){var e=0;for(var d=10;d>0;d--){if(this["pointer"+d]===null){e=d}}if(e===0){console.warn("You can only have 10 Pointer objects");return null}else{this["pointer"+e]=new b.Pointer(this.game,e);return this["pointer"+e]}},update:function(){this.keyboard.update();if(this.pollRate>0&&this._pollCounter<this.pollRate){this._pollCounter++;return}this.speed.x=this.position.x-this._oldPosition.x;this.speed.y=this.position.y-this._oldPosition.y;this._oldPosition.copyFrom(this.position);this.mousePointer.update();if(this.gamepad.active){this.gamepad.update()}this.pointer1.update();this.pointer2.update();if(this.pointer3){this.pointer3.update()}if(this.pointer4){this.pointer4.update()}if(this.pointer5){this.pointer5.update()}if(this.pointer6){this.pointer6.update()}if(this.pointer7){this.pointer7.update()}if(this.pointer8){this.pointer8.update()}if(this.pointer9){this.pointer9.update()}if(this.pointer10){this.pointer10.update()}this._pollCounter=0},reset:function(e){if(!this.game.isBooted||this.resetLocked){return}if(typeof e==="undefined"){e=false}this.keyboard.reset(e);this.mousePointer.reset();this.gamepad.reset();for(var d=1;d<=10;d++){if(this["pointer"+d]){this["pointer"+d].reset()}}this.currentPointers=0;if(this.game.canvas.style.cursor!=="none"){this.game.canvas.style.cursor="inherit"}if(e){this.onDown.dispose();this.onUp.dispose();this.onTap.dispose();this.onHold.dispose();this.onDown=new b.Signal();this.onUp=new b.Signal();this.onTap=new b.Signal();this.onHold=new b.Signal();this.moveCallbacks=[]}this._pollCounter=0},resetSpeed:function(d,e){this._oldPosition.setTo(d,e);this.speed.setTo(0,0)},startPointer:function(e){if(this.maxPointers<10&&this.totalActivePointers==this.maxPointers){return null}if(this.pointer1.active===false){return this.pointer1.start(e)}else{if(this.pointer2.active===false){return this.pointer2.start(e)}else{for(var d=3;d<=10;d++){if(this["pointer"+d]&&this["pointer"+d].active===false){return this["pointer"+d].start(e)}}}}return null},updatePointer:function(e){if(this.pointer1.active&&this.pointer1.identifier==e.identifier){return this.pointer1.move(e)}else{if(this.pointer2.active&&this.pointer2.identifier==e.identifier){return this.pointer2.move(e)}else{for(var d=3;d<=10;d++){if(this["pointer"+d]&&this["pointer"+d].active&&this["pointer"+d].identifier==e.identifier){return this["pointer"+d].move(e)}}}}return null},stopPointer:function(e){if(this.pointer1.active&&this.pointer1.identifier==e.identifier){return this.pointer1.stop(e)}else{if(this.pointer2.active&&this.pointer2.identifier==e.identifier){return this.pointer2.stop(e)}else{for(var d=3;d<=10;d++){if(this["pointer"+d]&&this["pointer"+d].active&&this["pointer"+d].identifier==e.identifier){return this["pointer"+d].stop(e)}}}}return null},getPointer:function(e){e=e||false;if(this.pointer1.active==e){return this.pointer1}else{if(this.pointer2.active==e){return this.pointer2}else{for(var d=3;d<=10;d++){if(this["pointer"+d]&&this["pointer"+d].active==e){return this["pointer"+d]}}}}return null},getPointerFromIdentifier:function(d){if(this.pointer1.identifier===d){return this.pointer1}else{if(this.pointer2.identifier===d){return this.pointer2}else{for(var e=3;e<=10;e++){if(this["pointer"+e]&&this["pointer"+e].identifier===d){return this["pointer"+e]}}}}return null},getPointerFromId:function(e){if(this.pointer1.pointerId===e){return this.pointer1}else{if(this.pointer2.pointerId===e){return this.pointer2}else{for(var d=3;d<=10;d++){if(this["pointer"+d]&&this["pointer"+d].pointerId===e){return this["pointer"+d]}}}}return null},getLocalPosition:function(g,f,e){if(typeof e==="undefined"){e=new b.Point()}var d=g.worldTransform;var h=1/(d.a*d.d+d.b*-d.c);return e.setTo(d.d*h*f.x+-d.b*h*f.y+(d.ty*d.b-d.tx*d.d)*h,d.a*h*f.y+-d.c*h*f.x+(-d.ty*d.a+d.tx*d.c)*h)},hitTest:function(j,d,m){if(!j.worldVisible){return false}this.getLocalPosition(j,d,this._localPoint);m.copyFrom(this._localPoint);if(j.hitArea&&j.hitArea.contains){if(j.hitArea.contains(this._localPoint.x,this._localPoint.y)){return true}return false}else{if(j instanceof b.TileSprite){var e=j.width;var l=j.height;var f=-e*j.anchor.x;if(this._localPoint.x>f&&this._localPoint.x<f+e){var k=-l*j.anchor.y;if(this._localPoint.y>k&&this._localPoint.y<k+l){return true}}}else{if(j instanceof PIXI.Sprite){var e=j.texture.frame.width;var l=j.texture.frame.height;var f=-e*j.anchor.x;if(this._localPoint.x>f&&this._localPoint.x<f+e){var k=-l*j.anchor.y;if(this._localPoint.y>k&&this._localPoint.y<k+l){return true}}}}}for(var g=0,h=j.children.length;g<h;g++){if(this.hitTest(j.children[g],d,m)){return true}}return false}};b.Input.prototype.constructor=b.Input;Object.defineProperty(b.Input.prototype,"x",{get:function(){return this._x},set:function(d){this._x=Math.floor(d)}});Object.defineProperty(b.Input.prototype,"y",{get:function(){return this._y},set:function(d){this._y=Math.floor(d)}});Object.defineProperty(b.Input.prototype,"pollLocked",{get:function(){return(this.pollRate>0&&this._pollCounter<this.pollRate)}});Object.defineProperty(b.Input.prototype,"totalInactivePointers",{get:function(){return 10-this.currentPointers}});Object.defineProperty(b.Input.prototype,"totalActivePointers",{get:function(){this.currentPointers=0;for(var d=1;d<=10;d++){if(this["pointer"+d]&&this["pointer"+d].active){this.currentPointers++}}return this.currentPointers}});Object.defineProperty(b.Input.prototype,"worldX",{get:function(){return this.game.camera.view.x+this.x}});Object.defineProperty(b.Input.prototype,"worldY",{get:function(){return this.game.camera.view.y+this.y}});b.Key=function(e,d){this.game=e;this.enabled=true;this.event=null;this.isDown=false;this.isUp=true;this.altKey=false;this.ctrlKey=false;this.shiftKey=false;this.timeDown=0;this.duration=0;this.timeUp=-2500;this.repeats=0;this.keyCode=d;this.onDown=new b.Signal();this.onHoldCallback=null;this.onHoldContext=null;this.onUp=new b.Signal()};b.Key.prototype={update:function(){if(!this.enabled){return}if(this.isDown){this.duration=this.game.time.now-this.timeDown;this.repeats++;if(this.onHoldCallback){this.onHoldCallback.call(this.onHoldContext,this)}}},processKeyDown:function(d){if(!this.enabled){return}this.event=d;if(this.isDown){return}this.altKey=d.altKey;this.ctrlKey=d.ctrlKey;this.shiftKey=d.shiftKey;this.isDown=true;this.isUp=false;this.timeDown=this.game.time.now;this.duration=0;this.repeats=0;this.onDown.dispatch(this)},processKeyUp:function(d){if(!this.enabled){return}this.event=d;if(this.isUp){return}this.isDown=false;this.isUp=true;this.timeUp=this.game.time.now;this.duration=this.game.time.now-this.timeDown;this.onUp.dispatch(this)},reset:function(d){if(typeof d==="undefined"){d=true}this.isDown=false;this.isUp=true;this.timeUp=this.game.time.now;this.duration=0;this.enabled=true;if(d){this.onDown.removeAll();this.onUp.removeAll();this.onHoldCallback=null;this.onHoldContext=null}},justPressed:function(d){if(typeof d==="undefined"){d=50}return(this.isDown&&this.duration<d)},justReleased:function(d){if(typeof d==="undefined"){d=50}return(!this.isDown&&((this.game.time.now-this.timeUp)<d))}};b.Key.prototype.constructor=b.Key;b.Keyboard=function(d){this.game=d;this.disabled=false;this.event=null;this.pressEvent=null;this.callbackContext=this;this.onDownCallback=null;this.onPressCallback=null;this.onUpCallback=null;this._keys=[];this._capture=[];this._onKeyDown=null;this._onKeyPress=null;this._onKeyUp=null;this._i=0;this._k=0};b.Keyboard.prototype={addCallbacks:function(d,e,g,f){this.callbackContext=d;if(typeof e!=="undefined"){this.onDownCallback=e}if(typeof g!=="undefined"){this.onUpCallback=g}if(typeof f!=="undefined"){this.onPressCallback=f}},addKey:function(d){if(!this._keys[d]){this._keys[d]=new b.Key(this.game,d);this.addKeyCapture(d)}return this._keys[d]},removeKey:function(d){if(this._keys[d]){this._keys[d]=null;this.removeKeyCapture(d)}},createCursorKeys:function(){return{up:this.addKey(b.Keyboard.UP),down:this.addKey(b.Keyboard.DOWN),left:this.addKey(b.Keyboard.LEFT),right:this.addKey(b.Keyboard.RIGHT)}},start:function(){if(this.game.device.cocoonJS){return}if(this._onKeyDown!==null){return}var d=this;this._onKeyDown=function(e){return d.processKeyDown(e)};this._onKeyUp=function(e){return d.processKeyUp(e)};this._onKeyPress=function(e){return d.processKeyPress(e)};window.addEventListener("keydown",this._onKeyDown,false);window.addEventListener("keyup",this._onKeyUp,false);window.addEventListener("keypress",this._onKeyPress,false)},stop:function(){window.removeEventListener("keydown",this._onKeyDown);window.removeEventListener("keyup",this._onKeyUp);window.removeEventListener("keypress",this._onKeyPress);this._onKeyDown=null;this._onKeyUp=null;this._onKeyPress=null},destroy:function(){this.stop();this.clearCaptures();this._keys.length=0;this._i=0},addKeyCapture:function(d){if(typeof d==="object"){for(var e in d){this._capture[d[e]]=true}}else{this._capture[d]=true}},removeKeyCapture:function(d){delete this._capture[d]},clearCaptures:function(){this._capture={}},update:function(){this._i=this._keys.length;while(this._i--){if(this._keys[this._i]){this._keys[this._i].update()}}},processKeyDown:function(d){this.event=d;if(this.game.input.disabled||this.disabled){return}if(this._capture[d.keyCode]){d.preventDefault()}if(!this._keys[d.keyCode]){this._keys[d.keyCode]=new b.Key(this.game,d.keyCode)}this._keys[d.keyCode].processKeyDown(d);this._k=d.keyCode;if(this.onDownCallback){this.onDownCallback.call(this.callbackContext,d)}},processKeyPress:function(d){this.pressEvent=d;if(this.game.input.disabled||this.disabled){return}if(this.onPressCallback){this.onPressCallback.call(this.callbackContext,String.fromCharCode(d.charCode),d)}},processKeyUp:function(d){this.event=d;if(this.game.input.disabled||this.disabled){return}if(this._capture[d.keyCode]){d.preventDefault()}if(!this._keys[d.keyCode]){this._keys[d.keyCode]=new b.Key(this.game,d.keyCode)}this._keys[d.keyCode].processKeyUp(d);if(this.onUpCallback){this.onUpCallback.call(this.callbackContext,d)}},reset:function(e){if(typeof e==="undefined"){e=true}this.event=null;var d=this._keys.length;while(d--){if(this._keys[d]){this._keys[d].reset(e)}}},justPressed:function(d,e){if(typeof e==="undefined"){e=50}if(this._keys[d]){return this._keys[d].justPressed(e)}else{return false}},justReleased:function(d,e){if(typeof e==="undefined"){e=50}if(this._keys[d]){return this._keys[d].justReleased(e)}else{return false}},isDown:function(d){if(this._keys[d]){return this._keys[d].isDown}return false}};Object.defineProperty(b.Keyboard.prototype,"lastChar",{get:function(){if(this.event.charCode===32){return""}else{return String.fromCharCode(this.pressEvent.charCode)}}});Object.defineProperty(b.Keyboard.prototype,"lastKey",{get:function(){return this._keys[this._k]}});b.Keyboard.prototype.constructor=b.Keyboard;b.Keyboard.A="A".charCodeAt(0);b.Keyboard.B="B".charCodeAt(0);b.Keyboard.C="C".charCodeAt(0);b.Keyboard.D="D".charCodeAt(0);b.Keyboard.E="E".charCodeAt(0);b.Keyboard.F="F".charCodeAt(0);b.Keyboard.G="G".charCodeAt(0);b.Keyboard.H="H".charCodeAt(0);b.Keyboard.I="I".charCodeAt(0);b.Keyboard.J="J".charCodeAt(0);b.Keyboard.K="K".charCodeAt(0);b.Keyboard.L="L".charCodeAt(0);b.Keyboard.M="M".charCodeAt(0);b.Keyboard.N="N".charCodeAt(0);b.Keyboard.O="O".charCodeAt(0);b.Keyboard.P="P".charCodeAt(0);b.Keyboard.Q="Q".charCodeAt(0);b.Keyboard.R="R".charCodeAt(0);b.Keyboard.S="S".charCodeAt(0);b.Keyboard.T="T".charCodeAt(0);b.Keyboard.U="U".charCodeAt(0);b.Keyboard.V="V".charCodeAt(0);b.Keyboard.W="W".charCodeAt(0);b.Keyboard.X="X".charCodeAt(0);b.Keyboard.Y="Y".charCodeAt(0);b.Keyboard.Z="Z".charCodeAt(0);b.Keyboard.ZERO="0".charCodeAt(0);b.Keyboard.ONE="1".charCodeAt(0);b.Keyboard.TWO="2".charCodeAt(0);b.Keyboard.THREE="3".charCodeAt(0);b.Keyboard.FOUR="4".charCodeAt(0);b.Keyboard.FIVE="5".charCodeAt(0);b.Keyboard.SIX="6".charCodeAt(0);b.Keyboard.SEVEN="7".charCodeAt(0);b.Keyboard.EIGHT="8".charCodeAt(0);b.Keyboard.NINE="9".charCodeAt(0);b.Keyboard.NUMPAD_0=96;b.Keyboard.NUMPAD_1=97;b.Keyboard.NUMPAD_2=98;b.Keyboard.NUMPAD_3=99;b.Keyboard.NUMPAD_4=100;b.Keyboard.NUMPAD_5=101;b.Keyboard.NUMPAD_6=102;b.Keyboard.NUMPAD_7=103;b.Keyboard.NUMPAD_8=104;b.Keyboard.NUMPAD_9=105;b.Keyboard.NUMPAD_MULTIPLY=106;b.Keyboard.NUMPAD_ADD=107;b.Keyboard.NUMPAD_ENTER=108;b.Keyboard.NUMPAD_SUBTRACT=109;b.Keyboard.NUMPAD_DECIMAL=110;b.Keyboard.NUMPAD_DIVIDE=111;b.Keyboard.F1=112;b.Keyboard.F2=113;b.Keyboard.F3=114;b.Keyboard.F4=115;b.Keyboard.F5=116;b.Keyboard.F6=117;b.Keyboard.F7=118;b.Keyboard.F8=119;b.Keyboard.F9=120;b.Keyboard.F10=121;b.Keyboard.F11=122;b.Keyboard.F12=123;b.Keyboard.F13=124;b.Keyboard.F14=125;b.Keyboard.F15=126;b.Keyboard.COLON=186;b.Keyboard.EQUALS=187;b.Keyboard.UNDERSCORE=189;b.Keyboard.QUESTION_MARK=191;b.Keyboard.TILDE=192;b.Keyboard.OPEN_BRACKET=219;b.Keyboard.BACKWARD_SLASH=220;b.Keyboard.CLOSED_BRACKET=221;b.Keyboard.QUOTES=222;b.Keyboard.BACKSPACE=8;b.Keyboard.TAB=9;b.Keyboard.CLEAR=12;b.Keyboard.ENTER=13;b.Keyboard.SHIFT=16;b.Keyboard.CONTROL=17;b.Keyboard.ALT=18;b.Keyboard.CAPS_LOCK=20;b.Keyboard.ESC=27;b.Keyboard.SPACEBAR=32;b.Keyboard.PAGE_UP=33;b.Keyboard.PAGE_DOWN=34;b.Keyboard.END=35;b.Keyboard.HOME=36;b.Keyboard.LEFT=37;b.Keyboard.UP=38;b.Keyboard.RIGHT=39;b.Keyboard.DOWN=40;b.Keyboard.INSERT=45;b.Keyboard.DELETE=46;b.Keyboard.HELP=47;b.Keyboard.NUM_LOCK=144;b.Mouse=function(d){this.game=d;this.callbackContext=this.game;this.mouseDownCallback=null;this.mouseMoveCallback=null;this.mouseUpCallback=null;this.mouseOutCallback=null;this.mouseOverCallback=null;this.mouseWheelCallback=null;this.capture=false;this.button=-1;this.wheelDelta=0;this.disabled=false;this.locked=false;this.stopOnGameOut=false;this.pointerLock=new b.Signal();this.event=null;this._onMouseDown=null;this._onMouseMove=null;this._onMouseUp=null;this._onMouseOut=null;this._onMouseOver=null;this._onMouseWheel=null};b.Mouse.NO_BUTTON=-1;b.Mouse.LEFT_BUTTON=0;b.Mouse.MIDDLE_BUTTON=1;b.Mouse.RIGHT_BUTTON=2;b.Mouse.WHEEL_UP=1;b.Mouse.WHEEL_DOWN=-1;b.Mouse.prototype={start:function(){if(this.game.device.android&&this.game.device.chrome===false){return}if(this._onMouseDown!==null){return}var d=this;this._onMouseDown=function(e){return d.onMouseDown(e)};this._onMouseMove=function(e){return d.onMouseMove(e)};this._onMouseUp=function(e){return d.onMouseUp(e)};this._onMouseOut=function(e){return d.onMouseOut(e)};this._onMouseOver=function(e){return d.onMouseOver(e)};this._onMouseWheel=function(e){return d.onMouseWheel(e)};this.game.canvas.addEventListener("mousedown",this._onMouseDown,true);this.game.canvas.addEventListener("mousemove",this._onMouseMove,true);this.game.canvas.addEventListener("mouseup",this._onMouseUp,true);this.game.canvas.addEventListener("mousewheel",this._onMouseWheel,true);this.game.canvas.addEventListener("DOMMouseScroll",this._onMouseWheel,true);if(!this.game.device.cocoonJS){this.game.canvas.addEventListener("mouseover",this._onMouseOver,true);this.game.canvas.addEventListener("mouseout",this._onMouseOut,true)}},onMouseDown:function(d){this.event=d;if(this.capture){d.preventDefault()}this.button=d.button;if(this.mouseDownCallback){this.mouseDownCallback.call(this.callbackContext,d)}if(this.game.input.disabled||this.disabled){return}d.identifier=0;this.game.input.mousePointer.start(d)},onMouseMove:function(d){this.event=d;if(this.capture){d.preventDefault()}if(this.mouseMoveCallback){this.mouseMoveCallback.call(this.callbackContext,d)}if(this.game.input.disabled||this.disabled){return}d.identifier=0;this.game.input.mousePointer.move(d)},onMouseUp:function(d){this.event=d;if(this.capture){d.preventDefault()}this.button=b.Mouse.NO_BUTTON;if(this.mouseUpCallback){this.mouseUpCallback.call(this.callbackContext,d)}if(this.game.input.disabled||this.disabled){return}d.identifier=0;this.game.input.mousePointer.stop(d)},onMouseOut:function(d){this.event=d;if(this.capture){d.preventDefault()}if(this.mouseOutCallback){this.mouseOutCallback.call(this.callbackContext,d)}if(this.game.input.disabled||this.disabled){return}this.game.input.mousePointer.withinGame=false;if(this.stopOnGameOut){d.identifier=0;this.game.input.mousePointer.stop(d)}},onMouseWheel:function(d){this.event=d;if(this.capture){d.preventDefault()}this.wheelDelta=Math.max(-1,Math.min(1,(d.wheelDelta||-d.detail)));if(this.mouseWheelCallback){this.mouseWheelCallback.call(this.callbackContext,d)}},onMouseOver:function(d){this.event=d;if(this.capture){d.preventDefault()}if(this.mouseOverCallback){this.mouseOverCallback.call(this.callbackContext,d)}if(this.game.input.disabled||this.disabled){return}this.game.input.mousePointer.withinGame=true},requestPointerLock:function(){if(this.game.device.pointerLock){var d=this.game.canvas;d.requestPointerLock=d.requestPointerLock||d.mozRequestPointerLock||d.webkitRequestPointerLock;d.requestPointerLock();var e=this;this._pointerLockChange=function(f){return e.pointerLockChange(f)};document.addEventListener("pointerlockchange",this._pointerLockChange,true);document.addEventListener("mozpointerlockchange",this._pointerLockChange,true);document.addEventListener("webkitpointerlockchange",this._pointerLockChange,true)}},pointerLockChange:function(e){var d=this.game.canvas;if(document.pointerLockElement===d||document.mozPointerLockElement===d||document.webkitPointerLockElement===d){this.locked=true;this.pointerLock.dispatch(true,e)}else{this.locked=false;this.pointerLock.dispatch(false,e)}},releasePointerLock:function(){document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock;document.exitPointerLock();document.removeEventListener("pointerlockchange",this._pointerLockChange,true);document.removeEventListener("mozpointerlockchange",this._pointerLockChange,true);document.removeEventListener("webkitpointerlockchange",this._pointerLockChange,true)},stop:function(){this.game.canvas.removeEventListener("mousedown",this._onMouseDown,true);this.game.canvas.removeEventListener("mousemove",this._onMouseMove,true);this.game.canvas.removeEventListener("mouseup",this._onMouseUp,true);this.game.canvas.removeEventListener("mouseover",this._onMouseOver,true);this.game.canvas.removeEventListener("mouseout",this._onMouseOut,true);this.game.canvas.removeEventListener("mousewheel",this._onMouseWheel,true);this.game.canvas.removeEventListener("DOMMouseScroll",this._onMouseWheel,true)}};b.Mouse.prototype.constructor=b.Mouse;b.MSPointer=function(d){this.game=d;this.callbackContext=this.game;this.disabled=false;this._onMSPointerDown=null;this._onMSPointerMove=null;this._onMSPointerUp=null};b.MSPointer.prototype={start:function(){if(this._onMSPointerDown!==null){return}var d=this;if(this.game.device.mspointer===true){this._onMSPointerDown=function(e){return d.onPointerDown(e)};this._onMSPointerMove=function(e){return d.onPointerMove(e)};this._onMSPointerUp=function(e){return d.onPointerUp(e)};this.game.renderer.view.addEventListener("MSPointerDown",this._onMSPointerDown,false);this.game.renderer.view.addEventListener("MSPointerMove",this._onMSPointerMove,false);this.game.renderer.view.addEventListener("MSPointerUp",this._onMSPointerUp,false);this.game.renderer.view.addEventListener("pointerDown",this._onMSPointerDown,false);this.game.renderer.view.addEventListener("pointerMove",this._onMSPointerMove,false);this.game.renderer.view.addEventListener("pointerUp",this._onMSPointerUp,false);this.game.renderer.view.style["-ms-content-zooming"]="none";this.game.renderer.view.style["-ms-touch-action"]="none"}},onPointerDown:function(d){if(this.game.input.disabled||this.disabled){return}d.preventDefault();d.identifier=d.pointerId;this.game.input.startPointer(d)},onPointerMove:function(d){if(this.game.input.disabled||this.disabled){return}d.preventDefault();d.identifier=d.pointerId;this.game.input.updatePointer(d)},onPointerUp:function(d){if(this.game.input.disabled||this.disabled){return}d.preventDefault();d.identifier=d.pointerId;this.game.input.stopPointer(d)},stop:function(){this.game.canvas.removeEventListener("MSPointerDown",this._onMSPointerDown);this.game.canvas.removeEventListener("MSPointerMove",this._onMSPointerMove);this.game.canvas.removeEventListener("MSPointerUp",this._onMSPointerUp);this.game.canvas.removeEventListener("pointerDown",this._onMSPointerDown);this.game.canvas.removeEventListener("pointerMove",this._onMSPointerMove);this.game.canvas.removeEventListener("pointerUp",this._onMSPointerUp)}};b.MSPointer.prototype.constructor=b.MSPointer;b.Pointer=function(d,e){this.game=d;this.id=e;this.type=b.POINTER;this.exists=true;this.identifier=0;this.pointerId=null;this.target=null;this.button=null;this._holdSent=false;this._history=[];this._nextDrop=0;this._stateReset=false;this.withinGame=false;this.clientX=-1;this.clientY=-1;this.pageX=-1;this.pageY=-1;this.screenX=-1;this.screenY=-1;this.rawMovementX=0;this.rawMovementY=0;this.movementX=0;this.movementY=0;this.x=-1;this.y=-1;this.isMouse=false;this.isDown=false;this.isUp=true;this.timeDown=0;this.timeUp=0;this.previousTapTime=0;this.totalTouches=0;this.msSinceLastClick=Number.MAX_VALUE;this.targetObject=null;this.active=false;this.position=new b.Point();this.positionDown=new b.Point();this.positionUp=new b.Point();this.circle=new b.Circle(0,0,44);if(e===0){this.isMouse=true}};b.Pointer.prototype={start:function(d){if(d.pointerId){this.pointerId=d.pointerId}this.identifier=d.identifier;this.target=d.target;if(typeof d.button!=="undefined"){this.button=d.button}this._history=[];this.active=true;this.withinGame=true;this.isDown=true;this.isUp=false;this.msSinceLastClick=this.game.time.now-this.timeDown;this.timeDown=this.game.time.now;this._holdSent=false;this.move(d,true);this.positionDown.setTo(this.x,this.y);if(this.game.input.multiInputOverride===b.Input.MOUSE_OVERRIDES_TOUCH||this.game.input.multiInputOverride===b.Input.MOUSE_TOUCH_COMBINE||(this.game.input.multiInputOverride===b.Input.TOUCH_OVERRIDES_MOUSE&&this.game.input.currentPointers===0)){this.game.input.x=this.x;this.game.input.y=this.y;this.game.input.position.setTo(this.x,this.y);this.game.input.onDown.dispatch(this,d);this.game.input.resetSpeed(this.x,this.y)}this._stateReset=false;this.totalTouches++;if(!this.isMouse){this.game.input.currentPointers++}if(this.targetObject!==null){this.targetObject._touchedHandler(this)}return this},update:function(){if(this.active){if(this._holdSent===false&&this.duration>=this.game.input.holdRate){if(this.game.input.multiInputOverride==b.Input.MOUSE_OVERRIDES_TOUCH||this.game.input.multiInputOverride==b.Input.MOUSE_TOUCH_COMBINE||(this.game.input.multiInputOverride==b.Input.TOUCH_OVERRIDES_MOUSE&&this.game.input.currentPointers===0)){this.game.input.onHold.dispatch(this)}this._holdSent=true}if(this.game.input.recordPointerHistory&&this.game.time.now>=this._nextDrop){this._nextDrop=this.game.time.now+this.game.input.recordRate;this._history.push({x:this.position.x,y:this.position.y});if(this._history.length>this.game.input.recordLimit){this._history.shift()}}}},move:function(e,f){if(this.game.input.pollLocked){return}if(typeof f==="undefined"){f=false}if(typeof e.button!=="undefined"){this.button=e.button}this.clientX=e.clientX;this.clientY=e.clientY;this.pageX=e.pageX;this.pageY=e.pageY;this.screenX=e.screenX;this.screenY=e.screenY;if(this.isMouse&&this.game.input.mouse.locked&&!f){this.rawMovementX=e.movementX||e.mozMovementX||e.webkitMovementX||0;this.rawMovementY=e.movementY||e.mozMovementY||e.webkitMovementY||0;this.movementX+=this.rawMovementX;this.movementY+=this.rawMovementY}this.x=(this.pageX-this.game.stage.offset.x)*this.game.input.scale.x;this.y=(this.pageY-this.game.stage.offset.y)*this.game.input.scale.y;this.position.setTo(this.x,this.y);this.circle.x=this.x;this.circle.y=this.y;if(this.game.input.multiInputOverride===b.Input.MOUSE_OVERRIDES_TOUCH||this.game.input.multiInputOverride===b.Input.MOUSE_TOUCH_COMBINE||(this.game.input.multiInputOverride===b.Input.TOUCH_OVERRIDES_MOUSE&&this.game.input.currentPointers===0)){this.game.input.activePointer=this;this.game.input.x=this.x;this.game.input.y=this.y;this.game.input.position.setTo(this.game.input.x,this.game.input.y);this.game.input.circle.x=this.game.input.x;this.game.input.circle.y=this.game.input.y}this.withinGame=this.game.scale.bounds.contains(this.pageX,this.pageY);if(this.game.paused){return this}if(this.game.input.moveCallback){this.game.input.moveCallback.call(this.game.input.moveCallbackContext,this,this.x,this.y)}var d=this.game.input.moveCallbacks.length;while(d--){this.game.input.moveCallbacks[d].callback.call(this.game.input.moveCallbacks[d].context,this,this.x,this.y)}if(this.targetObject!==null&&this.targetObject.isDragged===true){if(this.targetObject.update(this)===false){this.targetObject=null}return this}else{if(this.game.input.interactiveItems.total>0){this.processInteractiveObjects(f)}}return this},processInteractiveObjects:function(e){this.game.input.interactiveItems.setAll("checked",false);this._highestRenderOrderID=Number.MAX_SAFE_INTEGER;this._highestRenderObject=null;this._highestInputPriorityID=-1;var d=this.game.input.interactiveItems.first;do{if(d&&d.validForInput(this._highestInputPriorityID,this._highestRenderOrderID,false)){d.checked=true;if((e&&d.checkPointerDown(this,true))||(!e&&d.checkPointerOver(this,true))){this._highestRenderOrderID=d.sprite._cache[3];this._highestInputPriorityID=d.priorityID;this._highestRenderObject=d}}d=this.game.input.interactiveItems.next}while(d!==null);var d=this.game.input.interactiveItems.first;do{if(d&&!d.checked&&d.validForInput(this._highestInputPriorityID,this._highestRenderOrderID,true)){if((e&&d.checkPointerDown(this,false))||(!e&&d.checkPointerOver(this,false))){this._highestRenderOrderID=d.sprite._cache[3];this._highestInputPriorityID=d.priorityID;this._highestRenderObject=d}}d=this.game.input.interactiveItems.next}while(d!==null);if(this._highestRenderObject===null){if(this.targetObject){this.targetObject._pointerOutHandler(this);this.targetObject=null}}else{if(this.targetObject===null){this.targetObject=this._highestRenderObject;this._highestRenderObject._pointerOverHandler(this)}else{if(this.targetObject===this._highestRenderObject){if(this._highestRenderObject.update(this)===false){this.targetObject=null}}else{this.targetObject._pointerOutHandler(this);this.targetObject=this._highestRenderObject;this.targetObject._pointerOverHandler(this)}}}},leave:function(d){this.withinGame=false;this.move(d,false)},stop:function(d){if(this._stateReset){d.preventDefault();return}this.timeUp=this.game.time.now;if(this.game.input.multiInputOverride===b.Input.MOUSE_OVERRIDES_TOUCH||this.game.input.multiInputOverride===b.Input.MOUSE_TOUCH_COMBINE||(this.game.input.multiInputOverride===b.Input.TOUCH_OVERRIDES_MOUSE&&this.game.input.currentPointers===0)){this.game.input.onUp.dispatch(this,d);if(this.duration>=0&&this.duration<=this.game.input.tapRate){if(this.timeUp-this.previousTapTime<this.game.input.doubleTapRate){this.game.input.onTap.dispatch(this,true)}else{this.game.input.onTap.dispatch(this,false)}this.previousTapTime=this.timeUp}}if(this.id>0){this.active=false}this.withinGame=false;this.isDown=false;this.isUp=true;this.pointerId=null;this.identifier=null;this.positionUp.setTo(this.x,this.y);if(this.isMouse===false){this.game.input.currentPointers--}this.game.input.interactiveItems.callAll("_releasedHandler",this);this.targetObject=null;return this},justPressed:function(d){d=d||this.game.input.justPressedRate;return(this.isDown===true&&(this.timeDown+d)>this.game.time.now)},justReleased:function(d){d=d||this.game.input.justReleasedRate;return(this.isUp===true&&(this.timeUp+d)>this.game.time.now)},reset:function(){if(this.isMouse===false){this.active=false}this.pointerId=null;this.identifier=null;this.isDown=false;this.isUp=true;this.totalTouches=0;this._holdSent=false;this._history.length=0;this._stateReset=true;if(this.targetObject){this.targetObject._releasedHandler(this)}this.targetObject=null},resetMovement:function(){this.movementX=0;this.movementY=0}};b.Pointer.prototype.constructor=b.Pointer;Object.defineProperty(b.Pointer.prototype,"duration",{get:function(){if(this.isUp){return -1}return this.game.time.now-this.timeDown}});Object.defineProperty(b.Pointer.prototype,"worldX",{get:function(){return this.game.world.camera.x+this.x}});Object.defineProperty(b.Pointer.prototype,"worldY",{get:function(){return this.game.world.camera.y+this.y}});b.Touch=function(d){this.game=d;this.disabled=false;this.callbackContext=this.game;this.touchStartCallback=null;this.touchMoveCallback=null;this.touchEndCallback=null;this.touchEnterCallback=null;this.touchLeaveCallback=null;this.touchCancelCallback=null;this.preventDefault=true;this.event=null;this._onTouchStart=null;this._onTouchMove=null;this._onTouchEnd=null;this._onTouchEnter=null;this._onTouchLeave=null;this._onTouchCancel=null;this._onTouchMove=null};b.Touch.prototype={start:function(){if(this._onTouchStart!==null){return}var d=this;if(this.game.device.touch){this._onTouchStart=function(e){return d.onTouchStart(e)};this._onTouchMove=function(e){return d.onTouchMove(e)};this._onTouchEnd=function(e){return d.onTouchEnd(e)};this._onTouchEnter=function(e){return d.onTouchEnter(e)};this._onTouchLeave=function(e){return d.onTouchLeave(e)};this._onTouchCancel=function(e){return d.onTouchCancel(e)};this.game.canvas.addEventListener("touchstart",this._onTouchStart,false);this.game.canvas.addEventListener("touchmove",this._onTouchMove,false);this.game.canvas.addEventListener("touchend",this._onTouchEnd,false);this.game.canvas.addEventListener("touchcancel",this._onTouchCancel,false);if(!this.game.device.cocoonJS){this.game.canvas.addEventListener("touchenter",this._onTouchEnter,false);this.game.canvas.addEventListener("touchleave",this._onTouchLeave,false)}}},consumeDocumentTouches:function(){this._documentTouchMove=function(d){d.preventDefault()};document.addEventListener("touchmove",this._documentTouchMove,false)},onTouchStart:function(e){this.event=e;if(this.touchStartCallback){this.touchStartCallback.call(this.callbackContext,e)}if(this.game.input.disabled||this.disabled){return}if(this.preventDefault){e.preventDefault()}for(var d=0;d<e.changedTouches.length;d++){this.game.input.startPointer(e.changedTouches[d])}},onTouchCancel:function(e){this.event=e;if(this.touchCancelCallback){this.touchCancelCallback.call(this.callbackContext,e)}if(this.game.input.disabled||this.disabled){return}if(this.preventDefault){e.preventDefault()}for(var d=0;d<e.changedTouches.length;d++){this.game.input.stopPointer(e.changedTouches[d])}},onTouchEnter:function(d){this.event=d;if(this.touchEnterCallback){this.touchEnterCallback.call(this.callbackContext,d)}if(this.game.input.disabled||this.disabled){return}if(this.preventDefault){d.preventDefault()}},onTouchLeave:function(d){this.event=d;if(this.touchLeaveCallback){this.touchLeaveCallback.call(this.callbackContext,d)}if(this.preventDefault){d.preventDefault()}},onTouchMove:function(e){this.event=e;if(this.touchMoveCallback){this.touchMoveCallback.call(this.callbackContext,e)}if(this.preventDefault){e.preventDefault()}for(var d=0;d<e.changedTouches.length;d++){this.game.input.updatePointer(e.changedTouches[d])}},onTouchEnd:function(e){this.event=e;if(this.touchEndCallback){this.touchEndCallback.call(this.callbackContext,e)}if(this.preventDefault){e.preventDefault()}for(var d=0;d<e.changedTouches.length;d++){this.game.input.stopPointer(e.changedTouches[d])}},stop:function(){if(this.game.device.touch){this.game.canvas.removeEventListener("touchstart",this._onTouchStart);this.game.canvas.removeEventListener("touchmove",this._onTouchMove);this.game.canvas.removeEventListener("touchend",this._onTouchEnd);this.game.canvas.removeEventListener("touchenter",this._onTouchEnter);this.game.canvas.removeEventListener("touchleave",this._onTouchLeave);this.game.canvas.removeEventListener("touchcancel",this._onTouchCancel)}}};b.Touch.prototype.constructor=b.Touch;b.Gamepad=function(d){this.game=d;this._gamepads=[new b.SinglePad(d,this),new b.SinglePad(d,this),new b.SinglePad(d,this),new b.SinglePad(d,this)];this._gamepadIndexMap={};this._rawPads=[];this._active=false;this.disabled=false;this._gamepadSupportAvailable=!!navigator.webkitGetGamepads||!!navigator.webkitGamepads||(navigator.userAgent.indexOf("Firefox/")!=-1)||!!navigator.getGamepads;this._prevRawGamepadTypes=[];this._prevTimestamps=[];this.callbackContext=this;this.onConnectCallback=null;this.onDisconnectCallback=null;this.onDownCallback=null;this.onUpCallback=null;this.onAxisCallback=null;this.onFloatCallback=null;this._ongamepadconnected=null;this._gamepaddisconnected=null};b.Gamepad.prototype={addCallbacks:function(d,e){if(typeof e!=="undefined"){this.onConnectCallback=(typeof e.onConnect==="function")?e.onConnect:this.onConnectCallback;this.onDisconnectCallback=(typeof e.onDisconnect==="function")?e.onDisconnect:this.onDisconnectCallback;this.onDownCallback=(typeof e.onDown==="function")?e.onDown:this.onDownCallback;this.onUpCallback=(typeof e.onUp==="function")?e.onUp:this.onUpCallback;this.onAxisCallback=(typeof e.onAxis==="function")?e.onAxis:this.onAxisCallback;this.onFloatCallback=(typeof e.onFloat==="function")?e.onFloat:this.onFloatCallback}},start:function(){if(this._active){return}this._active=true;var d=this;this._ongamepadconnected=function(f){var e=f.gamepad;d._rawPads.push(e);d._gamepads[e.index].connect(e)};window.addEventListener("gamepadconnected",this._ongamepadconnected,false);this._ongamepaddisconnected=function(f){var g=f.gamepad;for(var e in d._rawPads){if(d._rawPads[e].index===g.index){d._rawPads.splice(e,1)}}d._gamepads[g.index].disconnect()};window.addEventListener("gamepaddisconnected",this._ongamepaddisconnected,false)},update:function(){this._pollGamepads();this.pad1.pollStatus();this.pad2.pollStatus();this.pad3.pollStatus();this.pad4.pollStatus()},_pollGamepads:function(){if(navigator.getGamepads){var d=navigator.getGamepads()}else{if(navigator.webkitGetGamepads){var d=navigator.webkitGetGamepads()}else{if(navigator.webkitGamepads){var d=navigator.webkitGamepads()}}}if(d){this._rawPads=[];var o=false;for(var n=0;n<d.length;n++){if(typeof d[n]!==this._prevRawGamepadTypes[n]){o=true;this._prevRawGamepadTypes[n]=typeof d[n]}if(d[n]){this._rawPads.push(d[n])}if(n===3){break}}if(o){var r={rawIndices:{},padIndices:{}};var q;for(var h=0;h<this._gamepads.length;h++){q=this._gamepads[h];if(q.connected){for(var g=0;g<this._rawPads.length;g++){if(this._rawPads[g].index===q.index){r.rawIndices[q.index]=true;r.padIndices[h]=true}}}}for(var f=0;f<this._gamepads.length;f++){q=this._gamepads[f];if(r.padIndices[f]){continue}if(this._rawPads.length<1){q.disconnect()}for(var e=0;e<this._rawPads.length;e++){if(r.padIndices[f]){break}var p=this._rawPads[e];if(p){if(r.rawIndices[p.index]){q.disconnect();continue}else{q.connect(p);r.rawIndices[p.index]=true;r.padIndices[f]=true}}else{q.disconnect()}}}}}},setDeadZones:function(e){for(var d=0;d<this._gamepads.length;d++){this._gamepads[d].deadZone=e}},stop:function(){this._active=false;window.removeEventListener("gamepadconnected",this._ongamepadconnected);window.removeEventListener("gamepaddisconnected",this._ongamepaddisconnected)},reset:function(){this.update();for(var d=0;d<this._gamepads.length;d++){this._gamepads[d].reset()}},justPressed:function(d,f){for(var e=0;e<this._gamepads.length;e++){if(this._gamepads[e].justPressed(d,f)===true){return true}}return false},justReleased:function(d,f){for(var e=0;e<this._gamepads.length;e++){if(this._gamepads[e].justReleased(d,f)===true){return true}}return false},isDown:function(d){for(var e=0;e<this._gamepads.length;e++){if(this._gamepads[e].isDown(d)===true){return true}}return false}};b.Gamepad.prototype.constructor=b.Gamepad;Object.defineProperty(b.Gamepad.prototype,"active",{get:function(){return this._active}});Object.defineProperty(b.Gamepad.prototype,"supported",{get:function(){return this._gamepadSupportAvailable}});Object.defineProperty(b.Gamepad.prototype,"padsConnected",{get:function(){return this._rawPads.length}});Object.defineProperty(b.Gamepad.prototype,"pad1",{get:function(){return this._gamepads[0]}});Object.defineProperty(b.Gamepad.prototype,"pad2",{get:function(){return this._gamepads[1]}});Object.defineProperty(b.Gamepad.prototype,"pad3",{get:function(){return this._gamepads[2]}});Object.defineProperty(b.Gamepad.prototype,"pad4",{get:function(){return this._gamepads[3]}});b.Gamepad.BUTTON_0=0;b.Gamepad.BUTTON_1=1;b.Gamepad.BUTTON_2=2;b.Gamepad.BUTTON_3=3;b.Gamepad.BUTTON_4=4;b.Gamepad.BUTTON_5=5;b.Gamepad.BUTTON_6=6;b.Gamepad.BUTTON_7=7;b.Gamepad.BUTTON_8=8;b.Gamepad.BUTTON_9=9;b.Gamepad.BUTTON_10=10;b.Gamepad.BUTTON_11=11;b.Gamepad.BUTTON_12=12;b.Gamepad.BUTTON_13=13;b.Gamepad.BUTTON_14=14;b.Gamepad.BUTTON_15=15;b.Gamepad.AXIS_0=0;b.Gamepad.AXIS_1=1;b.Gamepad.AXIS_2=2;b.Gamepad.AXIS_3=3;b.Gamepad.AXIS_4=4;b.Gamepad.AXIS_5=5;b.Gamepad.AXIS_6=6;b.Gamepad.AXIS_7=7;b.Gamepad.AXIS_8=8;b.Gamepad.AXIS_9=9;b.Gamepad.XBOX360_A=0;b.Gamepad.XBOX360_B=1;b.Gamepad.XBOX360_X=2;b.Gamepad.XBOX360_Y=3;b.Gamepad.XBOX360_LEFT_BUMPER=4;b.Gamepad.XBOX360_RIGHT_BUMPER=5;b.Gamepad.XBOX360_LEFT_TRIGGER=6;b.Gamepad.XBOX360_RIGHT_TRIGGER=7;b.Gamepad.XBOX360_BACK=8;b.Gamepad.XBOX360_START=9;b.Gamepad.XBOX360_STICK_LEFT_BUTTON=10;b.Gamepad.XBOX360_STICK_RIGHT_BUTTON=11;b.Gamepad.XBOX360_DPAD_LEFT=14;b.Gamepad.XBOX360_DPAD_RIGHT=15;b.Gamepad.XBOX360_DPAD_UP=12;b.Gamepad.XBOX360_DPAD_DOWN=13;b.Gamepad.XBOX360_STICK_LEFT_X=0;b.Gamepad.XBOX360_STICK_LEFT_Y=1;b.Gamepad.XBOX360_STICK_RIGHT_X=2;b.Gamepad.XBOX360_STICK_RIGHT_Y=3;b.Gamepad.PS3XC_X=0;b.Gamepad.PS3XC_CIRCLE=1;b.Gamepad.PS3XC_SQUARE=2;b.Gamepad.PS3XC_TRIANGLE=3;b.Gamepad.PS3XC_L1=4;b.Gamepad.PS3XC_R1=5;b.Gamepad.PS3XC_L2=6;b.Gamepad.PS3XC_R2=7;b.Gamepad.PS3XC_SELECT=8;b.Gamepad.PS3XC_START=9;b.Gamepad.PS3XC_STICK_LEFT_BUTTON=10;b.Gamepad.PS3XC_STICK_RIGHT_BUTTON=11;b.Gamepad.PS3XC_DPAD_UP=12;b.Gamepad.PS3XC_DPAD_DOWN=13;b.Gamepad.PS3XC_DPAD_LEFT=14;b.Gamepad.PS3XC_DPAD_RIGHT=15;b.Gamepad.PS3XC_STICK_LEFT_X=0;b.Gamepad.PS3XC_STICK_LEFT_Y=1;b.Gamepad.PS3XC_STICK_RIGHT_X=2;b.Gamepad.PS3XC_STICK_RIGHT_Y=3;b.SinglePad=function(d,e){this.game=d;this.index=null;this.connected=false;this.callbackContext=this;this.onConnectCallback=null;this.onDisconnectCallback=null;this.onDownCallback=null;this.onUpCallback=null;this.onAxisCallback=null;this.onFloatCallback=null;this.deadZone=0.26;this._padParent=e;this._rawPad=null;this._prevTimestamp=null;this._buttons=[];this._buttonsLen=0;this._axes=[];this._axesLen=0};b.SinglePad.prototype={addCallbacks:function(d,e){if(typeof e!=="undefined"){this.onConnectCallback=(typeof e.onConnect==="function")?e.onConnect:this.onConnectCallback;this.onDisconnectCallback=(typeof e.onDisconnect==="function")?e.onDisconnect:this.onDisconnectCallback;this.onDownCallback=(typeof e.onDown==="function")?e.onDown:this.onDownCallback;this.onUpCallback=(typeof e.onUp==="function")?e.onUp:this.onUpCallback;this.onAxisCallback=(typeof e.onAxis==="function")?e.onAxis:this.onAxisCallback;this.onFloatCallback=(typeof e.onFloat==="function")?e.onFloat:this.onFloatCallback}},addButton:function(d){return this.getButton(d)},getButton:function(d){if(this._buttons[d]){return this._buttons[d]}else{return null}},pollStatus:function(){if(!this.connected||this.game.input.disabled||this.game.input.gamepad.disabled||(this._rawPad.timestamp&&(this._rawPad.timestamp===this._prevTimestamp))){return}for(var f=0;f<this._buttonsLen;f++){var d=isNaN(this._rawPad.buttons[f])?this._rawPad.buttons[f].value:this._rawPad.buttons[f];if(d!==this._buttons[f].value){if(d===1){this.processButtonDown(f,d)}else{if(d===0){this.processButtonUp(f,d)}else{this.processButtonFloat(f,d)}}}}for(var e=0;e<this._axesLen;e++){var g=this._rawPad.axes[e];if(g>0&&g>this.deadZone||g<0&&g<-this.deadZone){this.processAxisChange({axis:e,value:g})}else{this.processAxisChange({axis:e,value:0})}}this._prevTimestamp=this._rawPad.timestamp},connect:function(e){var f=!this.connected;this.connected=true;this.index=e.index;this._rawPad=e;this._buttons=[];this._buttonsLen=e.buttons.length;this._axes=e.axes;this._axesLen=e.axes.length;for(var d in e.buttons){d=parseInt(d,10);this._buttons[d]=new b.GamepadButton(this,d)}if(f&&this._padParent.onConnectCallback){this._padParent.onConnectCallback.call(this._padParent.callbackContext,this.index)}if(f&&this.onConnectCallback){this.onConnectCallback.call(this.callbackContext)}},disconnect:function(){var f=this.connected;var d=this.index;this.connected=false;this.index=null;this._rawPad=undefined;for(var e=0;e<this._buttonsLen;e++){this._buttons[e].destroy()}this._buttons=[];this._buttonsLen=0;this._axes=[];this._axesLen=0;if(f&&this._padParent.onDisconnectCallback){this._padParent.onDisconnectCallback.call(this._padParent.callbackContext,d)}if(f&&this.onDisconnectCallback){this.onDisconnectCallback.call(this.callbackContext)}},processAxisChange:function(d){if(this._axes[d.axis]===d.value){return}this._axes[d.axis]=d.value;if(this._padParent.onAxisCallback){this._padParent.onAxisCallback.call(this._padParent.callbackContext,d,this.index)}if(this.onAxisCallback){this.onAxisCallback.call(this.callbackContext,d)}},processButtonDown:function(d,e){if(this._padParent.onDownCallback){this._padParent.onDownCallback.call(this._padParent.callbackContext,d,e,this.index)}if(this.onDownCallback){this.onDownCallback.call(this.callbackContext,d,e)}if(this._buttons[d]){this._buttons[d].processButtonDown(e)}},processButtonUp:function(d,e){if(this._padParent.onUpCallback){this._padParent.onUpCallback.call(this._padParent.callbackContext,d,e,this.index)}if(this.onUpCallback){this.onUpCallback.call(this.callbackContext,d,e)}if(this._buttons[d]){this._buttons[d].processButtonUp(e)}},processButtonFloat:function(d,e){if(this._padParent.onFloatCallback){this._padParent.onFloatCallback.call(this._padParent.callbackContext,d,e,this.index)}if(this.onFloatCallback){this.onFloatCallback.call(this.callbackContext,d,e)}if(this._buttons[d]){this._buttons[d].processButtonFloat(e)}},axis:function(d){if(this._axes[d]){return this._axes[d]}return false},isDown:function(d){if(this._buttons[d]){return this._buttons[d].isDown}return false},isUp:function(d){if(this._buttons[d]){return this._buttons[d].isUp}return false},justReleased:function(d,e){if(this._buttons[d]){return this._buttons[d].justReleased(e)}},justPressed:function(d,e){if(this._buttons[d]){return this._buttons[d].justPressed(e)}},buttonValue:function(d){if(this._buttons[d]){return this._buttons[d].value}return null},reset:function(){for(var d=0;d<this._axes.length;d++){this._axes[d]=0}}};b.SinglePad.prototype.constructor=b.SinglePad;b.GamepadButton=function(e,d){this.pad=e;this.game=e.game;this.isDown=false;this.isUp=true;this.timeDown=0;this.duration=0;this.timeUp=0;this.repeats=0;this.value=0;this.buttonCode=d;this.onDown=new b.Signal();this.onUp=new b.Signal();this.onFloat=new b.Signal()};b.GamepadButton.prototype={processButtonDown:function(d){if(this.isDown){this.duration=this.game.time.now-this.timeDown;this.repeats++}else{this.isDown=true;this.isUp=false;this.timeDown=this.game.time.now;this.duration=0;this.repeats=0;this.value=d;this.onDown.dispatch(this,d)}},processButtonUp:function(d){if(this.isDown){this.isDown=false;this.isUp=true;this.timeUp=this.game.time.now;this.value=d;this.onUp.dispatch(this,d)}},processButtonFloat:function(d){this.value=d;this.onFloat.dispatch(this,d)},justPressed:function(d){if(typeof d==="undefined"){d=250}return(this.isDown&&this.duration<d)},justReleased:function(d){if(typeof d==="undefined"){d=250}return(this.isDown===false&&(this.game.time.now-this.timeUp<d))},reset:function(){this.isDown=false;this.isUp=true;this.timeDown=this.game.time.now;this.duration=0;this.repeats=0},destroy:function(){this.onDown.dispose();this.onUp.dispose();this.onFloat.dispose();this.pad=null;this.game=null}};b.GamepadButton.prototype.constructor=b.GamepadButton;b.InputHandler=function(d){this.sprite=d;this.game=d.game;this.enabled=false;this.checked=false;this.priorityID=0;this.useHandCursor=false;this._setHandCursor=false;this.isDragged=false;this.allowHorizontalDrag=true;this.allowVerticalDrag=true;this.bringToTop=false;this.snapOffset=null;this.snapOnDrag=false;this.snapOnRelease=false;this.snapX=0;this.snapY=0;this.snapOffsetX=0;this.snapOffsetY=0;this.pixelPerfectOver=false;this.pixelPerfectClick=false;this.pixelPerfectAlpha=255;this.draggable=false;this.boundsRect=null;this.boundsSprite=null;this.consumePointerEvent=false;this._dragPhase=false;this._wasEnabled=false;this._tempPoint=new b.Point();this._pointerData=[];this._pointerData.push({id:0,x:0,y:0,isDown:false,isUp:false,isOver:false,isOut:false,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:false})};b.InputHandler.prototype={start:function(f,d){f=f||0;if(typeof d==="undefined"){d=false}if(this.enabled===false){this.game.input.interactiveItems.add(this);this.useHandCursor=d;this.priorityID=f;for(var e=0;e<10;e++){this._pointerData[e]={id:e,x:0,y:0,isDown:false,isUp:false,isOver:false,isOut:false,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:false}}this.snapOffset=new b.Point();this.enabled=true;this._wasEnabled=true;if(this.sprite.events&&this.sprite.events.onInputOver===null){this.sprite.events.onInputOver=new b.Signal();this.sprite.events.onInputOut=new b.Signal();this.sprite.events.onInputDown=new b.Signal();this.sprite.events.onInputUp=new b.Signal();this.sprite.events.onDragStart=new b.Signal();this.sprite.events.onDragStop=new b.Signal()}}this.sprite.events.onAddedToGroup.add(this.addedToGroup,this);this.sprite.events.onRemovedFromGroup.add(this.removedFromGroup,this);this.flagged=false;return this.sprite},addedToGroup:function(){if(this._dragPhase){return}if(this._wasEnabled&&!this.enabled){this.start()}},removedFromGroup:function(){if(this._dragPhase){return}if(this.enabled){this._wasEnabled=true;this.stop()}else{this._wasEnabled=false}},reset:function(){this.enabled=false;this.flagged=false;for(var d=0;d<10;d++){this._pointerData[d]={id:d,x:0,y:0,isDown:false,isUp:false,isOver:false,isOut:false,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:false}}},stop:function(){if(this.enabled===false){return}else{this.enabled=false;this.game.input.interactiveItems.remove(this)}},destroy:function(){if(this.sprite){if(this._setHandCursor){this.game.canvas.style.cursor="default";this._setHandCursor=false}this.enabled=false;this.game.input.interactiveItems.remove(this);this._pointerData.length=0;this.boundsRect=null;this.boundsSprite=null;this.sprite=null}},validForInput:function(f,e,d){if(typeof d==="undefined"){d=true}if(this.sprite.scale.x===0||this.sprite.scale.y===0||this.priorityID<this.game.input.minPriorityID){return false}if(!d&&(this.pixelPerfectClick||this.pixelPerfectOver)){return false}if(this.priorityID>f||(this.priorityID===f&&this.sprite._cache[3]<e)){return true}return false},isPixelPerfect:function(){return(this.pixelPerfectClick||this.pixelPerfectOver)},pointerX:function(d){d=d||0;return this._pointerData[d].x},pointerY:function(d){d=d||0;return this._pointerData[d].y},pointerDown:function(d){d=d||0;return this._pointerData[d].isDown},pointerUp:function(d){d=d||0;return this._pointerData[d].isUp},pointerTimeDown:function(d){d=d||0;return this._pointerData[d].timeDown},pointerTimeUp:function(d){d=d||0;return this._pointerData[d].timeUp},pointerOver:function(d){if(this.enabled){if(typeof d==="undefined"){for(var e=0;e<10;e++){if(this._pointerData[e].isOver){return true}}}else{return this._pointerData[d].isOver}}return false},pointerOut:function(d){if(this.enabled){if(typeof d==="undefined"){for(var e=0;e<10;e++){if(this._pointerData[e].isOut){return true}}}else{return this._pointerData[d].isOut}}return false},pointerTimeOver:function(d){d=d||0;return this._pointerData[d].timeOver},pointerTimeOut:function(d){d=d||0;return this._pointerData[d].timeOut},pointerDragged:function(d){d=d||0;return this._pointerData[d].isDragged},checkPointerDown:function(e,d){if(!e.isDown||!this.enabled||!this.sprite||!this.sprite.parent||!this.sprite.visible||!this.sprite.parent.visible){return false}if(this.game.input.hitTest(this.sprite,e,this._tempPoint)){if(typeof d==="undefined"){d=false}if(!d&&this.pixelPerfectClick){return this.checkPixel(this._tempPoint.x,this._tempPoint.y)}else{return true}}return false},checkPointerOver:function(e,d){if(!this.enabled||!this.sprite||!this.sprite.parent||!this.sprite.visible||!this.sprite.parent.visible){return false}if(this.game.input.hitTest(this.sprite,e,this._tempPoint)){if(typeof d==="undefined"){d=false}if(!d&&this.pixelPerfectOver){return this.checkPixel(this._tempPoint.x,this._tempPoint.y)}else{return true}}return false},checkPixel:function(d,g,f){if(this.sprite.texture.baseTexture.source){this.game.input.hitContext.clearRect(0,0,1,1);if(d===null&&g===null){this.game.input.getLocalPosition(this.sprite,f,this._tempPoint);var d=this._tempPoint.x;var g=this._tempPoint.y}if(this.sprite.anchor.x!==0){d-=-this.sprite.texture.frame.width*this.sprite.anchor.x}if(this.sprite.anchor.y!==0){g-=-this.sprite.texture.frame.height*this.sprite.anchor.y}d+=this.sprite.texture.frame.x;g+=this.sprite.texture.frame.y;this.game.input.hitContext.drawImage(this.sprite.texture.baseTexture.source,d,g,1,1,0,0,1,1);var e=this.game.input.hitContext.getImageData(0,0,1,1);if(e.data[3]>=this.pixelPerfectAlpha){return true}}return false},update:function(d){if(this.sprite===null||this.sprite.parent===undefined){return}if(!this.enabled||!this.sprite.visible||!this.sprite.parent.visible){this._pointerOutHandler(d);return false}if(this.draggable&&this._draggedPointerID==d.id){return this.updateDrag(d)}else{if(this._pointerData[d.id].isOver===true){if(this.checkPointerOver(d)){this._pointerData[d.id].x=d.x-this.sprite.x;this._pointerData[d.id].y=d.y-this.sprite.y;return true}else{this._pointerOutHandler(d);return false}}}},_pointerOverHandler:function(d){if(this.sprite===null){return}if(this._pointerData[d.id].isOver===false){this._pointerData[d.id].isOver=true;this._pointerData[d.id].isOut=false;this._pointerData[d.id].timeOver=this.game.time.now;this._pointerData[d.id].x=d.x-this.sprite.x;this._pointerData[d.id].y=d.y-this.sprite.y;if(this.useHandCursor&&this._pointerData[d.id].isDragged===false){this.game.canvas.style.cursor="pointer";this._setHandCursor=true}if(this.sprite&&this.sprite.events){this.sprite.events.onInputOver.dispatch(this.sprite,d)}}},_pointerOutHandler:function(d){if(this.sprite===null){return}this._pointerData[d.id].isOver=false;this._pointerData[d.id].isOut=true;this._pointerData[d.id].timeOut=this.game.time.now;if(this.useHandCursor&&this._pointerData[d.id].isDragged===false){this.game.canvas.style.cursor="default";this._setHandCursor=false}if(this.sprite&&this.sprite.events){this.sprite.events.onInputOut.dispatch(this.sprite,d)}},_touchedHandler:function(d){if(this.sprite===null){return}if(this._pointerData[d.id].isDown===false&&this._pointerData[d.id].isOver===true){if(this.pixelPerfectClick&&!this.checkPixel(null,null,d)){return}this._pointerData[d.id].isDown=true;this._pointerData[d.id].isUp=false;this._pointerData[d.id].timeDown=this.game.time.now;if(this.sprite&&this.sprite.events){this.sprite.events.onInputDown.dispatch(this.sprite,d)}if(this.draggable&&this.isDragged===false){this.startDrag(d)}if(this.bringToTop){this.sprite.bringToTop()}}return this.consumePointerEvent},_releasedHandler:function(d){if(this.sprite===null){return}if(this._pointerData[d.id].isDown&&d.isUp){this._pointerData[d.id].isDown=false;this._pointerData[d.id].isUp=true;this._pointerData[d.id].timeUp=this.game.time.now;this._pointerData[d.id].downDuration=this._pointerData[d.id].timeUp-this._pointerData[d.id].timeDown;if(this.checkPointerOver(d)){if(this.sprite&&this.sprite.events){this.sprite.events.onInputUp.dispatch(this.sprite,d,true)}}else{if(this.sprite&&this.sprite.events){this.sprite.events.onInputUp.dispatch(this.sprite,d,false)}if(this.useHandCursor){this.game.canvas.style.cursor="default";this._setHandCursor=false}}if(this.draggable&&this.isDragged&&this._draggedPointerID===d.id){this.stopDrag(d)}}},updateDrag:function(d){if(d.isUp){this.stopDrag(d);return false}if(this.sprite.fixedToCamera){if(this.allowHorizontalDrag){this.sprite.cameraOffset.x=d.x+this._dragPoint.x+this.dragOffset.x}if(this.allowVerticalDrag){this.sprite.cameraOffset.y=d.y+this._dragPoint.y+this.dragOffset.y}if(this.boundsRect){this.checkBoundsRect()}if(this.boundsSprite){this.checkBoundsSprite()}if(this.snapOnDrag){this.sprite.cameraOffset.x=Math.round((this.sprite.cameraOffset.x-(this.snapOffsetX%this.snapX))/this.snapX)*this.snapX+(this.snapOffsetX%this.snapX);this.sprite.cameraOffset.y=Math.round((this.sprite.cameraOffset.y-(this.snapOffsetY%this.snapY))/this.snapY)*this.snapY+(this.snapOffsetY%this.snapY)}}else{if(this.allowHorizontalDrag){this.sprite.x=d.x+this._dragPoint.x+this.dragOffset.x}if(this.allowVerticalDrag){this.sprite.y=d.y+this._dragPoint.y+this.dragOffset.y}if(this.boundsRect){this.checkBoundsRect()}if(this.boundsSprite){this.checkBoundsSprite()}if(this.snapOnDrag){this.sprite.x=Math.round((this.sprite.x-(this.snapOffsetX%this.snapX))/this.snapX)*this.snapX+(this.snapOffsetX%this.snapX);this.sprite.y=Math.round((this.sprite.y-(this.snapOffsetY%this.snapY))/this.snapY)*this.snapY+(this.snapOffsetY%this.snapY)}}return true},justOver:function(e,d){e=e||0;d=d||500;return(this._pointerData[e].isOver&&this.overDuration(e)<d)},justOut:function(e,d){e=e||0;d=d||500;return(this._pointerData[e].isOut&&(this.game.time.now-this._pointerData[e].timeOut<d))},justPressed:function(e,d){e=e||0;d=d||500;return(this._pointerData[e].isDown&&this.downDuration(e)<d)},justReleased:function(e,d){e=e||0;d=d||500;return(this._pointerData[e].isUp&&(this.game.time.now-this._pointerData[e].timeUp<d))},overDuration:function(d){d=d||0;if(this._pointerData[d].isOver){return this.game.time.now-this._pointerData[d].timeOver}return -1},downDuration:function(d){d=d||0;if(this._pointerData[d].isDown){return this.game.time.now-this._pointerData[d].timeDown}return -1},enableDrag:function(e,h,d,g,i,f){if(typeof e=="undefined"){e=false}if(typeof h=="undefined"){h=false}if(typeof d=="undefined"){d=false}if(typeof g=="undefined"){g=255}if(typeof i=="undefined"){i=null}if(typeof f=="undefined"){f=null}this._dragPoint=new b.Point();this.draggable=true;this.bringToTop=h;this.dragOffset=new b.Point();this.dragFromCenter=e;this.pixelPerfectClick=d;this.pixelPerfectAlpha=g;if(i){this.boundsRect=i}if(f){this.boundsSprite=f}},disableDrag:function(){if(this._pointerData){for(var d=0;d<10;d++){this._pointerData[d].isDragged=false}}this.draggable=false;this.isDragged=false;this._draggedPointerID=-1},startDrag:function(e){this.isDragged=true;this._draggedPointerID=e.id;this._pointerData[e.id].isDragged=true;if(this.sprite.fixedToCamera){if(this.dragFromCenter){this.sprite.centerOn(e.x,e.y);this._dragPoint.setTo(this.sprite.cameraOffset.x-e.x,this.sprite.cameraOffset.y-e.y)}else{this._dragPoint.setTo(this.sprite.cameraOffset.x-e.x,this.sprite.cameraOffset.y-e.y)}}else{if(this.dragFromCenter){var d=this.sprite.getBounds();this.sprite.x=e.x+(this.sprite.x-d.centerX);this.sprite.y=e.y+(this.sprite.y-d.centerY);this._dragPoint.setTo(this.sprite.x-e.x,this.sprite.y-e.y)}else{this._dragPoint.setTo(this.sprite.x-e.x,this.sprite.y-e.y)}}this.updateDrag(e);if(this.bringToTop){this._dragPhase=true;this.sprite.bringToTop()}this.sprite.events.onDragStart.dispatch(this.sprite,e)},stopDrag:function(d){this.isDragged=false;this._draggedPointerID=-1;this._pointerData[d.id].isDragged=false;this._dragPhase=false;if(this.snapOnRelease){if(this.sprite.fixedToCamera){this.sprite.cameraOffset.x=Math.round((this.sprite.cameraOffset.x-(this.snapOffsetX%this.snapX))/this.snapX)*this.snapX+(this.snapOffsetX%this.snapX);this.sprite.cameraOffset.y=Math.round((this.sprite.cameraOffset.y-(this.snapOffsetY%this.snapY))/this.snapY)*this.snapY+(this.snapOffsetY%this.snapY)}else{this.sprite.x=Math.round((this.sprite.x-(this.snapOffsetX%this.snapX))/this.snapX)*this.snapX+(this.snapOffsetX%this.snapX);this.sprite.y=Math.round((this.sprite.y-(this.snapOffsetY%this.snapY))/this.snapY)*this.snapY+(this.snapOffsetY%this.snapY)}}this.sprite.events.onDragStop.dispatch(this.sprite,d);if(this.checkPointerOver(d)===false){this._pointerOutHandler(d)}},setDragLock:function(d,e){if(typeof d=="undefined"){d=true}if(typeof e=="undefined"){e=true}this.allowHorizontalDrag=d;this.allowVerticalDrag=e},enableSnap:function(g,f,e,d,i,h){if(typeof e=="undefined"){e=true}if(typeof d=="undefined"){d=false}if(typeof i=="undefined"){i=0}if(typeof h=="undefined"){h=0}this.snapX=g;this.snapY=f;this.snapOffsetX=i;this.snapOffsetY=h;this.snapOnDrag=e;this.snapOnRelease=d},disableSnap:function(){this.snapOnDrag=false;this.snapOnRelease=false},checkBoundsRect:function(){if(this.sprite.fixedToCamera){if(this.sprite.cameraOffset.x<this.boundsRect.left){this.sprite.cameraOffset.x=this.boundsRect.cameraOffset.x}else{if((this.sprite.cameraOffset.x+this.sprite.width)>this.boundsRect.right){this.sprite.cameraOffset.x=this.boundsRect.right-this.sprite.width}}if(this.sprite.cameraOffset.y<this.boundsRect.top){this.sprite.cameraOffset.y=this.boundsRect.top}else{if((this.sprite.cameraOffset.y+this.sprite.height)>this.boundsRect.bottom){this.sprite.cameraOffset.y=this.boundsRect.bottom-this.sprite.height}}}else{if(this.sprite.x<this.boundsRect.left){this.sprite.x=this.boundsRect.x}else{if((this.sprite.x+this.sprite.width)>this.boundsRect.right){this.sprite.x=this.boundsRect.right-this.sprite.width}}if(this.sprite.y<this.boundsRect.top){this.sprite.y=this.boundsRect.top}else{if((this.sprite.y+this.sprite.height)>this.boundsRect.bottom){this.sprite.y=this.boundsRect.bottom-this.sprite.height}}}},checkBoundsSprite:function(){if(this.sprite.fixedToCamera&&this.boundsSprite.fixedToCamera){if(this.sprite.cameraOffset.x<this.boundsSprite.camerOffset.x){this.sprite.cameraOffset.x=this.boundsSprite.camerOffset.x}else{if((this.sprite.cameraOffset.x+this.sprite.width)>(this.boundsSprite.camerOffset.x+this.boundsSprite.width)){this.sprite.cameraOffset.x=(this.boundsSprite.camerOffset.x+this.boundsSprite.width)-this.sprite.width}}if(this.sprite.cameraOffset.y<this.boundsSprite.camerOffset.y){this.sprite.cameraOffset.y=this.boundsSprite.camerOffset.y}else{if((this.sprite.cameraOffset.y+this.sprite.height)>(this.boundsSprite.camerOffset.y+this.boundsSprite.height)){this.sprite.cameraOffset.y=(this.boundsSprite.camerOffset.y+this.boundsSprite.height)-this.sprite.height}}}else{if(this.sprite.x<this.boundsSprite.x){this.sprite.x=this.boundsSprite.x}else{if((this.sprite.x+this.sprite.width)>(this.boundsSprite.x+this.boundsSprite.width)){this.sprite.x=(this.boundsSprite.x+this.boundsSprite.width)-this.sprite.width}}if(this.sprite.y<this.boundsSprite.y){this.sprite.y=this.boundsSprite.y}else{if((this.sprite.y+this.sprite.height)>(this.boundsSprite.y+this.boundsSprite.height)){this.sprite.y=(this.boundsSprite.y+this.boundsSprite.height)-this.sprite.height}}}}};b.InputHandler.prototype.constructor=b.InputHandler;b.Events=function(d){this.parent=d;this.onAddedToGroup=new b.Signal();this.onRemovedFromGroup=new b.Signal();this.onKilled=new b.Signal();this.onRevived=new b.Signal();this.onOutOfBounds=new b.Signal();this.onEnterBounds=new b.Signal();this.onInputOver=null;this.onInputOut=null;this.onInputDown=null;this.onInputUp=null;this.onDragStart=null;this.onDragStop=null;this.onAnimationStart=null;this.onAnimationComplete=null;this.onAnimationLoop=null};b.Events.prototype={destroy:function(){this.parent=null;this.onAddedToGroup.dispose();this.onRemovedFromGroup.dispose();this.onKilled.dispose();this.onRevived.dispose();this.onOutOfBounds.dispose();if(this.onInputOver){this.onInputOver.dispose();this.onInputOut.dispose();this.onInputDown.dispose();this.onInputUp.dispose();this.onDragStart.dispose();this.onDragStop.dispose()}if(this.onAnimationStart){this.onAnimationStart.dispose();this.onAnimationComplete.dispose();this.onAnimationLoop.dispose()}}};b.Events.prototype.constructor=b.Events;b.GameObjectFactory=function(d){this.game=d;this.world=this.game.world};b.GameObjectFactory.prototype={existing:function(d){return this.world.add(d)},image:function(d,h,e,g,f){if(typeof f==="undefined"){f=this.world}return f.add(new b.Image(this.game,d,h,e,g))},sprite:function(d,h,e,g,f){if(typeof f==="undefined"){f=this.world}return f.create(d,h,e,g)},tween:function(d){return this.game.tweens.create(d)},group:function(g,e,d,h,f){return new b.Group(this.game,g,e,d,h,f)},physicsGroup:function(g,f,e,d){return new b.Group(this.game,f,e,d,true,g)},spriteBatch:function(f,e,d){if(typeof f==="undefined"){f=null}if(typeof e==="undefined"){e="group"}if(typeof d==="undefined"){d=false}return new b.SpriteBatch(this.game,f,e,d)},audio:function(f,g,d,e){return this.game.sound.add(f,g,d,e)},sound:function(f,g,d,e){return this.game.sound.add(f,g,d,e)},tileSprite:function(e,j,g,d,f,i,h){if(typeof h==="undefined"){h=this.world}return h.add(new b.TileSprite(this.game,e,j,g,d,f,i))},text:function(d,h,g,e,f){if(typeof f==="undefined"){f=this.world}return f.add(new b.Text(this.game,d,h,g,e))},button:function(j,i,l,m,e,f,d,g,h,k){if(typeof k==="undefined"){k=this.world}return k.add(new b.Button(this.game,j,i,l,m,e,f,d,g,h))},graphics:function(d,f,e){if(typeof e==="undefined"){e=this.world}return e.add(new b.Graphics(this.game,d,f))},emitter:function(d,f,e){return this.game.particles.add(new b.Particles.Arcade.Emitter(this.game,d,f,e))},retroFont:function(e,d,g,j,l,k,h,i,f){return new b.RetroFont(this.game,e,d,g,j,l,k,h,i,f)},bitmapText:function(d,i,e,h,f,g){if(typeof g==="undefined"){g=this.world}return g.add(new b.BitmapText(this.game,d,i,e,h,f))},tilemap:function(f,h,e,g,d){return new b.Tilemap(this.game,f,h,e,g,d)},renderTexture:function(g,e,f,d){if(typeof f==="undefined"||f===""){f=this.game.rnd.uuid()}if(typeof d==="undefined"){d=false}var h=new b.RenderTexture(this.game,g,e,f);if(d){this.game.cache.addRenderTexture(f,h)}return h},bitmapData:function(g,e,f,d){if(typeof d==="undefined"){d=false}if(typeof f==="undefined"||f===""){f=this.game.rnd.uuid()}var h=new b.BitmapData(this.game,f,g,e);if(d){this.game.cache.addBitmapData(f,h)}return h},filter:function(e){var d=Array.prototype.splice.call(arguments,1);var e=new b.Filter[e](this.game);e.init.apply(e,d);return e},plugin:function(d){return this.game.plugins.add(d)}};b.GameObjectFactory.prototype.constructor=b.GameObjectFactory;b.GameObjectCreator=function(d){this.game=d;this.world=this.game.world};b.GameObjectCreator.prototype={image:function(d,g,e,f){return new b.Image(this.game,d,g,e,f)},sprite:function(d,g,e,f){return new b.Sprite(this.game,d,g,e,f)},tween:function(d){return new b.Tween(d,this.game)},group:function(g,e,d,h,f){return new b.Group(this.game,null,e,d,h,f)},spriteBatch:function(f,e,d){if(typeof e==="undefined"){e="group"}if(typeof d==="undefined"){d=false}return new b.SpriteBatch(this.game,f,e,d)},audio:function(f,g,d,e){return this.game.sound.add(f,g,d,e)},sound:function(f,g,d,e){return this.game.sound.add(f,g,d,e)},tileSprite:function(e,i,g,d,f,h){return new b.TileSprite(this.game,e,i,g,d,f,h)},text:function(d,g,f,e){return new b.Text(this.game,d,g,f,e)},button:function(j,i,k,l,e,f,d,g,h){return new b.Button(this.game,j,i,k,l,e,f,d,g,h)},graphics:function(d,e){return new b.Graphics(this.game,d,e)},emitter:function(d,f,e){return new b.Particles.Arcade.Emitter(this.game,d,f,e)},retroFont:function(e,d,g,j,l,k,h,i,f){return new b.RetroFont(this.game,e,d,g,j,l,k,h,i,f)},bitmapText:function(d,h,e,g,f){return new b.BitmapText(this.game,d,h,e,g,f)},tilemap:function(f,h,e,g,d){return new b.Tilemap(this.game,f,h,e,g,d)},renderTexture:function(g,e,f,d){if(typeof f==="undefined"||f===""){f=this.game.rnd.uuid()}if(typeof d==="undefined"){d=false}var h=new b.RenderTexture(this.game,g,e,f);if(d){this.game.cache.addRenderTexture(f,h)}return h},bitmapData:function(g,e,f,d){if(typeof d==="undefined"){d=false}if(typeof f==="undefined"||f===""){f=this.game.rnd.uuid()}var h=new b.BitmapData(this.game,f,g,e);if(d){this.game.cache.addBitmapData(f,h)}return h},filter:function(e){var d=Array.prototype.splice.call(arguments,1);var e=new b.Filter[e](this.game);e.init.apply(e,d);return e}};b.GameObjectCreator.prototype.constructor=b.GameObjectCreator;b.BitmapData=function(e,f,g,d){if(typeof g==="undefined"){g=100}if(typeof d==="undefined"){d=100}this.game=e;this.key=f;this.width=g;this.height=d;this.canvas=b.Canvas.create(g,d,"",true);this.context=this.canvas.getContext("2d");this.ctx=this.context;this.imageData=this.context.getImageData(0,0,g,d);this.data=this.imageData.data;this.pixels=null;if(this.imageData.data.buffer){this.buffer=this.imageData.data.buffer;this.pixels=new Uint32Array(this.buffer)}else{if(window.ArrayBuffer){this.buffer=new ArrayBuffer(this.imageData.data.length);this.pixels=new Uint32Array(this.buffer)}else{this.pixels=this.imageData.data}}this.baseTexture=new PIXI.BaseTexture(this.canvas);this.texture=new PIXI.Texture(this.baseTexture);this.textureFrame=new b.Frame(0,0,0,g,d,"bitmapData",e.rnd.uuid());this.texture.frame=this.textureFrame;this.type=b.BITMAPDATA;this.disableTextureUpload=false;this.dirty=false;this.cls=this.clear;this.update=this.refreshBuffer;this._tempR=0;this._tempG=0;this._tempB=0};b.BitmapData.prototype={add:function(d){if(Array.isArray(d)){for(var e=0;e<d.length;e++){if(d[e]["loadTexture"]){d[e].loadTexture(this)}}}else{d.loadTexture(this)}},load:function(d){if(typeof d==="string"){d=this.game.cache.getImage(d)}this.resize(d.width,d.height);this.cls();if(d instanceof b.Image||d instanceof b.Sprite){this.drawSprite(d,0,0)}else{this.draw(d,0,0)}this.update()},clear:function(){this.context.clearRect(0,0,this.width,this.height);this.dirty=true},fill:function(h,f,d,e){if(typeof e==="undefined"){e=1}this.context.fillStyle="rgba("+h+","+f+","+d+","+e+")";this.context.fillRect(0,0,this.width,this.height);this.dirty=true},resize:function(e,d){if(e!==this.width||d!==this.height){this.width=e;this.height=d;this.canvas.width=e;this.canvas.height=d;this.baseTexture.width=e;this.baseTexture.height=d;this.textureFrame.width=e;this.textureFrame.height=d;this.texture.width=e;this.texture.height=d;this.texture.crop.width=e;this.texture.crop.height=d;this.refreshBuffer();this.dirty=true}},refreshBuffer:function(e,g,f,d){if(typeof e==="undefined"){e=0}if(typeof g==="undefined"){g=0}if(typeof f==="undefined"){f=this.width}if(typeof d==="undefined"){d=this.height}this.imageData=this.context.getImageData(e,g,f,d);this.data=this.imageData.data;if(this.imageData.data.buffer){this.buffer=this.imageData.data.buffer;this.pixels=new Uint32Array(this.buffer)}else{if(window.ArrayBuffer){this.buffer=new ArrayBuffer(this.imageData.data.length);this.pixels=new Uint32Array(this.buffer)}else{this.pixels=this.imageData.data}}},processPixelRGB:function(o,g,m,l,f,p){if(typeof m==="undefined"){m=0}if(typeof l==="undefined"){l=0}if(typeof f==="undefined"){f=this.width}if(typeof p==="undefined"){p=this.height}var n=m+f;var k=l+p;var e=b.Color.createColor();var q={r:0,g:0,b:0,a:0};var d=false;for(var i=l;i<k;i++){for(var j=m;j<n;j++){b.Color.unpackPixel(this.getPixel32(j,i),e);q=o.call(g,e,j,i);if(q!==false&&q!==null&&q!==undefined){this.setPixel32(j,i,q.r,q.g,q.b,q.a,false);d=true}}}if(d){this.context.putImageData(this.imageData,0,0);this.dirty=true}},processPixel:function(o,g,m,l,f,p){if(typeof m==="undefined"){m=0}if(typeof l==="undefined"){l=0}if(typeof f==="undefined"){f=this.width}if(typeof p==="undefined"){p=this.height}var n=m+f;var k=l+p;var e=0;var q=0;var d=false;for(var i=l;i<k;i++){for(var j=m;j<n;j++){e=this.getPixel32(j,i);q=o.call(g,e,j,i);if(q!==e){this.pixels[i*this.width+j]=q;d=true}}}if(d){this.context.putImageData(this.imageData,0,0);this.dirty=true}},replaceRGB:function(j,e,r,g,i,t,o,f,n){var q=0;var m=0;var s=this.width;var k=this.height;var d=b.Color.packPixel(j,e,r,g);if(n!==undefined&&n instanceof b.Rectangle){q=n.x;m=n.y;s=n.width;k=n.height}for(var l=0;l<k;l++){for(var p=0;p<s;p++){if(this.getPixel32(q+p,m+l)===d){this.setPixel32(q+p,m+l,i,t,o,f,false)}}}this.context.putImageData(this.imageData,0,0);this.dirty=true},setHSL:function(i,g,e,j){if(typeof i==="undefined"||i===null){i=false}if(typeof g==="undefined"||g===null){g=false}if(typeof e==="undefined"||e===null){e=false}if(!i&&!g&&!e){return}if(typeof j==="undefined"){j=new b.Rectangle(0,0,this.width,this.height)}var f=b.Color.createColor();for(var k=j.y;k<j.bottom;k++){for(var d=j.x;d<j.right;d++){b.Color.unpackPixel(this.getPixel32(d,k),f,true);if(i){f.h=i}if(g){f.s=g}if(e){f.l=e}b.Color.HSLtoRGB(f.h,f.s,f.l,f);this.setPixel32(d,k,f.r,f.g,f.b,f.a,false)}}this.context.putImageData(this.imageData,0,0);this.dirty=true},shiftHSL:function(i,g,e,j){if(typeof i==="undefined"||i===null){i=false}if(typeof g==="undefined"||g===null){g=false}if(typeof e==="undefined"||e===null){e=false}if(!i&&!g&&!e){return}if(typeof j==="undefined"){j=new b.Rectangle(0,0,this.width,this.height)}var f=b.Color.createColor();for(var k=j.y;k<j.bottom;k++){for(var d=j.x;d<j.right;d++){b.Color.unpackPixel(this.getPixel32(d,k),f,true);if(i){f.h=this.game.math.wrap(f.h+i,0,1)}if(g){f.s=this.game.math.limitValue(f.s+g,0,1)}if(e){f.l=this.game.math.limitValue(f.l+e,0,1)}b.Color.HSLtoRGB(f.h,f.s,f.l,f);this.setPixel32(d,k,f.r,f.g,f.b,f.a,false)}}this.context.putImageData(this.imageData,0,0);this.dirty=true},setPixel32:function(e,j,i,g,d,h,f){if(typeof f==="undefined"){f=true}if(e>=0&&e<=this.width&&j>=0&&j<=this.height){if(b.Device.LITTLE_ENDIAN){this.pixels[j*this.width+e]=(h<<24)|(d<<16)|(g<<8)|i}else{this.pixels[j*this.width+e]=(i<<24)|(g<<16)|(d<<8)|h}if(f){this.context.putImageData(this.imageData,0,0);this.dirty=true}}},setPixel:function(e,i,h,g,d,f){this.setPixel32(e,i,h,g,d,255,f)},getPixel:function(d,g,f){if(!f){f=b.Color.createColor()}var e=~~(d+(g*this.width));e*=4;f.r=this.data[e];f.g=this.data[++e];f.b=this.data[++e];f.a=this.data[++e];return f},getPixel32:function(d,e){if(d>=0&&d<=this.width&&e>=0&&e<=this.height){return this.pixels[e*this.width+d]}},getPixelRGB:function(d,h,g,e,f){return b.Color.unpackPixel(this.getPixel32(d,h),g,e,f)},getPixels:function(d){return this.context.getImageData(d.x,d.y,d.width,d.height)},addToWorld:function(d,e){return this.game.add.image(d,e,this)},copyPixels:function(f,e,d,k){if(typeof f==="string"){f=this.game.cache.getImage(f)}var i=f;var j=0;var h=0;if(f instanceof b.Image||f instanceof b.Sprite){i=f.texture.baseTexture.source;var g=f.texture.frame;j=g.x;h=g.y}else{if(f instanceof b.BitmapData){i=f.canvas}}this.context.drawImage(i,j+e.x,h+e.y,e.width,e.height,d,k,e.width,e.height);this.dirty=true},draw:function(e,l,i,f,n){if(typeof l==="undefined"){l=0}if(typeof i==="undefined"){i=0}if(typeof e==="string"){e=this.game.cache.getImage(e)}var d=e;var k=0;var j=0;var m=0;var h=0;if(e instanceof b.Image||e instanceof b.Sprite){d=e.texture.baseTexture.source;var g=e.texture.frame;k=g.x;j=g.y;m=g.width;h=g.height}else{if(e instanceof b.BitmapData){d=e.canvas}m=e.width;h=e.height}if(typeof f==="undefined"){f=m}if(typeof n==="undefined"){n=h}this.context.drawImage(d,k,j,m,h,l,i,f,n);this.dirty=true},drawSprite:function(e,d,f){if(typeof d==="undefined"){d=0}if(typeof f==="undefined"){f=0}this.draw(e,d,f)},alphaMask:function(h,d,f,g){if(typeof d==="undefined"||d===null){d=this}var e=this.context.globalCompositeOperation;if(typeof g==="undefined"||g===null){this.draw(d)}else{this.draw(d,g.x,g.y,g.width,g.height)}this.context.globalCompositeOperation="source-atop";if(typeof f==="undefined"||f===null){this.draw(h)}else{this.draw(h,f.x,f.y,f.width,f.height)}this.context.globalCompositeOperation=e;this.update();this.dirty=true},extract:function(j,d,h,k,l,e,f,m,i){if(typeof l==="undefined"){l=255}if(typeof e==="undefined"){e=false}if(typeof f==="undefined"){f=d}if(typeof m==="undefined"){m=h}if(typeof i==="undefined"){i=k}if(e){j.resize(this.width,this.height)}this.processPixelRGB(function(n,g,o){if(n.r===d&&n.g===h&&n.b===k){j.setPixel32(g,o,f,m,i,l,false)}return false},this);j.context.putImageData(j.imageData,0,0);j.dirty=true;return j},rect:function(e,h,g,d,f){if(typeof f!=="undefined"){this.context.fillStyle=f}this.context.fillRect(e,h,g,d)},circle:function(e,g,d,f){if(typeof f!=="undefined"){this.context.fillStyle=f}this.context.beginPath();this.context.arc(e,g,d,0,Math.PI*2,false);this.context.closePath();this.context.fill()},render:function(){if(!this.disableTextureUpload&&this.game.renderType===b.WEBGL&&this.dirty){PIXI.updateWebGLTexture(this.baseTexture,this.game.renderer.gl);this.dirty=false}}};b.BitmapData.prototype.constructor=b.BitmapData;b.Sprite=function(e,d,h,f,g){d=d||0;h=h||0;f=f||null;g=g||null;this.game=e;this.name="";this.type=b.SPRITE;this.z=0;this.events=new b.Events(this);this.animations=new b.AnimationManager(this);this.key=f;PIXI.Sprite.call(this,PIXI.TextureCache.__default);this.position.set(d,h);this.world=new b.Point(d,h);this.autoCull=false;this.input=null;this.body=null;this.alive=true;this.health=1;this.lifespan=0;this.checkWorldBounds=false;this.outOfBoundsKill=false;this.debug=false;this.cameraOffset=new b.Point();this.cropRect=null;this._cache=[0,0,0,0,1,0,1,0];this._crop=null;this._frame=null;this._bounds=new b.Rectangle();this.loadTexture(f,g)};b.Sprite.prototype=Object.create(PIXI.Sprite.prototype);b.Sprite.prototype.constructor=b.Sprite;b.Sprite.prototype.preUpdate=function(){if(this._cache[4]===1&&this.exists){this.world.setTo(this.parent.position.x+this.position.x,this.parent.position.y+this.position.y);this.worldTransform.tx=this.world.x;this.worldTransform.ty=this.world.y;this._cache[0]=this.world.x;this._cache[1]=this.world.y;this._cache[2]=this.rotation;if(this.body){this.body.preUpdate()}this._cache[4]=0;return false}this._cache[0]=this.world.x;this._cache[1]=this.world.y;this._cache[2]=this.rotation;if(!this.exists||!this.parent.exists){this._cache[3]=-1;return false}if(this.lifespan>0){this.lifespan-=this.game.time.elapsed;if(this.lifespan<=0){this.kill();return false}}if(this.autoCull||this.checkWorldBounds){this._bounds.copyFrom(this.getBounds())}if(this.autoCull){this.renderable=this.game.world.camera.screenView.intersects(this._bounds)}if(this.checkWorldBounds){if(this._cache[5]===1&&this.game.world.bounds.intersects(this._bounds)){this._cache[5]=0;this.events.onEnterBounds.dispatch(this)}else{if(this._cache[5]===0&&!this.game.world.bounds.intersects(this._bounds)){this._cache[5]=1;this.events.onOutOfBounds.dispatch(this);if(this.outOfBoundsKill){this.kill();return false}}}}this.world.setTo(this.game.camera.x+this.worldTransform.tx,this.game.camera.y+this.worldTransform.ty);if(this.visible){this._cache[3]=this.game.stage.currentRenderOrderID++}this.animations.update();if(this.body){this.body.preUpdate()}for(var e=0,d=this.children.length;e<d;e++){this.children[e].preUpdate()}return true};b.Sprite.prototype.update=function(){};b.Sprite.prototype.postUpdate=function(){if(this.key instanceof b.BitmapData){this.key.render()}if(this.exists&&this.body){this.body.postUpdate()}if(this._cache[7]===1){this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x;this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y}for(var e=0,d=this.children.length;e<d;e++){this.children[e].postUpdate()}};b.Sprite.prototype.loadTexture=function(g,h,e){h=h||0;if(e||typeof e==="undefined"){this.animations.stop()}this.key=g;var d=true;var f=this.smoothed;if(g instanceof b.RenderTexture){this.key=g.key;this.setTexture(g)}else{if(g instanceof b.BitmapData){this.setTexture(g.texture)}else{if(g instanceof PIXI.Texture){this.setTexture(g)}else{if(g===null||typeof g==="undefined"){this.key="__default";this.setTexture(PIXI.TextureCache[this.key])}else{if(typeof g==="string"&&!this.game.cache.checkImageKey(g)){console.warn("Texture with key '"+g+"' not found.");this.key="__missing";this.setTexture(PIXI.TextureCache[this.key])}else{this.setTexture(new PIXI.Texture(PIXI.BaseTextureCache[g]));d=!this.animations.loadFrameData(this.game.cache.getFrameData(g),h)}}}}}if(d){this._frame=b.Rectangle.clone(this.texture.frame)}if(!f){this.smoothed=false}};b.Sprite.prototype.setFrame=function(d){this._frame=d;this.texture.frame.x=d.x;this.texture.frame.y=d.y;this.texture.frame.width=d.width;this.texture.frame.height=d.height;this.texture.crop.x=d.x;this.texture.crop.y=d.y;this.texture.crop.width=d.width;this.texture.crop.height=d.height;if(d.trimmed){if(this.texture.trim){this.texture.trim.x=d.spriteSourceSizeX;this.texture.trim.y=d.spriteSourceSizeY;this.texture.trim.width=d.sourceSizeW;this.texture.trim.height=d.sourceSizeH}else{this.texture.trim={x:d.spriteSourceSizeX,y:d.spriteSourceSizeY,width:d.sourceSizeW,height:d.sourceSizeH}}this.texture.width=d.sourceSizeW;this.texture.height=d.sourceSizeH;this.texture.frame.width=d.sourceSizeW;this.texture.frame.height=d.sourceSizeH}if(this.cropRect){this.updateCrop()}else{if(this.game.renderType===b.WEBGL){PIXI.WebGLRenderer.updateTextureFrame(this.texture)}}};b.Sprite.prototype.resetFrame=function(){if(this._frame){this.setFrame(this._frame)}};b.Sprite.prototype.crop=function(d,e){if(typeof e==="undefined"){e=false}if(d){if(e&&this.cropRect!==null){this.cropRect.setTo(d.x,d.y,d.width,d.height)}else{if(e&&this.cropRect===null){this.cropRect=new b.Rectangle(d.x,d.y,d.width,d.height)}else{this.cropRect=d}}this.updateCrop()}else{this._crop=null;this.cropRect=null;this.resetFrame()}};b.Sprite.prototype.updateCrop=function(){if(!this.cropRect){return}this._crop=b.Rectangle.clone(this.cropRect,this._crop);this._crop.x+=this._frame.x;this._crop.y+=this._frame.y;var d=Math.max(this._frame.x,this._crop.x);var g=Math.max(this._frame.y,this._crop.y);var e=Math.min(this._frame.right,this._crop.right)-d;var f=Math.min(this._frame.bottom,this._crop.bottom)-g;this.texture.crop.x=d;this.texture.crop.y=g;this.texture.crop.width=e;this.texture.crop.height=f;this.texture.frame.width=Math.min(e,this.cropRect.width);this.texture.frame.height=Math.min(f,this.cropRect.height);this.texture.width=this.texture.frame.width;this.texture.height=this.texture.frame.height;if(this.game.renderType===b.WEBGL){PIXI.WebGLRenderer.updateTextureFrame(this.texture)}};b.Sprite.prototype.revive=function(d){if(typeof d==="undefined"){d=1}this.alive=true;this.exists=true;this.visible=true;this.health=d;if(this.events){this.events.onRevived.dispatch(this)}return this};b.Sprite.prototype.kill=function(){this.alive=false;this.exists=false;this.visible=false;if(this.events){this.events.onKilled.dispatch(this)}return this};b.Sprite.prototype.destroy=function(e){if(this.game===null||this._cache[8]===1){return}if(typeof e==="undefined"){e=true}this._cache[8]=1;if(this.parent){if(this.parent instanceof b.Group){this.parent.remove(this)}else{this.parent.removeChild(this)}}if(this.input){this.input.destroy()}if(this.animations){this.animations.destroy()}if(this.body){this.body.destroy()}if(this.events){this.events.destroy()}var d=this.children.length;if(e){while(d--){this.children[d].destroy(e)}}else{while(d--){this.removeChild(this.children[d])}}if(this._crop){this._crop=null}if(this._frame){this._frame=null}this.alive=false;this.exists=false;this.visible=false;this.filters=null;this.mask=null;this.game=null;this._cache[8]=0};b.Sprite.prototype.damage=function(d){if(this.alive){this.health-=d;if(this.health<=0){this.kill()}}return this};b.Sprite.prototype.reset=function(d,f,e){if(typeof e==="undefined"){e=1}this.world.setTo(d,f);this.position.x=d;this.position.y=f;this.alive=true;this.exists=true;this.visible=true;this.renderable=true;this._outOfBoundsFired=false;this.health=e;if(this.body){this.body.reset(d,f,false,false)}this._cache[4]=1;return this};b.Sprite.prototype.bringToTop=function(){if(this.parent){this.parent.bringToTop(this)}return this};b.Sprite.prototype.play=function(g,f,e,d){if(this.animations){return this.animations.play(g,f,e,d)}};b.Sprite.prototype.overlap=function(d){return b.Rectangle.intersects(this.getBounds(),d.getBounds())};Object.defineProperty(b.Sprite.prototype,"angle",{get:function(){return b.Math.wrapAngle(b.Math.radToDeg(this.rotation))},set:function(d){this.rotation=b.Math.degToRad(b.Math.wrapAngle(d))}});Object.defineProperty(b.Sprite.prototype,"deltaX",{get:function(){return this.world.x-this._cache[0]}});Object.defineProperty(b.Sprite.prototype,"deltaY",{get:function(){return this.world.y-this._cache[1]}});Object.defineProperty(b.Sprite.prototype,"deltaZ",{get:function(){return this.rotation-this._cache[2]}});Object.defineProperty(b.Sprite.prototype,"inWorld",{get:function(){return this.game.world.bounds.intersects(this.getBounds())}});Object.defineProperty(b.Sprite.prototype,"inCamera",{get:function(){return this.game.world.camera.screenView.intersects(this.getBounds())}});Object.defineProperty(b.Sprite.prototype,"frame",{get:function(){return this.animations.frame},set:function(d){this.animations.frame=d}});Object.defineProperty(b.Sprite.prototype,"frameName",{get:function(){return this.animations.frameName},set:function(d){this.animations.frameName=d}});Object.defineProperty(b.Sprite.prototype,"renderOrderID",{get:function(){return this._cache[3]}});Object.defineProperty(b.Sprite.prototype,"inputEnabled",{get:function(){return(this.input&&this.input.enabled)},set:function(d){if(d){if(this.input===null){this.input=new b.InputHandler(this);this.input.start()}else{if(this.input&&!this.input.enabled){this.input.start()}}}else{if(this.input&&this.input.enabled){this.input.stop()}}}});Object.defineProperty(b.Sprite.prototype,"exists",{get:function(){return !!this._cache[6]},set:function(d){if(d){this._cache[6]=1;if(this.body&&this.body.type===b.Physics.P2JS){this.body.addToWorld()}this.visible=true}else{this._cache[6]=0;if(this.body&&this.body.type===b.Physics.P2JS){this.body.removeFromWorld()}this.visible=false}}});Object.defineProperty(b.Sprite.prototype,"fixedToCamera",{get:function(){return !!this._cache[7]},set:function(d){if(d){this._cache[7]=1;this.cameraOffset.set(this.x,this.y)}else{this._cache[7]=0}}});Object.defineProperty(b.Sprite.prototype,"smoothed",{get:function(){return !this.texture.baseTexture.scaleMode},set:function(d){if(d){if(this.texture){this.texture.baseTexture.scaleMode=0}}else{if(this.texture){this.texture.baseTexture.scaleMode=1}}}});Object.defineProperty(b.Sprite.prototype,"x",{get:function(){return this.position.x},set:function(d){this.position.x=d;if(this.body&&this.body.type===b.Physics.ARCADE&&this.body.phase===2){this.body._reset=1}}});Object.defineProperty(b.Sprite.prototype,"y",{get:function(){return this.position.y},set:function(d){this.position.y=d;if(this.body&&this.body.type===b.Physics.ARCADE&&this.body.phase===2){this.body._reset=1}}});Object.defineProperty(b.Sprite.prototype,"destroyPhase",{get:function(){return !!this._cache[8]}});b.Image=function(e,d,h,f,g){d=d||0;h=h||0;f=f||null;g=g||null;this.game=e;this.exists=true;this.name="";this.type=b.IMAGE;this.z=0;this.events=new b.Events(this);this.key=f;this._frame=0;this._frameName="";PIXI.Sprite.call(this,PIXI.TextureCache.__default);this.loadTexture(f,g);this.position.set(d,h);this.world=new b.Point(d,h);this.autoCull=false;this.input=null;this.cameraOffset=new b.Point();this._cache=[0,0,0,0,1,0,1,0,0]};b.Image.prototype=Object.create(PIXI.Sprite.prototype);b.Image.prototype.constructor=b.Image;b.Image.prototype.preUpdate=function(){this._cache[0]=this.world.x;this._cache[1]=this.world.y;this._cache[2]=this.rotation;if(!this.exists||!this.parent.exists){this._cache[3]=-1;return false}if(this.autoCull){this.renderable=this.game.world.camera.screenView.intersects(this.getBounds())}this.world.setTo(this.game.camera.x+this.worldTransform.tx,this.game.camera.y+this.worldTransform.ty);if(this.visible){this._cache[3]=this.game.stage.currentRenderOrderID++}for(var e=0,d=this.children.length;e<d;e++){this.children[e].preUpdate()}return true};b.Image.prototype.update=function(){};b.Image.prototype.postUpdate=function(){if(this.key instanceof b.BitmapData){this.key.render()}if(this._cache[7]===1){this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x;this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y}for(var e=0,d=this.children.length;e<d;e++){this.children[e].postUpdate()}};b.Image.prototype.loadTexture=function(d,f){f=f||0;if(d instanceof b.RenderTexture){this.key=d.key;this.setTexture(d);return}else{if(d instanceof b.BitmapData){this.key=d;this.setTexture(d.texture);return}else{if(d instanceof PIXI.Texture){this.key=d;this.setTexture(d);return}else{if(d===null||typeof d==="undefined"){this.key="__default";this.setTexture(PIXI.TextureCache[this.key]);return}else{if(typeof d==="string"&&!this.game.cache.checkImageKey(d)){this.key="__missing";this.setTexture(PIXI.TextureCache[this.key]);return}}if(this.game.cache.isSpriteSheet(d)){this.key=d;var e=this.game.cache.getFrameData(d);if(typeof f==="string"){this._frame=0;this._frameName=f;this.setTexture(PIXI.TextureCache[e.getFrameByName(f).uuid]);return}else{this._frame=f;this._frameName="";this.setTexture(PIXI.TextureCache[e.getFrame(f).uuid]);return}}else{this.key=d;this.setTexture(PIXI.TextureCache[d]);return}}}}};b.Image.prototype.crop=function(e){if(typeof e==="undefined"||e===null){if(this.texture.hasOwnProperty("sourceWidth")){this.texture.setFrame(new b.Rectangle(0,0,this.texture.sourceWidth,this.texture.sourceHeight))}}else{if(this.texture instanceof PIXI.Texture){var d={};b.Utils.extend(true,d,this.texture);d.sourceWidth=d.width;d.sourceHeight=d.height;d.frame=e;d.width=e.width;d.height=e.height;this.texture=d;this.texture.updateFrame=true;PIXI.Texture.frameUpdates.push(this.texture)}else{this.texture.setFrame(e)}}};b.Image.prototype.revive=function(){this.alive=true;this.exists=true;this.visible=true;if(this.events){this.events.onRevived.dispatch(this)}return this};b.Image.prototype.kill=function(){this.alive=false;this.exists=false;this.visible=false;if(this.events){this.events.onKilled.dispatch(this)}return this};b.Image.prototype.destroy=function(e){if(this.game===null||this.destroyPhase){return}if(typeof e==="undefined"){e=true}this._cache[8]=1;if(this.parent){if(this.parent instanceof b.Group){this.parent.remove(this)}else{this.parent.removeChild(this)}}if(this.events){this.events.destroy()}if(this.input){this.input.destroy()}var d=this.children.length;if(e){while(d--){this.children[d].destroy(e)}}else{while(d--){this.removeChild(this.children[d])}}this.alive=false;this.exists=false;this.visible=false;this.filters=null;this.mask=null;this.game=null;this._cache[8]=0};b.Image.prototype.reset=function(d,e){this.world.setTo(d,e);this.position.x=d;this.position.y=e;this.alive=true;this.exists=true;this.visible=true;this.renderable=true;return this};b.Image.prototype.bringToTop=function(){if(this.parent){this.parent.bringToTop(this)}return this};Object.defineProperty(b.Image.prototype,"angle",{get:function(){return b.Math.wrapAngle(b.Math.radToDeg(this.rotation))},set:function(d){this.rotation=b.Math.degToRad(b.Math.wrapAngle(d))}});Object.defineProperty(b.Image.prototype,"deltaX",{get:function(){return this.world.x-this._cache[0]}});Object.defineProperty(b.Image.prototype,"deltaY",{get:function(){return this.world.y-this._cache[1]}});Object.defineProperty(b.Image.prototype,"deltaZ",{get:function(){return this.rotation-this._cache[2]}});Object.defineProperty(b.Image.prototype,"inWorld",{get:function(){return this.game.world.bounds.intersects(this.getBounds())}});Object.defineProperty(b.Image.prototype,"inCamera",{get:function(){return this.game.world.camera.screenView.intersects(this.getBounds())}});Object.defineProperty(b.Image.prototype,"frame",{get:function(){return this._frame},set:function(e){if(e!==this.frame&&this.game.cache.isSpriteSheet(this.key)){var d=this.game.cache.getFrameData(this.key);if(d&&e<d.total&&d.getFrame(e)){this.setTexture(PIXI.TextureCache[d.getFrame(e).uuid]);this._frame=e}}}});Object.defineProperty(b.Image.prototype,"frameName",{get:function(){return this._frameName},set:function(e){if(e!==this.frameName&&this.game.cache.isSpriteSheet(this.key)){var d=this.game.cache.getFrameData(this.key);if(d&&d.getFrameByName(e)){this.setTexture(PIXI.TextureCache[d.getFrameByName(e).uuid]);this._frameName=e}}}});Object.defineProperty(b.Image.prototype,"renderOrderID",{get:function(){return this._cache[3]}});Object.defineProperty(b.Image.prototype,"inputEnabled",{get:function(){return(this.input&&this.input.enabled)},set:function(d){if(d){if(this.input===null){this.input=new b.InputHandler(this);this.input.start()}else{if(this.input&&!this.input.enabled){this.input.start()}}}else{if(this.input&&this.input.enabled){this.input.stop()}}}});Object.defineProperty(b.Image.prototype,"fixedToCamera",{get:function(){return !!this._cache[7]},set:function(d){if(d){this._cache[7]=1;this.cameraOffset.set(this.x,this.y)}else{this._cache[7]=0}}});Object.defineProperty(b.Image.prototype,"smoothed",{get:function(){return !this.texture.baseTexture.scaleMode},set:function(d){if(d){if(this.texture){this.texture.baseTexture.scaleMode=0}}else{if(this.texture){this.texture.baseTexture.scaleMode=1}}}});Object.defineProperty(b.Image.prototype,"destroyPhase",{get:function(){return !!this._cache[8]}});b.TileSprite=function(f,e,j,h,d,g,i){e=e||0;j=j||0;h=h||256;d=d||256;g=g||null;i=i||null;this.game=f;this.name="";this.type=b.TILESPRITE;this.z=0;this.events=new b.Events(this);this.animations=new b.AnimationManager(this);this.key=g;this._frame=0;this._frameName="";this._scroll=new b.Point();PIXI.TilingSprite.call(this,PIXI.TextureCache.__default,h,d);this.position.set(e,j);this.input=null;this.world=new b.Point(e,j);this.autoCull=false;this.checkWorldBounds=false;this.cameraOffset=new b.Point();this.body=null;this._cache=[0,0,0,0,1,0,1,0,0];this.loadTexture(g,i)};b.TileSprite.prototype=Object.create(PIXI.TilingSprite.prototype);b.TileSprite.prototype.constructor=b.TileSprite;b.TileSprite.prototype.preUpdate=function(){if(this._cache[4]===1&&this.exists){this.world.setTo(this.parent.position.x+this.position.x,this.parent.position.y+this.position.y);this.worldTransform.tx=this.world.x;this.worldTransform.ty=this.world.y;this._cache[0]=this.world.x;this._cache[1]=this.world.y;this._cache[2]=this.rotation;if(this.body){this.body.preUpdate()}this._cache[4]=0;return false}this._cache[0]=this.world.x;this._cache[1]=this.world.y;this._cache[2]=this.rotation;if(!this.exists||!this.parent.exists){this._cache[3]=-1;return false}if(this.autoCull||this.checkWorldBounds){this._bounds.copyFrom(this.getBounds())}if(this.autoCull){this.renderable=this.game.world.camera.screenView.intersects(this._bounds)}if(this.checkWorldBounds){if(this._cache[5]===1&&this.game.world.bounds.intersects(this._bounds)){this._cache[5]=0;this.events.onEnterBounds.dispatch(this)}else{if(this._cache[5]===0&&!this.game.world.bounds.intersects(this._bounds)){this._cache[5]=1;this.events.onOutOfBounds.dispatch(this)}}}this.world.setTo(this.game.camera.x+this.worldTransform.tx,this.game.camera.y+this.worldTransform.ty);if(this.visible){this._cache[3]=this.game.stage.currentRenderOrderID++}this.animations.update();if(this._scroll.x!==0){this.tilePosition.x+=this._scroll.x*this.game.time.physicsElapsed}if(this._scroll.y!==0){this.tilePosition.y+=this._scroll.y*this.game.time.physicsElapsed}if(this.body){this.body.preUpdate()}for(var e=0,d=this.children.length;e<d;e++){this.children[e].preUpdate()}return true};b.TileSprite.prototype.update=function(){};b.TileSprite.prototype.postUpdate=function(){if(this.exists&&this.body){this.body.postUpdate()}if(this._cache[7]===1){this.position.x=this.game.camera.view.x+this.cameraOffset.x;this.position.y=this.game.camera.view.y+this.cameraOffset.y}for(var e=0,d=this.children.length;e<d;e++){this.children[e].postUpdate()}};b.TileSprite.prototype.autoScroll=function(d,e){this._scroll.set(d,e)};b.TileSprite.prototype.stopScroll=function(){this._scroll.set(0,0)};b.TileSprite.prototype.loadTexture=function(d,e){e=e||0;this.key=d;if(d instanceof b.RenderTexture){this.key=d.key;this.setTexture(d)}else{if(d instanceof b.BitmapData){this.setTexture(d.texture)}else{if(d instanceof PIXI.Texture){this.setTexture(d)}else{if(d===null||typeof d==="undefined"){this.key="__default";this.setTexture(PIXI.TextureCache[this.key])}else{if(typeof d==="string"&&!this.game.cache.checkImageKey(d)){console.warn("Texture with key '"+d+"' not found.");this.key="__missing";this.setTexture(PIXI.TextureCache[this.key])}else{this.setTexture(new PIXI.Texture(PIXI.BaseTextureCache[d]));this.animations.loadFrameData(this.game.cache.getFrameData(d),e)}}}}}};b.TileSprite.prototype.setFrame=function(d){this.texture.frame.x=d.x;this.texture.frame.y=d.y;this.texture.frame.width=d.width;this.texture.frame.height=d.height;this.texture.crop.x=d.x;this.texture.crop.y=d.y;this.texture.crop.width=d.width;this.texture.crop.height=d.height;if(d.trimmed){if(this.texture.trim){this.texture.trim.x=d.spriteSourceSizeX;this.texture.trim.y=d.spriteSourceSizeY;this.texture.trim.width=d.sourceSizeW;this.texture.trim.height=d.sourceSizeH}else{this.texture.trim={x:d.spriteSourceSizeX,y:d.spriteSourceSizeY,width:d.sourceSizeW,height:d.sourceSizeH}}this.texture.width=d.sourceSizeW;this.texture.height=d.sourceSizeH;this.texture.frame.width=d.sourceSizeW;this.texture.frame.height=d.sourceSizeH}if(this.game.renderType===b.WEBGL){PIXI.WebGLRenderer.updateTextureFrame(this.texture)}};b.TileSprite.prototype.destroy=function(e){if(this.game===null||this.destroyPhase){return}if(typeof e==="undefined"){e=true}this._cache[8]=1;if(this.filters){this.filters=null}if(this.parent){if(this.parent instanceof b.Group){this.parent.remove(this)}else{this.parent.removeChild(this)}}this.animations.destroy();this.events.destroy();var d=this.children.length;if(e){while(d--){this.children[d].destroy(e)}}else{while(d--){this.removeChild(this.children[d])}}this.exists=false;this.visible=false;this.filters=null;this.mask=null;this.game=null;this._cache[8]=0};b.TileSprite.prototype.play=function(g,f,e,d){return this.animations.play(g,f,e,d)};b.TileSprite.prototype.reset=function(d,e){this.world.setTo(d,e);this.position.x=d;this.position.y=e;this.alive=true;this.exists=true;this.visible=true;this.renderable=true;this._outOfBoundsFired=false;this.tilePosition.x=0;this.tilePosition.y=0;if(this.body){this.body.reset(d,e,false,false)}this._cache[4]=1;return this};Object.defineProperty(b.TileSprite.prototype,"angle",{get:function(){return b.Math.wrapAngle(b.Math.radToDeg(this.rotation))},set:function(d){this.rotation=b.Math.degToRad(b.Math.wrapAngle(d))}});Object.defineProperty(b.TileSprite.prototype,"frame",{get:function(){return this.animations.frame},set:function(d){if(d!==this.animations.frame){this.animations.frame=d}}});Object.defineProperty(b.TileSprite.prototype,"frameName",{get:function(){return this.animations.frameName},set:function(d){if(d!==this.animations.frameName){this.animations.frameName=d}}});Object.defineProperty(b.TileSprite.prototype,"fixedToCamera",{get:function(){return !!this._cache[7]},set:function(d){if(d){this._cache[7]=1;this.cameraOffset.set(this.x,this.y)}else{this._cache[7]=0}}});Object.defineProperty(b.TileSprite.prototype,"exists",{get:function(){return !!this._cache[6]},set:function(d){if(d){this._cache[6]=1;if(this.body&&this.body.type===b.Physics.P2JS){this.body.addToWorld()}this.visible=true}else{this._cache[6]=0;if(this.body&&this.body.type===b.Physics.P2JS){this.body.safeRemove=true}this.visible=false}}});Object.defineProperty(b.TileSprite.prototype,"inputEnabled",{get:function(){return(this.input&&this.input.enabled)},set:function(d){if(d){if(this.input===null){this.input=new b.InputHandler(this);this.input.start()}else{if(this.input&&!this.input.enabled){this.input.start()}}}else{if(this.input&&this.input.enabled){this.input.stop()}}}});Object.defineProperty(b.TileSprite.prototype,"x",{get:function(){return this.position.x},set:function(d){this.position.x=d;if(this.body&&this.body.type===b.Physics.ARCADE&&this.body.phase===2){this.body._reset=1}}});Object.defineProperty(b.TileSprite.prototype,"y",{get:function(){return this.position.y},set:function(d){this.position.y=d;if(this.body&&this.body.type===b.Physics.ARCADE&&this.body.phase===2){this.body._reset=1}}});Object.defineProperty(b.TileSprite.prototype,"destroyPhase",{get:function(){return !!this._cache[8]}});b.Text=function(e,d,h,g,f){d=d||0;h=h||0;g=g||" ";f=f||{};if(g.length===0){g=" "}else{g=g.toString()}this.game=e;this.exists=true;this.name="";this.type=b.TEXT;this.z=0;this.world=new b.Point(d,h);this._text=g;this._font="";this._fontSize=32;this._fontWeight="normal";this._lineSpacing=0;this.events=new b.Events(this);this.input=null;this.cameraOffset=new b.Point();this.setStyle(f);PIXI.Text.call(this,g,this.style);this.position.set(d,h);this._cache=[0,0,0,0,1,0,1,0,0]};b.Text.prototype=Object.create(PIXI.Text.prototype);b.Text.prototype.constructor=b.Text;b.Text.prototype.preUpdate=function(){this._cache[0]=this.world.x;this._cache[1]=this.world.y;this._cache[2]=this.rotation;if(!this.exists||!this.parent.exists){this.renderOrderID=-1;return false}if(this.autoCull){this.renderable=this.game.world.camera.screenView.intersects(this.getBounds())}this.world.setTo(this.game.camera.x+this.worldTransform.tx,this.game.camera.y+this.worldTransform.ty);if(this.visible){this._cache[3]=this.game.stage.currentRenderOrderID++}for(var e=0,d=this.children.length;e<d;e++){this.children[e].preUpdate()}return true};b.Text.prototype.update=function(){};b.Text.prototype.postUpdate=function(){if(this._cache[7]===1){this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x;this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y}for(var e=0,d=this.children.length;e<d;e++){this.children[e].postUpdate()}};b.Text.prototype.destroy=function(e){if(this.game===null||this.destroyPhase){return}if(typeof e==="undefined"){e=true}this._cache[8]=1;if(this.parent){if(this.parent instanceof b.Group){this.parent.remove(this)}else{this.parent.removeChild(this)}}this.texture.destroy();if(this.canvas.parentNode){this.canvas.parentNode.removeChild(this.canvas)}else{this.canvas=null;this.context=null}var d=this.children.length;if(e){while(d--){this.children[d].destroy(e)}}else{while(d--){this.removeChild(this.children[d])}}this.exists=false;this.visible=false;this.filters=null;this.mask=null;this.game=null;this._cache[8]=0};b.Text.prototype.setShadow=function(d,g,e,f){this.style.shadowOffsetX=d||0;this.style.shadowOffsetY=g||0;this.style.shadowColor=e||"rgba(0,0,0,0)";this.style.shadowBlur=f||0;this.dirty=true};b.Text.prototype.setStyle=function(d){d=d||{};d.font=d.font||"bold 20pt Arial";d.fill=d.fill||"black";d.align=d.align||"left";d.stroke=d.stroke||"black";d.strokeThickness=d.strokeThickness||0;d.wordWrap=d.wordWrap||false;d.wordWrapWidth=d.wordWrapWidth||100;d.shadowOffsetX=d.shadowOffsetX||0;d.shadowOffsetY=d.shadowOffsetY||0;d.shadowColor=d.shadowColor||"rgba(0,0,0,0)";d.shadowBlur=d.shadowBlur||0;this.style=d;this.dirty=true};b.Text.prototype.updateText=function(){this.context.font=this.style.font;var j=this.text;if(this.style.wordWrap){j=this.runWordWrap(this.text)}var h=j.split(/(?:\r\n|\r|\n)/);var f=[];var e=0;for(var k=0;k<h.length;k++){var d=this.context.measureText(h[k]).width;f[k]=d;e=Math.max(e,d)}this.canvas.width=e+this.style.strokeThickness;var l=this.determineFontHeight("font: "+this.style.font+";")+this.style.strokeThickness+this._lineSpacing+this.style.shadowOffsetY;this.canvas.height=l*h.length;if(navigator.isCocoonJS){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}this.context.fillStyle=this.style.fill;this.context.font=this.style.font;this.context.strokeStyle=this.style.stroke;this.context.lineWidth=this.style.strokeThickness;this.context.shadowOffsetX=this.style.shadowOffsetX;this.context.shadowOffsetY=this.style.shadowOffsetY;this.context.shadowColor=this.style.shadowColor;this.context.shadowBlur=this.style.shadowBlur;this.context.textBaseline="top";this.context.lineCap="round";this.context.lineJoin="round";for(k=0;k<h.length;k++){var g=new PIXI.Point(this.style.strokeThickness/2,this.style.strokeThickness/2+k*l);if(this.style.align==="right"){g.x+=e-f[k]}else{if(this.style.align==="center"){g.x+=(e-f[k])/2}}g.y+=this._lineSpacing;if(this.style.stroke&&this.style.strokeThickness){this.context.strokeText(h[k],g.x,g.y)}if(this.style.fill){this.context.fillText(h[k],g.x,g.y)}}this.updateTexture()};b.Text.prototype.runWordWrap=function(k){var n="";var m=k.split("\n");for(var f=0;f<m.length;f++){var e=this.style.wordWrapWidth;var h=m[f].split(" ");for(var d=0;d<h.length;d++){var l=this.context.measureText(h[d]).width;var g=l+this.context.measureText(" ").width;if(g>e){if(d>0){n+="\n"}n+=h[d]+" ";e=this.style.wordWrapWidth-l}else{e-=g;n+=h[d]+" "}}if(f<m.length-1){n+="\n"}}return n};Object.defineProperty(b.Text.prototype,"angle",{get:function(){return b.Math.radToDeg(this.rotation)},set:function(d){this.rotation=b.Math.degToRad(d)}});Object.defineProperty(b.Text.prototype,"text",{get:function(){return this._text},set:function(d){if(d!==this._text){this._text=d.toString()||" ";this.dirty=true;this.updateTransform()}}});Object.defineProperty(b.Text.prototype,"font",{get:function(){return this._font},set:function(d){if(d!==this._font){this._font=d.trim();this.style.font=this._fontWeight+" "+this._fontSize+"px '"+this._font+"'";this.dirty=true;this.updateTransform()}}});Object.defineProperty(b.Text.prototype,"fontSize",{get:function(){return this._fontSize},set:function(d){d=parseInt(d,10);if(d!==this._fontSize){this._fontSize=d;this.style.font=this._fontWeight+" "+this._fontSize+"px '"+this._font+"'";this.dirty=true;this.updateTransform()}}});Object.defineProperty(b.Text.prototype,"fontWeight",{get:function(){return this._fontWeight},set:function(d){if(d!==this._fontWeight){this._fontWeight=d;this.style.font=this._fontWeight+" "+this._fontSize+"px '"+this._font+"'";this.dirty=true;this.updateTransform()}}});Object.defineProperty(b.Text.prototype,"fill",{get:function(){return this.style.fill},set:function(d){if(d!==this.style.fill){this.style.fill=d;this.dirty=true}}});Object.defineProperty(b.Text.prototype,"align",{get:function(){return this.style.align},set:function(d){if(d!==this.style.align){this.style.align=d;this.dirty=true}}});Object.defineProperty(b.Text.prototype,"stroke",{get:function(){return this.style.stroke},set:function(d){if(d!==this.style.stroke){this.style.stroke=d;this.dirty=true}}});Object.defineProperty(b.Text.prototype,"strokeThickness",{get:function(){return this.style.strokeThickness},set:function(d){if(d!==this.style.strokeThickness){this.style.strokeThickness=d;this.dirty=true}}});Object.defineProperty(b.Text.prototype,"wordWrap",{get:function(){return this.style.wordWrap},set:function(d){if(d!==this.style.wordWrap){this.style.wordWrap=d;this.dirty=true}}});Object.defineProperty(b.Text.prototype,"wordWrapWidth",{get:function(){return this.style.wordWrapWidth},set:function(d){if(d!==this.style.wordWrapWidth){this.style.wordWrapWidth=d;this.dirty=true}}});Object.defineProperty(b.Text.prototype,"lineSpacing",{get:function(){return this._lineSpacing},set:function(d){if(d!==this._lineSpacing){this._lineSpacing=parseFloat(d);this.dirty=true;this.updateTransform()}}});Object.defineProperty(b.Text.prototype,"shadowOffsetX",{get:function(){return this.style.shadowOffsetX},set:function(d){if(d!==this.style.shadowOffsetX){this.style.shadowOffsetX=d;this.dirty=true}}});Object.defineProperty(b.Text.prototype,"shadowOffsetY",{get:function(){return this.style.shadowOffsetY},set:function(d){if(d!==this.style.shadowOffsetY){this.style.shadowOffsetY=d;this.dirty=true}}});Object.defineProperty(b.Text.prototype,"shadowColor",{get:function(){return this.style.shadowColor},set:function(d){if(d!==this.style.shadowColor){this.style.shadowColor=d;this.dirty=true}}});Object.defineProperty(b.Text.prototype,"shadowBlur",{get:function(){return this.style.shadowBlur},set:function(d){if(d!==this.style.shadowBlur){this.style.shadowBlur=d;this.dirty=true}}});Object.defineProperty(b.Text.prototype,"inputEnabled",{get:function(){return(this.input&&this.input.enabled)},set:function(d){if(d){if(this.input===null){this.input=new b.InputHandler(this);this.input.start()}else{if(this.input&&!this.input.enabled){this.input.start()}}}else{if(this.input&&this.input.enabled){this.input.stop()}}}});Object.defineProperty(b.Text.prototype,"fixedToCamera",{get:function(){return !!this._cache[7]},set:function(d){if(d){this._cache[7]=1;this.cameraOffset.set(this.x,this.y)}else{this._cache[7]=0}}});Object.defineProperty(b.Text.prototype,"destroyPhase",{get:function(){return !!this._cache[8]}});b.BitmapText=function(f,d,i,e,h,g){d=d||0;i=i||0;e=e||"";h=h||"";g=g||32;this.game=f;this.exists=true;this.name="";this.type=b.BITMAPTEXT;this.z=0;this.world=new b.Point(d,i);this._text=h;this._font=e;this._fontSize=g;this._align="left";this._tint=16777215;this.events=new b.Events(this);this.input=null;this.cameraOffset=new b.Point();PIXI.BitmapText.call(this,h);this.position.set(d,i);this._cache=[0,0,0,0,1,0,1,0,0]};b.BitmapText.prototype=Object.create(PIXI.BitmapText.prototype);b.BitmapText.prototype.constructor=b.BitmapText;b.BitmapText.prototype.setStyle=function(){this.style={align:this._align};this.fontName=this._font;this.fontSize=this._fontSize;this.dirty=true};b.BitmapText.prototype.preUpdate=function(){this._cache[0]=this.world.x;this._cache[1]=this.world.y;this._cache[2]=this.rotation;if(!this.exists||!this.parent.exists){this.renderOrderID=-1;return false}if(this.autoCull){this.renderable=this.game.world.camera.screenView.intersects(this.getBounds())}this.world.setTo(this.game.camera.x+this.worldTransform.tx,this.game.camera.y+this.worldTransform.ty);if(this.visible){this._cache[3]=this.game.stage.currentRenderOrderID++}return true};b.BitmapText.prototype.update=function(){};b.BitmapText.prototype.postUpdate=function(){if(this._cache[7]===1){this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x;this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y}};b.BitmapText.prototype.destroy=function(e){if(this.game===null||this.destroyPhase){return}if(typeof e==="undefined"){e=true}this._cache[8]=1;if(this.parent){if(this.parent instanceof b.Group){this.parent.remove(this)}else{this.parent.removeChild(this)}}var d=this.children.length;if(e){while(d--){if(this.children[d].destroy){this.children[d].destroy(e)}else{this.removeChild(this.children[d])}}}else{while(d--){this.removeChild(this.children[d])}}this.exists=false;this.visible=false;this.filters=null;this.mask=null;this.game=null;this._cache[8]=0};Object.defineProperty(b.BitmapText.prototype,"align",{get:function(){return this._align},set:function(d){if(d!==this._align){this._align=d;this.setStyle()}}});Object.defineProperty(b.BitmapText.prototype,"tint",{get:function(){return this._tint},set:function(d){if(d!==this._tint){this._tint=d;this.dirty=true}}});Object.defineProperty(b.BitmapText.prototype,"angle",{get:function(){return b.Math.radToDeg(this.rotation)},set:function(d){this.rotation=b.Math.degToRad(d)}});Object.defineProperty(b.BitmapText.prototype,"font",{get:function(){return this._font},set:function(d){if(d!==this._font){this._font=d.trim();this.style.font=this._fontSize+"px '"+this._font+"'";this.dirty=true}}});Object.defineProperty(b.BitmapText.prototype,"fontSize",{get:function(){return this._fontSize},set:function(d){d=parseInt(d,10);if(d!==this._fontSize){this._fontSize=d;this.style.font=this._fontSize+"px '"+this._font+"'";this.dirty=true}}});Object.defineProperty(b.BitmapText.prototype,"text",{get:function(){return this._text},set:function(d){if(d!==this._text){this._text=d.toString()||" ";this.dirty=true}}});Object.defineProperty(b.BitmapText.prototype,"inputEnabled",{get:function(){return(this.input&&this.input.enabled)},set:function(d){if(d){if(this.input===null){this.input=new b.InputHandler(this);this.input.start()}else{if(this.input&&!this.input.enabled){this.input.start()}}}else{if(this.input&&this.input.enabled){this.input.stop()}}}});Object.defineProperty(b.BitmapText.prototype,"fixedToCamera",{get:function(){return !!this._cache[7]},set:function(d){if(d){this._cache[7]=1;this.cameraOffset.set(this.x,this.y)}else{this._cache[7]=0}}});Object.defineProperty(b.BitmapText.prototype,"destroyPhase",{get:function(){return !!this._cache[8]}});b.Button=function(m,j,i,k,l,e,f,d,g,h){j=j||0;i=i||0;k=k||null;l=l||null;e=e||this;b.Image.call(this,m,j,i,k,d);this.type=b.BUTTON;this._onOverFrameName=null;this._onOutFrameName=null;this._onDownFrameName=null;this._onUpFrameName=null;this._onOverFrameID=null;this._onOutFrameID=null;this._onDownFrameID=null;this._onUpFrameID=null;this.onOverMouseOnly=false;this.onOverSound=null;this.onOutSound=null;this.onDownSound=null;this.onUpSound=null;this.onOverSoundMarker="";this.onOutSoundMarker="";this.onDownSoundMarker="";this.onUpSoundMarker="";this.onInputOver=new b.Signal();this.onInputOut=new b.Signal();this.onInputDown=new b.Signal();this.onInputUp=new b.Signal();this.freezeFrames=false;this.forceOut=false;this.inputEnabled=true;this.input.start(0,true);this.setFrames(f,d,g,h);if(l!==null){this.onInputUp.add(l,e)}this.events.onInputOver.add(this.onInputOverHandler,this);this.events.onInputOut.add(this.onInputOutHandler,this);this.events.onInputDown.add(this.onInputDownHandler,this);this.events.onInputUp.add(this.onInputUpHandler,this)};b.Button.prototype=Object.create(b.Image.prototype);b.Button.prototype.constructor=b.Button;b.Button.prototype.clearFrames=function(){this._onOverFrameName=null;this._onOverFrameID=null;this._onOutFrameName=null;this._onOutFrameID=null;this._onDownFrameName=null;this._onDownFrameID=null;this._onUpFrameName=null;this._onUpFrameID=null};b.Button.prototype.setFrames=function(e,g,d,f){this.clearFrames();if(e!==null){if(typeof e==="string"){this._onOverFrameName=e;if(this.input.pointerOver()){this.frameName=e}}else{this._onOverFrameID=e;if(this.input.pointerOver()){this.frame=e}}}if(g!==null){if(typeof g==="string"){this._onOutFrameName=g;if(this.input.pointerOver()===false){this.frameName=g}}else{this._onOutFrameID=g;if(this.input.pointerOver()===false){this.frame=g}}}if(d!==null){if(typeof d==="string"){this._onDownFrameName=d;if(this.input.pointerDown()){this.frameName=d}}else{this._onDownFrameID=d;if(this.input.pointerDown()){this.frame=d}}}if(f!==null){if(typeof f==="string"){this._onUpFrameName=f;if(this.input.pointerUp()){this.frameName=f}}else{this._onUpFrameID=f;if(this.input.pointerUp()){this.frame=f}}}};b.Button.prototype.setSounds=function(e,i,d,h,g,k,f,j){this.setOverSound(e,i);this.setOutSound(g,k);this.setDownSound(d,h);this.setUpSound(f,j)};b.Button.prototype.setOverSound=function(e,d){this.onOverSound=null;this.onOverSoundMarker="";if(e instanceof b.Sound){this.onOverSound=e}if(typeof d==="string"){this.onOverSoundMarker=d}};b.Button.prototype.setOutSound=function(e,d){this.onOutSound=null;this.onOutSoundMarker="";if(e instanceof b.Sound){this.onOutSound=e}if(typeof d==="string"){this.onOutSoundMarker=d}};b.Button.prototype.setDownSound=function(e,d){this.onDownSound=null;this.onDownSoundMarker="";if(e instanceof b.Sound){this.onDownSound=e}if(typeof d==="string"){this.onDownSoundMarker=d}};b.Button.prototype.setUpSound=function(e,d){this.onUpSound=null;this.onUpSoundMarker="";if(e instanceof b.Sound){this.onUpSound=e}if(typeof d==="string"){this.onUpSoundMarker=d}};b.Button.prototype.onInputOverHandler=function(d,e){if(this.freezeFrames===false){this.setState(1)}if(this.onOverMouseOnly&&!e.isMouse){return}if(this.onOverSound){this.onOverSound.play(this.onOverSoundMarker)}if(this.onInputOver){this.onInputOver.dispatch(this,e)}};b.Button.prototype.onInputOutHandler=function(d,e){if(this.freezeFrames===false){this.setState(2)}if(this.onOutSound){this.onOutSound.play(this.onOutSoundMarker)}if(this.onInputOut){this.onInputOut.dispatch(this,e)}};b.Button.prototype.onInputDownHandler=function(d,e){if(this.freezeFrames===false){this.setState(3)}if(this.onDownSound){this.onDownSound.play(this.onDownSoundMarker)}if(this.onInputDown){this.onInputDown.dispatch(this,e)}};b.Button.prototype.onInputUpHandler=function(d,f,e){if(this.onUpSound){this.onUpSound.play(this.onUpSoundMarker)}if(this.onInputUp){this.onInputUp.dispatch(this,f,e)}if(this.freezeFrames){return}if(this.forceOut){this.setState(2)}else{if(this._onUpFrameName!==null||this._onUpFrameID!==null){this.setState(4)}else{if(e){this.setState(1)}else{this.setState(2)}}}};b.Button.prototype.setState=function(d){if(d===1){if(this._onOverFrameName!=null){this.frameName=this._onOverFrameName}else{if(this._onOverFrameID!=null){this.frame=this._onOverFrameID}}}else{if(d===2){if(this._onOutFrameName!=null){this.frameName=this._onOutFrameName}else{if(this._onOutFrameID!=null){this.frame=this._onOutFrameID}}}else{if(d===3){if(this._onDownFrameName!=null){this.frameName=this._onDownFrameName}else{if(this._onDownFrameID!=null){this.frame=this._onDownFrameID}}}else{if(d===4){if(this._onUpFrameName!=null){this.frameName=this._onUpFrameName}else{if(this._onUpFrameID!=null){this.frame=this._onUpFrameID}}}}}}};b.Graphics=function(e,d,f){d=d||0;f=f||0;this.game=e;this.exists=true;this.name="";this.type=b.GRAPHICS;this.z=0;this.world=new b.Point(d,f);this.cameraOffset=new b.Point();PIXI.Graphics.call(this);this.position.set(d,f);this._cache=[0,0,0,0,1,0,1,0,0]};b.Graphics.prototype=Object.create(PIXI.Graphics.prototype);b.Graphics.prototype.constructor=b.Graphics;b.Graphics.prototype.preUpdate=function(){this._cache[0]=this.world.x;this._cache[1]=this.world.y;this._cache[2]=this.rotation;if(!this.exists||!this.parent.exists){this.renderOrderID=-1;return false}if(this.autoCull){this.renderable=this.game.world.camera.screenView.intersects(this.getBounds())}this.world.setTo(this.game.camera.x+this.worldTransform.tx,this.game.camera.y+this.worldTransform.ty);if(this.visible){this._cache[3]=this.game.stage.currentRenderOrderID++}return true};b.Graphics.prototype.update=function(){};b.Graphics.prototype.postUpdate=function(){if(this._cache[7]===1){this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x;this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y}};b.Graphics.prototype.destroy=function(e){if(this.game===null||this.destroyPhase){return}if(typeof e==="undefined"){e=true}this._cache[8]=1;this.clear();if(this.parent){if(this.parent instanceof b.Group){this.parent.remove(this)}else{this.parent.removeChild(this)}}var d=this.children.length;if(e){while(d--){this.children[d].destroy(e)}}else{while(d--){this.removeChild(this.children[d])}}this.exists=false;this.visible=false;this.game=null;this._cache[8]=0};b.Graphics.prototype.drawPolygon=function(e){this.moveTo(e.points[0].x,e.points[0].y);for(var d=1;d<e.points.length;d+=1){this.lineTo(e.points[d].x,e.points[d].y)}this.lineTo(e.points[0].x,e.points[0].y)};b.Graphics.prototype.drawTriangle=function(f,e){if(typeof e==="undefined"){e=false}var j=new b.Polygon(f);if(e){var h=new b.Point(this.game.camera.x-f[0].x,this.game.camera.y-f[0].y);var g=new b.Point(f[1].x-f[0].x,f[1].y-f[0].y);var d=new b.Point(f[1].x-f[2].x,f[1].y-f[2].y);var i=d.cross(g);if(h.dot(i)>0){this.drawPolygon(j)}}else{this.drawPolygon(j)}};b.Graphics.prototype.drawTriangles=function(f,l,d){if(typeof d==="undefined"){d=false}var k=new b.Point();var h=new b.Point();var e=new b.Point();var j=[];var g;if(!l){if(f[0] instanceof b.Point){for(g=0;g<f.length/3;g++){this.drawTriangle([f[g*3],f[g*3+1],f[g*3+2]],d)}}else{for(g=0;g<f.length/6;g++){k.x=f[g*6+0];k.y=f[g*6+1];h.x=f[g*6+2];h.y=f[g*6+3];e.x=f[g*6+4];e.y=f[g*6+5];this.drawTriangle([k,h,e],d)}}}else{if(f[0] instanceof b.Point){for(g=0;g<l.length/3;g++){j.push(f[l[g*3]]);j.push(f[l[g*3+1]]);j.push(f[l[g*3+2]]);if(j.length===3){this.drawTriangle(j,d);j=[]}}}else{for(g=0;g<l.length;g++){k.x=f[l[g]*2];k.y=f[l[g]*2+1];j.push(k.copyTo({}));if(j.length===3){this.drawTriangle(j,d);j=[]}}}}};Object.defineProperty(b.Graphics.prototype,"angle",{get:function(){return b.Math.radToDeg(this.rotation)},set:function(d){this.rotation=b.Math.degToRad(d)}});Object.defineProperty(b.Graphics.prototype,"fixedToCamera",{get:function(){return !!this._cache[7]},set:function(d){if(d){this._cache[7]=1;this.cameraOffset.set(this.x,this.y)}else{this._cache[7]=0}}});Object.defineProperty(b.Graphics.prototype,"destroyPhase",{get:function(){return !!this._cache[8]}});b.RenderTexture=function(e,h,d,f,g){if(typeof f==="undefined"){f=""}if(typeof g==="undefined"){g=b.scaleModes.DEFAULT}this.game=e;this.key=f;this.type=b.RENDERTEXTURE;this._temp=new b.Point();PIXI.RenderTexture.call(this,h,d,this.game.renderer,g)};b.RenderTexture.prototype=Object.create(PIXI.RenderTexture.prototype);b.RenderTexture.prototype.constructor=b.RenderTexture;b.RenderTexture.prototype.renderXY=function(f,e,g,d){this._temp.set(e,g);this.render(f,this._temp,d)};b.SpriteBatch=function(e,g,f,d){if(typeof g==="undefined"||g===null){g=e.world}PIXI.SpriteBatch.call(this);b.Group.call(this,e,g,f,d);this.type=b.SPRITEBATCH};b.SpriteBatch.prototype=b.Utils.extend(true,b.SpriteBatch.prototype,b.Group.prototype,PIXI.SpriteBatch.prototype);b.SpriteBatch.prototype.constructor=b.SpriteBatch;b.RetroFont=function(u,t,f,k,p,s,q,n,m,j){if(!u.cache.checkImageKey(t)){return false}if(typeof s==="undefined"||s===null){s=u.cache.getImage(t).width/f}this.characterWidth=f;this.characterHeight=k;this.characterSpacingX=q||0;this.characterSpacingY=n||0;this.characterPerRow=s;this.offsetX=m||0;this.offsetY=j||0;this.align="left";this.multiLine=false;this.autoUpperCase=true;this.customSpacingX=0;this.customSpacingY=0;this.fixedWidth=0;this.fontSet=u.cache.getImage(t);this._text="";this.grabData=[];var i=this.offsetX;var h=this.offsetY;var e=0;var l=new b.FrameData();for(var o=0;o<p.length;o++){var d=u.rnd.uuid();var g=l.addFrame(new b.Frame(o,i,h,this.characterWidth,this.characterHeight,"",d));this.grabData[p.charCodeAt(o)]=g.index;PIXI.TextureCache[d]=new PIXI.Texture(PIXI.BaseTextureCache[t],{x:i,y:h,width:this.characterWidth,height:this.characterHeight});e++;if(e==this.characterPerRow){e=0;i=this.offsetX;h+=this.characterHeight+this.characterSpacingY}else{i+=this.characterWidth+this.characterSpacingX}}u.cache.updateFrameData(t,l);this.stamp=new b.Image(u,0,0,t,0);b.RenderTexture.call(this,u,100,100,"",b.scaleModes.NEAREST);this.type=b.RETROFONT};b.RetroFont.prototype=Object.create(b.RenderTexture.prototype);b.RetroFont.prototype.constructor=b.RetroFont;b.RetroFont.ALIGN_LEFT="left";b.RetroFont.ALIGN_RIGHT="right";b.RetroFont.ALIGN_CENTER="center";b.RetroFont.TEXT_SET1=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~";b.RetroFont.TEXT_SET2=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ";b.RetroFont.TEXT_SET3="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789 ";b.RetroFont.TEXT_SET4="ABCDEFGHIJKLMNOPQRSTUVWXYZ 0123456789";b.RetroFont.TEXT_SET5="ABCDEFGHIJKLMNOPQRSTUVWXYZ.,/() '!?-*:0123456789";b.RetroFont.TEXT_SET6="ABCDEFGHIJKLMNOPQRSTUVWXYZ!?:;0123456789\"(),-.' ";b.RetroFont.TEXT_SET7="AGMSY+:4BHNTZ!;5CIOU.?06DJPV,(17EKQW\")28FLRX-'39";b.RetroFont.TEXT_SET8="0123456789 .ABCDEFGHIJKLMNOPQRSTUVWXYZ";b.RetroFont.TEXT_SET9="ABCDEFGHIJKLMNOPQRSTUVWXYZ()-0123456789.:,'\"?!";b.RetroFont.TEXT_SET10="ABCDEFGHIJKLMNOPQRSTUVWXYZ";b.RetroFont.TEXT_SET11="ABCDEFGHIJKLMNOPQRSTUVWXYZ.,\"-+!?()':;0123456789";b.RetroFont.prototype.setFixedWidth=function(e,d){if(typeof d==="undefined"){d="left"}this.fixedWidth=e;this.align=d};b.RetroFont.prototype.setText=function(g,h,f,i,e,d){this.multiLine=h||false;this.customSpacingX=f||0;this.customSpacingY=i||0;this.align=e||"left";if(d){this.autoUpperCase=false}else{this.autoUpperCase=true}if(g.length>0){this.text=g}};b.RetroFont.prototype.buildRetroFontText=function(){var d=0;var g=0;this.clear();if(this.multiLine){var e=this._text.split("\n");if(this.fixedWidth>0){this.resize(this.fixedWidth,(e.length*(this.characterHeight+this.customSpacingY))-this.customSpacingY,true)}else{this.resize(this.getLongestLine()*(this.characterWidth+this.customSpacingX),(e.length*(this.characterHeight+this.customSpacingY))-this.customSpacingY,true)}for(var f=0;f<e.length;f++){switch(this.align){case b.RetroFont.ALIGN_LEFT:d=0;break;case b.RetroFont.ALIGN_RIGHT:d=this.width-(e[f].length*(this.characterWidth+this.customSpacingX));break;case b.RetroFont.ALIGN_CENTER:d=(this.width/2)-((e[f].length*(this.characterWidth+this.customSpacingX))/2);d+=this.customSpacingX/2;break}if(d<0){d=0}this.pasteLine(e[f],d,g,this.customSpacingX);g+=this.characterHeight+this.customSpacingY}}else{if(this.fixedWidth>0){this.resize(this.fixedWidth,this.characterHeight,true)}else{this.resize(this._text.length*(this.characterWidth+this.customSpacingX),this.characterHeight,true)}switch(this.align){case b.RetroFont.ALIGN_LEFT:d=0;break;case b.RetroFont.ALIGN_RIGHT:d=this.width-(this._text.length*(this.characterWidth+this.customSpacingX));break;case b.RetroFont.ALIGN_CENTER:d=(this.width/2)-((this._text.length*(this.characterWidth+this.customSpacingX))/2);d+=this.customSpacingX/2;break}this.textureBuffer.clear();this.pasteLine(this._text,d,0,this.customSpacingX)}};b.RetroFont.prototype.pasteLine=function(e,d,i,f){var g=new b.Point();for(var h=0;h<e.length;h++){if(e.charAt(h)==" "){d+=this.characterWidth+f}else{if(this.grabData[e.charCodeAt(h)]>=0){this.stamp.frame=this.grabData[e.charCodeAt(h)];g.set(d,i);this.render(this.stamp,g,false);d+=this.characterWidth+f;if(d>this.width){break}}}}};b.RetroFont.prototype.getLongestLine=function(){var e=0;if(this._text.length>0){var d=this._text.split("\n");for(var f=0;f<d.length;f++){if(d[f].length>e){e=d[f].length}}}return e};b.RetroFont.prototype.removeUnsupportedCharacters=function(g){var e="";for(var h=0;h<this._text.length;h++){var d=this._text[h];var f=d.charCodeAt(0);if(this.grabData[f]>=0||(!g&&d==="\n")){e=e.concat(d)}}return e};b.RetroFont.prototype.updateOffset=function(d,j){if(this.offsetX===d&&this.offsetY===j){return}var f=d-this.offsetX;var e=j-this.offsetY;var h=this.game.cache.getFrameData(this.stamp.key).getFrames();var g=h.length;while(g--){h[g].x+=f;h[g].y+=e;PIXI.TextureCache[h[g].uuid].frame.x=h[g].x;PIXI.TextureCache[h[g].uuid].frame.y=h[g].y}this.buildRetroFontText()};Object.defineProperty(b.RetroFont.prototype,"text",{get:function(){return this._text},set:function(e){var d;if(this.autoUpperCase){d=e.toUpperCase()}else{d=e}if(d!==this._text){this._text=d;this.removeUnsupportedCharacters(this.multiLine);this.buildRetroFontText()}}});Object.defineProperty(b.RetroFont.prototype,"smoothed",{get:function(){return this.stamp.smoothed},set:function(d){this.stamp.smoothed=d;this.buildRetroFontText()}});b.Particle=function(e,d,h,f,g){b.Sprite.call(this,e,d,h,f,g);this.autoScale=false;this.scaleData=null;this._s=0;this.autoAlpha=false;this.alphaData=null;this._a=0};b.Particle.prototype=Object.create(b.Sprite.prototype);b.Particle.prototype.constructor=b.Particle;b.Particle.prototype.update=function(){if(this.autoScale){this._s--;if(this._s){this.scale.set(this.scaleData[this._s].x,this.scaleData[this._s].y)}else{this.autoScale=false}}if(this.autoAlpha){this._a--;if(this._a){this.alpha=this.alphaData[this._a].v}else{this.autoAlpha=false}}};b.Particle.prototype.onEmit=function(){};b.Particle.prototype.setAlphaData=function(d){this.alphaData=d;this._a=d.length-1;this.alpha=this.alphaData[this._a].v;this.autoAlpha=true};b.Particle.prototype.setScaleData=function(d){this.scaleData=d;this._s=d.length-1;this.scale.set(this.scaleData[this._s].x,this.scaleData[this._s].y);this.autoScale=true};b.Particle.prototype.reset=function(d,f,e){if(typeof e==="undefined"){e=1}this.world.setTo(d,f);this.position.x=d;this.position.y=f;this.alive=true;this.exists=true;this.visible=true;this.renderable=true;this._outOfBoundsFired=false;this.health=e;if(this.body){this.body.reset(d,f,false,false)}this._cache[4]=1;this.alpha=1;this.scale.set(1);this.autoScale=false;this.autoAlpha=false;return this};b.Canvas={create:function(g,d,h,e){if(typeof e==="undefined"){e=false}g=g||256;d=d||256;var f=document.createElement("canvas");if(typeof h==="string"&&h!==""){f.id=h}f.width=g;f.height=d;f.style.display="block";return f},getOffset:function(e,d){d=d||new b.Point();var f=e.getBoundingClientRect();var j=e.clientTop||document.body.clientTop||0;var i=e.clientLeft||document.body.clientLeft||0;var g=0;var h=0;if(document.compatMode==="CSS1Compat"){g=window.pageYOffset||document.documentElement.scrollTop||e.scrollTop||0;h=window.pageXOffset||document.documentElement.scrollLeft||e.scrollLeft||0}else{g=window.pageYOffset||document.body.scrollTop||e.scrollTop||0;h=window.pageXOffset||document.body.scrollLeft||e.scrollLeft||0}d.x=f.left+h-i;d.y=f.top+g-j;return d},getAspectRatio:function(d){return d.width/d.height},setBackgroundColor:function(e,d){d=d||"rgb(0,0,0)";e.style.backgroundColor=d;return e},setTouchAction:function(d,e){e=e||"none";d.style.msTouchAction=e;d.style["ms-touch-action"]=e;d.style["touch-action"]=e;return d},setUserSelect:function(d,e){e=e||"none";d.style["-webkit-touch-callout"]=e;d.style["-webkit-user-select"]=e;d.style["-khtml-user-select"]=e;d.style["-moz-user-select"]=e;d.style["-ms-user-select"]=e;d.style["user-select"]=e;d.style["-webkit-tap-highlight-color"]="rgba(0, 0, 0, 0)";return d},addToDOM:function(d,e,g){var f;if(typeof g==="undefined"){g=true}if(e){if(typeof e==="string"){f=document.getElementById(e)}else{if(typeof e==="object"&&e.nodeType===1){f=e}}}if(!f){f=document.body}if(g&&f.style){f.style.overflow="hidden"}f.appendChild(d);return d},setTransform:function(h,j,i,f,d,g,e){h.setTransform(f,g,e,d,j,i);return h},setSmoothingEnabled:function(d,e){d.imageSmoothingEnabled=e;d.mozImageSmoothingEnabled=e;d.oImageSmoothingEnabled=e;d.webkitImageSmoothingEnabled=e;d.msImageSmoothingEnabled=e;return d},setImageRenderingCrisp:function(d){d.style["image-rendering"]="optimizeSpeed";d.style["image-rendering"]="crisp-edges";d.style["image-rendering"]="-moz-crisp-edges";d.style["image-rendering"]="-webkit-optimize-contrast";d.style["image-rendering"]="optimize-contrast";d.style.msInterpolationMode="nearest-neighbor";return d},setImageRenderingBicubic:function(d){d.style["image-rendering"]="auto";d.style.msInterpolationMode="bicubic";return d}};b.Device=function(d){this.game=d;this.desktop=false;this.iOS=false;this.cocoonJS=false;this.ejecta=false;this.crosswalk=false;this.android=false;this.chromeOS=false;this.linux=false;this.macOS=false;this.windows=false;this.windowsPhone=false;this.canvas=false;this.file=false;this.fileSystem=false;this.localStorage=false;this.webGL=false;this.worker=false;this.touch=false;this.mspointer=false;this.css3D=false;this.pointerLock=false;this.typedArray=false;this.vibration=false;this.getUserMedia=false;this.quirksMode=false;this.arora=false;this.chrome=false;this.epiphany=false;this.firefox=false;this.ie=false;this.ieVersion=0;this.trident=false;this.tridentVersion=0;this.mobileSafari=false;this.midori=false;this.opera=false;this.safari=false;this.webApp=false;this.silk=false;this.audioData=false;this.webAudio=false;this.ogg=false;this.opus=false;this.mp3=false;this.wav=false;this.m4a=false;this.webm=false;this.iPhone=false;this.iPhone4=false;this.iPad=false;this.pixelRatio=0;this.littleEndian=false;this.support32bit=false;this.fullscreen=false;this.requestFullscreen="";this.cancelFullscreen="";this.fullscreenKeyboard=false;this._checkOS();this._checkAudio();this._checkBrowser();this._checkCSS3D();this._checkDevice();this._checkFeatures()};b.Device.LITTLE_ENDIAN=false;b.Device.prototype={_checkOS:function(){var d=navigator.userAgent;if(/Android/.test(d)){this.android=true}else{if(/CrOS/.test(d)){this.chromeOS=true}else{if(/iP[ao]d|iPhone/i.test(d)){this.iOS=true}else{if(/Linux/.test(d)){this.linux=true}else{if(/Mac OS/.test(d)){this.macOS=true}else{if(/Windows/.test(d)){this.windows=true;if(/Windows Phone/i.test(d)){this.windowsPhone=true}}}}}}}if(this.windows||this.macOS||(this.linux&&this.silk===false)){this.desktop=true}if(this.windowsPhone||((/Windows NT/i.test(d))&&(/Touch/i.test(d)))){this.desktop=false}},_checkFeatures:function(){this.canvas=!!window.CanvasRenderingContext2D||this.cocoonJS;try{this.localStorage=!!localStorage.getItem}catch(d){this.localStorage=false}this.file=!!window.File&&!!window.FileReader&&!!window.FileList&&!!window.Blob;this.fileSystem=!!window.requestFileSystem;this.webGL=(function(){try{var f=document.createElement("canvas");return !!window.WebGLRenderingContext&&(f.getContext("webgl")||f.getContext("experimental-webgl"))}catch(g){return false}})();if(this.webGL===null||this.webGL===false){this.webGL=false}else{this.webGL=true}this.worker=!!window.Worker;if("ontouchstart" in document.documentElement||(window.navigator.maxTouchPoints&&window.navigator.maxTouchPoints>1)){this.touch=true}if(window.navigator.msPointerEnabled||window.navigator.pointerEnabled){this.mspointer=true}this.pointerLock="pointerLockElement" in document||"mozPointerLockElement" in document||"webkitPointerLockElement" in document;this.quirksMode=(document.compatMode==="CSS1Compat")?false:true;this.getUserMedia=!!(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia)},checkFullScreenSupport:function(){var e=["requestFullscreen","requestFullScreen","webkitRequestFullscreen","webkitRequestFullScreen","msRequestFullscreen","msRequestFullScreen","mozRequestFullScreen","mozRequestFullscreen"];for(var f=0;f<e.length;f++){if(this.game.canvas[e[f]]){this.fullscreen=true;this.requestFullscreen=e[f];break}}var d=["cancelFullScreen","exitFullscreen","webkitCancelFullScreen","webkitExitFullscreen","msCancelFullScreen","msExitFullscreen","mozCancelFullScreen","mozExitFullscreen"];if(this.fullscreen){for(var f=0;f<d.length;f++){if(document[d[f]]){this.cancelFullscreen=d[f];break}}}if(window.Element&&Element.ALLOW_KEYBOARD_INPUT){this.fullscreenKeyboard=true}},_checkBrowser:function(){var d=navigator.userAgent;if(/Arora/.test(d)){this.arora=true}else{if(/Chrome/.test(d)){this.chrome=true}else{if(/Epiphany/.test(d)){this.epiphany=true}else{if(/Firefox/.test(d)){this.firefox=true}else{if(/AppleWebKit/.test(d)&&this.iOS){this.mobileSafari=true}else{if(/MSIE (\d+\.\d+);/.test(d)){this.ie=true;this.ieVersion=parseInt(RegExp.$1,10)}else{if(/Midori/.test(d)){this.midori=true}else{if(/Opera/.test(d)){this.opera=true}else{if(/Safari/.test(d)){this.safari=true}else{if(/Trident\/(\d+\.\d+)(.*)rv:(\d+\.\d+)/.test(d)){this.ie=true;this.trident=true;this.tridentVersion=parseInt(RegExp.$1,10);this.ieVersion=parseInt(RegExp.$3,10)}}}}}}}}}}if(/Silk/.test(d)){this.silk=true}if(navigator.standalone){this.webApp=true}if(navigator.isCocoonJS){this.cocoonJS=true}if(typeof window.ejecta!=="undefined"){this.ejecta=true}if(/Crosswalk/.test(d)){this.crosswalk=true}},_checkAudio:function(){this.audioData=!!(window.Audio);this.webAudio=!!(window.webkitAudioContext||window.AudioContext);var g=document.createElement("audio");var d=false;try{if(d=!!g.canPlayType){if(g.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")){this.ogg=true}if(g.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,"")){this.opus=true}if(g.canPlayType("audio/mpeg;").replace(/^no$/,"")){this.mp3=true}if(g.canPlayType('audio/wav; codecs="1"').replace(/^no$/,"")){this.wav=true}if(g.canPlayType("audio/x-m4a;")||g.canPlayType("audio/aac;").replace(/^no$/,"")){this.m4a=true}if(g.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")){this.webm=true}}}catch(f){}},_checkDevice:function(){this.pixelRatio=window.devicePixelRatio||1;this.iPhone=navigator.userAgent.toLowerCase().indexOf("iphone")!=-1;this.iPhone4=(this.pixelRatio==2&&this.iPhone);this.iPad=navigator.userAgent.toLowerCase().indexOf("ipad")!=-1;if(typeof Int8Array!=="undefined"){this.typedArray=true}else{this.typedArray=false}if(typeof ArrayBuffer!=="undefined"&&typeof Uint8Array!=="undefined"&&typeof Uint32Array!=="undefined"){this.littleEndian=this._checkIsLittleEndian();b.Device.LITTLE_ENDIAN=this.littleEndian}this.support32bit=(typeof ArrayBuffer!=="undefined"&&typeof Uint8ClampedArray!=="undefined"&&typeof Int32Array!=="undefined"&&this.littleEndian!==null&&this._checkIsUint8ClampedImageData());navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate;if(navigator.vibrate){this.vibration=true}},_checkIsLittleEndian:function(){var e=new ArrayBuffer(4);var d=new Uint8Array(e);var f=new Uint32Array(e);d[0]=161;d[1]=178;d[2]=195;d[3]=212;if(f[0]==3569595041){return true}if(f[0]==2712847316){return false}else{return null}},_checkIsUint8ClampedImageData:function(){if(typeof Uint8ClampedArray==="undefined"){return false}var e=document.createElement("canvas");var d=e.getContext("2d");if(!d){return false}var f=d.createImageData(1,1);return f.data instanceof Uint8ClampedArray},_checkCSS3D:function(){var f=document.createElement("p");var g;var e={webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"};document.body.insertBefore(f,null);for(var d in e){if(f.style[d]!==undefined){f.style[d]="translate3d(1px,1px,1px)";g=window.getComputedStyle(f).getPropertyValue(e[d])}}document.body.removeChild(f);this.css3D=(g!==undefined&&g.length>0&&g!=="none")},canPlayAudio:function(d){if(d=="mp3"&&this.mp3){return true}else{if(d=="ogg"&&(this.ogg||this.opus)){return true}else{if(d=="m4a"&&this.m4a){return true}else{if(d=="wav"&&this.wav){return true}else{if(d=="webm"&&this.webm){return true}}}}}return false},isConsoleOpen:function(){if(window.console&&window.console.firebug){return true}if(window.console){console.profile();console.profileEnd();if(console.clear){console.clear()}if(console.profiles){return console.profiles.length>0}}return false}};b.Device.prototype.constructor=b.Device;b.RequestAnimationFrame=function(e,f){if(typeof f==="undefined"){f=false}this.game=e;this.isRunning=false;this.forceSetTimeOut=f;var g=["ms","moz","webkit","o"];for(var d=0;d<g.length&&!window.requestAnimationFrame;d++){window.requestAnimationFrame=window[g[d]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[g[d]+"CancelAnimationFrame"]}this._isSetTimeOut=false;this._onLoop=null;this._timeOutID=null};b.RequestAnimationFrame.prototype={start:function(){this.isRunning=true;var d=this;if(!window.requestAnimationFrame||this.forceSetTimeOut){this._isSetTimeOut=true;this._onLoop=function(){return d.updateSetTimeout()};this._timeOutID=window.setTimeout(this._onLoop,0)}else{this._isSetTimeOut=false;this._onLoop=function(e){return d.updateRAF(e)};this._timeOutID=window.requestAnimationFrame(this._onLoop)}},updateRAF:function(){this.game.update(Date.now());this._timeOutID=window.requestAnimationFrame(this._onLoop)},updateSetTimeout:function(){this.game.update(Date.now());this._timeOutID=window.setTimeout(this._onLoop,this.game.time.timeToCall)},stop:function(){if(this._isSetTimeOut){clearTimeout(this._timeOutID)}else{window.cancelAnimationFrame(this._timeOutID)}this.isRunning=false},isSetTimeOut:function(){return this._isSetTimeOut},isRAF:function(){return(this._isSetTimeOut===false)}};b.RequestAnimationFrame.prototype.constructor=b.RequestAnimationFrame;b.Math={PI2:Math.PI*2,fuzzyEqual:function(e,d,f){if(typeof f==="undefined"){f=0.0001}return Math.abs(e-d)<f},fuzzyLessThan:function(e,d,f){if(typeof f==="undefined"){f=0.0001}return e<d+f},fuzzyGreaterThan:function(e,d,f){if(typeof f==="undefined"){f=0.0001}return e>d-f},fuzzyCeil:function(d,e){if(typeof e==="undefined"){e=0.0001}return Math.ceil(d-e)},fuzzyFloor:function(d,e){if(typeof e==="undefined"){e=0.0001}return Math.floor(d+e)},average:function(){var d=[];for(var f=0;f<(arguments.length-0);f++){d[f]=arguments[f+0]}var g=0;for(var e=0;e<d.length;e++){g+=d[e]}return g/d.length},truncate:function(d){return(d>0)?Math.floor(d):Math.ceil(d)},shear:function(d){return d%1},snapTo:function(d,f,e){if(typeof e==="undefined"){e=0}if(f===0){return d}d-=e;d=f*Math.round(d/f);return e+d},snapToFloor:function(d,f,e){if(typeof e==="undefined"){e=0}if(f===0){return d}d-=e;d=f*Math.floor(d/f);return e+d},snapToCeil:function(d,f,e){if(typeof e==="undefined"){e=0}if(f===0){return d}d-=e;d=f*Math.ceil(d/f);return e+d},snapToInArray:function(f,e,h){if(typeof h==="undefined"){h=true}if(h){e.sort()}if(f<e[0]){return e[0]}var g=1;while(e[g]<f){g++}var d=e[g-1];var j=(g<e.length)?e[g]:Number.POSITIVE_INFINITY;return((j-f)<=(f-d))?j:d},roundTo:function(f,d,e){if(typeof d==="undefined"){d=0}if(typeof e==="undefined"){e=10}var g=Math.pow(e,-d);return Math.round(f*g)/g},floorTo:function(f,d,e){if(typeof d==="undefined"){d=0}if(typeof e==="undefined"){e=10}var g=Math.pow(e,-d);return Math.floor(f*g)/g},ceilTo:function(f,d,e){if(typeof d==="undefined"){d=0}if(typeof e==="undefined"){e=10}var g=Math.pow(e,-d);return Math.ceil(f*g)/g},interpolateFloat:function(e,d,f){return(d-e)*f+e},angleBetween:function(e,g,d,f){return Math.atan2(f-g,d-e)},angleBetweenPoints:function(e,d){return Math.atan2(d.y-e.y,d.x-e.x)},reverseAngle:function(d){return this.normalizeAngle(d+Math.PI,true)},normalizeAngle:function(d){d=d%(2*Math.PI);return d>=0?d:d+2*Math.PI},normalizeLatitude:function(d){return Math.max(-90,Math.min(90,d))},normalizeLongitude:function(d){if(d%360==180){return 180}d=d%360;return d<-180?d+360:d>180?d-360:d},chanceRoll:function(d){if(typeof d==="undefined"){d=50}if(d<=0){return false}else{if(d>=100){return true}else{if(Math.random()*100>=d){return false}else{return true}}}},numberArray:function(g,e){var d=[];for(var f=g;f<=e;f++){d.push(f)}return d},maxAdd:function(f,e,d){f+=e;if(f>d){f=d}return f},minSub:function(f,e,d){f-=e;if(f<d){f=d}return f},wrap:function(h,g,e){var f=e-g;if(f<=0){return 0}var d=(h-g)%f;if(d<0){d+=f}return d+g},wrapValue:function(f,e,d){var g;f=Math.abs(f);e=Math.abs(e);d=Math.abs(d);g=(f+e)%d;return g},limitValue:function(f,e,d){return f<e?e:f>d?d:f},randomSign:function(){return(Math.random()>0.5)?1:-1},isOdd:function(d){return(d&1)},isEven:function(d){if(d&1){return false}else{return true}},min:function(){if(arguments.length===1&&typeof arguments[0]==="object"){var g=arguments[0]}else{var g=arguments}for(var f=1,e=0,d=g.length;f<d;f++){if(g[f]<g[e]){e=f}}return g[e]},max:function(){if(arguments.length===1&&typeof arguments[0]==="object"){var g=arguments[0]}else{var g=arguments}for(var f=1,e=0,d=g.length;f<d;f++){if(g[f]>g[e]){e=f}}return g[e]},minProperty:function(h){if(arguments.length===2&&typeof arguments[1]==="object"){var g=arguments[1]}else{var g=arguments.slice(1)}for(var f=1,e=0,d=g.length;f<d;f++){if(g[f][h]<g[e][h]){e=f}}return g[e][h]},maxProperty:function(h){if(arguments.length===2&&typeof arguments[1]==="object"){var g=arguments[1]}else{var g=arguments.slice(1)}for(var f=1,e=0,d=g.length;f<d;f++){if(g[f][h]>g[e][h]){e=f}}return g[e][h]},wrapAngle:function(f,e){var d=(e)?Math.PI/180:1;return this.wrap(f,-180*d,180*d)},angleLimit:function(g,f,e){var d=g;if(g>e){d=e}else{if(g<f){d=f}}return d},linearInterpolation:function(g,e){var d=g.length-1;var j=d*e;var h=Math.floor(j);if(e<0){return this.linear(g[0],g[1],j)}if(e>1){return this.linear(g[d],g[d-1],d-j)}return this.linear(g[h],g[h+1>d?d:h+1],j-h)},bezierInterpolation:function(f,e){var d=0;var h=f.length-1;for(var g=0;g<=h;g++){d+=Math.pow(1-e,h-g)*Math.pow(e,g)*f[g]*this.bernstein(h,g)}return d},catmullRomInterpolation:function(g,e){var d=g.length-1;var j=d*e;var h=Math.floor(j);if(g[0]===g[d]){if(e<0){h=Math.floor(j=d*(1+e))}return this.catmullRom(g[(h-1+d)%d],g[h],g[(h+1)%d],g[(h+2)%d],j-h)}else{if(e<0){return g[0]-(this.catmullRom(g[0],g[0],g[1],g[1],-j)-g[0])}if(e>1){return g[d]-(this.catmullRom(g[d],g[d],g[d-1],g[d-1],j-d)-g[d])}return this.catmullRom(g[h?h-1:0],g[h],g[d<h+1?d:h+1],g[d<h+2?d:h+2],j-h)}},linear:function(f,e,d){return(e-f)*d+f},bernstein:function(e,d){return this.factorial(e)/this.factorial(d)/this.factorial(e-d)},factorial:function(e){if(e===0){return 1}var d=e;while(--e){d*=e}return d},catmullRom:function(k,j,h,g,l){var i=(h-k)*0.5,f=(g-j)*0.5,e=l*l,d=l*e;return(2*j-2*h+i+f)*d+(-3*j+3*h-2*i-f)*e+i*l+j},difference:function(e,d){return Math.abs(e-d)},getRandom:function(f,g,e){if(typeof g==="undefined"){g=0}if(typeof e==="undefined"){e=0}if(f!=null){var d=e;if((d===0)||(d>f.length-g)){d=f.length-g}if(d>0){return f[g+Math.floor(Math.random()*d)]}}return null},removeRandom:function(g,i,f){if(typeof i==="undefined"){i=0}if(typeof f==="undefined"){f=0}if(g!=null){var e=f;if((e===0)||(e>g.length-i)){e=g.length-i}if(e>0){var d=i+Math.floor(Math.random()*e);var h=g.splice(d,1);return h[0]}}return null},floor:function(d){var e=d|0;return(d>0)?(e):((e!=d)?(e-1):(e))},ceil:function(d){var e=d|0;return(d>0)?((e!=d)?(e+1):(e)):(e)},sinCosGenerator:function(d,k,e,i){if(typeof k==="undefined"){k=1}if(typeof e==="undefined"){e=1}if(typeof i==="undefined"){i=1}var j=k;var m=e;var g=i*Math.PI/d;var f=[];var l=[];for(var h=0;h<d;h++){m-=j*g;j+=m*g;f[h]=m;l[h]=j}return{sin:l,cos:f,length:d}},shift:function(d){var e=d.shift();d.push(e);return e},shuffleArray:function(g){for(var f=g.length-1;f>0;f--){var e=Math.floor(Math.random()*(f+1));var d=g[f];g[f]=g[e];g[e]=d}return g},distance:function(g,i,f,h){var e=g-f;var d=i-h;return Math.sqrt(e*e+d*d)},distancePow:function(e,g,d,f,h){if(typeof h==="undefined"){h=2}return Math.sqrt(Math.pow(d-e,h)+Math.pow(f-g,h))},distanceRounded:function(e,g,d,f){return Math.round(b.Math.distance(e,g,d,f))},clamp:function(e,f,d){return(e<f)?f:((e>d)?d:e)},clampBottom:function(d,e){return d<e?e:d},within:function(e,d,f){return(Math.abs(e-d)<=f)},mapLinear:function(e,f,d,h,g){return h+(e-f)*(g-h)/(d-f)},smoothstep:function(e,f,d){e=Math.max(0,Math.min(1,(e-f)/(d-f)));return e*e*(3-2*e)},smootherstep:function(e,f,d){e=Math.max(0,Math.min(1,(e-f)/(d-f)));return e*e*e*(e*(e*6-15)+10)},sign:function(d){return(d<0)?-1:((d>0)?1:0)},percent:function(e,d,f){if(typeof f==="undefined"){f=0}if(e>d||f>d){return 1}else{if(e<f||f>e){return 0}else{return(e-f)/d}}},degToRad:(function(){var d=Math.PI/180;return function(e){return e*d}}()),radToDeg:(function(){var d=180/Math.PI;return function(e){return e*d}}())};b.RandomDataGenerator=function(d){if(typeof d==="undefined"){d=[]}this.c=1;this.s0=0;this.s1=0;this.s2=0;this.sow(d)};b.RandomDataGenerator.prototype={rnd:function(){var d=2091639*this.s0+this.c*2.3283064365386963e-10;this.c=d|0;this.s0=this.s1;this.s1=this.s2;this.s2=d-this.c;return this.s2},sow:function(e){if(typeof e==="undefined"){e=[]}this.s0=this.hash(" ");this.s1=this.hash(this.s0);this.s2=this.hash(this.s1);this.c=1;var d;for(var f=0;d=e[f++];){this.s0-=this.hash(d);this.s0+=~~(this.s0<0);this.s1-=this.hash(d);this.s1+=~~(this.s1<0);this.s2-=this.hash(d);this.s2+=~~(this.s2<0)}},hash:function(f){var e,d,g;g=4022871197;f=f.toString();for(d=0;d<f.length;d++){g+=f.charCodeAt(d);e=0.02519603282416938*g;g=e>>>0;e-=g;e*=g;g=e>>>0;e-=g;g+=e*4294967296}return(g>>>0)*2.3283064365386963e-10},integer:function(){return this.rnd.apply(this)*4294967296},frac:function(){return this.rnd.apply(this)+(this.rnd.apply(this)*2097152|0)*1.1102230246251565e-16},real:function(){return this.integer()+this.frac()},integerInRange:function(e,d){return Math.floor(this.realInRange(0,d-e+1)+e)},between:function(e,d){return this.integerInRange(e,d)},realInRange:function(e,d){return this.frac()*(d-e)+e},normal:function(){return 1-2*this.frac()},uuid:function(){var e="";var d="";for(d=e="";e++<36;d+=~e%5|e*3&4?(e^15?8^this.frac()*(e^20?16:4):4).toString(16):"-"){}return d},pick:function(d){return d[this.integerInRange(0,d.length-1)]},weightedPick:function(d){return d[~~(Math.pow(this.frac(),2)*(d.length-1))]},timestamp:function(e,d){return this.realInRange(e||946684800000,d||1577862000000)},angle:function(){return this.integerInRange(-180,180)}};b.RandomDataGenerator.prototype.constructor=b.RandomDataGenerator;b.QuadTree=function(e,j,h,d,g,f,i){this.maxObjects=10;this.maxLevels=4;this.level=0;this.bounds={};this.objects=[];this.nodes=[];this._empty=[];this.reset(e,j,h,d,g,f,i)};b.QuadTree.prototype={reset:function(e,j,h,d,g,f,i){this.maxObjects=g||10;this.maxLevels=f||4;this.level=i||0;this.bounds={x:Math.round(e),y:Math.round(j),width:h,height:d,subWidth:Math.floor(h/2),subHeight:Math.floor(d/2),right:Math.round(e)+Math.floor(h/2),bottom:Math.round(j)+Math.floor(d/2)};this.objects.length=0;this.nodes.length=0},populate:function(d){d.forEach(this.populateHandler,this,true)},populateHandler:function(d){if(d.body&&d.exists){this.insert(d.body)}},split:function(){this.nodes[0]=new b.QuadTree(this.bounds.right,this.bounds.y,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,(this.level+1));this.nodes[1]=new b.QuadTree(this.bounds.x,this.bounds.y,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,(this.level+1));this.nodes[2]=new b.QuadTree(this.bounds.x,this.bounds.bottom,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,(this.level+1));this.nodes[3]=new b.QuadTree(this.bounds.right,this.bounds.bottom,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,(this.level+1))},insert:function(d){var f=0;var e;if(this.nodes[0]!=null){e=this.getIndex(d);if(e!==-1){this.nodes[e].insert(d);return}}this.objects.push(d);if(this.objects.length>this.maxObjects&&this.level<this.maxLevels){if(this.nodes[0]==null){this.split()}while(f<this.objects.length){e=this.getIndex(this.objects[f]);if(e!==-1){this.nodes[e].insert(this.objects.splice(f,1)[0])}else{f++}}}},getIndex:function(e){var d=-1;if(e.x<this.bounds.right&&e.right<this.bounds.right){if(e.y<this.bounds.bottom&&e.bottom<this.bounds.bottom){d=1}else{if(e.y>this.bounds.bottom){d=2}}}else{if(e.x>this.bounds.right){if(e.y<this.bounds.bottom&&e.bottom<this.bounds.bottom){d=0}else{if(e.y>this.bounds.bottom){d=3}}}}return d},retrieve:function(e){if(e instanceof b.Rectangle){var f=this.objects;var d=this.getIndex(e)}else{if(!e.body){return this._empty}var f=this.objects;var d=this.getIndex(e.body)}if(this.nodes[0]){if(d!==-1){f=f.concat(this.nodes[d].retrieve(e))}else{f=f.concat(this.nodes[0].retrieve(e));f=f.concat(this.nodes[1].retrieve(e));f=f.concat(this.nodes[2].retrieve(e));f=f.concat(this.nodes[3].retrieve(e))}}return f},clear:function(){this.objects.length=0;var d=this.nodes.length;while(d--){this.nodes[d].clear();this.nodes.splice(d,1)}this.nodes.length=0}};b.QuadTree.prototype.constructor=b.QuadTree;b.Net=function(d){this.game=d};b.Net.prototype={getHostName:function(){if(window.location&&window.location.hostname){return window.location.hostname}return null},checkDomainName:function(d){return window.location.hostname.indexOf(d)!==-1},updateQueryString:function(f,h,k,e){if(typeof k==="undefined"){k=false}if(typeof e==="undefined"||e===""){e=window.location.href}var d="";var g=new RegExp("([?|&])"+f+"=.*?(&|#|$)(.*)","gi");if(g.test(e)){if(typeof h!=="undefined"&&h!==null){d=e.replace(g,"$1"+f+"="+h+"$2$3")}else{d=e.replace(g,"$1$3").replace(/(&|\?)$/,"")}}else{if(typeof h!=="undefined"&&h!==null){var j=e.indexOf("?")!==-1?"&":"?";var i=e.split("#");e=i[0]+j+f+"="+h;if(i[1]){e+="#"+i[1]}d=e}else{d=e}}if(k){window.location.href=d}else{return d}},getQueryString:function(h){if(typeof h==="undefined"){h=""}var e={};var d=location.search.substring(1).split("&");for(var g in d){var f=d[g].split("=");if(f.length>1){if(h&&h==this.decodeURI(f[0])){return this.decodeURI(f[1])}else{e[this.decodeURI(f[0])]=this.decodeURI(f[1])}}}return e},decodeURI:function(d){return decodeURIComponent(d.replace(/\+/g," "))}};b.Net.prototype.constructor=b.Net;b.TweenManager=function(d){this.game=d;this._tweens=[];this._add=[];this.game.onPause.add(this._pauseAll,this);this.game.onResume.add(this._resumeAll,this)};b.TweenManager.prototype={getAll:function(){return this._tweens},removeAll:function(){for(var d=0;d<this._tweens.length;d++){this._tweens[d].pendingDelete=true}this._add=[]},add:function(d){d._manager=this;this._add.push(d)},create:function(d){return new b.Tween(d,this.game,this)},remove:function(e){var d=this._tweens.indexOf(e);if(d!==-1){this._tweens[d].pendingDelete=true}else{d=this._add.indexOf(e);if(d!==-1){this._add[d].pendingDelete=true}}},update:function(){var f=this._add.length;var e=this._tweens.length;if(e===0&&f===0){return false}var d=0;while(d<e){if(this._tweens[d].update(this.game.time.now)){d++}else{this._tweens.splice(d,1);e--}}if(f>0){this._tweens=this._tweens.concat(this._add);this._add.length=0}return true},isTweening:function(d){return this._tweens.some(function(e){return e._object===d})},_pauseAll:function(){for(var d=this._tweens.length-1;d>=0;d--){this._tweens[d]._pause()}},_resumeAll:function(){for(var d=this._tweens.length-1;d>=0;d--){this._tweens[d]._resume()}},pauseAll:function(){for(var d=this._tweens.length-1;d>=0;d--){this._tweens[d].pause()}},resumeAll:function(){for(var d=this._tweens.length-1;d>=0;d--){this._tweens[d].resume(true)}}};b.TweenManager.prototype.constructor=b.TweenManager;b.Tween=function(e,d,f){this._object=e;this.game=d;this._manager=f;this._valuesStart={};this._valuesEnd={};this._valuesStartRepeat={};this._duration=1000;this._repeat=0;this._yoyo=false;this._reversed=false;this._delayTime=0;this._startTime=null;this._easingFunction=b.Easing.Linear.None;this._interpolationFunction=b.Math.linearInterpolation;this._chainedTweens=[];this._onStartCallbackFired=false;this._onUpdateCallback=null;this._onUpdateCallbackContext=null;this._paused=false;this._pausedTime=0;this._codePaused=false;this.pendingDelete=false;this.onStart=new b.Signal();this.onLoop=new b.Signal();this.onComplete=new b.Signal();this.isRunning=false};b.Tween.prototype={to:function(g,j,k,f,e,i,h){j=j||1000;k=k||null;f=f||false;e=e||0;i=i||0;h=h||false;if(h&&i===0){i=1}var d;if(this._parent){d=this._manager.create(this._object);this._lastChild.chain(d);this._lastChild=d}else{d=this;this._parent=this;this._lastChild=this}d._repeat=i;d._duration=j;d._valuesEnd=g;if(k!==null){d._easingFunction=k}if(e>0){d._delayTime=e}d._yoyo=h;if(f){return this.start()}else{return this}},from:function(k,h,g,l,i,e,j){var f={};for(var d in k){f[d]=this._object[d];this._object[d]=k[d]}return this.to(f,h,g,l,i,e,j)},start:function(){if(this.game===null||this._object===null){return}this._manager.add(this);this.isRunning=true;this._onStartCallbackFired=false;this._startTime=this.game.time.now+this._delayTime;for(var d in this._valuesEnd){if(Array.isArray(this._valuesEnd[d])){if(this._valuesEnd[d].length===0){continue}this._valuesEnd[d]=[this._object[d]].concat(this._valuesEnd[d])}this._valuesStart[d]=this._object[d];if(!Array.isArray(this._valuesStart[d])){this._valuesStart[d]*=1}this._valuesStartRepeat[d]=this._valuesStart[d]||0}return this},generateData:function(p,j){if(this.game===null||this._object===null){return null}this._startTime=0;for(var n in this._valuesEnd){if(Array.isArray(this._valuesEnd[n])){if(this._valuesEnd[n].length===0){continue}this._valuesEnd[n]=[this._object[n]].concat(this._valuesEnd[n])}this._valuesStart[n]=this._object[n];if(!Array.isArray(this._valuesStart[n])){this._valuesStart[n]*=1}this._valuesStartRepeat[n]=this._valuesStart[n]||0}var g=0;var l=Math.floor(p*(this._duration/1000));var k=this._duration/l;var f=[];while(l--){var n;var o=(g-this._startTime)/this._duration;o=o>1?1:o;var m=this._easingFunction(o);var d={};for(n in this._valuesEnd){var e=this._valuesStart[n]||0;var h=this._valuesEnd[n];if(h instanceof Array){d[n]=this._interpolationFunction(h,m)}else{if(typeof(h)==="string"){h=e+parseFloat(h,10)}if(typeof(h)==="number"){d[n]=e+(h-e)*m}}}f.push(d);g+=k}if(this._yoyo){var i=f.slice();i.reverse();f=f.concat(i)}if(typeof j!=="undefined"){j=j.concat(f);return j}else{return f}},stop:function(){this.isRunning=false;this._onUpdateCallback=null;this._manager.remove(this);return this},delay:function(d){this._delayTime=d;return this},repeat:function(d){this._repeat=d;return this},yoyo:function(d){this._yoyo=d;if(d&&this._repeat===0){this._repeat=1}return this},easing:function(d){this._easingFunction=d;return this},interpolation:function(d){this._interpolationFunction=d;return this},chain:function(){this._chainedTweens=arguments;return this},loop:function(){this._lastChild.chain(this);return this},onUpdateCallback:function(e,d){this._onUpdateCallback=e;this._onUpdateCallbackContext=d;return this},pause:function(){this._codePaused=true;this._paused=true;this._pausedTime=this.game.time.now},_pause:function(){if(!this._codePaused){this._paused=true;this._pausedTime=this.game.time.now}},resume:function(){if(this._paused){this._paused=false;this._codePaused=false;this._startTime+=(this.game.time.now-this._pausedTime)}},_resume:function(){if(this._codePaused){return}else{this._startTime+=this.game.time.pauseDuration;this._paused=false}},update:function(e){if(this.pendingDelete){return false}if(this._paused||e<this._startTime){return true}var l;if(e<this._startTime){return true}if(this._onStartCallbackFired===false){this.onStart.dispatch(this._object);this._onStartCallbackFired=true}var m=(e-this._startTime)/this._duration;m=m>1?1:m;var k=this._easingFunction(m);for(l in this._valuesEnd){var d=this._valuesStart[l]||0;var f=this._valuesEnd[l];if(f instanceof Array){this._object[l]=this._interpolationFunction(f,k)}else{if(typeof(f)==="string"){f=d+parseFloat(f,10)}if(typeof(f)==="number"){this._object[l]=d+(f-d)*k}}}if(this._onUpdateCallback!==null){this._onUpdateCallback.call(this._onUpdateCallbackContext,this,k);if(!this.isRunning){return false}}if(m==1){if(this._repeat>0){if(isFinite(this._repeat)){this._repeat--}for(l in this._valuesStartRepeat){if(typeof(this._valuesEnd[l])==="string"){this._valuesStartRepeat[l]=this._valuesStartRepeat[l]+parseFloat(this._valuesEnd[l],10)}if(this._yoyo){var g=this._valuesStartRepeat[l];this._valuesStartRepeat[l]=this._valuesEnd[l];this._valuesEnd[l]=g}this._valuesStart[l]=this._valuesStartRepeat[l]}if(this._yoyo){this._reversed=!this._reversed}this._startTime=e+this._delayTime;this.onLoop.dispatch(this._object);return true}else{this.isRunning=false;this.onComplete.dispatch(this._object);for(var h=0,j=this._chainedTweens.length;h<j;h++){this._chainedTweens[h].start(e)}return false}}return true}};b.Tween.prototype.constructor=b.Tween;b.Easing={Linear:{None:function(d){return d}},Quadratic:{In:function(d){return d*d},Out:function(d){return d*(2-d)},InOut:function(d){if((d*=2)<1){return 0.5*d*d}return -0.5*(--d*(d-2)-1)}},Cubic:{In:function(d){return d*d*d},Out:function(d){return --d*d*d+1},InOut:function(d){if((d*=2)<1){return 0.5*d*d*d}return 0.5*((d-=2)*d*d+2)}},Quartic:{In:function(d){return d*d*d*d},Out:function(d){return 1-(--d*d*d*d)},InOut:function(d){if((d*=2)<1){return 0.5*d*d*d*d}return -0.5*((d-=2)*d*d*d-2)}},Quintic:{In:function(d){return d*d*d*d*d},Out:function(d){return --d*d*d*d*d+1},InOut:function(d){if((d*=2)<1){return 0.5*d*d*d*d*d}return 0.5*((d-=2)*d*d*d*d+2)}},Sinusoidal:{In:function(d){return 1-Math.cos(d*Math.PI/2)},Out:function(d){return Math.sin(d*Math.PI/2)},InOut:function(d){return 0.5*(1-Math.cos(Math.PI*d))}},Exponential:{In:function(d){return d===0?0:Math.pow(1024,d-1)},Out:function(d){return d===1?1:1-Math.pow(2,-10*d)},InOut:function(d){if(d===0){return 0}if(d===1){return 1}if((d*=2)<1){return 0.5*Math.pow(1024,d-1)}return 0.5*(-Math.pow(2,-10*(d-1))+2)}},Circular:{In:function(d){return 1-Math.sqrt(1-d*d)},Out:function(d){return Math.sqrt(1-(--d*d))},InOut:function(d){if((d*=2)<1){return -0.5*(Math.sqrt(1-d*d)-1)}return 0.5*(Math.sqrt(1-(d-=2)*d)+1)}},Elastic:{In:function(e){var f,d=0.1,g=0.4;if(e===0){return 0}if(e===1){return 1}if(!d||d<1){d=1;f=g/4}else{f=g*Math.asin(1/d)/(2*Math.PI)}return -(d*Math.pow(2,10*(e-=1))*Math.sin((e-f)*(2*Math.PI)/g))},Out:function(e){var f,d=0.1,g=0.4;if(e===0){return 0}if(e===1){return 1}if(!d||d<1){d=1;f=g/4}else{f=g*Math.asin(1/d)/(2*Math.PI)}return(d*Math.pow(2,-10*e)*Math.sin((e-f)*(2*Math.PI)/g)+1)},InOut:function(e){var f,d=0.1,g=0.4;if(e===0){return 0}if(e===1){return 1}if(!d||d<1){d=1;f=g/4}else{f=g*Math.asin(1/d)/(2*Math.PI)}if((e*=2)<1){return -0.5*(d*Math.pow(2,10*(e-=1))*Math.sin((e-f)*(2*Math.PI)/g))}return d*Math.pow(2,-10*(e-=1))*Math.sin((e-f)*(2*Math.PI)/g)*0.5+1}},Back:{In:function(d){var e=1.70158;return d*d*((e+1)*d-e)},Out:function(d){var e=1.70158;return --d*d*((e+1)*d+e)+1},InOut:function(d){var e=1.70158*1.525;if((d*=2)<1){return 0.5*(d*d*((e+1)*d-e))}return 0.5*((d-=2)*d*((e+1)*d+e)+2)}},Bounce:{In:function(d){return 1-b.Easing.Bounce.Out(1-d)},Out:function(d){if(d<(1/2.75)){return 7.5625*d*d}else{if(d<(2/2.75)){return 7.5625*(d-=(1.5/2.75))*d+0.75}else{if(d<(2.5/2.75)){return 7.5625*(d-=(2.25/2.75))*d+0.9375}else{return 7.5625*(d-=(2.625/2.75))*d+0.984375}}}},InOut:function(d){if(d<0.5){return b.Easing.Bounce.In(d*2)*0.5}return b.Easing.Bounce.Out(d*2-1)*0.5+0.5}}};b.Time=function(d){this.game=d;this.time=0;this.now=0;this.elapsed=0;this.pausedTime=0;this.advancedTiming=false;this.fps=0;this.fpsMin=1000;this.fpsMax=0;this.msMin=1000;this.msMax=0;this.physicsElapsed=0;this.deltaCap=0;this.timeCap=1000;this.frames=0;this.pauseDuration=0;this.timeToCall=0;this.lastTime=0;this.events=new b.Timer(this.game,false);this._started=0;this._timeLastSecond=0;this._pauseStarted=0;this._justResumed=false;this._timers=[];this._len=0;this._i=0};b.Time.prototype={boot:function(){this._started=Date.now();this.events.start()},add:function(d){this._timers.push(d);return d},create:function(d){if(typeof d==="undefined"){d=true}var e=new b.Timer(this.game,d);this._timers.push(e);return e},removeAll:function(){for(var d=0;d<this._timers.length;d++){this._timers[d].destroy()}this._timers=[];this.events.removeAll()},update:function(d){this.now=d;this.timeToCall=this.game.math.max(0,16-(d-this.lastTime));this.elapsed=this.now-this.time;if(this.elapsed>this.timeCap){this.elapsed=1/60}this.physicsElapsed=this.elapsed/1000||1/60;if(this.deltaCap>0&&this.physicsElapsed>this.deltaCap){this.physicsElapsed=this.deltaCap}if(this.advancedTiming){this.msMin=this.game.math.min(this.msMin,this.elapsed);this.msMax=this.game.math.max(this.msMax,this.elapsed);this.frames++;if(this.now>this._timeLastSecond+1000){this.fps=Math.round((this.frames*1000)/(this.now-this._timeLastSecond));this.fpsMin=this.game.math.min(this.fpsMin,this.fps);this.fpsMax=this.game.math.max(this.fpsMax,this.fps);this._timeLastSecond=this.now;this.frames=0}}this.time=this.now;this.lastTime=d+this.timeToCall;if(!this.game.paused){this.events.update(this.now);this._i=0;this._len=this._timers.length;while(this._i<this._len){if(this._timers[this._i].update(this.now)){this._i++}else{this._timers.splice(this._i,1);this._len--}}}},gamePaused:function(){this._pauseStarted=this.now;this.events.pause();var d=this._timers.length;while(d--){this._timers[d]._pause()}},gameResumed:function(){this.time=this.now=Date.now();this.pauseDuration=this.time-this._pauseStarted;this.events.resume();var d=this._timers.length;while(d--){this._timers[d]._resume()}},totalElapsedSeconds:function(){return(this.now-this._started)*0.001},elapsedSince:function(d){return this.now-d},elapsedSecondsSince:function(d){return(this.now-d)*0.001},reset:function(){this._started=this.now;this.removeAll()}};b.Time.prototype.constructor=b.Time;b.Timer=function(d,e){if(typeof e==="undefined"){e=true}this.game=d;this.running=false;this.autoDestroy=e;this.expired=false;this.elapsed=0;this.events=[];this.onComplete=new b.Signal();this.nextTick=0;this.timeCap=1000;this.paused=false;this._codePaused=false;this._started=0;this._pauseStarted=0;this._pauseTotal=0;this._now=Date.now();this._len=0;this._marked=0;this._i=0;this._diff=0;this._newTick=0};b.Timer.MINUTE=60000;b.Timer.SECOND=1000;b.Timer.HALF=500;b.Timer.QUARTER=250;b.Timer.prototype={create:function(h,d,f,k,e,g){var i=h;if(this._now===0){i+=this.game.time.now}else{i+=this._now}var j=new b.TimerEvent(this,h,i,f,d,k,e,g);this.events.push(j);this.order();this.expired=false;return j},add:function(e,f,d){return this.create(e,false,0,f,d,Array.prototype.splice.call(arguments,3))},repeat:function(f,e,g,d){return this.create(f,false,e,g,d,Array.prototype.splice.call(arguments,4))},loop:function(e,f,d){return this.create(e,true,0,f,d,Array.prototype.splice.call(arguments,3))},start:function(d){if(this.running){return}this._started=this.game.time.now+(d||0);this.running=true;for(var e=0;e<this.events.length;e++){this.events[e].tick=this.events[e].delay+this._started}},stop:function(d){this.running=false;if(typeof d==="undefined"){d=true}if(d){this.events.length=0}},remove:function(e){for(var d=0;d<this.events.length;d++){if(this.events[d]===e){this.events[d].pendingDelete=true;return true}}return false},order:function(){if(this.events.length>0){this.events.sort(this.sortHandler);this.nextTick=this.events[0].tick}},sortHandler:function(e,d){if(e.tick<d.tick){return -1}else{if(e.tick>d.tick){return 1}}return 0},clearPendingEvents:function(){this._i=this.events.length;while(this._i--){if(this.events[this._i].pendingDelete){this.events.splice(this._i,1)}}this._len=this.events.length;this._i=0},update:function(d){if(this.paused){return true}this.elapsed=d-this._now;this._now=d;if(this.elapsed>this.timeCap){this.adjustEvents(d-this.elapsed)}this._marked=0;this.clearPendingEvents();if(this.running&&this._now>=this.nextTick&&this._len>0){while(this._i<this._len&&this.running){if(this._now>=this.events[this._i].tick){this._newTick=(this._now+this.events[this._i].delay)-(this._now-this.events[this._i].tick);if(this._newTick<0){this._newTick=this._now+this.events[this._i].delay}if(this.events[this._i].loop===true){this.events[this._i].tick=this._newTick;this.events[this._i].callback.apply(this.events[this._i].callbackContext,this.events[this._i].args)}else{if(this.events[this._i].repeatCount>0){this.events[this._i].repeatCount--;this.events[this._i].tick=this._newTick;this.events[this._i].callback.apply(this.events[this._i].callbackContext,this.events[this._i].args)}else{this._marked++;this.events[this._i].pendingDelete=true;this.events[this._i].callback.apply(this.events[this._i].callbackContext,this.events[this._i].args)}}this._i++}else{break}}if(this.events.length>this._marked){this.order()}else{this.expired=true;this.onComplete.dispatch(this)}}if(this.expired&&this.autoDestroy){return false}else{return true}},pause:function(){if(!this.running){return}this._codePaused=true;if(this.paused){return}this._pauseStarted=this.game.time.now;this.paused=true},_pause:function(){if(this.paused||!this.running){return}this._pauseStarted=this.game.time.now;this.paused=true},adjustEvents:function(h){for(var f=0;f<this.events.length;f++){if(!this.events[f].pendingDelete){var e=this.events[f].tick-h;if(e<0){e=0}this.events[f].tick=this._now+e}}var g=this.nextTick-h;if(g<0){this.nextTick=this._now}else{this.nextTick=this._now+g}},resume:function(){if(!this.paused){return}var d=this.game.time.now;this._pauseTotal+=d-this._now;this._now=d;this.adjustEvents(this._pauseStarted);this.paused=false;this._codePaused=false},_resume:function(){if(this._codePaused){return}else{this.resume()}},removeAll:function(){this.onComplete.removeAll();this.events.length=0;this._len=0;this._i=0},destroy:function(){this.onComplete.removeAll();this.running=false;this.events=[];this._len=0;this._i=0}};Object.defineProperty(b.Timer.prototype,"next",{get:function(){return this.nextTick}});Object.defineProperty(b.Timer.prototype,"duration",{get:function(){if(this.running&&this.nextTick>this._now){return this.nextTick-this._now}else{return 0}}});Object.defineProperty(b.Timer.prototype,"length",{get:function(){return this.events.length}});Object.defineProperty(b.Timer.prototype,"ms",{get:function(){if(this.running){return this._now-this._started-this._pauseTotal}else{return 0}}});Object.defineProperty(b.Timer.prototype,"seconds",{get:function(){if(this.running){return this.ms*0.001}else{return 0}}});b.Timer.prototype.constructor=b.Timer;b.TimerEvent=function(k,h,i,f,d,j,e,g){this.timer=k;this.delay=h;this.tick=i;this.repeatCount=f-1;this.loop=d;this.callback=j;this.callbackContext=e;this.args=g;this.pendingDelete=false};b.TimerEvent.prototype.constructor=b.TimerEvent;b.AnimationManager=function(d){this.sprite=d;this.game=d.game;this.currentFrame=null;this.currentAnim=null;this.updateIfVisible=true;this.isLoaded=false;this._frameData=null;this._anims={};this._outputFrames=[]};b.AnimationManager.prototype={loadFrameData:function(d,f){if(this.isLoaded){for(var e in this._anims){this._anims[e].updateFrameData(d)}}this._frameData=d;if(typeof f==="undefined"||f===null){this.frame=0}else{if(typeof f==="string"){this.frameName=f}else{this.frame=f}}this.isLoaded=true;if(this._frameData){return true}else{return false}},add:function(g,h,f,e,d){if(this._frameData===null){console.warn("No FrameData available for Phaser.Animation "+g);return}h=h||[];f=f||60;if(typeof e==="undefined"){e=false}if(typeof d==="undefined"){if(h&&typeof h[0]==="number"){d=true}else{d=false}}if(this.sprite.events.onAnimationStart===null){this.sprite.events.onAnimationStart=new b.Signal();this.sprite.events.onAnimationComplete=new b.Signal();this.sprite.events.onAnimationLoop=new b.Signal()}this._outputFrames.length=0;this._frameData.getFrameIndexes(h,d,this._outputFrames);this._anims[g]=new b.Animation(this.game,this.sprite,g,this._frameData,this._outputFrames,f,e);this.currentAnim=this._anims[g];this.currentFrame=this.currentAnim.currentFrame;if(this.sprite.__tilePattern){this.sprite.__tilePattern=false;this.tilingTexture=false}return this._anims[g]},validateFrames:function(f,d){if(typeof d=="undefined"){d=true}for(var e=0;e<f.length;e++){if(d===true){if(f[e]>this._frameData.total){return false}}else{if(this._frameData.checkFrameName(f[e])===false){return false}}}return true},play:function(g,f,e,d){if(this._anims[g]){if(this.currentAnim===this._anims[g]){if(this.currentAnim.isPlaying===false){this.currentAnim.paused=false;return this.currentAnim.play(f,e,d)}return this.currentAnim}else{if(this.currentAnim&&this.currentAnim.isPlaying){this.currentAnim.stop()}this.currentAnim=this._anims[g];this.currentAnim.paused=false;this.currentFrame=this.currentAnim.currentFrame;return this.currentAnim.play(f,e,d)}}},stop:function(e,d){if(typeof d=="undefined"){d=false}if(typeof e=="string"){if(this._anims[e]){this.currentAnim=this._anims[e];this.currentAnim.stop(d)}}else{if(this.currentAnim){this.currentAnim.stop(d)}}},update:function(){if(this.updateIfVisible&&!this.sprite.visible){return false}if(this.currentAnim&&this.currentAnim.update()===true){this.currentFrame=this.currentAnim.currentFrame;return true}return false},next:function(d){if(this.currentAnim){this.currentAnim.next(d);this.currentFrame=this.currentAnim.currentFrame}},previous:function(d){if(this.currentAnim){this.currentAnim.previous(d);this.currentFrame=this.currentAnim.currentFrame}},getAnimation:function(d){if(typeof d==="string"){if(this._anims[d]){return this._anims[d]}}return null},refreshFrame:function(){this.sprite.setTexture(PIXI.TextureCache[this.currentFrame.uuid]);if(this.sprite.__tilePattern){this.__tilePattern=false;this.tilingTexture=false}},destroy:function(){var d=null;for(var d in this._anims){if(this._anims.hasOwnProperty(d)){this._anims[d].destroy()}}this._anims={};this._frameData=null;this._frameIndex=0;this.currentAnim=null;this.currentFrame=null}};b.AnimationManager.prototype.constructor=b.AnimationManager;Object.defineProperty(b.AnimationManager.prototype,"frameData",{get:function(){return this._frameData}});Object.defineProperty(b.AnimationManager.prototype,"frameTotal",{get:function(){if(this._frameData){return this._frameData.total}else{return -1}}});Object.defineProperty(b.AnimationManager.prototype,"paused",{get:function(){return this.currentAnim.isPaused},set:function(d){this.currentAnim.paused=d}});Object.defineProperty(b.AnimationManager.prototype,"frame",{get:function(){if(this.currentFrame){return this._frameIndex}},set:function(d){if(typeof d==="number"&&this._frameData&&this._frameData.getFrame(d)!==null){this.currentFrame=this._frameData.getFrame(d);if(this.currentFrame){this._frameIndex=d;this.sprite.setFrame(this.currentFrame);if(this.sprite.__tilePattern){this.__tilePattern=false;this.tilingTexture=false}}}}});Object.defineProperty(b.AnimationManager.prototype,"frameName",{get:function(){if(this.currentFrame){return this.currentFrame.name}},set:function(d){if(typeof d==="string"&&this._frameData&&this._frameData.getFrameByName(d)!==null){this.currentFrame=this._frameData.getFrameByName(d);if(this.currentFrame){this._frameIndex=this.currentFrame.index;this.sprite.setFrame(this.currentFrame);if(this.sprite.__tilePattern){this.__tilePattern=false;this.tilingTexture=false}}}else{console.warn("Cannot set frameName: "+d)}}});b.Animation=function(e,i,g,h,j,f,d){this.game=e;this._parent=i;this._frameData=h;this.name=g;this._frames=[];this._frames=this._frames.concat(j);this.delay=1000/f;this.loop=d;this.loopCount=0;this.killOnComplete=false;this.isFinished=false;this.isPlaying=false;this.isPaused=false;this._pauseStartTime=0;this._frameIndex=0;this._frameDiff=0;this._frameSkip=1;this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);this.onStart=new b.Signal();this.onComplete=new b.Signal();this.onLoop=new b.Signal();this.game.onPause.add(this.onPause,this);this.game.onResume.add(this.onResume,this)};b.Animation.prototype={play:function(f,e,d){if(typeof f==="number"){this.delay=1000/f}if(typeof e==="boolean"){this.loop=e}if(typeof d!=="undefined"){this.killOnComplete=d}this.isPlaying=true;this.isFinished=false;this.paused=false;this.loopCount=0;this._timeLastFrame=this.game.time.now;this._timeNextFrame=this.game.time.now+this.delay;this._frameIndex=0;this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);this._parent.setFrame(this.currentFrame);if(this._parent.__tilePattern){this._parent.__tilePattern=false;this._parent.tilingTexture=false}this._parent.events.onAnimationStart.dispatch(this._parent,this);this.onStart.dispatch(this._parent,this);return this},restart:function(){this.isPlaying=true;this.isFinished=false;this.paused=false;this.loopCount=0;this._timeLastFrame=this.game.time.now;this._timeNextFrame=this.game.time.now+this.delay;this._frameIndex=0;this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);this._parent.setFrame(this.currentFrame);this.onStart.dispatch(this._parent,this)},setFrame:function(f,d){var g;if(typeof d==="undefined"){d=false}if(typeof f==="string"){for(var e=0;e<this._frames.length;e++){if(this._frameData.getFrame(this._frames[e]).name===f){g=e}}}else{if(typeof f==="number"){if(d){g=f}else{for(var e=0;e<this._frames.length;e++){if(this.frames[e]===g){g=e}}}}}if(g){this._frameIndex=g-1;this._timeNextFrame=this.game.time.now;this.update()}},stop:function(d,e){if(typeof d==="undefined"){d=false}if(typeof e==="undefined"){e=false}this.isPlaying=false;this.isFinished=true;this.paused=false;if(d){this.currentFrame=this._frameData.getFrame(this._frames[0]);this._parent.setFrame(this.currentFrame)}if(e){this._parent.events.onAnimationComplete.dispatch(this._parent,this);this.onComplete.dispatch(this._parent,this)}},onPause:function(){if(this.isPlaying){this._frameDiff=this._timeNextFrame-this.game.time.now}},onResume:function(){if(this.isPlaying){this._timeNextFrame=this.game.time.now+this._frameDiff}},update:function(){if(this.isPaused){return false}if(this.isPlaying&&this.game.time.now>=this._timeNextFrame){this._frameSkip=1;this._frameDiff=this.game.time.now-this._timeNextFrame;this._timeLastFrame=this.game.time.now;if(this._frameDiff>this.delay){this._frameSkip=Math.floor(this._frameDiff/this.delay);this._frameDiff-=(this._frameSkip*this.delay)}this._timeNextFrame=this.game.time.now+(this.delay-this._frameDiff);this._frameIndex+=this._frameSkip;if(this._frameIndex>=this._frames.length){if(this.loop){this._frameIndex%=this._frames.length;this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);this.loopCount++;this._parent.events.onAnimationLoop.dispatch(this._parent,this);this.onLoop.dispatch(this._parent,this)}else{this.complete()}}this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);if(this.currentFrame){this._parent.setFrame(this.currentFrame);if(this._parent.__tilePattern){this._parent.__tilePattern=false;this._parent.tilingTexture=false}}return true}return false},next:function(d){if(typeof d==="undefined"){d=1}var e=this._frameIndex+d;if(e>=this._frames.length){if(this.loop){e%=this._frames.length}else{e=this._frames.length-1}}if(e!==this._frameIndex){this._frameIndex=e;this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);if(this.currentFrame){this._parent.setFrame(this.currentFrame);if(this._parent.__tilePattern){this._parent.__tilePattern=false;this._parent.tilingTexture=false}}}},previous:function(d){if(typeof d==="undefined"){d=1}var e=this._frameIndex-d;if(e<0){if(this.loop){e=this._frames.length+e}else{e++}}if(e!==this._frameIndex){this._frameIndex=e;this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);if(this.currentFrame){this._parent.setFrame(this.currentFrame);if(this._parent.__tilePattern){this._parent.__tilePattern=false;this._parent.tilingTexture=false}}}},updateFrameData:function(d){this._frameData=d;this.currentFrame=this._frameData?this._frameData.getFrame(this._frames[this._frameIndex%this._frames.length]):null},destroy:function(){this.game.onPause.remove(this.onPause,this);this.game.onResume.remove(this.onResume,this);this.game=null;this._parent=null;this._frames=null;this._frameData=null;this.currentFrame=null;this.isPlaying=false;this.onStart.dispose();this.onLoop.dispose();this.onComplete.dispose()},complete:function(){this.isPlaying=false;this.isFinished=true;this.paused=false;this._parent.events.onAnimationComplete.dispatch(this._parent,this);this.onComplete.dispatch(this._parent,this);if(this.killOnComplete){this._parent.kill()}}};b.Animation.prototype.constructor=b.Animation;Object.defineProperty(b.Animation.prototype,"paused",{get:function(){return this.isPaused},set:function(d){this.isPaused=d;if(d){this._pauseStartTime=this.game.time.now}else{if(this.isPlaying){this._timeNextFrame=this.game.time.now+this.delay}}}});Object.defineProperty(b.Animation.prototype,"frameTotal",{get:function(){return this._frames.length}});Object.defineProperty(b.Animation.prototype,"frame",{get:function(){if(this.currentFrame!==null){return this.currentFrame.index}else{return this._frameIndex}},set:function(d){this.currentFrame=this._frameData.getFrame(this._frames[d]);if(this.currentFrame!==null){this._frameIndex=d;this._parent.setFrame(this.currentFrame)}}});Object.defineProperty(b.Animation.prototype,"speed",{get:function(){return Math.round(1000/this.delay)},set:function(d){if(d>=1){this.delay=1000/d}}});b.Animation.generateFrameNames=function(h,l,f,j,g){if(typeof j=="undefined"){j=""}var d=[];var k="";if(l<f){for(var e=l;e<=f;e++){if(typeof g=="number"){k=b.Utils.pad(e.toString(),g,"0",1)}else{k=e.toString()}k=h+k+j;d.push(k)}}else{for(var e=l;e>=f;e--){if(typeof g=="number"){k=b.Utils.pad(e.toString(),g,"0",1)}else{k=e.toString()}k=h+k+j;d.push(k)}}return d};b.Frame=function(g,e,j,i,d,f,h){this.index=g;this.x=e;this.y=j;this.width=i;this.height=d;this.name=f;this.uuid=h;this.centerX=Math.floor(i/2);this.centerY=Math.floor(d/2);this.distance=b.Math.distance(0,0,i,d);this.rotated=false;this.rotationDirection="cw";this.trimmed=false;this.sourceSizeW=i;this.sourceSizeH=d;this.spriteSourceSizeX=0;this.spriteSourceSizeY=0;this.spriteSourceSizeW=0;this.spriteSourceSizeH=0;this.right=this.x+this.width;this.bottom=this.y+this.height};b.Frame.prototype={setTrim:function(h,g,j,e,d,f,i){this.trimmed=h;if(h){this.sourceSizeW=g;this.sourceSizeH=j;this.centerX=Math.floor(g/2);this.centerY=Math.floor(j/2);this.spriteSourceSizeX=e;this.spriteSourceSizeY=d;this.spriteSourceSizeW=f;this.spriteSourceSizeH=i}},getRect:function(d){if(typeof d==="undefined"){d=new b.Rectangle(this.x,this.y,this.width,this.height)}else{d.setTo(this.x,this.y,this.width,this.height)}return d}};b.Frame.prototype.constructor=b.Frame;b.FrameData=function(){this._frames=[];this._frameNames=[]};b.FrameData.prototype={addFrame:function(d){d.index=this._frames.length;this._frames.push(d);if(d.name!==""){this._frameNames[d.name]=d.index}return d},getFrame:function(d){if(d>this._frames.length){d=0}return this._frames[d]},getFrameByName:function(d){if(typeof this._frameNames[d]==="number"){return this._frames[this._frameNames[d]]}return null},checkFrameName:function(d){if(this._frameNames[d]==null){return false}return true},getFrameRange:function(g,d,e){if(typeof e==="undefined"){e=[]}for(var f=g;f<=d;f++){e.push(this._frames[f])}return e},getFrames:function(h,e,f){if(typeof e==="undefined"){e=true}if(typeof f==="undefined"){f=[]}if(typeof h==="undefined"||h.length===0){for(var g=0;g<this._frames.length;g++){f.push(this._frames[g])}}else{for(var g=0,d=h.length;g<d;g++){if(e){f.push(this.getFrame(h[g]))}else{f.push(this.getFrameByName(h[g]))}}}return f},getFrameIndexes:function(h,e,f){if(typeof e==="undefined"){e=true}if(typeof f==="undefined"){f=[]}if(typeof h==="undefined"||h.length===0){for(var g=0,d=this._frames.length;g<d;g++){f.push(this._frames[g].index)}}else{for(var g=0,d=h.length;g<d;g++){if(e){f.push(h[g])}else{if(this.getFrameByName(h[g])){f.push(this.getFrameByName(h[g]).index)}}}}return f}};b.FrameData.prototype.constructor=b.FrameData;Object.defineProperty(b.FrameData.prototype,"total",{get:function(){return this._frames.length}});b.AnimationParser={spriteSheet:function(r,t,n,g,q,k,e){var v=r.cache.getImage(t);if(v==null){return null}var m=v.width;var l=v.height;if(n<=0){n=Math.floor(-m/Math.min(-1,n))}if(g<=0){g=Math.floor(-l/Math.min(-1,g))}var f=Math.floor((m-k)/(n+e));var d=Math.floor((l-k)/(g+e));var u=f*d;if(q!==-1){u=q}if(m===0||l===0||m<n||l<g||u===0){console.warn("Phaser.AnimationParser.spriteSheet: '"+t+"'s width/height zero or width/height < given frameWidth/frameHeight");return null}var s=new b.FrameData();var j=k;var h=k;for(var p=0;p<u;p++){var o=r.rnd.uuid();s.addFrame(new b.Frame(p,j,h,n,g,"",o));PIXI.TextureCache[o]=new PIXI.Texture(PIXI.BaseTextureCache[t],{x:j,y:h,width:n,height:g});j+=n+e;if(j+n>m){j=k;h+=g+e}}return s},JSONData:function(d,f,k){if(!f.frames){console.warn("Phaser.AnimationParser.JSONData: Invalid Texture Atlas JSON given, missing 'frames' array");console.log(f);return}var h=new b.FrameData();var j=f.frames;var l;for(var e=0;e<j.length;e++){var g=d.rnd.uuid();l=h.addFrame(new b.Frame(e,j[e].frame.x,j[e].frame.y,j[e].frame.w,j[e].frame.h,j[e].filename,g));PIXI.TextureCache[g]=new PIXI.Texture(PIXI.BaseTextureCache[k],{x:j[e].frame.x,y:j[e].frame.y,width:j[e].frame.w,height:j[e].frame.h});if(j[e].trimmed){l.setTrim(j[e].trimmed,j[e].sourceSize.w,j[e].sourceSize.h,j[e].spriteSourceSize.x,j[e].spriteSourceSize.y,j[e].spriteSourceSize.w,j[e].spriteSourceSize.h)}}return h},JSONDataHash:function(l,m,h){if(!m.frames){console.warn("Phaser.AnimationParser.JSONDataHash: Invalid Texture Atlas JSON given, missing 'frames' object");console.log(m);return}var e=new b.FrameData();var j=m.frames;var g;var f=0;for(var k in j){var d=l.rnd.uuid();g=e.addFrame(new b.Frame(f,j[k].frame.x,j[k].frame.y,j[k].frame.w,j[k].frame.h,k,d));PIXI.TextureCache[d]=new PIXI.Texture(PIXI.BaseTextureCache[h],{x:j[k].frame.x,y:j[k].frame.y,width:j[k].frame.w,height:j[k].frame.h});if(j[k].trimmed){g.setTrim(j[k].trimmed,j[k].sourceSize.w,j[k].sourceSize.h,j[k].spriteSourceSize.x,j[k].spriteSourceSize.y,j[k].spriteSourceSize.w,j[k].spriteSourceSize.h)}f++}return e},XMLData:function(t,f,g){if(!f.getElementsByTagName("TextureAtlas")){console.warn("Phaser.AnimationParser.XMLData: Invalid Texture Atlas XML given, missing <TextureAtlas> tag");return}var u=new b.FrameData();var m=f.getElementsByTagName("SubTexture");var h;var s;var v;var n;var l;var k;var p;var o;var e;var d;var q;var j;for(var r=0;r<m.length;r++){s=t.rnd.uuid();n=m[r].attributes;v=n.name.nodeValue;l=parseInt(n.x.nodeValue,10);k=parseInt(n.y.nodeValue,10);p=parseInt(n.width.nodeValue,10);o=parseInt(n.height.nodeValue,10);e=null;d=null;if(n.frameX){e=Math.abs(parseInt(n.frameX.nodeValue,10));d=Math.abs(parseInt(n.frameY.nodeValue,10));q=parseInt(n.frameWidth.nodeValue,10);j=parseInt(n.frameHeight.nodeValue,10)}h=u.addFrame(new b.Frame(r,l,k,p,o,v,s));PIXI.TextureCache[s]=new PIXI.Texture(PIXI.BaseTextureCache[g],{x:l,y:k,width:p,height:o});if(e!==null||d!==null){h.setTrim(true,p,o,e,d,q,j)}}return u}};b.Cache=function(d){this.game=d;this._canvases={};this._images={};this._textures={};this._sounds={};this._text={};this._json={};this._physics={};this._tilemaps={};this._binary={};this._bitmapDatas={};this._bitmapFont={};this.addDefaultImage();this.addMissingImage();this.onSoundUnlock=new b.Signal();this._cacheMap=[];this._cacheMap[b.Cache.CANVAS]=this._canvases;this._cacheMap[b.Cache.IMAGE]=this._images;this._cacheMap[b.Cache.TEXTURE]=this._textures;this._cacheMap[b.Cache.SOUND]=this._sounds;this._cacheMap[b.Cache.TEXT]=this._text;this._cacheMap[b.Cache.PHYSICS]=this._physics;this._cacheMap[b.Cache.TILEMAP]=this._tilemaps;this._cacheMap[b.Cache.BINARY]=this._binary;this._cacheMap[b.Cache.BITMAPDATA]=this._bitmapDatas;this._cacheMap[b.Cache.BITMAPFONT]=this._bitmapFont;this._cacheMap[b.Cache.JSON]=this._json};b.Cache.CANVAS=1;b.Cache.IMAGE=2;b.Cache.TEXTURE=3;b.Cache.SOUND=4;b.Cache.TEXT=5;b.Cache.PHYSICS=6;b.Cache.TILEMAP=7;b.Cache.BINARY=8;b.Cache.BITMAPDATA=9;b.Cache.BITMAPFONT=10;b.Cache.JSON=11;b.Cache.prototype={addCanvas:function(f,d,e){this._canvases[f]={canvas:d,context:e}},addBinary:function(e,d){this._binary[e]=d},addBitmapData:function(d,e){this._bitmapDatas[d]=e;return e},addRenderTexture:function(d,e){var f=new b.Frame(0,0,0,e.width,e.height,"","");this._textures[d]={texture:e,frame:f}},addSpriteSheet:function(g,f,i,d,e,j,h,k){this._images[g]={url:f,data:i,spriteSheet:true,frameWidth:d,frameHeight:e,margin:h,spacing:k};PIXI.BaseTextureCache[g]=new PIXI.BaseTexture(i);PIXI.TextureCache[g]=new PIXI.Texture(PIXI.BaseTextureCache[g]);this._images[g].frameData=b.AnimationParser.spriteSheet(this.game,g,d,e,j,h,k)},addTilemap:function(e,d,g,f){this._tilemaps[e]={url:d,data:g,format:f}},addTextureAtlas:function(f,e,g,d,h){this._images[f]={url:e,data:g,spriteSheet:true};PIXI.BaseTextureCache[f]=new PIXI.BaseTexture(g);PIXI.TextureCache[f]=new PIXI.Texture(PIXI.BaseTextureCache[f]);if(h==b.Loader.TEXTURE_ATLAS_JSON_ARRAY){this._images[f].frameData=b.AnimationParser.JSONData(this.game,d,f)}else{if(h==b.Loader.TEXTURE_ATLAS_JSON_HASH){this._images[f].frameData=b.AnimationParser.JSONDataHash(this.game,d,f)}else{if(h==b.Loader.TEXTURE_ATLAS_XML_STARLING){this._images[f].frameData=b.AnimationParser.XMLData(this.game,d,f)}}}},addBitmapFont:function(e,d,i,f,h,g){this._images[e]={url:d,data:i,spriteSheet:true};PIXI.BaseTextureCache[e]=new PIXI.BaseTexture(i);PIXI.TextureCache[e]=new PIXI.Texture(PIXI.BaseTextureCache[e]);b.LoaderParser.bitmapFont(this.game,f,e,h,g)},addPhysicsData:function(e,d,f,g){this._physics[e]={url:d,data:f,format:g}},addDefaultImage:function(){var d=new Image();d.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgAQMAAABJtOi3AAAAA1BMVEX///+nxBvIAAAAAXRSTlMAQObYZgAAABVJREFUeF7NwIEAAAAAgKD9qdeocAMAoAABm3DkcAAAAABJRU5ErkJggg==";this._images.__default={url:null,data:d,spriteSheet:false};this._images.__default.frame=new b.Frame(0,0,0,32,32,"","");PIXI.BaseTextureCache.__default=new PIXI.BaseTexture(d);PIXI.TextureCache.__default=new PIXI.Texture(PIXI.BaseTextureCache.__default)},addMissingImage:function(){var d=new Image();d.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJ9JREFUeNq01ssOwyAMRFG46v//Mt1ESmgh+DFmE2GPOBARKb2NVjo+17PXLD8a1+pl5+A+wSgFygymWYHBb0FtsKhJDdZlncG2IzJ4ayoMDv20wTmSMzClEgbWYNTAkQ0Z+OJ+A/eWnAaR9+oxCF4Os0H8htsMUp+pwcgBBiMNnAwF8GqIgL2hAzaGFFgZauDPKABmowZ4GL369/0rwACp2yA/ttmvsQAAAABJRU5ErkJggg==";this._images.__missing={url:null,data:d,spriteSheet:false};this._images.__missing.frame=new b.Frame(0,0,0,32,32,"","");PIXI.BaseTextureCache.__missing=new PIXI.BaseTexture(d);PIXI.TextureCache.__missing=new PIXI.Texture(PIXI.BaseTextureCache.__missing)},addText:function(e,d,f){this._text[e]={url:d,data:f}},addJSON:function(e,d,f){this._json[e]={url:d,data:f}},addImage:function(e,d,f){this._images[e]={url:d,data:f,spriteSheet:false};this._images[e].frame=new b.Frame(0,0,0,f.width,f.height,e,this.game.rnd.uuid());PIXI.BaseTextureCache[e]=new PIXI.BaseTexture(f);PIXI.TextureCache[e]=new PIXI.Texture(PIXI.BaseTextureCache[e])},addSound:function(g,f,i,e,h){e=e||true;h=h||false;var d=false;if(h){d=true}this._sounds[g]={url:f,data:i,isDecoding:false,decoded:d,webAudio:e,audioTag:h,locked:this.game.sound.touchLocked}},reloadSound:function(d){var e=this;if(this._sounds[d]){this._sounds[d].data.src=this._sounds[d].url;this._sounds[d].data.addEventListener("canplaythrough",function(){return e.reloadSoundComplete(d)},false);this._sounds[d].data.load()}},reloadSoundComplete:function(d){if(this._sounds[d]){this._sounds[d].locked=false;this.onSoundUnlock.dispatch(d)}},updateSound:function(d,f,e){if(this._sounds[d]){this._sounds[d][f]=e}},decodedSound:function(d,e){this._sounds[d].data=e;this._sounds[d].decoded=true;this._sounds[d].isDecoding=false},getCanvas:function(d){if(this._canvases[d]){return this._canvases[d].canvas}else{console.warn('Phaser.Cache.getCanvas: Invalid key: "'+d+'"')}},getBitmapData:function(d){if(this._bitmapDatas[d]){return this._bitmapDatas[d]}else{console.warn('Phaser.Cache.getBitmapData: Invalid key: "'+d+'"')}},getBitmapFont:function(d){if(this._bitmapFont[d]){return this._bitmapFont[d]}else{console.warn('Phaser.Cache.getBitmapFont: Invalid key: "'+d+'"')}},getPhysicsData:function(f,e,d){if(typeof e==="undefined"||e===null){if(this._physics[f]){return this._physics[f].data}else{console.warn('Phaser.Cache.getPhysicsData: Invalid key: "'+f+'"')}}else{if(this._physics[f]&&this._physics[f].data[e]){var g=this._physics[f].data[e];if(g&&d){for(var h in g){h=g[h];if(h.fixtureKey===d){return h}}console.warn('Phaser.Cache.getPhysicsData: Could not find given fixtureKey: "'+d+" in "+f+'"')}else{return g}}else{console.warn('Phaser.Cache.getPhysicsData: Invalid key/object: "'+f+" / "+e+'"')}}return null},checkKey:function(e,d){if(this._cacheMap[e][d]){return true}return false},checkCanvasKey:function(d){return this.checkKey(b.Cache.CANVAS,d)},checkImageKey:function(d){return this.checkKey(b.Cache.IMAGE,d)},checkTextureKey:function(d){return this.checkKey(b.Cache.TEXTURE,d)},checkSoundKey:function(d){return this.checkKey(b.Cache.SOUND,d)},checkTextKey:function(d){return this.checkKey(b.Cache.TEXT,d)},checkPhysicsKey:function(d){return this.checkKey(b.Cache.PHYSICS,d)},checkTilemapKey:function(d){return this.checkKey(b.Cache.TILEMAP,d)},checkBinaryKey:function(d){return this.checkKey(b.Cache.BINARY,d)},checkBitmapDataKey:function(d){return this.checkKey(b.Cache.BITMAPDATA,d)},checkBitmapFontKey:function(d){return this.checkKey(b.Cache.BITMAPFONT,d)},checkJSONKey:function(d){return this.checkKey(b.Cache.JSON,d)},getImage:function(d){if(this._images[d]){return this._images[d].data}else{console.warn('Phaser.Cache.getImage: Invalid key: "'+d+'"')}},getTilemapData:function(d){if(this._tilemaps[d]){return this._tilemaps[d]}else{console.warn('Phaser.Cache.getTilemapData: Invalid key: "'+d+'"')}},getFrameData:function(d){if(this._images[d]&&this._images[d].frameData){return this._images[d].frameData}return null},updateFrameData:function(d,e){if(this._images[d]){this._images[d].spriteSheet=true;this._images[d].frameData=e}},getFrameByIndex:function(d,e){if(this._images[d]&&this._images[d].frameData){return this._images[d].frameData.getFrame(e)}return null},getFrameByName:function(d,e){if(this._images[d]&&this._images[d].frameData){return this._images[d].frameData.getFrameByName(e)}return null},getFrame:function(d){if(this._images[d]&&this._images[d].spriteSheet===false){return this._images[d].frame}return null},getTextureFrame:function(d){if(this._textures[d]){return this._textures[d].frame}return null},getTexture:function(d){if(this._textures[d]){return this._textures[d]}else{console.warn('Phaser.Cache.getTexture: Invalid key: "'+d+'"')}},getSound:function(d){if(this._sounds[d]){return this._sounds[d]}else{console.warn('Phaser.Cache.getSound: Invalid key: "'+d+'"')}},getSoundData:function(d){if(this._sounds[d]){return this._sounds[d].data}else{console.warn('Phaser.Cache.getSoundData: Invalid key: "'+d+'"')}},isSoundDecoded:function(d){if(this._sounds[d]){return this._sounds[d].decoded}},isSoundReady:function(d){return(this._sounds[d]&&this._sounds[d].decoded&&this.game.sound.touchLocked===false)},isSpriteSheet:function(d){if(this._images[d]){return this._images[d].spriteSheet}return false},getText:function(d){if(this._text[d]){return this._text[d].data}else{console.warn('Phaser.Cache.getText: Invalid key: "'+d+'"')}},getJSON:function(d){if(this._json[d]){return this._json[d].data}else{console.warn('Phaser.Cache.getJSON: Invalid key: "'+d+'"')}},getBinary:function(d){if(this._binary[d]){return this._binary[d]}else{console.warn('Phaser.Cache.getBinary: Invalid key: "'+d+'"')}},getKeys:function(e){var g=null;switch(e){case b.Cache.CANVAS:g=this._canvases;break;case b.Cache.IMAGE:g=this._images;break;case b.Cache.TEXTURE:g=this._textures;break;case b.Cache.SOUND:g=this._sounds;break;case b.Cache.TEXT:g=this._text;break;case b.Cache.PHYSICS:g=this._physics;break;case b.Cache.TILEMAP:g=this._tilemaps;break;case b.Cache.BINARY:g=this._binary;break;case b.Cache.BITMAPDATA:g=this._bitmapDatas;break;case b.Cache.BITMAPFONT:g=this._bitmapFont;break;case b.Cache.JSON:g=this._json;break}if(!g){return}var d=[];for(var f in g){if(f!=="__default"&&f!=="__missing"){d.push(f)}}return d},removeCanvas:function(d){delete this._canvases[d]},removeImage:function(d){delete this._images[d]},removeSound:function(d){delete this._sounds[d]},removeText:function(d){delete this._text[d]},removeJSON:function(d){delete this._json[d]},removePhysics:function(d){delete this._physics[d]},removeTilemap:function(d){delete this._tilemaps[d]},removeBinary:function(d){delete this._binary[d]},removeBitmapData:function(d){delete this._bitmapDatas[d]},removeBitmapFont:function(d){delete this._bitmapFont[d]},destroy:function(){for(var d in this._canvases){delete this._canvases[d]}for(var d in this._images){if(d!=="__default"&&d!=="__missing"){delete this._images[d]}}for(var d in this._sounds){delete this._sounds[d]}for(var d in this._text){delete this._text[d]}for(var d in this._json){delete this._json[d]}for(var d in this._textures){delete this._textures[d]}for(var d in this._physics){delete this._physics[d]}for(var d in this._tilemaps){delete this._tilemaps[d]}for(var d in this._binary){delete this._binary[d]}for(var d in this._bitmapDatas){delete this._bitmapDatas[d]}for(var d in this._bitmapFont){delete this._bitmapFont[d]}}};b.Cache.prototype.constructor=b.Cache;b.Loader=function(d){this.game=d;this.isLoading=false;this.hasLoaded=false;this.progress=0;this.progressFloat=0;this.preloadSprite=null;this.crossOrigin=false;this.baseURL="";this.onLoadStart=new b.Signal();this.onFileStart=new b.Signal();this.onFileComplete=new b.Signal();this.onFileError=new b.Signal();this.onLoadComplete=new b.Signal();this.onPackComplete=new b.Signal();this._packList=[];this._packIndex=0;this._fileList=[];this._fileIndex=0;this._progressChunk=0;this._xhr=new XMLHttpRequest();this._ajax=null};b.Loader.TEXTURE_ATLAS_JSON_ARRAY=0;b.Loader.TEXTURE_ATLAS_JSON_HASH=1;b.Loader.TEXTURE_ATLAS_XML_STARLING=2;b.Loader.PHYSICS_LIME_CORONA_JSON=3;b.Loader.PHYSICS_PHASER_JSON=4;b.Loader.prototype={setPreloadSprite:function(d,e){e=e||0;this.preloadSprite={sprite:d,direction:e,width:d.width,height:d.height,rect:null};if(e===0){this.preloadSprite.rect=new b.Rectangle(0,0,1,d.height)}else{this.preloadSprite.rect=new b.Rectangle(0,0,d.width,1)}d.crop(this.preloadSprite.rect);d.visible=true},checkKeyExists:function(f,e){if(this._fileList.length>0){for(var d=0;d<this._fileList.length;d++){if(this._fileList[d].type===f&&this._fileList[d].key===e){return true}}}return false},getAssetIndex:function(f,e){if(this._fileList.length>0){for(var d=0;d<this._fileList.length;d++){if(this._fileList[d].type===f&&this._fileList[d].key===e){return d}}}return -1},getAsset:function(f,e){if(this._fileList.length>0){for(var d=0;d<this._fileList.length;d++){if(this._fileList[d].type===f&&this._fileList[d].key===e){return{index:d,file:this._fileList[d]}}}}return false},reset:function(){this.preloadSprite=null;this.isLoading=false;this._packList.length=0;this._packIndex=0;this._fileList.length=0;this._fileIndex=0},addToFileList:function(g,f,d,e){var h={type:g,key:f,url:d,data:null,error:false,loaded:false};if(typeof e!=="undefined"){for(var i in e){h[i]=e[i]}}if(this.checkKeyExists(g,f)===false){this._fileList.push(h)}},replaceInFileList:function(h,g,e,f){var i={type:h,key:g,url:e,data:null,error:false,loaded:false};if(typeof f!=="undefined"){for(var j in f){i[j]=f[j]}}var d=this.getAssetIndex(h,g);if(d===-1){this._fileList.push(i)}else{this._fileList[d]=i}},pack:function(f,e,g,d){if(typeof e==="undefined"){e=null}if(typeof g==="undefined"){g=null}if(typeof d==="undefined"){d=this}if(e===null&&g===null){console.warn("Phaser.Loader.pack - Both url and data are null. One must be set.");return this}if(g){if(typeof g==="string"){g=JSON.parse(g)}}this._packList.push({key:f,url:e,data:g,loaded:false,error:false,callbackContext:d});return this},image:function(f,e,d){if(typeof d==="undefined"){d=false}if(d){this.replaceInFileList("image",f,e)}else{this.addToFileList("image",f,e)}return this},text:function(f,e,d){if(typeof d==="undefined"){d=false}if(d){this.replaceInFileList("text",f,e)}else{this.addToFileList("text",f,e)}return this},json:function(f,e,d){if(typeof d==="undefined"){d=false}if(d){this.replaceInFileList("json",f,e)}else{this.addToFileList("json",f,e)}return this},script:function(f,e,g,d){if(typeof g==="undefined"){g=false}if(g!==false&&typeof d==="undefined"){d=g}this.addToFileList("script",f,e,{callback:g,callbackContext:d});return this},binary:function(f,e,g,d){if(typeof g==="undefined"){g=false}if(g!==false&&typeof d==="undefined"){d=g}this.addToFileList("binary",f,e,{callback:g,callbackContext:d});return this},spritesheet:function(g,f,d,e,i,h,j){if(typeof i==="undefined"){i=-1}if(typeof h==="undefined"){h=0}if(typeof j==="undefined"){j=0}this.addToFileList("spritesheet",g,f,{frameWidth:d,frameHeight:e,frameMax:i,margin:h,spacing:j});return this},audio:function(e,f,d){if(typeof d==="undefined"){d=true}this.addToFileList("audio",e,f,{buffer:null,autoDecode:d});return this},tilemap:function(e,d,f,g){if(typeof d==="undefined"){d=null}if(typeof f==="undefined"){f=null}if(typeof g==="undefined"){g=b.Tilemap.CSV}if(d==null&&f==null){console.warn("Phaser.Loader.tilemap - Both url and data are null. One must be set.");return this}if(f){switch(g){case b.Tilemap.CSV:break;case b.Tilemap.TILED_JSON:if(typeof f==="string"){f=JSON.parse(f)}break}this.game.cache.addTilemap(e,null,f,g)}else{this.addToFileList("tilemap",e,d,{format:g})}return this},physics:function(e,d,f,g){if(typeof d==="undefined"){d=null}if(typeof f==="undefined"){f=null}if(typeof g==="undefined"){g=b.Physics.LIME_CORONA_JSON}if(d==null&&f==null){console.warn("Phaser.Loader.physics - Both url and data are null. One must be set.");return this}if(f){if(typeof f==="string"){f=JSON.parse(f)}this.game.cache.addPhysicsData(e,null,f,g)}else{this.addToFileList("physics",e,d,{format:g})}return this},bitmapFont:function(m,f,l,d,k,j){if(typeof l==="undefined"){l=null}if(typeof d==="undefined"){d=null}if(typeof k==="undefined"){k=0}if(typeof j==="undefined"){j=0}if(l){this.addToFileList("bitmapfont",m,f,{xmlURL:l,xSpacing:k,ySpacing:j})}else{if(typeof d==="string"){var g;try{if(window.DOMParser){var h=new DOMParser();g=h.parseFromString(d,"text/xml")}else{g=new ActiveXObject("Microsoft.XMLDOM");g.async="false";g.loadXML(d)}}catch(i){g=undefined}if(!g||!g.documentElement||g.getElementsByTagName("parsererror").length){throw new Error("Phaser.Loader. Invalid Bitmap Font XML given")}else{this.addToFileList("bitmapfont",m,f,{xmlURL:null,xmlData:g,xSpacing:k,ySpacing:j})}}}return this},atlasJSONArray:function(f,e,g,d){return this.atlas(f,e,g,d,b.Loader.TEXTURE_ATLAS_JSON_ARRAY)},atlasJSONHash:function(f,e,g,d){return this.atlas(f,e,g,d,b.Loader.TEXTURE_ATLAS_JSON_HASH)},atlasXML:function(f,e,g,d){return this.atlas(f,e,g,d,b.Loader.TEXTURE_ATLAS_XML_STARLING)},atlas:function(h,g,i,d,k){if(typeof i==="undefined"){i=null}if(typeof d==="undefined"){d=null}if(typeof k==="undefined"){k=b.Loader.TEXTURE_ATLAS_JSON_ARRAY}if(i){this.addToFileList("textureatlas",h,g,{atlasURL:i,format:k})}else{switch(k){case b.Loader.TEXTURE_ATLAS_JSON_ARRAY:if(typeof d==="string"){d=JSON.parse(d)}break;case b.Loader.TEXTURE_ATLAS_XML_STARLING:if(typeof d==="string"){var f;try{if(window.DOMParser){var l=new DOMParser();f=l.parseFromString(d,"text/xml")}else{f=new ActiveXObject("Microsoft.XMLDOM");f.async="false";f.loadXML(d)}}catch(j){f=undefined}if(!f||!f.documentElement||f.getElementsByTagName("parsererror").length){throw new Error("Phaser.Loader. Invalid Texture Atlas XML given")}else{d=f}}break}this.addToFileList("textureatlas",h,g,{atlasURL:null,atlasData:d,format:k})}return this},removeFile:function(f,e){var d=this.getAsset(f,e);if(d!==false){this._fileList.splice(d.index,1)}},removeAll:function(){this._fileList.length=0},start:function(){if(this.isLoading){return}if(this._packList.length>0){this._packIndex=0;this.loadPack()}else{this.beginLoad()}},beginLoad:function(){this.progress=0;this.progressFloat=0;this.hasLoaded=false;this.isLoading=true;this.onLoadStart.dispatch(this._fileList.length);if(this._fileList.length>0){this._fileIndex=0;this._progressChunk=100/this._fileList.length;this.loadFile()}else{this.progress=100;this.progressFloat=100;this.hasLoaded=true;this.isLoading=false;this.onLoadComplete.dispatch()}},loadPack:function(){if(!this._packList[this._packIndex]){console.warn("Phaser.Loader loadPackList invalid index "+this._packIndex);return}var d=this._packList[this._packIndex];if(d.data!==null){this.packLoadComplete(this._packIndex,false)}else{this.xhrLoad(this._packIndex,this.baseURL+d.url,"text","packLoadComplete","packLoadError")}},packLoadComplete:function(d,j){if(typeof j==="undefined"){j=true}if(!this._packList[d]){console.warn("Phaser.Loader packLoadComplete invalid index "+d);return}var g=this._packList[d];g.loaded=true;if(j){var h=JSON.parse(this._xhr.responseText)}else{var h=this._packList[d].data}if(h[g.key]){var f;for(var e=0;e<h[g.key].length;e++){f=h[g.key][e];switch(f.type){case"image":this.image(f.key,f.url,f.overwrite);break;case"text":this.text(f.key,f.url,f.overwrite);break;case"json":this.json(f.key,f.url,f.overwrite);break;case"script":this.script(f.key,f.url,f.callback,g.callbackContext);break;case"binary":this.binary(f.key,f.url,f.callback,g.callbackContext);break;case"spritesheet":this.spritesheet(f.key,f.url,f.frameWidth,f.frameHeight,f.frameMax,f.margin,f.spacing);break;case"audio":this.audio(f.key,f.urls,f.autoDecode);break;case"tilemap":this.tilemap(f.key,f.url,f.data,b.Tilemap[f.format]);break;case"physics":this.physics(f.key,f.url,f.data,b.Loader[f.format]);break;case"bitmapFont":this.bitmapFont(f.key,f.textureURL,f.xmlURL,f.xmlData,f.xSpacing,f.ySpacing);break;case"atlasJSONArray":this.atlasJSONArray(f.key,f.textureURL,f.atlasURL,f.atlasData);break;case"atlasJSONHash":this.atlasJSONHash(f.key,f.textureURL,f.atlasURL,f.atlasData);break;case"atlasXML":this.atlasXML(f.key,f.textureURL,f.atlasURL,f.atlasData);break;case"atlas":this.atlas(f.key,f.textureURL,f.atlasURL,f.atlasData,b.Loader[f.format]);break}}}this.nextPack(d,true)},packError:function(d){this._packList[d].loaded=true;this._packList[d].error=true;this.onFileError.dispatch(this._packList[d].key,this._packList[d]);console.warn("Phaser.Loader error loading pack file: "+this._packList[d].key+" from URL "+this._packList[d].url);this.nextPack(d,false)},nextPack:function(d,e){this.onPackComplete.dispatch(this._packList[d].key,e,this.totalLoadedPacks(),this._packList.length);this._packIndex++;if(this._packIndex<this._packList.length){this.loadPack()}else{this.beginLoad()}},loadFile:function(){if(!this._fileList[this._fileIndex]){console.warn("Phaser.Loader loadFile invalid index "+this._fileIndex);return}var d=this._fileList[this._fileIndex];var e=this;this.onFileStart.dispatch(this.progress,d.key);switch(d.type){case"image":case"spritesheet":case"textureatlas":case"bitmapfont":d.data=new Image();d.data.name=d.key;d.data.onload=function(){return e.fileComplete(e._fileIndex)};d.data.onerror=function(){return e.fileError(e._fileIndex)};if(this.crossOrigin){d.data.crossOrigin=this.crossOrigin}d.data.src=this.baseURL+d.url;break;case"audio":d.url=this.getAudioURL(d.url);if(d.url!==null){if(this.game.sound.usingWebAudio){this.xhrLoad(this._fileIndex,this.baseURL+d.url,"arraybuffer","fileComplete","fileError")}else{if(this.game.sound.usingAudioTag){if(this.game.sound.touchLocked){d.data=new Audio();d.data.name=d.key;d.data.preload="auto";d.data.src=this.baseURL+d.url;this.fileComplete(this._fileIndex)}else{d.data=new Audio();d.data.name=d.key;d.data.onerror=function(){return e.fileError(e._fileIndex)};d.data.preload="auto";d.data.src=this.baseURL+d.url;d.data.addEventListener("canplaythrough",b.GAMES[this.game.id].load.fileComplete(this._fileIndex),false);d.data.load()}}}}else{this.fileError(this._fileIndex)}break;case"json":if(window.XDomainRequest){this._ajax=new window.XDomainRequest();this._ajax.timeout=3000;this._ajax.onerror=function(){return e.dataLoadError(e._fileIndex)};this._ajax.ontimeout=function(){return e.dataLoadError(e._fileIndex)};this._ajax.onprogress=function(){};this._ajax.onload=function(){return e.jsonLoadComplete(e._fileIndex)};this._ajax.open("GET",this.baseURL+d.url,true);this._ajax.send()}else{this.xhrLoad(this._fileIndex,this.baseURL+d.url,"text","jsonLoadComplete","dataLoadError")}break;case"tilemap":if(d.format===b.Tilemap.TILED_JSON){this.xhrLoad(this._fileIndex,this.baseURL+d.url,"text","jsonLoadComplete","dataLoadError")}else{if(d.format===b.Tilemap.CSV){this.xhrLoad(this._fileIndex,this.baseURL+d.url,"text","csvLoadComplete","dataLoadError")}else{throw new Error("Phaser.Loader. Invalid Tilemap format: "+d.format)}}break;case"text":case"script":case"physics":this.xhrLoad(this._fileIndex,this.baseURL+d.url,"text","fileComplete","fileError");break;case"binary":this.xhrLoad(this._fileIndex,this.baseURL+d.url,"arraybuffer","fileComplete","fileError");break}},xhrLoad:function(f,e,g,h,d){this._xhr.open("GET",e,true);this._xhr.responseType=g;var i=this;this._xhr.onload=function(){return i[h](f)};this._xhr.onerror=function(){return i[d](f)};this._xhr.send()},getAudioURL:function(e){var f;if(typeof e==="string"){e=[e]}for(var d=0;d<e.length;d++){f=e[d].toLowerCase();f=f.substr((Math.max(0,f.lastIndexOf("."))||Infinity)+1);if(this.game.device.canPlayAudio(f)){return e[d]}}return null},fileError:function(d){this._fileList[d].loaded=true;this._fileList[d].error=true;this.onFileError.dispatch(this._fileList[d].key,this._fileList[d]);console.warn("Phaser.Loader error loading file: "+this._fileList[d].key+" from URL "+this._fileList[d].url);this.nextFile(d,false)},fileComplete:function(d){if(!this._fileList[d]){console.warn("Phaser.Loader fileComplete invalid index "+d);return}var f=this._fileList[d];f.loaded=true;var i=true;switch(f.type){case"image":this.game.cache.addImage(f.key,f.url,f.data);break;case"spritesheet":this.game.cache.addSpriteSheet(f.key,f.url,f.data,f.frameWidth,f.frameHeight,f.frameMax,f.margin,f.spacing);break;case"textureatlas":if(f.atlasURL==null){this.game.cache.addTextureAtlas(f.key,f.url,f.data,f.atlasData,f.format)}else{i=false;if(f.format==b.Loader.TEXTURE_ATLAS_JSON_ARRAY||f.format==b.Loader.TEXTURE_ATLAS_JSON_HASH){this.xhrLoad(this._fileIndex,this.baseURL+f.atlasURL,"text","jsonLoadComplete","dataLoadError")}else{if(f.format==b.Loader.TEXTURE_ATLAS_XML_STARLING){this.xhrLoad(this._fileIndex,this.baseURL+f.atlasURL,"text","xmlLoadComplete","dataLoadError")}else{throw new Error("Phaser.Loader. Invalid Texture Atlas format: "+f.format)}}}break;case"bitmapfont":if(f.xmlURL==null){this.game.cache.addBitmapFont(f.key,f.url,f.data,f.xmlData,f.xSpacing,f.ySpacing)}else{i=false;this.xhrLoad(this._fileIndex,this.baseURL+f.xmlURL,"text","xmlLoadComplete","dataLoadError")}break;case"audio":if(this.game.sound.usingWebAudio){f.data=this._xhr.response;this.game.cache.addSound(f.key,f.url,f.data,true,false);if(f.autoDecode){var g=this;var e=f.key;this.game.cache.updateSound(e,"isDecoding",true);this.game.sound.context.decodeAudioData(f.data,function(j){if(j){g.game.cache.decodedSound(e,j);g.game.sound.onSoundDecode.dispatch(e,g.game.cache.getSound(e))}})}}else{f.data.removeEventListener("canplaythrough",b.GAMES[this.game.id].load.fileComplete);this.game.cache.addSound(f.key,f.url,f.data,false,true)}break;case"text":f.data=this._xhr.responseText;this.game.cache.addText(f.key,f.url,f.data);break;case"physics":var h=JSON.parse(this._xhr.responseText);this.game.cache.addPhysicsData(f.key,f.url,h,f.format);break;case"script":f.data=document.createElement("script");f.data.language="javascript";f.data.type="text/javascript";f.data.defer=false;f.data.text=this._xhr.responseText;document.head.appendChild(f.data);if(f.callback){f.data=f.callback.call(f.callbackContext,f.key,this._xhr.responseText)}break;case"binary":if(f.callback){f.data=f.callback.call(f.callbackContext,f.key,this._xhr.response)}else{f.data=this._xhr.response}this.game.cache.addBinary(f.key,f.data);break}if(i){this.nextFile(d,true)}},jsonLoadComplete:function(d){if(!this._fileList[d]){console.warn("Phaser.Loader jsonLoadComplete invalid index "+d);return}var e=this._fileList[d];var f=JSON.parse(this._xhr.responseText);e.loaded=true;if(e.type==="tilemap"){this.game.cache.addTilemap(e.key,e.url,f,e.format)}else{if(e.type==="json"){this.game.cache.addJSON(e.key,e.url,f)}else{this.game.cache.addTextureAtlas(e.key,e.url,e.data,f,e.format)}}this.nextFile(d,true)},csvLoadComplete:function(d){if(!this._fileList[d]){console.warn("Phaser.Loader csvLoadComplete invalid index "+d);return}var e=this._fileList[d];var f=this._xhr.responseText;e.loaded=true;this.game.cache.addTilemap(e.key,e.url,f,e.format);this.nextFile(d,true)},dataLoadError:function(d){var e=this._fileList[d];e.loaded=true;e.error=true;console.warn("Phaser.Loader dataLoadError: "+e.key);this.nextFile(d,true)},xmlLoadComplete:function(f){var h=this._xhr.responseText;var d;try{if(window.DOMParser){var j=new DOMParser();d=j.parseFromString(h,"text/xml")}else{d=new ActiveXObject("Microsoft.XMLDOM");d.async="false";d.loadXML(h)}}catch(i){d=undefined}if(!d||!d.documentElement||d.getElementsByTagName("parsererror").length){throw new Error("Phaser.Loader. Invalid XML given")}var g=this._fileList[f];g.loaded=true;if(g.type=="bitmapfont"){this.game.cache.addBitmapFont(g.key,g.url,g.data,d,g.xSpacing,g.ySpacing)}else{if(g.type=="textureatlas"){this.game.cache.addTextureAtlas(g.key,g.url,g.data,d,g.format)}}this.nextFile(f,true)},nextFile:function(d,e){this.progressFloat+=this._progressChunk;this.progress=Math.round(this.progressFloat);if(this.progress>100){this.progress=100}if(this.preloadSprite!==null){if(this.preloadSprite.direction===0){this.preloadSprite.rect.width=Math.floor((this.preloadSprite.width/100)*this.progress);this.preloadSprite.sprite.crop(this.preloadSprite.rect)}else{this.preloadSprite.rect.height=Math.floor((this.preloadSprite.height/100)*this.progress);this.preloadSprite.sprite.crop(this.preloadSprite.rect)}}this.onFileComplete.dispatch(this.progress,this._fileList[d].key,e,this.totalLoadedFiles(),this._fileList.length);if(this.totalQueuedFiles()>0){this._fileIndex++;this.loadFile()}else{this.hasLoaded=true;this.isLoading=false;this.removeAll();this.onLoadComplete.dispatch()}},totalLoadedFiles:function(){var e=0;for(var d=0;d<this._fileList.length;d++){if(this._fileList[d].loaded){e++}}return e},totalQueuedFiles:function(){var e=0;for(var d=0;d<this._fileList.length;d++){if(this._fileList[d].loaded===false){e++}}return e},totalLoadedPacks:function(){var e=0;for(var d=0;d<this._packList.length;d++){if(this._packList[d].loaded){e++}}return e},totalQueuedPacks:function(){var e=0;for(var d=0;d<this._packList.length;d++){if(this._packList[d].loaded===false){e++}}return e}};b.Loader.prototype.constructor=b.Loader;b.LoaderParser={bitmapFont:function(t,k,o,p,l){var g={};var e=k.getElementsByTagName("info")[0];var m=k.getElementsByTagName("common")[0];g.font=e.getAttribute("face");g.size=parseInt(e.getAttribute("size"),10);g.lineHeight=parseInt(m.getAttribute("lineHeight"),10)+l;g.chars={};var n=k.getElementsByTagName("char");for(var f=0;f<n.length;f++){var s=parseInt(n[f].getAttribute("id"),10);var r=new PIXI.Rectangle(parseInt(n[f].getAttribute("x"),10),parseInt(n[f].getAttribute("y"),10),parseInt(n[f].getAttribute("width"),10),parseInt(n[f].getAttribute("height"),10));g.chars[s]={xOffset:parseInt(n[f].getAttribute("xoffset"),10),yOffset:parseInt(n[f].getAttribute("yoffset"),10),xAdvance:parseInt(n[f].getAttribute("xadvance"),10)+p,kerning:{},texture:PIXI.TextureCache[o]=new PIXI.Texture(PIXI.BaseTextureCache[o],r)}}var q=k.getElementsByTagName("kerning");for(f=0;f<q.length;f++){var j=parseInt(q[f].getAttribute("first"),10);var d=parseInt(q[f].getAttribute("second"),10);var h=parseInt(q[f].getAttribute("amount"),10);g.chars[d].kerning[j]=h}PIXI.BitmapText.fonts[o]=g}};b.Sound=function(f,g,h,d,e){if(typeof h=="undefined"){h=1}if(typeof d=="undefined"){d=false}if(typeof e==="undefined"){e=f.sound.connectToMaster}this.game=f;this.name=g;this.key=g;this.loop=d;this.volume=h;this.markers={};this.context=null;this.autoplay=false;this.totalDuration=0;this.startTime=0;this.currentTime=0;this.duration=0;this.durationMS=0;this.position=0;this.stopTime=0;this.paused=false;this.pausedPosition=0;this.pausedTime=0;this.isPlaying=false;this.currentMarker="";this.pendingPlayback=false;this.override=false;this.usingWebAudio=this.game.sound.usingWebAudio;this.usingAudioTag=this.game.sound.usingAudioTag;this.externalNode=null;this.masterGainNode=null;this.gainNode=null;if(this.usingWebAudio){this.context=this.game.sound.context;this.masterGainNode=this.game.sound.masterGain;if(typeof this.context.createGain==="undefined"){this.gainNode=this.context.createGainNode()}else{this.gainNode=this.context.createGain()}this.gainNode.gain.value=h*this.game.sound.volume;if(e){this.gainNode.connect(this.masterGainNode)}}else{if(this.game.cache.getSound(g)&&this.game.cache.isSoundReady(g)){this._sound=this.game.cache.getSoundData(g);this.totalDuration=0;if(this._sound.duration){this.totalDuration=this._sound.duration}}else{this.game.cache.onSoundUnlock.add(this.soundHasUnlocked,this)}}this.onDecoded=new b.Signal();this.onPlay=new b.Signal();this.onPause=new b.Signal();this.onResume=new b.Signal();this.onLoop=new b.Signal();this.onStop=new b.Signal();this.onMute=new b.Signal();this.onMarkerComplete=new b.Signal();this._volume=h;this._buffer=null;this._muted=false;this._tempMarker=0;this._tempPosition=0;this._tempVolume=0;this._tempLoop=0;this._paused=false;this._onDecodedEventDispatched=false};b.Sound.prototype={soundHasUnlocked:function(d){if(d==this.key){this._sound=this.game.cache.getSoundData(this.key);this.totalDuration=this._sound.duration}},addMarker:function(e,h,g,f,d){if(typeof f=="undefined"){f=1}if(typeof d=="undefined"){d=false}this.markers[e]={name:e,start:h,stop:h+g,volume:f,duration:g,durationMS:g*1000,loop:d}},removeMarker:function(d){delete this.markers[d]},update:function(){if(this.isDecoded&&!this._onDecodedEventDispatched){this.onDecoded.dispatch(this);this._onDecodedEventDispatched=true}if(this.pendingPlayback&&this.game.cache.isSoundReady(this.key)){this.pendingPlayback=false;this.play(this._tempMarker,this._tempPosition,this._tempVolume,this._tempLoop)}if(this.isPlaying){this.currentTime=this.game.time.now-this.startTime;if(this.currentTime>=this.durationMS){if(this.usingWebAudio){if(this.loop){this.onLoop.dispatch(this);if(this.currentMarker===""){this.currentTime=0;this.startTime=this.game.time.now}else{this.onMarkerComplete.dispatch(this.currentMarker,this);this.play(this.currentMarker,0,this.volume,true,true)}}else{this.stop()}}else{if(this.loop){this.onLoop.dispatch(this);this.play(this.currentMarker,0,this.volume,true,true)}else{this.stop()}}}}},play:function(f,d,h,e,g){if(typeof f==="undefined"){f=""}if(typeof g==="undefined"){g=true}if(this.isPlaying===true&&g===false&&this.override===false){return this}if(this.isPlaying&&this.override){if(this.usingWebAudio){if(typeof this._sound.stop==="undefined"){this._sound.noteOff(0)}else{this._sound.stop(0)}}else{if(this.usingAudioTag){this._sound.pause();this._sound.currentTime=0}}}this.currentMarker=f;if(f!==""){if(this.markers[f]){this.position=this.markers[f].start;this.volume=this.markers[f].volume;this.loop=this.markers[f].loop;this.duration=this.markers[f].duration;this.durationMS=this.markers[f].durationMS;if(typeof h!=="undefined"){this.volume=h}if(typeof e!=="undefined"){this.loop=e}this._tempMarker=f;this._tempPosition=this.position;this._tempVolume=this.volume;this._tempLoop=this.loop}else{console.warn("Phaser.Sound.play: audio marker "+f+" doesn't exist");return this}}else{d=d||0;if(typeof h==="undefined"){h=this._volume}if(typeof e==="undefined"){e=this.loop}this.position=d;this.volume=h;this.loop=e;this.duration=0;this.durationMS=0;this._tempMarker=f;this._tempPosition=d;this._tempVolume=h;this._tempLoop=e}if(this.usingWebAudio){if(this.game.cache.isSoundDecoded(this.key)){if(this._buffer==null){this._buffer=this.game.cache.getSoundData(this.key)}this._sound=this.context.createBufferSource();this._sound.buffer=this._buffer;if(this.externalNode){this._sound.connect(this.externalNode)}else{this._sound.connect(this.gainNode)}this.totalDuration=this._sound.buffer.duration;if(this.duration===0){this.duration=this.totalDuration;this.durationMS=this.totalDuration*1000}if(this.loop&&f===""){this._sound.loop=true}if(typeof this._sound.start==="undefined"){this._sound.noteGrainOn(0,this.position,this.duration)}else{this._sound.start(0,this.position,this.duration)}this.isPlaying=true;this.startTime=this.game.time.now;this.currentTime=0;this.stopTime=this.startTime+this.durationMS;this.onPlay.dispatch(this)}else{this.pendingPlayback=true;if(this.game.cache.getSound(this.key)&&this.game.cache.getSound(this.key).isDecoding===false){this.game.sound.decode(this.key,this)}}}else{if(this.game.cache.getSound(this.key)&&this.game.cache.getSound(this.key).locked){this.game.cache.reloadSound(this.key);this.pendingPlayback=true}else{if(this._sound&&(this.game.device.cocoonJS||this._sound.readyState===4)){this._sound.play();this.totalDuration=this._sound.duration;if(this.duration===0){this.duration=this.totalDuration;this.durationMS=this.totalDuration*1000}this._sound.currentTime=this.position;this._sound.muted=this._muted;if(this._muted){this._sound.volume=0}else{this._sound.volume=this._volume}this.isPlaying=true;this.startTime=this.game.time.now;this.currentTime=0;this.stopTime=this.startTime+this.durationMS;this.onPlay.dispatch(this)}else{this.pendingPlayback=true}}}return this},restart:function(f,d,g,e){f=f||"";d=d||0;g=g||1;if(typeof e=="undefined"){e=false}this.play(f,d,g,e,true)},pause:function(){if(this.isPlaying&&this._sound){this.paused=true;this.pausedPosition=this.currentTime;this.pausedTime=this.game.time.now;this.onPause.dispatch(this);this.stop()}},resume:function(){if(this.paused&&this._sound){if(this.usingWebAudio){var d=this.position+(this.pausedPosition/1000);this._sound=this.context.createBufferSource();this._sound.buffer=this._buffer;if(this.externalNode){this._sound.connect(this.externalNode)}else{this._sound.connect(this.gainNode)}if(this.loop){this._sound.loop=true}if(typeof this._sound.start==="undefined"){this._sound.noteGrainOn(0,d,this.duration)}else{this._sound.start(0,d,this.duration)}}else{this._sound.play()}this.isPlaying=true;this.paused=false;this.startTime+=(this.game.time.now-this.pausedTime);this.onResume.dispatch(this)}},stop:function(){if(this.isPlaying&&this._sound){if(this.usingWebAudio){if(typeof this._sound.stop==="undefined"){this._sound.noteOff(0)}else{try{this._sound.stop(0)}catch(f){}}}else{if(this.usingAudioTag){this._sound.pause();this._sound.currentTime=0}}}this.isPlaying=false;var d=this.currentMarker;if(this.currentMarker!==""){this.onMarkerComplete.dispatch(this.currentMarker,this)}this.currentMarker="";if(!this.paused){this.onStop.dispatch(this,d)}},destroy:function(d){if(typeof d==="undefined"){d=true}this.stop();if(d){this.game.sound.remove(this)}else{this.markers={};this.context=null;this._buffer=null;this.externalNode=null;this.onDecoded.dispose();this.onPlay.dispose();this.onPause.dispose();this.onResume.dispose();this.onLoop.dispose();this.onStop.dispose();this.onMute.dispose();this.onMarkerComplete.dispose()}}};b.Sound.prototype.constructor=b.Sound;Object.defineProperty(b.Sound.prototype,"isDecoding",{get:function(){return this.game.cache.getSound(this.key).isDecoding}});Object.defineProperty(b.Sound.prototype,"isDecoded",{get:function(){return this.game.cache.isSoundDecoded(this.key)}});Object.defineProperty(b.Sound.prototype,"mute",{get:function(){return(this._muted||this.game.sound.mute)},set:function(d){d=d||null;if(d){this._muted=true;if(this.usingWebAudio){this._muteVolume=this.gainNode.gain.value;this.gainNode.gain.value=0}else{if(this.usingAudioTag&&this._sound){this._muteVolume=this._sound.volume;this._sound.volume=0}}}else{this._muted=false;if(this.usingWebAudio){this.gainNode.gain.value=this._muteVolume}else{if(this.usingAudioTag&&this._sound){this._sound.volume=this._muteVolume}}}this.onMute.dispatch(this)}});Object.defineProperty(b.Sound.prototype,"volume",{get:function(){return this._volume},set:function(d){if(this.usingWebAudio){this._volume=d;this.gainNode.gain.value=d}else{if(this.usingAudioTag&&this._sound){if(d>=0&&d<=1){this._volume=d;this._sound.volume=d}}}}});b.SoundManager=function(d){this.game=d;this.onSoundDecode=new b.Signal();this._codeMuted=false;this._muted=false;this._unlockSource=null;this._volume=1;this._sounds=[];this.context=null;this.usingWebAudio=true;this.usingAudioTag=false;this.noAudio=false;this.connectToMaster=true;this.touchLocked=false;this.channels=32};b.SoundManager.prototype={boot:function(){if(this.game.device.iOS&&this.game.device.webAudio===false){this.channels=1}if(!this.game.device.cocoonJS&&this.game.device.iOS||(window.PhaserGlobal&&window.PhaserGlobal.fakeiOSTouchLock)){this.game.input.touch.callbackContext=this;this.game.input.touch.touchStartCallback=this.unlock;this.game.input.mouse.callbackContext=this;this.game.input.mouse.mouseDownCallback=this.unlock;this.touchLocked=true}else{this.touchLocked=false}if(window.PhaserGlobal){if(window.PhaserGlobal.disableAudio===true){this.usingWebAudio=false;this.noAudio=true;return}if(window.PhaserGlobal.disableWebAudio===true){this.usingWebAudio=false;this.usingAudioTag=true;this.noAudio=false;return}}if(!!window.AudioContext){try{this.context=new window.AudioContext()}catch(d){this.context=null;this.usingWebAudio=false;this.noAudio=true}}else{if(!!window.webkitAudioContext){try{this.context=new window.webkitAudioContext()}catch(d){this.context=null;this.usingWebAudio=false;this.noAudio=true}}}if(!!window.Audio&&this.context===null){this.usingWebAudio=false;this.usingAudioTag=true;this.noAudio=false}if(this.context!==null){if(typeof this.context.createGain==="undefined"){this.masterGain=this.context.createGainNode()}else{this.masterGain=this.context.createGain()}this.masterGain.gain.value=1;this.masterGain.connect(this.context.destination)}},unlock:function(){if(this.touchLocked===false){return}if(this.game.device.webAudio===false||(window.PhaserGlobal&&window.PhaserGlobal.disableWebAudio===true)){this.touchLocked=false;this._unlockSource=null;this.game.input.touch.callbackContext=null;this.game.input.touch.touchStartCallback=null;this.game.input.mouse.callbackContext=null;this.game.input.mouse.mouseDownCallback=null}else{var d=this.context.createBuffer(1,1,22050);this._unlockSource=this.context.createBufferSource();this._unlockSource.buffer=d;this._unlockSource.connect(this.context.destination);this._unlockSource.noteOn(0)}},stopAll:function(){for(var d=0;d<this._sounds.length;d++){if(this._sounds[d]){this._sounds[d].stop()}}},pauseAll:function(){for(var d=0;d<this._sounds.length;d++){if(this._sounds[d]){this._sounds[d].pause()}}},resumeAll:function(){for(var d=0;d<this._sounds.length;d++){if(this._sounds[d]){this._sounds[d].resume()}}},decode:function(e,g){g=g||null;var d=this.game.cache.getSoundData(e);if(d){if(this.game.cache.isSoundDecoded(e)===false){this.game.cache.updateSound(e,"isDecoding",true);var f=this;this.context.decodeAudioData(d,function(h){f.game.cache.decodedSound(e,h);if(g){f.onSoundDecode.dispatch(e,g)}})}}},update:function(){if(this.touchLocked){if(this.game.device.webAudio&&this._unlockSource!==null){if((this._unlockSource.playbackState===this._unlockSource.PLAYING_STATE||this._unlockSource.playbackState===this._unlockSource.FINISHED_STATE)){this.touchLocked=false;this._unlockSource=null;this.game.input.touch.callbackContext=null;this.game.input.touch.touchStartCallback=null}}}for(var d=0;d<this._sounds.length;d++){this._sounds[d].update()}},add:function(f,g,d,e){if(typeof g==="undefined"){g=1}if(typeof d==="undefined"){d=false}if(typeof e==="undefined"){e=this.connectToMaster}var h=new b.Sound(this.game,f,g,d,e);this._sounds.push(h);return h},remove:function(e){var d=this._sounds.length;while(d--){if(this._sounds[d]===e){this._sounds[d].destroy(false);this._sounds.splice(d,1);return true}}return false},removeByKey:function(e){var d=this._sounds.length;var f=0;while(d--){if(this._sounds[d].key===e){this._sounds[d].destroy(false);this._sounds.splice(d,1);f++}}return f},play:function(e,f,d){var g=this.add(e,f,d);g.play();return g},setMute:function(){if(this._muted){return}this._muted=true;if(this.usingWebAudio){this._muteVolume=this.masterGain.gain.value;this.masterGain.gain.value=0}for(var d=0;d<this._sounds.length;d++){if(this._sounds[d].usingAudioTag){this._sounds[d].mute=true}}},unsetMute:function(){if(!this._muted||this._codeMuted){return}this._muted=false;if(this.usingWebAudio){this.masterGain.gain.value=this._muteVolume}for(var d=0;d<this._sounds.length;d++){if(this._sounds[d].usingAudioTag){this._sounds[d].mute=false}}}};b.SoundManager.prototype.constructor=b.SoundManager;Object.defineProperty(b.SoundManager.prototype,"mute",{get:function(){return this._muted},set:function(d){d=d||null;if(d){if(this._muted){return}this._codeMuted=true;this.setMute()}else{if(!this._muted){return}this._codeMuted=false;this.unsetMute()}}});Object.defineProperty(b.SoundManager.prototype,"volume",{get:function(){if(this.usingWebAudio){return this.masterGain.gain.value}else{return this._volume}},set:function(e){this._volume=e;if(this.usingWebAudio){this.masterGain.gain.value=e}else{for(var d=0;d<this._sounds.length;d++){if(this._sounds[d].usingAudioTag){this._sounds[d].volume=this._sounds[d].volume*e}}}}});b.Utils.Debug=function(d){this.game=d;this.sprite=null;this.canvas=null;this.baseTexture=null;this.texture=null;this.textureFrame=null;this.context=null;this.font="14px Courier";this.columnWidth=100;this.lineHeight=16;this.renderShadow=true;this.currentX=0;this.currentY=0;this.currentAlpha=1;this.dirty=false};b.Utils.Debug.prototype={boot:function(){if(this.game.renderType===b.CANVAS){this.context=this.game.context}else{this.canvas=b.Canvas.create(this.game.width,this.game.height,"",true);this.context=this.canvas.getContext("2d");this.baseTexture=new PIXI.BaseTexture(this.canvas);this.texture=new PIXI.Texture(this.baseTexture);this.textureFrame=new b.Frame(0,0,0,this.game.width,this.game.height,"debug",this.game.rnd.uuid());this.sprite=this.game.make.image(0,0,this.texture,this.textureFrame);this.game.stage.addChild(this.sprite)}},preUpdate:function(){if(this.dirty&&this.sprite){this.context.clearRect(0,0,this.game.width,this.game.height);this.dirty=false}},start:function(d,g,e,f){if(typeof d!=="number"){d=0}if(typeof g!=="number"){g=0}e=e||"rgb(255,255,255)";if(typeof f==="undefined"){f=0}this.currentX=d;this.currentY=g;this.currentColor=e;this.currentAlpha=this.context.globalAlpha;this.columnWidth=f;if(this.sprite){this.dirty=true}this.context.save();this.context.setTransform(1,0,0,1,0,0);this.context.strokeStyle=e;this.context.fillStyle=e;this.context.font=this.font;this.context.globalAlpha=1},stop:function(){this.context.restore();this.context.globalAlpha=this.currentAlpha;if(this.sprite){PIXI.updateWebGLTexture(this.baseTexture,this.game.renderer.gl)}},line:function(){var d=this.currentX;for(var e=0;e<arguments.length;e++){if(this.renderShadow){this.context.fillStyle="rgb(0,0,0)";this.context.fillText(arguments[e],d+1,this.currentY+1);this.context.fillStyle=this.currentColor}this.context.fillText(arguments[e],d,this.currentY);d+=this.columnWidth}this.currentY+=this.lineHeight},soundInfo:function(f,d,g,e){this.start(d,g,e);this.line("Sound: "+f.key+" Locked: "+f.game.sound.touchLocked);this.line("Is Ready?: "+this.game.cache.isSoundReady(f.key)+" Pending Playback: "+f.pendingPlayback);this.line("Decoded: "+f.isDecoded+" Decoding: "+f.isDecoding);this.line("Total Duration: "+f.totalDuration+" Playing: "+f.isPlaying);this.line("Time: "+f.currentTime);this.line("Volume: "+f.volume+" Muted: "+f.mute);this.line("WebAudio: "+f.usingWebAudio+" Audio: "+f.usingAudioTag);if(f.currentMarker!==""){this.line("Marker: "+f.currentMarker+" Duration: "+f.duration+" (ms: "+f.durationMS+")");this.line("Start: "+f.markers[f.currentMarker].start+" Stop: "+f.markers[f.currentMarker].stop);this.line("Position: "+f.position)}this.stop()},cameraInfo:function(f,d,g,e){this.start(d,g,e);this.line("Camera ("+f.width+" x "+f.height+")");this.line("X: "+f.x+" Y: "+f.y);this.line("Bounds x: "+f.bounds.x+" Y: "+f.bounds.y+" w: "+f.bounds.width+" h: "+f.bounds.height);this.line("View x: "+f.view.x+" Y: "+f.view.y+" w: "+f.view.width+" h: "+f.view.height);this.stop()},timer:function(g,d,f,e){this.start(d,f,e);this.line("Timer (running: "+g.running+" expired: "+g.expired+")");this.line("Next Tick: "+g.next+" Duration: "+g.duration);this.line("Paused: "+g.paused+" Length: "+g.length);this.stop()},pointer:function(h,g,e,f,d){if(h==null){return}if(typeof g==="undefined"){g=false}e=e||"rgba(0,255,0,0.5)";f=f||"rgba(255,0,0,0.5)";if(g===true&&h.isUp===true){return}this.start(h.x,h.y-100,d);this.context.beginPath();this.context.arc(h.x,h.y,h.circle.radius,0,Math.PI*2);if(h.active){this.context.fillStyle=e}else{this.context.fillStyle=f}this.context.fill();this.context.closePath();this.context.beginPath();this.context.moveTo(h.positionDown.x,h.positionDown.y);this.context.lineTo(h.position.x,h.position.y);this.context.lineWidth=2;this.context.stroke();this.context.closePath();this.line("ID: "+h.id+" Active: "+h.active);this.line("World X: "+h.worldX+" World Y: "+h.worldY);this.line("Screen X: "+h.x+" Screen Y: "+h.y);this.line("Duration: "+h.duration+" ms");this.line("is Down: "+h.isDown+" is Up: "+h.isUp);this.stop()},spriteInputInfo:function(f,d,g,e){this.start(d,g,e);this.line("Sprite Input: ("+f.width+" x "+f.height+")");this.line("x: "+f.input.pointerX().toFixed(1)+" y: "+f.input.pointerY().toFixed(1));this.line("over: "+f.input.pointerOver()+" duration: "+f.input.overDuration().toFixed(0));this.line("down: "+f.input.pointerDown()+" duration: "+f.input.downDuration().toFixed(0));this.line("just over: "+f.input.justOver()+" just out: "+f.input.justOut());this.stop()},key:function(f,d,g,e){this.start(d,g,e,150);this.line("Key:",f.keyCode,"isDown:",f.isDown);this.line("justPressed:",f.justPressed(),"justReleased:",f.justReleased());this.line("Time Down:",f.timeDown.toFixed(0),"duration:",f.duration.toFixed(0));this.stop()},inputInfo:function(d,f,e){this.start(d,f,e);this.line("Input");this.line("X: "+this.game.input.x+" Y: "+this.game.input.y);this.line("World X: "+this.game.input.worldX+" World Y: "+this.game.input.worldY);this.line("Scale X: "+this.game.input.scale.x.toFixed(1)+" Scale Y: "+this.game.input.scale.x.toFixed(1));this.line("Screen X: "+this.game.input.activePointer.screenX+" Screen Y: "+this.game.input.activePointer.screenY);this.stop()},spriteBounds:function(e,d,g){var f=e.getBounds();f.x+=this.game.camera.x;f.y+=this.game.camera.y;this.rectangle(f,d,g)},spriteInfo:function(f,d,g,e){this.start(d,g,e);this.line("Sprite:  ("+f.width+" x "+f.height+") anchor: "+f.anchor.x+" x "+f.anchor.y);this.line("x: "+f.x.toFixed(1)+" y: "+f.y.toFixed(1));this.line("angle: "+f.angle.toFixed(1)+" rotation: "+f.rotation.toFixed(1));this.line("visible: "+f.visible+" in camera: "+f.inCamera);this.stop()},spriteCoords:function(f,d,g,e){this.start(d,g,e,100);if(f.name){this.line(f.name)}this.line("x:",f.x.toFixed(2),"y:",f.y.toFixed(2));this.line("pos x:",f.position.x.toFixed(2),"pos y:",f.position.y.toFixed(2));this.line("world x:",f.world.x.toFixed(2),"world y:",f.world.y.toFixed(2));this.stop()},lineInfo:function(e,d,g,f){this.start(d,g,f,80);this.line("start.x:",e.start.x.toFixed(2),"start.y:",e.start.y.toFixed(2));this.line("end.x:",e.end.x.toFixed(2),"end.y:",e.end.y.toFixed(2));this.line("length:",e.length.toFixed(2),"angle:",e.angle);this.stop()},pixel:function(d,g,e,f){f=f||2;this.start();this.context.fillStyle=e;this.context.fillRect(d,g,f,f);this.stop()},geom:function(e,d,g,f){if(typeof g==="undefined"){g=true}if(typeof f==="undefined"){f=0}d=d||"rgba(0,255,0,0.4)";this.start();this.context.fillStyle=d;this.context.strokeStyle=d;if(e instanceof b.Rectangle||f===1){if(g){this.context.fillRect(e.x-this.game.camera.x,e.y-this.game.camera.y,e.width,e.height)}else{this.context.strokeRect(e.x-this.game.camera.x,e.y-this.game.camera.y,e.width,e.height)}}else{if(e instanceof b.Circle||f===2){this.context.beginPath();this.context.arc(e.x-this.game.camera.x,e.y-this.game.camera.y,e.radius,0,Math.PI*2,false);this.context.closePath();if(g){this.context.fill()}else{this.context.stroke()}}else{if(e instanceof b.Point||f===3){this.context.fillRect(e.x-this.game.camera.x,e.y-this.game.camera.y,4,4)}else{if(e instanceof b.Line||f===4){this.context.lineWidth=1;this.context.beginPath();this.context.moveTo((e.start.x+0.5)-this.game.camera.x,(e.start.y+0.5)-this.game.camera.y);this.context.lineTo((e.end.x+0.5)-this.game.camera.x,(e.end.y+0.5)-this.game.camera.y);this.context.closePath();this.context.stroke()}}}}this.stop()},rectangle:function(e,d,f){if(typeof f==="undefined"){f=true}d=d||"rgba(0, 255, 0, 0.4)";this.start();if(f){this.context.fillStyle=d;this.context.fillRect(e.x-this.game.camera.x,e.y-this.game.camera.y,e.width,e.height)}else{this.context.strokeStyle=d;this.context.strokeRect(e.x-this.game.camera.x,e.y-this.game.camera.y,e.width,e.height)}this.stop()},text:function(g,d,h,f,e){f=f||"rgb(255,255,255)";e=e||"16px Courier";this.start();this.context.font=e;if(this.renderShadow){this.context.fillStyle="rgb(0,0,0)";this.context.fillText(g,d+1,h+1)}this.context.fillStyle=f;this.context.fillText(g,d,h);this.stop()},quadTree:function(d,e){e=e||"rgba(255,0,0,0.3)";this.start();var g=d.bounds;if(d.nodes.length===0){this.context.strokeStyle=e;this.context.strokeRect(g.x,g.y,g.width,g.height);this.text("size: "+d.objects.length,g.x+4,g.y+16,"rgb(0,200,0)","12px Courier");this.context.strokeStyle="rgb(0,255,0)";for(var f=0;f<d.objects.length;f++){this.context.strokeRect(d.objects[f].x,d.objects[f].y,d.objects[f].width,d.objects[f].height)}}else{for(var f=0;f<d.nodes.length;f++){this.quadTree(d.nodes[f])}}this.stop()},body:function(e,d,f){if(e.body){if(e.body.type===b.Physics.ARCADE){this.start();b.Physics.Arcade.Body.render(this.context,e.body,d,f);this.stop()}else{if(e.body.type===b.Physics.NINJA){this.start();b.Physics.Ninja.Body.render(this.context,e.body,d,f);this.stop()}}}},bodyInfo:function(f,d,g,e){if(f.body){if(f.body.type===b.Physics.ARCADE){this.start(d,g,e,210);b.Physics.Arcade.Body.renderBodyInfo(this,f.body);this.stop()}}}};b.Utils.Debug.prototype.constructor=b.Utils.Debug;b.Color={packPixel:function(h,f,d,e){if(b.Device.LITTLE_ENDIAN){return((e<<24)|(d<<16)|(f<<8)|h)>>>0}else{return((h<<24)|(f<<16)|(d<<8)|e)>>>0}},unpackPixel:function(g,f,d,e){if(typeof f==="undefined"||f===null){f=b.Color.createColor()}if(typeof d==="undefined"||d===null){d=false}if(typeof e==="undefined"||e===null){e=false}if(b.Device.LITTLE_ENDIAN){f.a=((g&4278190080)>>>24);f.b=((g&16711680)>>>16);f.g=((g&65280)>>>8);f.r=((g&255))}else{f.r=((g&4278190080)>>>24);f.g=((g&16711680)>>>16);f.b=((g&65280)>>>8);f.a=((g&255))}f.color=g;f.rgba="rgba("+f.r+","+f.g+","+f.b+","+(f.a/255)+")";if(d){b.Color.RGBtoHSL(f.r,f.g,f.b,f)}if(e){b.Color.RGBtoHSV(f.r,f.g,f.b,f)}return f},fromRGBA:function(e,d){if(!d){d=b.Color.createColor()}d.r=((e&4278190080)>>>24);d.g=((e&16711680)>>>16);d.b=((e&65280)>>>8);d.a=((e&255));d.rgba="rgba("+d.r+","+d.g+","+d.b+","+d.a+")";return d},toRGBA:function(h,f,d,e){return(h<<24)|(f<<16)|(d<<8)|e},RGBtoHSL:function(k,j,f,h){if(!h){h=b.Color.createColor(k,j,f,1)}k/=255;j/=255;f/=255;var i=Math.min(k,j,f);var e=Math.max(k,j,f);h.h=0;h.s=0;h.l=(e+i)/2;if(e!==i){var l=e-i;h.s=h.l>0.5?l/(2-e-i):l/(e+i);if(e===k){h.h=(j-f)/l+(j<f?6:0)}else{if(e===j){h.h=(f-k)/l+2}else{if(e===f){h.h=(k-j)/l+4}}}h.h/=6}return h},HSLtoRGB:function(g,f,d,e){if(!e){e=b.Color.createColor(d,d,d)}else{e.r=d;e.g=d;e.b=d}if(f!==0){var i=d<0.5?d*(1+f):d+f-d*f;var j=2*d-i;e.r=b.Color.hueToColor(j,i,g+1/3);e.g=b.Color.hueToColor(j,i,g);e.b=b.Color.hueToColor(j,i,g-1/3)}e.r=Math.floor((e.r*255|0));e.g=Math.floor((e.g*255|0));e.b=Math.floor((e.b*255|0));b.Color.updateColor(e);return e},RGBtoHSV:function(k,j,f,h){if(!h){h=b.Color.createColor(k,j,f,255)}k/=255;j/=255;f/=255;var i=Math.min(k,j,f);var e=Math.max(k,j,f);var l=e-i;h.h=0;h.s=e===0?0:l/e;h.v=e;if(e!==i){if(e===k){h.h=(j-f)/l+(j<f?6:0)}else{if(e===j){h.h=(f-k)/l+2}else{if(e===f){h.h=(k-j)/l+4}}}h.h/=6}return h},HSVtoRGB:function(m,y,w,k){if(typeof k==="undefined"){k=b.Color.createColor(0,0,0,1,m,y,0,w)}var d,n,u;var l=Math.floor(m*6);var o=m*6-l;var j=w*(1-y);var e=w*(1-o*y);var x=w*(1-(1-o)*y);switch(l%6){case 0:d=w;n=x;u=j;break;case 1:d=e;n=w;u=j;break;case 2:d=j;n=w;u=x;break;case 3:d=j;n=e;u=w;break;case 4:d=x;n=j;u=w;break;case 5:d=w;n=j;u=e;break}k.r=Math.floor(d*255);k.g=Math.floor(n*255);k.b=Math.floor(u*255);b.Color.updateColor(k);return k},hueToColor:function(f,e,d){if(d<0){d+=1}if(d>1){d-=1}if(d<1/6){return f+(e-f)*6*d}if(d<1/2){return e}if(d<2/3){return f+(e-f)*(2/3-d)*6}return f},createColor:function(d,j,k,m,i,o,e,n){var f={r:d||0,g:j||0,b:k||0,a:m||1,h:i||0,s:o||0,l:e||0,v:n||0,color:0};f.rgba="rgba("+f.r+","+f.g+","+f.b+","+f.a+")";return f},updateColor:function(d){d.rgba="rgba("+d.r+","+d.g+","+d.b+","+d.a+")";return d},getColor32:function(e,h,f,d){return e<<24|h<<16|f<<8|d},getColor:function(f,e,d){return f<<16|e<<8|d},RGBtoString:function(h,f,d,e,i){if(typeof e==="undefined"){e=255}if(typeof i==="undefined"){i="#"}if(i==="#"){return"#"+((1<<24)+(h<<16)+(f<<8)+d).toString(16).slice(1)}else{return"0x"+b.Color.componentToHex(e)+b.Color.componentToHex(h)+b.Color.componentToHex(f)+b.Color.componentToHex(d)}},hexToRGB:function(e){var d=b.Color.hexToColor(e);if(d){return b.Color.getColor32(d.a,d.r,d.g,d.b)}},hexToColor:function(g,f){if(!f){f=b.Color.createColor()}var e=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;g=g.replace(e,function(i,k,j,h){return k+k+j+j+h+h});var d=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(g);if(d){f.r=parseInt(d[1],16);f.g=parseInt(d[2],16);f.b=parseInt(d[3],16)}return f},componentToHex:function(d){var e=d.toString(16);return e.length==1?"0"+e:e},HSVColorWheel:function(f,e){if(typeof f==="undefined"){f=1}if(typeof e==="undefined"){e=1}var d=[];for(var g=0;g<=359;g++){d.push(b.Color.HSVtoRGB(g/359,f,e))}return d},HSLColorWheel:function(f,e){if(typeof f==="undefined"){f=0.5}if(typeof e==="undefined"){e=0.5}var d=[];for(var g=0;g<=359;g++){d.push(b.Color.HSLtoRGB(g/359,f,e))}return d},interpolateColor:function(n,m,l,e,i){if(typeof i==="undefined"){i=255}var h=b.Color.getRGB(n);var f=b.Color.getRGB(m);var d=(((f.red-h.red)*e)/l)+h.red;var j=(((f.green-h.green)*e)/l)+h.green;var k=(((f.blue-h.blue)*e)/l)+h.blue;return b.Color.getColor32(i,d,j,k)},interpolateColorWithRGB:function(i,e,k,m,l,f){var d=b.Color.getRGB(i);var j=(((e-d.red)*f)/l)+d.red;var n=(((k-d.green)*f)/l)+d.green;var h=(((m-d.blue)*f)/l)+d.blue;return b.Color.getColor(j,n,h)},interpolateRGB:function(i,e,n,h,o,l,m,f){var d=(((h-i)*f)/m)+i;var j=(((o-e)*f)/m)+e;var k=(((l-n)*f)/m)+n;return b.Color.getColor(d,j,k)},getRandomColor:function(f,e,i){if(typeof f==="undefined"){f=0}if(typeof e==="undefined"){e=255}if(typeof i==="undefined"){i=255}if(e>255||f>e){return b.Color.getColor(255,255,255)}var h=f+Math.round(Math.random()*(e-f));var g=f+Math.round(Math.random()*(e-f));var d=f+Math.round(Math.random()*(e-f));return b.Color.getColor32(i,h,g,d)},getRGB:function(d){if(d>16777215){return{alpha:d>>>24,red:d>>16&255,green:d>>8&255,blue:d&255,a:d>>>24,r:d>>16&255,g:d>>8&255,b:d&255}}else{return{alpha:255,red:d>>16&255,green:d>>8&255,blue:d&255,a:255,r:d>>16&255,g:d>>8&255,b:d&255}}},getWebRGB:function(d){if(typeof d==="object"){return"rgba("+d.r.toString()+","+d.g.toString()+","+d.b.toString()+","+(d.a/255).toString()+")"}else{var e=b.Color.getRGB(d);return"rgba("+e.r.toString()+","+e.g.toString()+","+e.b.toString()+","+(e.a/255).toString()+")"}},getAlpha:function(d){return d>>>24},getAlphaFloat:function(d){return(d>>>24)/255},getRed:function(d){return d>>16&255},getGreen:function(d){return d>>8&255},getBlue:function(d){return d&255},getColorInfo:function(e){var f=b.Color.getRGB(e);var d=b.Color.RGBtoHexstring(e)+"\n";d=d.concat("Alpha: "+f.alpha+" Red: "+f.red+" Green: "+f.green+" Blue: "+f.blue)+"\n";return d},RGBtoHexstring:function(d){var e=b.Color.getRGB(d);return"0x"+b.Color.colorToHexstring(e.alpha)+b.Color.colorToHexstring(e.red)+b.Color.colorToHexstring(e.green)+b.Color.colorToHexstring(e.blue)},RGBtoWebstring:function(d){var e=b.Color.getRGB(d);return"#"+b.Color.colorToHexstring(e.red)+b.Color.colorToHexstring(e.green)+b.Color.colorToHexstring(e.blue)},colorToHexstring:function(f){var h="0123456789ABCDEF";var g=f%16;var e=(f-g)/16;var d=h.charAt(e)+h.charAt(g);return d}};b.Physics=function(d,e){e=e||{};this.game=d;this.config=e;this.arcade=null;this.p2=null;this.ninja=null;this.box2d=null;this.chipmunk=null;this.parseConfig()};b.Physics.ARCADE=0;b.Physics.P2JS=1;b.Physics.NINJA=2;b.Physics.BOX2D=3;b.Physics.CHIPMUNK=5;b.Physics.prototype={parseConfig:function(){if((!this.config.hasOwnProperty("arcade")||this.config.arcade===true)&&b.Physics.hasOwnProperty("Arcade")){this.arcade=new b.Physics.Arcade(this.game);this.game.time.deltaCap=0.2}if(this.config.hasOwnProperty("ninja")&&this.config.ninja===true&&b.Physics.hasOwnProperty("Ninja")){this.ninja=new b.Physics.Ninja(this.game)}if(this.config.hasOwnProperty("p2")&&this.config.p2===true&&b.Physics.hasOwnProperty("P2")){this.p2=new b.Physics.P2(this.game,this.config)}},startSystem:function(d){if(d===b.Physics.ARCADE){this.arcade=new b.Physics.Arcade(this.game)}else{if(d===b.Physics.P2JS){this.p2=new b.Physics.P2(this.game,this.config)}}if(d===b.Physics.NINJA){this.ninja=new b.Physics.Ninja(this.game)}else{if(d===b.Physics.BOX2D&&this.box2d===null){throw new Error("The Box2D physics system has not been implemented yet.")}else{if(d===b.Physics.CHIPMUNK&&this.chipmunk===null){throw new Error("The Chipmunk physics system has not been implemented yet.")}}}this.setBoundsToWorld()},enable:function(e,f,d){if(typeof f==="undefined"){f=b.Physics.ARCADE}if(typeof d==="undefined"){d=false}if(f===b.Physics.ARCADE){this.arcade.enable(e)}else{if(f===b.Physics.P2JS&&this.p2){this.p2.enable(e,d)}else{if(f===b.Physics.NINJA&&this.ninja){this.ninja.enableAABB(e)}}}},preUpdate:function(){if(this.p2){this.p2.preUpdate()}},update:function(){if(this.p2){this.p2.update()}},setBoundsToWorld:function(){if(this.arcade){this.arcade.setBoundsToWorld()}if(this.ninja){this.ninja.setBoundsToWorld()}if(this.p2){this.p2.setBoundsToWorld()}},clear:function(){if(this.p2){this.p2.clear()}},destroy:function(){if(this.p2){this.p2.destroy()}this.arcade=null;this.ninja=null;this.p2=null}};b.Physics.prototype.constructor=b.Physics;b.Physics.Arcade=function(d){this.game=d;this.gravity=new b.Point();this.bounds=new b.Rectangle(0,0,d.world.width,d.world.height);this.checkCollision={up:true,down:true,left:true,right:true};this.maxObjects=10;this.maxLevels=4;this.OVERLAP_BIAS=4;this.TILE_BIAS=16;this.forceX=false;this.quadTree=new b.QuadTree(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels);this._overlap=0;this._maxOverlap=0;this._velocity1=0;this._velocity2=0;this._newVelocity1=0;this._newVelocity2=0;this._average=0;this._mapData=[];this._result=false;this._total=0;this._angle=0;this._dx=0;this._dy=0};b.Physics.Arcade.prototype.constructor=b.Physics.Arcade;b.Physics.Arcade.prototype={setBounds:function(e,g,f,d){this.bounds.setTo(e,g,f,d)},setBoundsToWorld:function(){this.bounds.setTo(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height)},enable:function(d,f){if(typeof f==="undefined"){f=true}var e=1;if(Array.isArray(d)){e=d.length;while(e--){if(d[e] instanceof b.Group){this.enable(d[e].children,f)}else{this.enableBody(d[e]);if(f&&d[e].hasOwnProperty("children")&&d[e].children.length>0){this.enable(d[e],true)}}}}else{if(d instanceof b.Group){this.enable(d.children,f)}else{this.enableBody(d);if(f&&d.hasOwnProperty("children")&&d.children.length>0){this.enable(d.children,true)}}}},enableBody:function(d){if(d.hasOwnProperty("body")&&d.body===null){d.body=new b.Physics.Arcade.Body(d)}},updateMotion:function(d){this._velocityDelta=this.computeVelocity(0,d,d.angularVelocity,d.angularAcceleration,d.angularDrag,d.maxAngular)-d.angularVelocity;d.angularVelocity+=this._velocityDelta;d.rotation+=(d.angularVelocity*this.game.time.physicsElapsed);d.velocity.x=this.computeVelocity(1,d,d.velocity.x,d.acceleration.x,d.drag.x,d.maxVelocity.x);d.velocity.y=this.computeVelocity(2,d,d.velocity.y,d.acceleration.y,d.drag.y,d.maxVelocity.y)},computeVelocity:function(g,e,i,h,f,d){d=d||10000;if(g==1&&e.allowGravity){i+=(this.gravity.x+e.gravity.x)*this.game.time.physicsElapsed}else{if(g==2&&e.allowGravity){i+=(this.gravity.y+e.gravity.y)*this.game.time.physicsElapsed}}if(h){i+=h*this.game.time.physicsElapsed}else{if(f){this._drag=f*this.game.time.physicsElapsed;if(i-this._drag>0){i-=this._drag}else{if(i+this._drag<0){i+=this._drag}else{i=0}}}}if(i>d){i=d}else{if(i<-d){i=-d}}return i},overlap:function(k,j,e,h,f){e=e||null;h=h||null;f=f||e;this._result=false;this._total=0;if(Array.isArray(j)){for(var g=0,d=j.length;g<d;g++){this.collideHandler(k,j[g],e,h,f,true)}}else{this.collideHandler(k,j,e,h,f,true)}return(this._total>0)},collide:function(k,j,h,g,e){h=h||null;g=g||null;e=e||h;this._result=false;this._total=0;if(Array.isArray(j)){for(var f=0,d=j.length;f<d;f++){this.collideHandler(k,j[f],h,g,e,false)}}else{this.collideHandler(k,j,h,g,e,false)}return(this._total>0)},collideHandler:function(i,h,g,f,d,e){if(typeof h==="undefined"&&(i.type===b.GROUP||i.type===b.EMITTER)){this.collideGroupVsSelf(i,g,f,d,e);return}if(i&&h&&i.exists&&h.exists){if(i.type==b.SPRITE||i.type==b.TILESPRITE){if(h.type==b.SPRITE||h.type==b.TILESPRITE){this.collideSpriteVsSprite(i,h,g,f,d,e)}else{if(h.type==b.GROUP||h.type==b.EMITTER){this.collideSpriteVsGroup(i,h,g,f,d,e)}else{if(h.type==b.TILEMAPLAYER){this.collideSpriteVsTilemapLayer(i,h,g,f,d)}}}}else{if(i.type==b.GROUP){if(h.type==b.SPRITE||h.type==b.TILESPRITE){this.collideSpriteVsGroup(h,i,g,f,d,e)}else{if(h.type==b.GROUP||h.type==b.EMITTER){this.collideGroupVsGroup(i,h,g,f,d,e)}else{if(h.type==b.TILEMAPLAYER){this.collideGroupVsTilemapLayer(i,h,g,f,d)}}}}else{if(i.type==b.TILEMAPLAYER){if(h.type==b.SPRITE||h.type==b.TILESPRITE){this.collideSpriteVsTilemapLayer(h,i,g,f,d)}else{if(h.type==b.GROUP||h.type==b.EMITTER){this.collideGroupVsTilemapLayer(h,i,g,f,d)}}}else{if(i.type==b.EMITTER){if(h.type==b.SPRITE||h.type==b.TILESPRITE){this.collideSpriteVsGroup(h,i,g,f,d,e)}else{if(h.type==b.GROUP||h.type==b.EMITTER){this.collideGroupVsGroup(i,h,g,f,d,e)}else{if(h.type==b.TILEMAPLAYER){this.collideGroupVsTilemapLayer(i,h,g,f,d)}}}}}}}}},collideSpriteVsSprite:function(i,h,g,f,d,e){if(!i.body||!h.body){return false}if(this.separate(i.body,h.body,f,d,e)){if(g){g.call(d,i,h)}this._total++}return true},collideSpriteVsGroup:function(h,l,k,j,e,f){if(l.length===0||!h.body){return}this.quadTree.clear();this.quadTree.reset(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels);this.quadTree.populate(l);this._potentials=this.quadTree.retrieve(h);for(var g=0,d=this._potentials.length;g<d;g++){if(this.separate(h.body,this._potentials[g],j,e,f)){if(k){k.call(e,h,this._potentials[g].sprite)}this._total++}}},collideGroupVsSelf:function(m,l,k,e,g){if(m.length===0){return}var d=m.children.length;for(var h=0;h<d;h++){for(var f=h+1;f<=d;f++){if(m.children[h]&&m.children[f]&&m.children[h].exists&&m.children[f].exists){this.collideSpriteVsSprite(m.children[h],m.children[f],l,k,e,g)}}}},collideGroupVsGroup:function(e,l,k,j,f,g){if(e.length===0||l.length===0){return}for(var h=0,d=e.children.length;h<d;h++){if(e.children[h].exists){this.collideSpriteVsGroup(e.children[h],l,k,j,f,g)}}},collideSpriteVsTilemapLayer:function(g,d,j,h,e){if(!g.body){return}this._mapData=d.getTiles(g.body.position.x-g.body.tilePadding.x,g.body.position.y-g.body.tilePadding.y,g.body.width+g.body.tilePadding.x,g.body.height+g.body.tilePadding.y,false,false);if(this._mapData.length===0){return}for(var f=0;f<this._mapData.length;f++){if(h){if(h.call(e,g,this._mapData[f])){if(this.separateTile(f,g.body,this._mapData[f])){this._total++;if(j){j.call(e,g,this._mapData[f])}}}}else{if(this.separateTile(f,g.body,this._mapData[f])){this._total++;if(j){j.call(e,g,this._mapData[f])}}}}},collideGroupVsTilemapLayer:function(k,e,j,h,f){if(k.length===0){return}for(var g=0,d=k.children.length;g<d;g++){if(k.children[g].exists){this.collideSpriteVsTilemapLayer(k.children[g],e,j,h,f)}}},separate:function(g,e,h,d,f){if(!g.enable||!e.enable||!this.intersects(g,e)){return false}if(h&&h.call(d,g.sprite,e.sprite)===false){return false}if(f){return true}if(this.forceX||Math.abs(this.gravity.y+g.gravity.y)<Math.abs(this.gravity.x+g.gravity.x)){this._result=(this.separateX(g,e,f)||this.separateY(g,e,f))}else{this._result=(this.separateY(g,e,f)||this.separateX(g,e,f))}return this._result},intersects:function(e,d){if(e.right<=d.position.x){return false}if(e.bottom<=d.position.y){return false}if(e.position.x>=d.right){return false}if(e.position.y>=d.bottom){return false}return true},separateX:function(f,d,e){if(f.immovable&&d.immovable){return false}this._overlap=0;if(this.intersects(f,d)){this._maxOverlap=f.deltaAbsX()+d.deltaAbsX()+this.OVERLAP_BIAS;if(f.deltaX()===0&&d.deltaX()===0){f.embedded=true;d.embedded=true}else{if(f.deltaX()>d.deltaX()){this._overlap=f.right-d.x;if((this._overlap>this._maxOverlap)||f.checkCollision.right===false||d.checkCollision.left===false){this._overlap=0}else{f.touching.none=false;f.touching.right=true;d.touching.none=false;d.touching.left=true}}else{if(f.deltaX()<d.deltaX()){this._overlap=f.x-d.width-d.x;if((-this._overlap>this._maxOverlap)||f.checkCollision.left===false||d.checkCollision.right===false){this._overlap=0}else{f.touching.none=false;f.touching.left=true;d.touching.none=false;d.touching.right=true}}}}if(this._overlap!==0){f.overlapX=this._overlap;d.overlapX=this._overlap;if(e||f.customSeparateX||d.customSeparateX){return true}this._velocity1=f.velocity.x;this._velocity2=d.velocity.x;if(!f.immovable&&!d.immovable){this._overlap*=0.5;f.x=f.x-this._overlap;d.x+=this._overlap;this._newVelocity1=Math.sqrt((this._velocity2*this._velocity2*d.mass)/f.mass)*((this._velocity2>0)?1:-1);this._newVelocity2=Math.sqrt((this._velocity1*this._velocity1*f.mass)/d.mass)*((this._velocity1>0)?1:-1);this._average=(this._newVelocity1+this._newVelocity2)*0.5;this._newVelocity1-=this._average;this._newVelocity2-=this._average;f.velocity.x=this._average+this._newVelocity1*f.bounce.x;d.velocity.x=this._average+this._newVelocity2*d.bounce.x}else{if(!f.immovable){f.x=f.x-this._overlap;f.velocity.x=this._velocity2-this._velocity1*f.bounce.x}else{if(!d.immovable){d.x+=this._overlap;d.velocity.x=this._velocity1-this._velocity2*d.bounce.x}}}return true}}return false},separateY:function(f,d,e){if(f.immovable&&d.immovable){return false}this._overlap=0;if(this.intersects(f,d)){this._maxOverlap=f.deltaAbsY()+d.deltaAbsY()+this.OVERLAP_BIAS;if(f.deltaY()===0&&d.deltaY()===0){f.embedded=true;d.embedded=true}else{if(f.deltaY()>d.deltaY()){this._overlap=f.bottom-d.y;if((this._overlap>this._maxOverlap)||f.checkCollision.down===false||d.checkCollision.up===false){this._overlap=0}else{f.touching.none=false;f.touching.down=true;d.touching.none=false;d.touching.up=true}}else{if(f.deltaY()<d.deltaY()){this._overlap=f.y-d.bottom;if((-this._overlap>this._maxOverlap)||f.checkCollision.up===false||d.checkCollision.down===false){this._overlap=0}else{f.touching.none=false;f.touching.up=true;d.touching.none=false;d.touching.down=true}}}}if(this._overlap!==0){f.overlapY=this._overlap;d.overlapY=this._overlap;if(e||f.customSeparateY||d.customSeparateY){return true}this._velocity1=f.velocity.y;this._velocity2=d.velocity.y;if(!f.immovable&&!d.immovable){this._overlap*=0.5;f.y=f.y-this._overlap;d.y+=this._overlap;this._newVelocity1=Math.sqrt((this._velocity2*this._velocity2*d.mass)/f.mass)*((this._velocity2>0)?1:-1);this._newVelocity2=Math.sqrt((this._velocity1*this._velocity1*f.mass)/d.mass)*((this._velocity1>0)?1:-1);this._average=(this._newVelocity1+this._newVelocity2)*0.5;this._newVelocity1-=this._average;this._newVelocity2-=this._average;f.velocity.y=this._average+this._newVelocity1*f.bounce.y;d.velocity.y=this._average+this._newVelocity2*d.bounce.y}else{if(!f.immovable){f.y=f.y-this._overlap;f.velocity.y=this._velocity2-this._velocity1*f.bounce.y;if(d.moves){f.x+=d.x-d.prev.x}}else{if(!d.immovable){d.y+=this._overlap;d.velocity.y=this._velocity1-this._velocity2*d.bounce.y;if(f.moves){d.x+=f.x-f.prev.x}}}}return true}}return false},separateTile:function(h,e,j){if(!e.enable||!j.intersects(e.position.x,e.position.y,e.right,e.bottom)){return false}if(j.collisionCallback&&!j.collisionCallback.call(j.collisionCallbackContext,e.sprite,j)){return false}else{if(j.layer.callbacks[j.index]&&!j.layer.callbacks[j.index].callback.call(j.layer.callbacks[j.index].callbackContext,e.sprite,j)){return false}}if(!j.faceLeft&&!j.faceRight&&!j.faceTop&&!j.faceBottom){return false}var g=0;var f=0;var d=0;var k=1;if(e.deltaAbsX()>e.deltaAbsY()){d=-1}else{if(e.deltaAbsX()<e.deltaAbsY()){k=-1}}if(e.deltaX()!==0&&e.deltaY()!==0&&(j.faceLeft||j.faceRight)&&(j.faceTop||j.faceBottom)){d=Math.min(Math.abs(e.position.x-j.right),Math.abs(e.right-j.left));k=Math.min(Math.abs(e.position.y-j.bottom),Math.abs(e.bottom-j.top))}if(d<k){if(j.faceLeft||j.faceRight){g=this.tileCheckX(e,j);if(g!==0&&!j.intersects(e.position.x,e.position.y,e.right,e.bottom)){return true}}if(j.faceTop||j.faceBottom){f=this.tileCheckY(e,j)}}else{if(j.faceTop||j.faceBottom){f=this.tileCheckY(e,j);if(f!==0&&!j.intersects(e.position.x,e.position.y,e.right,e.bottom)){return true}}if(j.faceLeft||j.faceRight){g=this.tileCheckX(e,j)}}return(g!==0||f!==0)},tileCheckX:function(d,f){var e=0;if(d.deltaX()<0&&!d.blocked.left&&f.collideRight&&d.checkCollision.left){if(f.faceRight&&d.x<f.right){e=d.x-f.right;if(e<-this.TILE_BIAS){e=0}}}else{if(d.deltaX()>0&&!d.blocked.right&&f.collideLeft&&d.checkCollision.right){if(f.faceLeft&&d.right>f.left){e=d.right-f.left;if(e>this.TILE_BIAS){e=0}}}}if(e!==0){this.processTileSeparationX(d,e)}return e},tileCheckY:function(d,f){var e=0;if(d.deltaY()<0&&!d.blocked.up&&f.collideDown&&d.checkCollision.up){if(f.faceBottom&&d.y<f.bottom){e=d.y-f.bottom;if(e<-this.TILE_BIAS){e=0}}}else{if(d.deltaY()>0&&!d.blocked.down&&f.collideUp&&d.checkCollision.down){if(f.faceTop&&d.bottom>f.top){e=d.bottom-f.top;if(e>this.TILE_BIAS){e=0}}}}if(e!==0){this.processTileSeparationY(d,e)}return e},processTileSeparationX:function(e,d){if(d<0){e.blocked.left=true}else{if(d>0){e.blocked.right=true}}e.position.x-=d;if(e.bounce.x===0){e.velocity.x=0}else{e.velocity.x=-e.velocity.x*e.bounce.x}},processTileSeparationY:function(d,e){if(e<0){d.blocked.up=true}else{if(e>0){d.blocked.down=true}}d.position.y-=e;if(d.bounce.y===0){d.velocity.y=0}else{d.velocity.y=-d.velocity.y*d.bounce.y}},getObjectsUnderPointer:function(k,j,l,f){if(j.length===0||!k.exists){return}this.quadTree.clear();this.quadTree.reset(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels);this.quadTree.populate(j);var h=new b.Rectangle(k.x,k.y,1,1);var e=[];this._potentials=this.quadTree.retrieve(h);for(var g=0,d=this._potentials.length;g<d;g++){if(this._potentials[g].hitTest(k.x,k.y)){if(l){l.call(f,k,this._potentials[g].sprite)}e.push(this._potentials[g].sprite)}}return e},moveToObject:function(g,d,f,e){if(typeof f==="undefined"){f=60}if(typeof e==="undefined"){e=0}this._angle=Math.atan2(d.y-g.y,d.x-g.x);if(e>0){f=this.distanceBetween(g,d)/(e/1000)}g.body.velocity.x=Math.cos(this._angle)*f;g.body.velocity.y=Math.sin(this._angle)*f;return this._angle},moveToPointer:function(g,e,f,d){if(typeof e==="undefined"){e=60}f=f||this.game.input.activePointer;if(typeof d==="undefined"){d=0}this._angle=this.angleToPointer(g,f);if(d>0){e=this.distanceToPointer(g,f)/(d/1000)}g.body.velocity.x=Math.cos(this._angle)*e;g.body.velocity.y=Math.sin(this._angle)*e;return this._angle},moveToXY:function(g,d,h,f,e){if(typeof f==="undefined"){f=60}if(typeof e==="undefined"){e=0}this._angle=Math.atan2(h-g.y,d-g.x);if(e>0){f=this.distanceToXY(g,d,h)/(e/1000)}g.body.velocity.x=Math.cos(this._angle)*f;g.body.velocity.y=Math.sin(this._angle)*f;return this._angle},velocityFromAngle:function(f,e,d){if(typeof e==="undefined"){e=60}d=d||new b.Point();return d.setTo((Math.cos(this.game.math.degToRad(f))*e),(Math.sin(this.game.math.degToRad(f))*e))},velocityFromRotation:function(e,f,d){if(typeof f==="undefined"){f=60}d=d||new b.Point();return d.setTo((Math.cos(e)*f),(Math.sin(e)*f))},accelerationFromRotation:function(e,f,d){if(typeof f==="undefined"){f=60}d=d||new b.Point();return d.setTo((Math.cos(e)*f),(Math.sin(e)*f))},accelerateToObject:function(g,e,f,d,h){if(typeof f==="undefined"){f=60}if(typeof d==="undefined"){d=1000}if(typeof h==="undefined"){h=1000}this._angle=this.angleBetween(g,e);g.body.acceleration.setTo(Math.cos(this._angle)*f,Math.sin(this._angle)*f);g.body.maxVelocity.setTo(d,h);return this._angle},accelerateToPointer:function(g,f,e,d,h){if(typeof e==="undefined"){e=60}if(typeof f==="undefined"){f=this.game.input.activePointer}if(typeof d==="undefined"){d=1000}if(typeof h==="undefined"){h=1000}this._angle=this.angleToPointer(g,f);g.body.acceleration.setTo(Math.cos(this._angle)*e,Math.sin(this._angle)*e);g.body.maxVelocity.setTo(d,h);return this._angle},accelerateToXY:function(g,e,i,f,d,h){if(typeof f==="undefined"){f=60}if(typeof d==="undefined"){d=1000}if(typeof h==="undefined"){h=1000}this._angle=this.angleToXY(g,e,i);g.body.acceleration.setTo(Math.cos(this._angle)*f,Math.sin(this._angle)*f);g.body.maxVelocity.setTo(d,h);return this._angle},distanceBetween:function(d,e){this._dx=d.x-e.x;this._dy=d.y-e.y;return Math.sqrt(this._dx*this._dx+this._dy*this._dy)},distanceToXY:function(e,d,f){this._dx=e.x-d;this._dy=e.y-f;return Math.sqrt(this._dx*this._dx+this._dy*this._dy)},distanceToPointer:function(e,d){d=d||this.game.input.activePointer;this._dx=e.x-d.x;this._dy=e.y-d.y;return Math.sqrt(this._dx*this._dx+this._dy*this._dy)},angleBetween:function(d,e){this._dx=e.x-d.x;this._dy=e.y-d.y;return Math.atan2(this._dy,this._dx)},angleToXY:function(e,d,f){this._dx=d-e.x;this._dy=f-e.y;return Math.atan2(this._dy,this._dx)},angleToPointer:function(e,d){d=d||this.game.input.activePointer;this._dx=d.worldX-e.x;this._dy=d.worldY-e.y;return Math.atan2(this._dy,this._dx)}};b.Physics.Arcade.Body=function(d){this.sprite=d;this.game=d.game;this.type=b.Physics.ARCADE;this.enable=true;this.offset=new b.Point();this.position=new b.Point(d.x,d.y);this.prev=new b.Point(this.position.x,this.position.y);this.allowRotation=true;this.rotation=d.rotation;this.preRotation=d.rotation;this.sourceWidth=d.texture.frame.width;this.sourceHeight=d.texture.frame.height;this.width=d.width;this.height=d.height;this.halfWidth=Math.abs(d.width/2);this.halfHeight=Math.abs(d.height/2);this.center=new b.Point(d.x+this.halfWidth,d.y+this.halfHeight);this.velocity=new b.Point();this.newVelocity=new b.Point(0,0);this.deltaMax=new b.Point(0,0);this.acceleration=new b.Point();this.drag=new b.Point();this.allowGravity=true;this.gravity=new b.Point(0,0);this.bounce=new b.Point();this.maxVelocity=new b.Point(10000,10000);this.angularVelocity=0;this.angularAcceleration=0;this.angularDrag=0;this.maxAngular=1000;this.mass=1;this.angle=0;this.speed=0;this.facing=b.NONE;this.immovable=false;this.moves=true;this.customSeparateX=false;this.customSeparateY=false;this.overlapX=0;this.overlapY=0;this.embedded=false;this.collideWorldBounds=false;this.checkCollision={none:false,any:true,up:true,down:true,left:true,right:true};this.touching={none:true,up:false,down:false,left:false,right:false};this.wasTouching={none:true,up:false,down:false,left:false,right:false};this.blocked={up:false,down:false,left:false,right:false};this.tilePadding=new b.Point();this.phase=0;this._reset=true;this._sx=d.scale.x;this._sy=d.scale.y;this._dx=0;this._dy=0};b.Physics.Arcade.Body.prototype={updateBounds:function(){var e=Math.abs(this.sprite.scale.x);var d=Math.abs(this.sprite.scale.y);if(e!==this._sx||d!==this._sy){this.width=this.sourceWidth*e;this.height=this.sourceHeight*d;this.halfWidth=Math.floor(this.width/2);this.halfHeight=Math.floor(this.height/2);this._sx=e;this._sy=d;this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight);this._reset=true}},preUpdate:function(){if(!this.enable){return}this.phase=1;this.wasTouching.none=this.touching.none;this.wasTouching.up=this.touching.up;this.wasTouching.down=this.touching.down;this.wasTouching.left=this.touching.left;this.wasTouching.right=this.touching.right;this.touching.none=true;this.touching.up=false;this.touching.down=false;this.touching.left=false;this.touching.right=false;this.blocked.up=false;this.blocked.down=false;this.blocked.left=false;this.blocked.right=false;this.embedded=false;this.updateBounds();this.position.x=(this.sprite.world.x-(this.sprite.anchor.x*this.width))+this.offset.x;this.position.y=(this.sprite.world.y-(this.sprite.anchor.y*this.height))+this.offset.y;this.rotation=this.sprite.angle;this.preRotation=this.rotation;if(this._reset||this.sprite._cache[4]===1){this.prev.x=this.position.x;this.prev.y=this.position.y}if(this.moves){this.game.physics.arcade.updateMotion(this);this.newVelocity.set(this.velocity.x*this.game.time.physicsElapsed,this.velocity.y*this.game.time.physicsElapsed);this.position.x+=this.newVelocity.x;this.position.y+=this.newVelocity.y;if(this.position.x!==this.prev.x||this.position.y!==this.prev.y){this.speed=Math.sqrt(this.velocity.x*this.velocity.x+this.velocity.y*this.velocity.y);this.angle=Math.atan2(this.velocity.y,this.velocity.x)}if(this.collideWorldBounds){this.checkWorldBounds()}}this._dx=this.deltaX();this._dy=this.deltaY();this._reset=false},postUpdate:function(){if(!this.enable){return}if(this.phase===2){return}this.phase=2;if(this.deltaX()<0){this.facing=b.LEFT}else{if(this.deltaX()>0){this.facing=b.RIGHT}}if(this.deltaY()<0){this.facing=b.UP}else{if(this.deltaY()>0){this.facing=b.DOWN}}if(this.moves){this._dx=this.deltaX();this._dy=this.deltaY();if(this.deltaMax.x!==0&&this._dx!==0){if(this._dx<0&&this._dx<-this.deltaMax.x){this._dx=-this.deltaMax.x}else{if(this._dx>0&&this._dx>this.deltaMax.x){this._dx=this.deltaMax.x}}}if(this.deltaMax.y!==0&&this._dy!==0){if(this._dy<0&&this._dy<-this.deltaMax.y){this._dy=-this.deltaMax.y}else{if(this._dy>0&&this._dy>this.deltaMax.y){this._dy=this.deltaMax.y}}}this.sprite.x+=this._dx;this.sprite.y+=this._dy}this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight);if(this.allowRotation){this.sprite.angle+=this.deltaZ()}this.prev.x=this.position.x;this.prev.y=this.position.y},destroy:function(){this.sprite=null},checkWorldBounds:function(){if(this.position.x<this.game.physics.arcade.bounds.x&&this.game.physics.arcade.checkCollision.left){this.position.x=this.game.physics.arcade.bounds.x;this.velocity.x*=-this.bounce.x;this.blocked.left=true}else{if(this.right>this.game.physics.arcade.bounds.right&&this.game.physics.arcade.checkCollision.right){this.position.x=this.game.physics.arcade.bounds.right-this.width;this.velocity.x*=-this.bounce.x;this.blocked.right=true}}if(this.position.y<this.game.physics.arcade.bounds.y&&this.game.physics.arcade.checkCollision.up){this.position.y=this.game.physics.arcade.bounds.y;this.velocity.y*=-this.bounce.y;this.blocked.up=true}else{if(this.bottom>this.game.physics.arcade.bounds.bottom&&this.game.physics.arcade.checkCollision.down){this.position.y=this.game.physics.arcade.bounds.bottom-this.height;this.velocity.y*=-this.bounce.y;this.blocked.down=true}}},setSize:function(f,e,d,g){if(typeof d==="undefined"){d=this.offset.x}if(typeof g==="undefined"){g=this.offset.y}this.sourceWidth=f;this.sourceHeight=e;this.width=this.sourceWidth*this._sx;this.height=this.sourceHeight*this._sy;this.halfWidth=Math.floor(this.width/2);this.halfHeight=Math.floor(this.height/2);this.offset.setTo(d,g);this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight)},reset:function(d,e){this.velocity.set(0);this.acceleration.set(0);this.angularVelocity=0;this.angularAcceleration=0;this.position.x=(d-(this.sprite.anchor.x*this.width))+this.offset.x;this.position.y=(e-(this.sprite.anchor.y*this.height))+this.offset.y;this.prev.x=this.position.x;this.prev.y=this.position.y;this.rotation=this.sprite.angle;this.preRotation=this.rotation;this._sx=this.sprite.scale.x;this._sy=this.sprite.scale.y;this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight)},hitTest:function(d,e){return b.Rectangle.contains(this,d,e)},onFloor:function(){return this.blocked.down},onWall:function(){return(this.blocked.left||this.blocked.right)},deltaAbsX:function(){return(this.deltaX()>0?this.deltaX():-this.deltaX())},deltaAbsY:function(){return(this.deltaY()>0?this.deltaY():-this.deltaY())},deltaX:function(){return this.position.x-this.prev.x},deltaY:function(){return this.position.y-this.prev.y},deltaZ:function(){return this.rotation-this.preRotation}};Object.defineProperty(b.Physics.Arcade.Body.prototype,"bottom",{get:function(){return this.position.y+this.height}});Object.defineProperty(b.Physics.Arcade.Body.prototype,"right",{get:function(){return this.position.x+this.width}});Object.defineProperty(b.Physics.Arcade.Body.prototype,"x",{get:function(){return this.position.x},set:function(d){this.position.x=d}});Object.defineProperty(b.Physics.Arcade.Body.prototype,"y",{get:function(){return this.position.y},set:function(d){this.position.y=d}});b.Physics.Arcade.Body.render=function(f,d,e,g){if(typeof g==="undefined"){g=true}e=e||"rgba(0,255,0,0.4)";if(g){f.fillStyle=e;f.fillRect(d.position.x-d.game.camera.x,d.position.y-d.game.camera.y,d.width,d.height)}else{f.strokeStyle=e;f.strokeRect(d.position.x-d.game.camera.x,d.position.y-d.game.camera.y,d.width,d.height)}};b.Physics.Arcade.Body.renderBodyInfo=function(e,d){e.line("x: "+d.x.toFixed(2),"y: "+d.y.toFixed(2),"width: "+d.width,"height: "+d.height);e.line("velocity x: "+d.velocity.x.toFixed(2),"y: "+d.velocity.y.toFixed(2),"deltaX: "+d._dx.toFixed(2),"deltaY: "+d._dy.toFixed(2));e.line("acceleration x: "+d.acceleration.x.toFixed(2),"y: "+d.acceleration.y.toFixed(2),"speed: "+d.speed.toFixed(2),"angle: "+d.angle.toFixed(2));e.line("gravity x: "+d.gravity.x,"y: "+d.gravity.y,"bounce x: "+d.bounce.x.toFixed(2),"y: "+d.bounce.y.toFixed(2));e.line("touching left: "+d.touching.left,"right: "+d.touching.right,"up: "+d.touching.up,"down: "+d.touching.down);e.line("blocked left: "+d.blocked.left,"right: "+d.blocked.right,"up: "+d.blocked.up,"down: "+d.blocked.down)};b.Physics.Arcade.Body.prototype.constructor=b.Physics.Arcade.Body;b.Particles=function(d){this.game=d;this.emitters={};this.ID=0};b.Particles.prototype={add:function(d){this.emitters[d.name]=d;return d},remove:function(d){delete this.emitters[d.name]},update:function(){for(var d in this.emitters){if(this.emitters[d].exists){this.emitters[d].update()}}}};b.Particles.prototype.constructor=b.Particles;b.Particles.Arcade={};b.Particles.Arcade.Emitter=function(e,d,g,f){this.maxParticles=f||50;b.Group.call(this,e);this.name="emitter"+this.game.particles.ID++;this.type=b.EMITTER;this.area=new b.Rectangle(d,g,1,1);this.minParticleSpeed=new b.Point(-100,-100);this.maxParticleSpeed=new b.Point(100,100);this.minParticleScale=1;this.maxParticleScale=1;this.scaleData=null;this.minRotation=-360;this.maxRotation=360;this.minParticleAlpha=1;this.maxParticleAlpha=1;this.alphaData=null;this.gravity=100;this.particleClass=b.Particle;this.particleDrag=new b.Point();this.angularDrag=0;this.frequency=100;this.lifespan=2000;this.bounce=new b.Point();this.on=false;this.particleAnchor=new b.Point(0.5,0.5);this.blendMode=b.blendModes.NORMAL;this.emitX=d;this.emitY=g;this.autoScale=false;this.autoAlpha=false;this.particleBringToTop=false;this.particleSendToBack=false;this._minParticleScale=new b.Point(1,1);this._maxParticleScale=new b.Point(1,1);this._quantity=0;this._timer=0;this._counter=0;this._explode=true;this._frames=null};b.Particles.Arcade.Emitter.prototype=Object.create(b.Group.prototype);b.Particles.Arcade.Emitter.prototype.constructor=b.Particles.Arcade.Emitter;b.Particles.Arcade.Emitter.prototype.update=function(){if(this.on){if(this._explode){this._counter=0;do{this.emitParticle();this._counter++}while(this._counter<this._quantity);this.on=false}else{if(this.game.time.now>=this._timer){this.emitParticle();this._counter++;if(this._quantity>0){if(this._counter>=this._quantity){this.on=false}}this._timer=this.game.time.now+this.frequency}}}var d=this.children.length;while(d--){if(this.children[d].exists){this.children[d].update()}}};b.Particles.Arcade.Emitter.prototype.makeParticles=function(l,h,e,k,m){if(typeof h==="undefined"){h=0}if(typeof e==="undefined"){e=this.maxParticles}if(typeof k==="undefined"){k=false}if(typeof m==="undefined"){m=false}var g;var f=0;var d=l;var j=h;this._frames=h;while(f<e){if(Array.isArray(l)){d=this.game.rnd.pick(l)}if(Array.isArray(h)){j=this.game.rnd.pick(h)}g=new this.particleClass(this.game,0,0,d,j);this.game.physics.arcade.enable(g,false);if(k){g.body.checkCollision.any=true;g.body.checkCollision.none=false}else{g.body.checkCollision.none=true}g.body.collideWorldBounds=m;g.exists=false;g.visible=false;g.anchor.copyFrom(this.particleAnchor);this.add(g);f++}return this};b.Particles.Arcade.Emitter.prototype.kill=function(){this.on=false;this.alive=false;this.exists=false};b.Particles.Arcade.Emitter.prototype.revive=function(){this.alive=true;this.exists=true};b.Particles.Arcade.Emitter.prototype.explode=function(e,d){this.start(true,e,0,d,false)};b.Particles.Arcade.Emitter.prototype.flow=function(f,e,d){this.start(false,f,e,d,true)};b.Particles.Arcade.Emitter.prototype.start=function(e,h,g,f,d){if(typeof e==="undefined"){e=true}if(typeof h==="undefined"){h=0}if(typeof g==="undefined"||g===null){g=250}if(typeof f==="undefined"){f=0}if(typeof d==="undefined"){d=false}this.revive();this.visible=true;this.on=true;this._explode=e;this.lifespan=h;this.frequency=g;if(e||d){this._quantity=f}else{this._quantity+=f}this._counter=0;this._timer=this.game.time.now+g};b.Particles.Arcade.Emitter.prototype.emitParticle=function(){var d=this.getFirstExists(false);if(d===null){return}if(this.width>1||this.height>1){d.reset(this.game.rnd.integerInRange(this.left,this.right),this.game.rnd.integerInRange(this.top,this.bottom))}else{d.reset(this.emitX,this.emitY)}d.angle=0;d.lifespan=this.lifespan;if(this.particleBringToTop){this.bringToTop(d)}else{if(this.particleSendToBack){this.sendToBack(d)}}if(this.autoScale){d.setScaleData(this.scaleData)}else{if(this.minParticleScale!==1||this.maxParticleScale!==1){d.scale.set(this.game.rnd.realInRange(this.minParticleScale,this.maxParticleScale))}else{if((this._minParticleScale.x!==this._maxParticleScale.x)||(this._minParticleScale.y!==this._maxParticleScale.y)){d.scale.set(this.game.rnd.realInRange(this._minParticleScale.x,this._maxParticleScale.x),this.game.rnd.realInRange(this._minParticleScale.y,this._maxParticleScale.y))}}}if(Array.isArray(this._frames==="object")){d.frame=this.game.rnd.pick(this._frames)}else{d.frame=this._frames}if(this.autoAlpha){d.setAlphaData(this.alphaData)}else{d.alpha=this.game.rnd.realInRange(this.minParticleAlpha,this.maxParticleAlpha)}d.blendMode=this.blendMode;d.body.updateBounds();d.body.bounce.setTo(this.bounce.x,this.bounce.y);d.body.velocity.x=this.game.rnd.integerInRange(this.minParticleSpeed.x,this.maxParticleSpeed.x);d.body.velocity.y=this.game.rnd.integerInRange(this.minParticleSpeed.y,this.maxParticleSpeed.y);d.body.angularVelocity=this.game.rnd.integerInRange(this.minRotation,this.maxRotation);d.body.gravity.y=this.gravity;d.body.drag.x=this.particleDrag.x;d.body.drag.y=this.particleDrag.y;d.body.angularDrag=this.angularDrag;d.onEmit()};b.Particles.Arcade.Emitter.prototype.setSize=function(e,d){this.area.width=e;this.area.height=d};b.Particles.Arcade.Emitter.prototype.setXSpeed=function(e,d){e=e||0;d=d||0;this.minParticleSpeed.x=e;this.maxParticleSpeed.x=d};b.Particles.Arcade.Emitter.prototype.setYSpeed=function(e,d){e=e||0;d=d||0;this.minParticleSpeed.y=e;this.maxParticleSpeed.y=d};b.Particles.Arcade.Emitter.prototype.setRotation=function(e,d){e=e||0;d=d||0;this.minRotation=e;this.maxRotation=d};b.Particles.Arcade.Emitter.prototype.setAlpha=function(g,d,i,j,h){if(typeof g==="undefined"){g=1}if(typeof d==="undefined"){d=1}if(typeof i==="undefined"){i=0}if(typeof j==="undefined"){j=b.Easing.Linear.None}if(typeof h==="undefined"){h=false}this.minParticleAlpha=g;this.maxParticleAlpha=d;this.autoAlpha=false;if(i>0&&g!==d){var e={v:g};var f=this.game.make.tween(e).to({v:d},i,j);f.yoyo(h);this.alphaData=f.generateData(60);this.alphaData.reverse();this.autoAlpha=true}};b.Particles.Arcade.Emitter.prototype.setScale=function(g,e,f,d,i,h,j){if(typeof g==="undefined"){g=1}if(typeof e==="undefined"){e=1}if(typeof f==="undefined"){f=1}if(typeof d==="undefined"){d=1}if(typeof i==="undefined"){i=0}if(typeof h==="undefined"){h=b.Easing.Linear.None}if(typeof j==="undefined"){j=false}this.minParticleScale=1;this.maxParticleScale=1;this._minParticleScale.set(g,f);this._maxParticleScale.set(e,d);this.autoScale=false;if(i>0&&(g!==e)||(f!==d)){var l={x:g,y:f};var k=this.game.make.tween(l).to({x:e,y:d},i,h);k.yoyo(j);this.scaleData=k.generateData(60);this.scaleData.reverse();this.autoScale=true}};b.Particles.Arcade.Emitter.prototype.at=function(d){if(d.center){this.emitX=d.center.x;this.emitY=d.center.y}else{this.emitX=d.world.x+(d.anchor.x*d.width);this.emitY=d.world.y+(d.anchor.y*d.height)}};Object.defineProperty(b.Particles.Arcade.Emitter.prototype,"width",{get:function(){return this.area.width},set:function(d){this.area.width=d}});Object.defineProperty(b.Particles.Arcade.Emitter.prototype,"height",{get:function(){return this.area.height},set:function(d){this.area.height=d}});Object.defineProperty(b.Particles.Arcade.Emitter.prototype,"x",{get:function(){return this.emitX},set:function(d){this.emitX=d}});Object.defineProperty(b.Particles.Arcade.Emitter.prototype,"y",{get:function(){return this.emitY},set:function(d){this.emitY=d}});Object.defineProperty(b.Particles.Arcade.Emitter.prototype,"left",{get:function(){return Math.floor(this.x-(this.area.width/2))}});Object.defineProperty(b.Particles.Arcade.Emitter.prototype,"right",{get:function(){return Math.floor(this.x+(this.area.width/2))}});Object.defineProperty(b.Particles.Arcade.Emitter.prototype,"top",{get:function(){return Math.floor(this.y-(this.area.height/2))}});Object.defineProperty(b.Particles.Arcade.Emitter.prototype,"bottom",{get:function(){return Math.floor(this.y+(this.area.height/2))}});b.Tile=function(g,f,e,i,h,d){this.layer=g;this.index=f;this.x=e;this.y=i;this.worldX=e*h;this.worldY=i*d;this.width=h;this.height=d;this.centerX=Math.abs(h/2);this.centerY=Math.abs(d/2);this.alpha=1;this.properties={};this.scanned=false;this.faceTop=false;this.faceBottom=false;this.faceLeft=false;this.faceRight=false;this.collideLeft=false;this.collideRight=false;this.collideUp=false;this.collideDown=false;this.collisionCallback=null;this.collisionCallbackContext=this};b.Tile.prototype={containsPoint:function(d,e){return !(d<this.worldX||e<this.worldY||d>this.right||e>this.bottom)},intersects:function(d,g,f,e){if(f<=this.worldX){return false}if(e<=this.worldY){return false}if(d>=this.worldX+this.width){return false}if(g>=this.worldY+this.height){return false}return true},setCollisionCallback:function(e,d){this.collisionCallback=e;this.collisionCallbackContext=d},destroy:function(){this.collisionCallback=null;this.collisionCallbackContext=null;this.properties=null},setCollision:function(f,e,d,g){this.collideLeft=f;this.collideRight=e;this.collideUp=d;this.collideDown=g},resetCollision:function(){this.collideLeft=false;this.collideRight=false;this.collideUp=false;this.collideDown=false;this.faceTop=false;this.faceBottom=false;this.faceLeft=false;this.faceRight=false},isInteresting:function(e,d){if(e&&d){return(this.collideLeft||this.collideRight||this.collideUp||this.collideDown||this.faceTop||this.faceBottom||this.faceLeft||this.faceRight||this.collisionCallback)}else{if(e){return(this.collideLeft||this.collideRight||this.collideUp||this.collideDown)}else{if(d){return(this.faceTop||this.faceBottom||this.faceLeft||this.faceRight)}}}return false},copy:function(d){this.index=d.index;this.alpha=d.alpha;this.properties=d.properties;this.collideUp=d.collideUp;this.collideDown=d.collideDown;this.collideLeft=d.collideLeft;this.collideRight=d.collideRight;this.collisionCallback=d.collisionCallback;this.collisionCallbackContext=d.collisionCallbackContext}};b.Tile.prototype.constructor=b.Tile;Object.defineProperty(b.Tile.prototype,"collides",{get:function(){return(this.collideLeft||this.collideRight||this.collideUp||this.collideDown)}});Object.defineProperty(b.Tile.prototype,"canCollide",{get:function(){return(this.collideLeft||this.collideRight||this.collideUp||this.collideDown||this.collisionCallback)}});Object.defineProperty(b.Tile.prototype,"left",{get:function(){return this.worldX}});Object.defineProperty(b.Tile.prototype,"right",{get:function(){return this.worldX+this.width}});Object.defineProperty(b.Tile.prototype,"top",{get:function(){return this.worldY}});Object.defineProperty(b.Tile.prototype,"bottom",{get:function(){return this.worldY+this.height}});b.Tilemap=function(f,g,j,e,h,d){this.game=f;this.key=g;var i=b.TilemapParser.parse(this.game,g,j,e,h,d);if(i===null){return}this.width=i.width;this.height=i.height;this.tileWidth=i.tileWidth;this.tileHeight=i.tileHeight;this.orientation=i.orientation;this.format=i.format;this.version=i.version;this.properties=i.properties;this.widthInPixels=i.widthInPixels;this.heightInPixels=i.heightInPixels;this.layers=i.layers;this.tilesets=i.tilesets;this.tiles=i.tiles;this.objects=i.objects;this.collideIndexes=[];this.collision=i.collision;this.images=i.images;this.currentLayer=0;this.debugMap=[];this._results=[];this._tempA=0;this._tempB=0};b.Tilemap.CSV=0;b.Tilemap.TILED_JSON=1;b.Tilemap.NORTH=0;b.Tilemap.EAST=1;b.Tilemap.SOUTH=2;b.Tilemap.WEST=3;b.Tilemap.prototype={create:function(f,g,d,i,e,h){if(typeof h==="undefined"){h=this.game.world}this.width=g;this.height=d;this.setTileSize(i,e);this.layers.length=0;return this.createBlankLayer(f,g,d,i,e,h)},setTileSize:function(e,d){this.tileWidth=e;this.tileHeight=d;this.widthInPixels=this.width*e;this.heightInPixels=this.height*d},addTilesetImage:function(d,o,m,h,s,j,f){if(typeof m==="undefined"){m=this.tileWidth}if(typeof h==="undefined"){h=this.tileHeight}if(typeof s==="undefined"){s=0}if(typeof j==="undefined"){j=0}if(typeof f==="undefined"){f=0}if(m===0){m=32}if(h===0){h=32}if(typeof o==="undefined"){if(typeof d==="string"){o=d;if(!this.game.cache.checkImageKey(o)){console.warn('Phaser.Tilemap.addTilesetImage: Invalid image key given: "'+o+'"');return null}}else{return null}}if(typeof d==="string"){d=this.getTilesetIndex(d);if(d===null&&this.format===b.Tilemap.TILED_JSON){console.warn('Phaser.Tilemap.addTilesetImage: No data found in the JSON matching the tileset name: "'+o+'"');return null}}if(this.tilesets[d]){this.tilesets[d].setImage(this.game.cache.getImage(o));return this.tilesets[d]}else{var n=new b.Tileset(o,f,m,h,s,j,{});n.setImage(this.game.cache.getImage(o));this.tilesets.push(n);var e=this.tilesets.length-1;var l=s;var k=s;var g=0;var r=0;var p=0;for(var q=f;q<f+n.total;q++){this.tiles[q]=[l,k,e];l+=m+j;g++;if(g===n.total){break}r++;if(r===n.columns){l=s;k+=h+j;r=0;p++;if(p===n.rows){break}}}return n}return null},createFromObjects:function(e,j,q,f,m,l,p,d,g){if(typeof m==="undefined"){m=true}if(typeof l==="undefined"){l=false}if(typeof p==="undefined"){p=this.game.world}if(typeof d==="undefined"){d=b.Sprite}if(typeof g==="undefined"){g=true}if(!this.objects[e]){console.warn("Tilemap.createFromObjects: Invalid objectgroup name given: "+e);return}var o;for(var h=0,k=this.objects[e].length;h<k;h++){if(this.objects[e][h].gid===j){o=new d(this.game,this.objects[e][h].x,this.objects[e][h].y,q,f);o.name=this.objects[e][h].name;o.visible=this.objects[e][h].visible;o.autoCull=l;o.exists=m;if(g){o.y-=o.height}p.add(o);for(var n in this.objects[e][h].properties){p.set(o,n,this.objects[e][h].properties[n],false,false,0,true)}}}},createLayer:function(f,g,d,h){if(typeof g==="undefined"){g=this.game.width}if(typeof d==="undefined"){d=this.game.height}if(typeof h==="undefined"){h=this.game.world}var e=f;if(typeof f==="string"){e=this.getLayerIndex(f)}if(e===null||e>this.layers.length){console.warn("Tilemap.createLayer: Invalid layer ID given: "+e);return}return h.add(new b.TilemapLayer(this.game,this,e,g,d))},createBlankLayer:function(d,e,p,m,j,o){if(typeof o==="undefined"){o=this.game.world}if(this.getLayerIndex(d)!==null){console.warn("Tilemap.createBlankLayer: Layer with matching name already exists");return}var i={name:d,x:0,y:0,width:e,height:p,widthInPixels:e*m,heightInPixels:p*j,alpha:1,visible:true,properties:{},indexes:[],callbacks:[],bodies:[],data:null};var q;var f=[];for(var k=0;k<p;k++){q=[];for(var l=0;l<e;l++){q.push(new b.Tile(i,-1,l,k,m,j))}f.push(q)}i.data=f;this.layers.push(i);this.currentLayer=this.layers.length-1;var n=i.widthInPixels;var g=i.heightInPixels;if(n>this.game.width){n=this.game.width}if(g>this.game.height){g=this.game.height}var f=new b.TilemapLayer(this.game,this,this.layers.length-1,n,g);f.name=d;return o.add(f)},getIndex:function(d,e){for(var f=0;f<d.length;f++){if(d[f].name===e){return f}}return null},getLayerIndex:function(d){return this.getIndex(this.layers,d)},getTilesetIndex:function(d){return this.getIndex(this.tilesets,d)},getImageIndex:function(d){return this.getIndex(this.images,d)},getObjectIndex:function(d){return this.getIndex(this.objects,d)},setTileIndexCallback:function(f,j,e,h){h=this.getLayer(h);if(typeof f==="number"){this.layers[h].callbacks[f]={callback:j,callbackContext:e}}else{for(var g=0,d=f.length;g<d;g++){this.layers[h].callbacks[f[g]]={callback:j,callbackContext:e}}}},setTileLocationCallback:function(e,l,j,d,k,f,h){h=this.getLayer(h);this.copy(e,l,j,d,h);if(this._results.length<2){return}for(var g=1;g<this._results.length;g++){this._results[g].setCollisionCallback(k,f)}},setCollision:function(g,e,j,f){if(typeof e==="undefined"){e=true}if(typeof f==="undefined"){f=true}j=this.getLayer(j);if(typeof g==="number"){return this.setCollisionByIndex(g,e,j,true)}else{for(var h=0,d=g.length;h<d;h++){this.setCollisionByIndex(g[h],e,j,false)}if(f){this.calculateFaces(j)}}},setCollisionBetween:function(i,h,d,g,f){if(typeof d==="undefined"){d=true}if(typeof f==="undefined"){f=true}g=this.getLayer(g);if(i>h){return}for(var e=i;e<=h;e++){this.setCollisionByIndex(e,d,g,false)}if(f){this.calculateFaces(g)}},setCollisionByExclusion:function(g,e,j,f){if(typeof e==="undefined"){e=true}if(typeof f==="undefined"){f=true}j=this.getLayer(j);for(var h=0,d=this.tiles.length;h<d;h++){if(g.indexOf(h)===-1){this.setCollisionByIndex(h,e,j,false)}}if(f){this.calculateFaces(j)}},setCollisionByIndex:function(g,e,j,f){if(typeof e==="undefined"){e=true}if(typeof j==="undefined"){j=this.currentLayer}if(typeof f==="undefined"){f=true}if(e){this.collideIndexes.push(g)}else{var h=this.collideIndexes.indexOf(g);if(h>-1){this.collideIndexes.splice(h,1)}}for(var l=0;l<this.layers[j].height;l++){for(var d=0;d<this.layers[j].width;d++){var k=this.layers[j].data[l][d];if(k&&k.index===g){if(e){k.setCollision(true,true,true,true)}else{k.resetCollision()}k.faceTop=e;k.faceBottom=e;k.faceLeft=e;k.faceRight=e}}}if(f){this.calculateFaces(j)}return j},getLayer:function(d){if(typeof d==="undefined"){d=this.currentLayer}else{if(typeof d==="string"){d=this.getLayerIndex(d)}else{if(d instanceof b.TilemapLayer){d=d.index}}}return d},setPreventRecalculate:function(e){if((e===true)&&(this.preventingRecalculate!==true)){this.preventingRecalculate=true;this.needToRecalculate={}}if((e===false)&&(this.preventingRecalculate===true)){this.preventingRecalculate=false;for(var d in this.needToRecalculate){this.calculateFaces(d)}this.needToRecalculate=false}},calculateFaces:function(f){if(this.preventingRecalculate===true){this.needToRecalculate[f]=true;return}var i=null;var m=null;var d=null;var n=null;for(var j=0,e=this.layers[f].height;j<e;j++){for(var k=0,l=this.layers[f].width;k<l;k++){var g=this.layers[f].data[j][k];if(g){i=this.getTileAbove(f,k,j);m=this.getTileBelow(f,k,j);d=this.getTileLeft(f,k,j);n=this.getTileRight(f,k,j);if(g.collides){g.faceTop=true;g.faceBottom=true;g.faceLeft=true;g.faceRight=true}if(i&&i.collides){g.faceTop=false}if(m&&m.collides){g.faceBottom=false}if(d&&d.collides){g.faceLeft=false}if(n&&n.collides){g.faceRight=false}}}}},getTileAbove:function(e,d,f){if(f>0){return this.layers[e].data[f-1][d]}return null},getTileBelow:function(e,d,f){if(f<this.layers[e].height-1){return this.layers[e].data[f+1][d]}return null},getTileLeft:function(e,d,f){if(d>0){return this.layers[e].data[f][d-1]}return null},getTileRight:function(e,d,f){if(d<this.layers[e].width-1){return this.layers[e].data[f][d+1]}return null},setLayer:function(d){d=this.getLayer(d);if(this.layers[d]){this.currentLayer=d}},hasTile:function(d,f,e){e=this.getLayer(e);return(this.layers[e].data[f]!==null&&this.layers[e].data[f][d]!==null)},removeTile:function(d,g,e){e=this.getLayer(e);if(d>=0&&d<this.layers[e].width&&g>=0&&g<this.layers[e].height){if(this.hasTile(d,g,e)){var f=this.layers[e].data[g][d];this.layers[e].data[g][d]=new b.Tile(this.layers[e],-1,d,g,this.tileWidth,this.tileHeight);this.layers[e].dirty=true;this.calculateFaces(e);return f}}},removeTileWorldXY:function(d,h,g,e,f){f=this.getLayer(f);d=this.game.math.snapToFloor(d,g)/g;h=this.game.math.snapToFloor(h,e)/e;return this.removeTile(d,h,f)},putTile:function(g,d,h,f){if(g===null){return this.removeTile(d,h,f)}f=this.getLayer(f);if(d>=0&&d<this.layers[f].width&&h>=0&&h<this.layers[f].height){var e;if(g instanceof b.Tile){e=g.index;if(this.hasTile(d,h,f)){this.layers[f].data[h][d].copy(g)}else{this.layers[f].data[h][d]=new b.Tile(f,e,d,h,g.width,g.height)}}else{e=g;if(this.hasTile(d,h,f)){this.layers[f].data[h][d].index=e}else{this.layers[f].data[h][d]=new b.Tile(this.layers[f],e,d,h,this.tileWidth,this.tileHeight)}}if(this.collideIndexes.indexOf(e)>-1){this.layers[f].data[h][d].setCollision(true,true,true,true)}else{this.layers[f].data[h][d].resetCollision()}this.layers[f].dirty=true;this.calculateFaces(f);return this.layers[f].data[h][d]}return null},putTileWorldXY:function(g,d,i,h,e,f){f=this.getLayer(f);d=this.game.math.snapToFloor(d,h)/h;i=this.game.math.snapToFloor(i,e)/e;return this.putTile(g,d,i,f)},searchTileIndex:function(f,h,e,g){if(typeof h==="undefined"){h=0}if(typeof e==="undefined"){e=false}g=this.getLayer(g);var j=0;if(e){for(var i=this.layers[g].height-1;i>=0;i--){for(var d=this.layers[g].width-1;d>=0;d--){if(this.layers[g].data[i][d].index===f){if(j===h){return this.layers[g].data[i][d]}else{j++}}}}}else{for(var i=0;i<this.layers[g].height;i++){for(var d=0;d<this.layers[g].width;d++){if(this.layers[g].data[i][d].index===f){if(j===h){return this.layers[g].data[i][d]}else{j++}}}}}return null},getTile:function(d,g,f,e){if(typeof e==="undefined"){e=false}f=this.getLayer(f);if(d>=0&&d<this.layers[f].width&&g>=0&&g<this.layers[f].height){if(this.layers[f].data[g][d].index===-1){if(e){return this.layers[f].data[g][d]}else{return null}}else{return this.layers[f].data[g][d]}}else{return null}},getTileWorldXY:function(d,h,g,e,f){if(typeof g==="undefined"){g=this.tileWidth}if(typeof e==="undefined"){e=this.tileHeight}f=this.getLayer(f);d=this.game.math.snapToFloor(d,g)/g;h=this.game.math.snapToFloor(h,e)/e;return this.getTile(d,h,f)},copy:function(f,j,i,e,h){h=this.getLayer(h);if(!this.layers[h]){this._results.length=0;return}if(typeof f==="undefined"){f=0}if(typeof j==="undefined"){j=0}if(typeof i==="undefined"){i=this.layers[h].width}if(typeof e==="undefined"){e=this.layers[h].height}if(f<0){f=0}if(j<0){j=0}if(i>this.layers[h].width){i=this.layers[h].width}if(e>this.layers[h].height){e=this.layers[h].height}this._results.length=0;this._results.push({x:f,y:j,width:i,height:e,layer:h});for(var d=j;d<j+e;d++){for(var g=f;g<f+i;g++){this._results.push(this.layers[h].data[d][g])}}return this._results},paste:function(d,k,j,h){if(typeof d==="undefined"){d=0}if(typeof k==="undefined"){k=0}h=this.getLayer(h);if(!j||j.length<2){return}var f=j[1].x-d;var e=j[1].y-k;for(var g=1;g<j.length;g++){this.layers[h].data[e+j[g].y][f+j[g].x].copy(j[g])}this.layers[h].dirty=true;this.calculateFaces(h)},swap:function(i,h,e,j,g,d,f){f=this.getLayer(f);this.copy(e,j,g,d,f);if(this._results.length<2){return}this._tempA=i;this._tempB=h;this._results.forEach(this.swapHandler,this);this.paste(e,j,this._results,f)},swapHandler:function(d){if(d.index===this._tempA){d.index=this._tempB}else{if(d.index===this._tempB){d.index=this._tempA}}},forEach:function(j,g,e,i,h,d,f){f=this.getLayer(f);this.copy(e,i,h,d,f);if(this._results.length<2){return}this._results.forEach(j,g);this.paste(e,i,this._results,f)},replace:function(k,f,e,l,j,d,h){h=this.getLayer(h);this.copy(e,l,j,d,h);if(this._results.length<2){return}for(var g=1;g<this._results.length;g++){if(this._results[g].index===k){this._results[g].index=f}}this.paste(e,l,this._results,h)},random:function(j,h,d,l,f){f=this.getLayer(f);this.copy(j,h,d,l,f);if(this._results.length<2){return}var g=[];for(var m=1;m<this._results.length;m++){if(this._results[m].index){var k=this._results[m].index;if(g.indexOf(k)===-1){g.push(k)}}}for(var e=1;e<this._results.length;e++){this._results[e].index=this.game.rnd.pick(g)}this.paste(j,h,this._results,f)},shuffle:function(e,l,k,d,j){j=this.getLayer(j);this.copy(e,l,k,d,j);if(this._results.length<2){return}var f=[];for(var h=1;h<this._results.length;h++){if(this._results[h].index){f.push(this._results[h].index)}}b.Utils.shuffle(f);for(var g=1;g<this._results.length;g++){this._results[g].index=f[g-1]}this.paste(e,l,this._results,j)},fill:function(f,e,k,j,d,h){h=this.getLayer(h);this.copy(e,k,j,d,h);if(this._results.length<2){return}for(var g=1;g<this._results.length;g++){this._results[g].index=f}this.paste(e,k,this._results,h)},removeAllLayers:function(){this.layers.length=0;this.currentLayer=0},dump:function(){var e="";var f=[""];for(var g=0;g<this.layers[this.currentLayer].height;g++){for(var d=0;d<this.layers[this.currentLayer].width;d++){e+="%c  ";if(this.layers[this.currentLayer].data[g][d]>1){if(this.debugMap[this.layers[this.currentLayer].data[g][d]]){f.push("background: "+this.debugMap[this.layers[this.currentLayer].data[g][d]])}else{f.push("background: #ffffff")}}else{f.push("background: rgb(0, 0, 0)")}}e+="\n"}f[0]=e;console.log.apply(console,f)},destroy:function(){this.removeAllLayers();this.data=[];this.game=null}};b.Tilemap.prototype.constructor=b.Tilemap;Object.defineProperty(b.Tilemap.prototype,"layer",{get:function(){return this.layers[this.currentLayer]},set:function(d){if(d!==this.currentLayer){this.setLayer(d)}}});b.TilemapLayer=function(e,h,f,g,d){this.game=e;this.map=h;this.index=f;this.layer=h.layers[f];this.canvas=b.Canvas.create(g,d,"",true);this.context=this.canvas.getContext("2d");this.baseTexture=new PIXI.BaseTexture(this.canvas);this.texture=new PIXI.Texture(this.baseTexture);this.textureFrame=new b.Frame(0,0,0,g,d,"tilemapLayer",e.rnd.uuid());b.Image.call(this,this.game,0,0,this.texture,this.textureFrame);this.name="";this.type=b.TILEMAPLAYER;this.fixedToCamera=true;this.cameraOffset=new b.Point(0,0);this.tileColor="rgb(255, 255, 255)";this.debug=false;this.debugAlpha=0.5;this.debugColor="rgba(0, 255, 0, 1)";this.debugFill=false;this.debugFillColor="rgba(0, 255, 0, 0.2)";this.debugCallbackColor="rgba(255, 0, 0, 1)";this.scrollFactorX=1;this.scrollFactorY=1;this.dirty=true;this.rayStepRate=4;this.wrap=false;this._mc={cw:h.tileWidth,ch:h.tileHeight,ga:1,dx:0,dy:0,dw:0,dh:0,tx:0,ty:0,tw:0,th:0,tl:0,maxX:0,maxY:0,startX:0,startY:0,x:0,y:0,prevX:0,prevY:0};this._results=[];this.updateMax()};b.TilemapLayer.prototype=Object.create(b.Image.prototype);b.TilemapLayer.prototype.constructor=b.TilemapLayer;b.TilemapLayer.prototype.postUpdate=function(){b.Image.prototype.postUpdate.call(this);this.scrollX=this.game.camera.x*this.scrollFactorX;this.scrollY=this.game.camera.y*this.scrollFactorY;this.render();if(this._cache[7]===1){this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x;this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y}};b.TilemapLayer.prototype.resizeWorld=function(){this.game.world.setBounds(0,0,this.layer.widthInPixels,this.layer.heightInPixels)};b.TilemapLayer.prototype._fixX=function(d){if(d<0){d=0}if(this.scrollFactorX===1){return d}return this._mc.x+(d-(this._mc.x/this.scrollFactorX))};b.TilemapLayer.prototype._unfixX=function(d){if(this.scrollFactorX===1){return d}return(this._mc.x/this.scrollFactorX)+(d-this._mc.x)};b.TilemapLayer.prototype._fixY=function(d){if(d<0){d=0}if(this.scrollFactorY===1){return d}return this._mc.y+(d-(this._mc.y/this.scrollFactorY))};b.TilemapLayer.prototype._unfixY=function(d){if(this.scrollFactorY===1){return d}return(this._mc.y/this.scrollFactorY)+(d-this._mc.y)};b.TilemapLayer.prototype.getTileX=function(d){return this.game.math.snapToFloor(this._fixX(d),this.map.tileWidth)/this.map.tileWidth};b.TilemapLayer.prototype.getTileY=function(d){return this.game.math.snapToFloor(this._fixY(d),this.map.tileHeight)/this.map.tileHeight};b.TilemapLayer.prototype.getTileXY=function(e,f,d){d.x=this.getTileX(e);d.y=this.getTileY(f);return d};b.TilemapLayer.prototype.getRayCastTiles=function(n,g,d,k){if(typeof g==="undefined"||g===null){g=this.rayStepRate}if(typeof d==="undefined"){d=false}if(typeof k==="undefined"){k=false}var l=this.getTiles(n.x,n.y,n.width,n.height,d,k);if(l.length===0){return[]}var j=n.coordinatesOnLine(g);var h=j.length;var f=[];for(var e=0;e<l.length;e++){for(var m=0;m<h;m++){if(l[e].containsPoint(j[m][0],j[m][1])){f.push(l[e]);break}}}return f};b.TilemapLayer.prototype.getTiles=function(e,k,h,d,f,g){if(typeof f==="undefined"){f=false}if(typeof g==="undefined"){g=false}e=this._fixX(e);k=this._fixY(k);if(h>this.layer.widthInPixels){h=this.layer.widthInPixels}if(d>this.layer.heightInPixels){d=this.layer.heightInPixels}this._mc.tx=this.game.math.snapToFloor(e,this._mc.cw)/this._mc.cw;this._mc.ty=this.game.math.snapToFloor(k,this._mc.ch)/this._mc.ch;this._mc.tw=(this.game.math.snapToCeil(h,this._mc.cw)+this._mc.cw)/this._mc.cw;this._mc.th=(this.game.math.snapToCeil(d,this._mc.ch)+this._mc.ch)/this._mc.ch;this._results.length=0;for(var i=this._mc.ty;i<this._mc.ty+this._mc.th;i++){for(var j=this._mc.tx;j<this._mc.tx+this._mc.tw;j++){if(this.layer.data[i]&&this.layer.data[i][j]){if((!f&&!g)||this.layer.data[i][j].isInteresting(f,g)){this._results.push(this.layer.data[i][j])}}}}return this._results};b.TilemapLayer.prototype.updateMax=function(){this._mc.maxX=this.game.math.ceil(this.canvas.width/this.map.tileWidth)+1;this._mc.maxY=this.game.math.ceil(this.canvas.height/this.map.tileHeight)+1;this.dirty=true};b.TilemapLayer.prototype.render=function(){if(this.layer.dirty){this.dirty=true}if(!this.dirty||!this.visible){return}this._mc.prevX=this._mc.dx;this._mc.prevY=this._mc.dy;this._mc.dx=-(this._mc.x-(this._mc.startX*this.map.tileWidth));this._mc.dy=-(this._mc.y-(this._mc.startY*this.map.tileHeight));this._mc.tx=this._mc.dx;this._mc.ty=this._mc.dy;this.context.clearRect(0,0,this.canvas.width,this.canvas.height);this.context.fillStyle=this.tileColor;var e;var i;if(this.debug){this.context.globalAlpha=this.debugAlpha}for(var h=this._mc.startY,f=this._mc.startY+this._mc.maxY;h<f;h++){this._column=null;if(h<0&&this.wrap){this._column=this.layer.data[h+this.map.height]}else{if(h>=this.map.height&&this.wrap){this._column=this.layer.data[h-this.map.height]}else{if(this.layer.data[h]){this._column=this.layer.data[h]}}}if(this._column){for(var d=this._mc.startX,g=this._mc.startX+this._mc.maxX;d<g;d++){var e=null;if(d<0&&this.wrap){e=this._column[d+this.map.width]}else{if(d>=this.map.width&&this.wrap){e=this._column[d-this.map.width]}else{if(this._column[d]){e=this._column[d]}}}if(e&&e.index>-1){i=this.map.tilesets[this.map.tiles[e.index][2]];if(this.debug===false&&e.alpha!==this.context.globalAlpha){this.context.globalAlpha=e.alpha}i.draw(this.context,Math.floor(this._mc.tx),Math.floor(this._mc.ty),e.index);if(e.debug){this.context.fillStyle="rgba(0, 255, 0, 0.4)";this.context.fillRect(Math.floor(this._mc.tx),Math.floor(this._mc.ty),this.map.tileWidth,this.map.tileHeight)}}this._mc.tx+=this.map.tileWidth}}this._mc.tx=this._mc.dx;this._mc.ty+=this.map.tileHeight}if(this.debug){this.context.globalAlpha=1;this.renderDebug()}if(this.game.renderType===b.WEBGL){PIXI.updateWebGLTexture(this.baseTexture,this.game.renderer.gl)}this.dirty=false;this.layer.dirty=false;return true};b.TilemapLayer.prototype.renderDebug=function(){this._mc.tx=this._mc.dx;this._mc.ty=this._mc.dy;this.context.strokeStyle=this.debugColor;this.context.fillStyle=this.debugFillColor;for(var h=this._mc.startY,f=this._mc.startY+this._mc.maxY;h<f;h++){this._column=null;if(h<0&&this.wrap){this._column=this.layer.data[h+this.map.height]}else{if(h>=this.map.height&&this.wrap){this._column=this.layer.data[h-this.map.height]}else{if(this.layer.data[h]){this._column=this.layer.data[h]}}}if(this._column){for(var d=this._mc.startX,g=this._mc.startX+this._mc.maxX;d<g;d++){var e=null;if(d<0&&this.wrap){e=this._column[d+this.map.width]}else{if(d>=this.map.width&&this.wrap){e=this._column[d-this.map.width]}else{if(this._column[d]){e=this._column[d]}}}if(e&&(e.faceTop||e.faceBottom||e.faceLeft||e.faceRight)){this._mc.tx=Math.floor(this._mc.tx);if(this.debugFill){this.context.fillRect(this._mc.tx,this._mc.ty,this._mc.cw,this._mc.ch)}this.context.beginPath();if(e.faceTop){this.context.moveTo(this._mc.tx,this._mc.ty);this.context.lineTo(this._mc.tx+this._mc.cw,this._mc.ty)}if(e.faceBottom){this.context.moveTo(this._mc.tx,this._mc.ty+this._mc.ch);this.context.lineTo(this._mc.tx+this._mc.cw,this._mc.ty+this._mc.ch)}if(e.faceLeft){this.context.moveTo(this._mc.tx,this._mc.ty);this.context.lineTo(this._mc.tx,this._mc.ty+this._mc.ch)}if(e.faceRight){this.context.moveTo(this._mc.tx+this._mc.cw,this._mc.ty);this.context.lineTo(this._mc.tx+this._mc.cw,this._mc.ty+this._mc.ch)}this.context.stroke()}this._mc.tx+=this.map.tileWidth}}this._mc.tx=this._mc.dx;this._mc.ty+=this.map.tileHeight}};Object.defineProperty(b.TilemapLayer.prototype,"scrollX",{get:function(){return this._mc.x},set:function(d){if(d!==this._mc.x){this._mc.x=d;this._mc.startX=this.game.math.floor(this._mc.x/this.map.tileWidth);this.dirty=true}}});Object.defineProperty(b.TilemapLayer.prototype,"scrollY",{get:function(){return this._mc.y},set:function(d){if(d!==this._mc.y){this._mc.y=d;this._mc.startY=this.game.math.floor(this._mc.y/this.map.tileHeight);this.dirty=true}}});Object.defineProperty(b.TilemapLayer.prototype,"collisionWidth",{get:function(){return this._mc.cw},set:function(d){this._mc.cw=d;this.dirty=true}});Object.defineProperty(b.TilemapLayer.prototype,"collisionHeight",{get:function(){return this._mc.ch},set:function(d){this._mc.ch=d;this.dirty=true}});b.TilemapParser={parse:function(f,g,j,e,h,d){if(typeof j==="undefined"){j=32}if(typeof e==="undefined"){e=32}if(typeof h==="undefined"){h=10}if(typeof d==="undefined"){d=10}if(typeof g==="undefined"){return this.getEmptyData()}if(g===null){return this.getEmptyData(j,e,h,d)}var i=f.cache.getTilemapData(g);if(i){if(i.format===b.Tilemap.CSV){return this.parseCSV(g,i.data,j,e)}else{if(!i.format||i.format===b.Tilemap.TILED_JSON){return this.parseTiledJSON(i.data)}}}else{console.warn("Phaser.TilemapParser.parse - No map data found for key "+g)}},parseCSV:function(m,h,l,i){var d=this.getEmptyData();h=h.trim();var f=[];var o=h.split("\n");var n=o.length;var e=0;for(var j=0;j<o.length;j++){f[j]=[];var g=o[j].split(",");for(var k=0;k<g.length;k++){f[j][k]=new b.Tile(d.layers[0],parseInt(g[k],10),k,j,l,i)}if(e===0){e=g.length}}d.format=b.Tilemap.CSV;d.name=m;d.width=e;d.height=n;d.tileWidth=l;d.tileHeight=i;d.widthInPixels=e*l;d.heightInPixels=n*i;d.layers[0].width=e;d.layers[0].height=n;d.layers[0].widthInPixels=d.widthInPixels;d.layers[0].heightInPixels=d.heightInPixels;d.layers[0].data=f;return d},getEmptyData:function(j,e,g,d){var i={};i.width=0;i.height=0;i.tileWidth=0;i.tileHeight=0;if(typeof j!=="undefined"&&j!==null){i.tileWidth=j}if(typeof e!=="undefined"&&e!==null){i.tileHeight=e}if(typeof g!=="undefined"&&g!==null){i.width=g}if(typeof d!=="undefined"&&d!==null){i.height=d}i.orientation="orthogonal";i.version="1";i.properties={};i.widthInPixels=0;i.heightInPixels=0;var h=[];var f={name:"layer",x:0,y:0,width:0,height:0,widthInPixels:0,heightInPixels:0,alpha:1,visible:true,properties:{},indexes:[],callbacks:[],data:[]};h.push(f);i.layers=h;i.images=[];i.objects={};i.collision={};i.tilesets=[];i.tiles=[];return i},parseTiledJSON:function(E){if(E.orientation!=="orthogonal"){console.warn("TilemapParser.parseTiledJSON: Only orthogonal map types are supported in this version of Phaser");return null}var F={};F.width=E.width;F.height=E.height;F.tileWidth=E.tilewidth;F.tileHeight=E.tileheight;F.orientation=E.orientation;F.format=b.Tilemap.TILED_JSON;F.version=E.version;F.properties=E.properties;F.widthInPixels=F.width*F.tileWidth;F.heightInPixels=F.height*F.tileHeight;var h=[];for(var C=0;C<E.layers.length;C++){if(E.layers[C].type!=="tilelayer"){continue}var H={name:E.layers[C].name,x:E.layers[C].x,y:E.layers[C].y,width:E.layers[C].width,height:E.layers[C].height,widthInPixels:E.layers[C].width*E.tilewidth,heightInPixels:E.layers[C].height*E.tileheight,alpha:E.layers[C].opacity,visible:E.layers[C].visible,properties:{},indexes:[],callbacks:[],bodies:[]};if(E.layers[C].properties){H.properties=E.layers[C].properties}var n=0;var g=[];var k=[];for(var s=0,D=E.layers[C].data.length;s<D;s++){if(E.layers[C].data[s]>0){g.push(new b.Tile(H,E.layers[C].data[s],n,k.length,E.tilewidth,E.tileheight))}else{g.push(new b.Tile(H,-1,n,k.length,E.tilewidth,E.tileheight))}n++;if(n===E.layers[C].width){k.push(g);n=0;g=[]}}H.data=k;h.push(H)}F.layers=h;var q=[];for(var C=0;C<E.layers.length;C++){if(E.layers[C].type!=="imagelayer"){continue}var w={name:E.layers[C].name,image:E.layers[C].image,x:E.layers[C].x,y:E.layers[C].y,alpha:E.layers[C].opacity,visible:E.layers[C].visible,properties:{}};if(E.layers[C].properties){w.properties=E.layers[C].properties}q.push(w)}F.images=q;var B=[];for(var C=0;C<E.tilesets.length;C++){var u=E.tilesets[C];var j=new b.Tileset(u.name,u.firstgid,u.tilewidth,u.tileheight,u.margin,u.spacing,u.properties);if(u.tileproperties){j.tileProperties=u.tileproperties}j.rows=Math.round((u.imageheight-u.margin)/(u.tileheight+u.spacing));j.columns=Math.round((u.imagewidth-u.margin)/(u.tilewidth+u.spacing));j.total=j.rows*j.columns;if(j.rows%1!==0||j.columns%1!==0){console.warn("TileSet image dimensions do not match expected dimensions. Tileset width/height must be evenly divisible by Tilemap tile width/height.")}else{B.push(j)}}F.tilesets=B;var d={};var e={};function A(x,i){var t={};for(var p in i){var v=i[p];t[v]=x[v]}return t}for(var C=0;C<E.layers.length;C++){if(E.layers[C].type!=="objectgroup"){continue}d[E.layers[C].name]=[];e[E.layers[C].name]=[];for(var r=0,D=E.layers[C].objects.length;r<D;r++){if(E.layers[C].objects[r].gid){var G={gid:E.layers[C].objects[r].gid,name:E.layers[C].objects[r].name,x:E.layers[C].objects[r].x,y:E.layers[C].objects[r].y,visible:E.layers[C].objects[r].visible,properties:E.layers[C].objects[r].properties};d[E.layers[C].name].push(G)}else{if(E.layers[C].objects[r].polyline){var G={name:E.layers[C].objects[r].name,x:E.layers[C].objects[r].x,y:E.layers[C].objects[r].y,width:E.layers[C].objects[r].width,height:E.layers[C].objects[r].height,visible:E.layers[C].objects[r].visible,properties:E.layers[C].objects[r].properties};G.polyline=[];for(var z=0;z<E.layers[C].objects[r].polyline.length;z++){G.polyline.push([E.layers[C].objects[r].polyline[z].x,E.layers[C].objects[r].polyline[z].y])}e[E.layers[C].name].push(G)}else{if(E.layers[C].objects[r].polygon){var G=A(E.layers[C].objects[r],["name","x","y","visible","properties"]);G.polygon=[];for(var z=0;z<E.layers[C].objects[r].polygon.length;z++){G.polygon.push([E.layers[C].objects[r].polygon[z].x,E.layers[C].objects[r].polygon[z].y])}d[E.layers[C].name].push(G)}else{if(E.layers[C].objects[r].ellipse){var G=A(E.layers[C].objects[r],["name","ellipse","x","y","width","height","visible","properties"]);d[E.layers[C].name].push(G)}else{var G=A(E.layers[C].objects[r],["name","x","y","width","height","visible","properties"]);G.rectangle=true;d[E.layers[C].name].push(G)}}}}}}F.objects=d;F.collision=e;F.tiles=[];for(var C=0;C<F.tilesets.length;C++){var u=F.tilesets[C];var n=u.tileMargin;var l=u.tileMargin;var f=0;var o=0;var m=0;for(var s=u.firstgid;s<u.firstgid+u.total;s++){F.tiles[s]=[n,l,C];n+=u.tileWidth+u.tileSpacing;f++;if(f===u.total){break}o++;if(o===u.columns){n=u.tileMargin;l+=u.tileHeight+u.tileSpacing;o=0;m++;if(m===u.rows){break}}}}return F}};b.Tileset=function(e,i,g,d,h,j,f){if(typeof g==="undefined"||g<=0){g=32}if(typeof d==="undefined"||d<=0){d=32}if(typeof h==="undefined"){h=0}if(typeof j==="undefined"){j=0}this.name=e;this.firstgid=i;this.tileWidth=g;this.tileHeight=d;this.tileMargin=h;this.tileSpacing=j;this.properties=f;this.image=null;this.rows=0;this.columns=0;this.total=0;this.drawCoords=[]};b.Tileset.prototype={draw:function(f,d,g,e){if(!this.image||!this.drawCoords[e]){return}f.drawImage(this.image,this.drawCoords[e][0],this.drawCoords[e][1],this.tileWidth,this.tileHeight,d,g,this.tileWidth,this.tileHeight)},setImage:function(h){this.image=h;this.rows=Math.round((h.height-this.tileMargin)/(this.tileHeight+this.tileSpacing));this.columns=Math.round((h.width-this.tileMargin)/(this.tileWidth+this.tileSpacing));this.total=this.rows*this.columns;this.drawCoords.length=0;var f=this.tileMargin;var e=this.tileMargin;var g=this.firstgid;for(var j=0;j<this.rows;j++){for(var d=0;d<this.columns;d++){this.drawCoords[g]=[f,e];f+=this.tileWidth+this.tileSpacing;g++}f=this.tileMargin;e+=this.tileHeight+this.tileSpacing}},setSpacing:function(d,e){this.tileMargin=d;this.tileSpacing=e;this.setImage(this.image)}};b.Tileset.prototype.constructor=b.Tileset;if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=b}exports.Phaser=b}else{if(typeof define!=="undefined"&&define.amd){define("Phaser",(function(){return a.Phaser=b})())}else{a.Phaser=b}}}).call(this);Phaser.Physics.Ninja=function(a){this.game=a;this.time=this.game.time;this.gravity=0.2;this.bounds=new Phaser.Rectangle(0,0,a.world.width,a.world.height);this.maxObjects=10;this.maxLevels=4;this.quadTree=new Phaser.QuadTree(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels)};Phaser.Physics.Ninja.prototype.constructor=Phaser.Physics.Ninja;Phaser.Physics.Ninja.prototype={enableAABB:function(a,b){this.enable(a,1,0,0,b)},enableCircle:function(b,a,c){this.enable(b,2,0,a,c)},enableTile:function(a,c,b){this.enable(a,3,c,0,b)},enable:function(b,e,f,a,d){if(typeof e==="undefined"){e=1}if(typeof f==="undefined"){f=1}if(typeof a==="undefined"){a=0}if(typeof d==="undefined"){d=true}if(Array.isArray(b)){var c=b.length;while(c--){if(b[c] instanceof Phaser.Group){this.enable(b[c].children,e,f,a,d)}else{this.enableBody(b[c],e,f,a);if(d&&b[c].hasOwnProperty("children")&&b[c].children.length>0){this.enable(b[c],e,f,a,true)}}}}else{if(b instanceof Phaser.Group){this.enable(b.children,e,f,a,d)}else{this.enableBody(b,e,f,a);if(d&&b.hasOwnProperty("children")&&b.children.length>0){this.enable(b.children,e,f,a,true)}}}},enableBody:function(b,c,d,a){if(b.hasOwnProperty("body")&&b.body===null){b.body=new Phaser.Physics.Ninja.Body(this,b,c,d,a);b.anchor.set(0.5)}},setBounds:function(b,d,c,a){this.bounds.setTo(b,d,c,a)},setBoundsToWorld:function(){this.bounds.setTo(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height)},clearTilemapLayerBodies:function(c,b){b=c.getLayer(b);var a=c.layers[b].bodies.length;while(a--){c.layers[b].bodies[a].destroy()}c.layers[b].bodies.length=[]},convertTilemap:function(b,e,a){e=b.getLayer(e);this.clearTilemapLayerBodies(b,e);for(var g=0,c=b.layers[e].height;g<c;g++){for(var i=0,j=b.layers[e].width;i<j;i++){var f=b.layers[e].data[g][i];if(f&&a.hasOwnProperty(f.index)){var d=new Phaser.Physics.Ninja.Body(this,null,3,a[f.index],0,f.worldX+f.centerX,f.worldY+f.centerY,f.width,f.height);b.layers[e].bodies.push(d)}}}return b.layers[e].bodies},overlap:function(g,f,b,e,c){b=b||null;e=e||null;c=c||b;this._result=false;this._total=0;if(Array.isArray(f)){for(var d=0,a=f.length;d<a;d++){this.collideHandler(g,f[d],b,e,c,true)}}else{this.collideHandler(g,f,b,e,c,true)}return(this._total>0)},collide:function(g,f,e,d,b){e=e||null;d=d||null;b=b||e;this._result=false;this._total=0;if(Array.isArray(f)){for(var c=0,a=f.length;c<a;c++){this.collideHandler(g,f[c],e,d,b,false)}}else{this.collideHandler(g,f,e,d,b,false)}return(this._total>0)},collideHandler:function(f,e,d,c,a,b){if(typeof e==="undefined"&&(f.type===Phaser.GROUP||f.type===Phaser.EMITTER)){this.collideGroupVsSelf(f,d,c,a,b);return}if(f&&e&&f.exists&&e.exists){if(f.type==Phaser.SPRITE||f.type==Phaser.TILESPRITE){if(e.type==Phaser.SPRITE||e.type==Phaser.TILESPRITE){this.collideSpriteVsSprite(f,e,d,c,a,b)}else{if(e.type==Phaser.GROUP||e.type==Phaser.EMITTER){this.collideSpriteVsGroup(f,e,d,c,a,b)}else{if(e.type==Phaser.TILEMAPLAYER){this.collideSpriteVsTilemapLayer(f,e,d,c,a)}}}}else{if(f.type==Phaser.GROUP){if(e.type==Phaser.SPRITE||e.type==Phaser.TILESPRITE){this.collideSpriteVsGroup(e,f,d,c,a,b)}else{if(e.type==Phaser.GROUP||e.type==Phaser.EMITTER){this.collideGroupVsGroup(f,e,d,c,a,b)}else{if(e.type==Phaser.TILEMAPLAYER){this.collideGroupVsTilemapLayer(f,e,d,c,a)}}}}else{if(f.type==Phaser.TILEMAPLAYER){if(e.type==Phaser.SPRITE||e.type==Phaser.TILESPRITE){this.collideSpriteVsTilemapLayer(e,f,d,c,a)}else{if(e.type==Phaser.GROUP||e.type==Phaser.EMITTER){this.collideGroupVsTilemapLayer(e,f,d,c,a)}}}else{if(f.type==Phaser.EMITTER){if(e.type==Phaser.SPRITE||e.type==Phaser.TILESPRITE){this.collideSpriteVsGroup(e,f,d,c,a,b)}else{if(e.type==Phaser.GROUP||e.type==Phaser.EMITTER){this.collideGroupVsGroup(f,e,d,c,a,b)}else{if(e.type==Phaser.TILEMAPLAYER){this.collideGroupVsTilemapLayer(f,e,d,c,a)}}}}}}}}},collideSpriteVsSprite:function(f,e,d,c,a,b){if(this.separate(f.body,e.body,c,a,b)){if(d){d.call(a,f,e)}this._total++}},collideSpriteVsGroup:function(e,h,g,f,b,c){if(h.length===0){return}for(var d=0,a=h.children.length;d<a;d++){if(h.children[d].exists&&h.children[d].body&&this.separate(e.body,h.children[d].body,f,b,c)){if(g){g.call(b,e,h.children[d])}this._total++}}},collideGroupVsSelf:function(h,g,f,b,d){if(h.length===0){return}var a=h.children.length;for(var e=0;e<a;e++){for(var c=e+1;c<=a;c++){if(h.children[e]&&h.children[c]&&h.children[e].exists&&h.children[c].exists){this.collideSpriteVsSprite(h.children[e],h.children[c],g,f,b,d)}}}},collideGroupVsGroup:function(b,h,g,f,c,d){if(b.length===0||h.length===0){return}for(var e=0,a=b.children.length;e<a;e++){if(b.children[e].exists){this.collideSpriteVsGroup(b.children[e],h,g,f,c,d)}}},separate:function(b,a){if(b.type!==Phaser.Physics.NINJA||a.type!==Phaser.Physics.NINJA){return false}if(b.aabb&&a.aabb){return b.aabb.collideAABBVsAABB(a.aabb)}if(b.aabb&&a.tile){return b.aabb.collideAABBVsTile(a.tile)}if(b.tile&&a.aabb){return a.aabb.collideAABBVsTile(b.tile)}if(b.circle&&a.tile){return b.circle.collideCircleVsTile(a.tile)}if(b.tile&&a.circle){return a.circle.collideCircleVsTile(b.tile)}}};Phaser.Physics.Ninja.Body=function(a,h,e,b,d,g,f,c,i){h=h||null;if(typeof e==="undefined"){e=1}if(typeof b==="undefined"){b=1}if(typeof d==="undefined"){d=16}this.sprite=h;this.game=a.game;this.type=Phaser.Physics.NINJA;this.system=a;this.aabb=null;this.tile=null;this.circle=null;this.shape=null;this.drag=1;this.friction=0.05;this.gravityScale=1;this.bounce=0.3;this.velocity=new Phaser.Point();this.facing=Phaser.NONE;this.immovable=false;this.collideWorldBounds=true;this.checkCollision={none:false,any:true,up:true,down:true,left:true,right:true};this.touching={none:true,up:false,down:false,left:false,right:false};this.wasTouching={none:true,up:false,down:false,left:false,right:false};this.maxSpeed=8;if(h){g=h.x;f=h.y;c=h.width;i=h.height;if(h.anchor.x===0){g+=(h.width*0.5)}if(h.anchor.y===0){f+=(h.height*0.5)}}if(e===1){this.aabb=new Phaser.Physics.Ninja.AABB(this,g,f,c,i);this.shape=this.aabb}else{if(e===2){this.circle=new Phaser.Physics.Ninja.Circle(this,g,f,d);this.shape=this.circle}else{if(e===3){this.tile=new Phaser.Physics.Ninja.Tile(this,g,f,c,i,b);this.shape=this.tile}}}};Phaser.Physics.Ninja.Body.prototype={preUpdate:function(){this.wasTouching.none=this.touching.none;this.wasTouching.up=this.touching.up;this.wasTouching.down=this.touching.down;this.wasTouching.left=this.touching.left;this.wasTouching.right=this.touching.right;this.touching.none=true;this.touching.up=false;this.touching.down=false;this.touching.left=false;this.touching.right=false;this.shape.integrate();if(this.collideWorldBounds){this.shape.collideWorldBounds()}},postUpdate:function(){if(this.sprite){if(this.sprite.type===Phaser.TILESPRITE){this.sprite.x=this.shape.pos.x-this.shape.xw;this.sprite.y=this.shape.pos.y-this.shape.yw}else{this.sprite.x=this.shape.pos.x;this.sprite.y=this.shape.pos.y}}if(this.velocity.x<0){this.facing=Phaser.LEFT}else{if(this.velocity.x>0){this.facing=Phaser.RIGHT}}if(this.velocity.y<0){this.facing=Phaser.UP}else{if(this.velocity.y>0){this.facing=Phaser.DOWN}}},setZeroVelocity:function(){this.shape.oldpos.x=this.shape.pos.x;this.shape.oldpos.y=this.shape.pos.y},moveTo:function(b,c){var a=b*this.game.time.physicsElapsed;var c=this.game.math.degToRad(c);this.shape.pos.x=this.shape.oldpos.x+(a*Math.cos(c));this.shape.pos.y=this.shape.oldpos.y+(a*Math.sin(c))},moveFrom:function(b,c){var a=-b*this.game.time.physicsElapsed;var c=this.game.math.degToRad(c);this.shape.pos.x=this.shape.oldpos.x+(a*Math.cos(c));this.shape.pos.y=this.shape.oldpos.y+(a*Math.sin(c))},moveLeft:function(b){var a=-b*this.game.time.physicsElapsed;this.shape.pos.x=this.shape.oldpos.x+Math.min(this.maxSpeed,Math.max(-this.maxSpeed,this.shape.pos.x-this.shape.oldpos.x+a))},moveRight:function(b){var a=b*this.game.time.physicsElapsed;this.shape.pos.x=this.shape.oldpos.x+Math.min(this.maxSpeed,Math.max(-this.maxSpeed,this.shape.pos.x-this.shape.oldpos.x+a))},moveUp:function(b){var a=-b*this.game.time.physicsElapsed;this.shape.pos.y=this.shape.oldpos.y+Math.min(this.maxSpeed,Math.max(-this.maxSpeed,this.shape.pos.y-this.shape.oldpos.y+a))},moveDown:function(b){var a=b*this.game.time.physicsElapsed;this.shape.pos.y=this.shape.oldpos.y+Math.min(this.maxSpeed,Math.max(-this.maxSpeed,this.shape.pos.y-this.shape.oldpos.y+a))},reset:function(){this.velocity.set(0);this.shape.pos.x=this.sprite.x;this.shape.pos.y=this.sprite.y;this.shape.oldpos.copyFrom(this.shape.pos)},deltaAbsX:function(){return(this.deltaX()>0?this.deltaX():-this.deltaX())},deltaAbsY:function(){return(this.deltaY()>0?this.deltaY():-this.deltaY())},deltaX:function(){return this.shape.pos.x-this.shape.oldpos.x},deltaY:function(){return this.shape.pos.y-this.shape.oldpos.y},destroy:function(){this.sprite=null;this.system=null;this.aabb=null;this.tile=null;this.circle=null;this.shape.destroy();this.shape=null}};Object.defineProperty(Phaser.Physics.Ninja.Body.prototype,"x",{get:function(){return this.shape.pos.x},set:function(a){this.shape.pos.x=a}});Object.defineProperty(Phaser.Physics.Ninja.Body.prototype,"y",{get:function(){return this.shape.pos.y},set:function(a){this.shape.pos.y=a}});Object.defineProperty(Phaser.Physics.Ninja.Body.prototype,"width",{get:function(){return this.shape.width}});Object.defineProperty(Phaser.Physics.Ninja.Body.prototype,"height",{get:function(){return this.shape.height}});Object.defineProperty(Phaser.Physics.Ninja.Body.prototype,"bottom",{get:function(){return this.shape.pos.y+this.shape.yw}});Object.defineProperty(Phaser.Physics.Ninja.Body.prototype,"right",{get:function(){return this.shape.pos.x+this.shape.xw}});Object.defineProperty(Phaser.Physics.Ninja.Body.prototype,"speed",{get:function(){return Math.sqrt(this.shape.velocity.x*this.shape.velocity.x+this.shape.velocity.y*this.shape.velocity.y)}});Object.defineProperty(Phaser.Physics.Ninja.Body.prototype,"angle",{get:function(){return Math.atan2(this.shape.velocity.y,this.shape.velocity.x)}});Phaser.Physics.Ninja.Body.render=function(c,a,b,d){b=b||"rgba(0,255,0,0.4)";if(typeof d==="undefined"){d=true}if(a.aabb||a.circle){a.shape.render(c,a.game.camera.x,a.game.camera.y,b,d)}};Phaser.Physics.Ninja.AABB=function(c,b,e,d,a){this.body=c;this.system=c.system;this.pos=new Phaser.Point(b,e);this.oldpos=new Phaser.Point(b,e);this.xw=Math.abs(d/2);this.yw=Math.abs(a/2);this.width=d;this.height=a;this.oH=0;this.oV=0;this.velocity=new Phaser.Point();this.aabbTileProjections={};this.aabbTileProjections[Phaser.Physics.Ninja.Tile.TYPE_FULL]=this.projAABB_Full;this.aabbTileProjections[Phaser.Physics.Ninja.Tile.TYPE_45DEG]=this.projAABB_45Deg;this.aabbTileProjections[Phaser.Physics.Ninja.Tile.TYPE_CONCAVE]=this.projAABB_Concave;this.aabbTileProjections[Phaser.Physics.Ninja.Tile.TYPE_CONVEX]=this.projAABB_Convex;this.aabbTileProjections[Phaser.Physics.Ninja.Tile.TYPE_22DEGs]=this.projAABB_22DegS;this.aabbTileProjections[Phaser.Physics.Ninja.Tile.TYPE_22DEGb]=this.projAABB_22DegB;this.aabbTileProjections[Phaser.Physics.Ninja.Tile.TYPE_67DEGs]=this.projAABB_67DegS;this.aabbTileProjections[Phaser.Physics.Ninja.Tile.TYPE_67DEGb]=this.projAABB_67DegB;this.aabbTileProjections[Phaser.Physics.Ninja.Tile.TYPE_HALF]=this.projAABB_Half};Phaser.Physics.Ninja.AABB.prototype.constructor=Phaser.Physics.Ninja.AABB;Phaser.Physics.Ninja.AABB.COL_NONE=0;Phaser.Physics.Ninja.AABB.COL_AXIS=1;Phaser.Physics.Ninja.AABB.COL_OTHER=2;Phaser.Physics.Ninja.AABB.prototype={integrate:function(){var b=this.pos.x;var a=this.pos.y;this.pos.x+=(this.body.drag*this.pos.x)-(this.body.drag*this.oldpos.x);this.pos.y+=(this.body.drag*this.pos.y)-(this.body.drag*this.oldpos.y)+(this.system.gravity*this.body.gravityScale);this.velocity.set(this.pos.x-b,this.pos.y-a);this.oldpos.set(b,a)},reportCollisionVsWorld:function(g,f,e,d){var j=this.pos;var k=this.oldpos;var i=j.x-k.x;var h=j.y-k.y;var l=(i*e+h*d);var r=l*e;var q=l*d;var u=i-r;var t=h-q;var s,n,m,c,a;if(l<0){c=u*this.body.friction;a=t*this.body.friction;s=1+this.body.bounce;n=(r*s);m=(q*s);if(e===1){this.body.touching.left=true}else{if(e===-1){this.body.touching.right=true}}if(d===1){this.body.touching.up=true}else{if(d===-1){this.body.touching.down=true}}}else{n=m=c=a=0}j.x+=g;j.y+=f;k.x+=g+n+c;k.y+=f+m+a},reverse:function(){var b=this.pos.x-this.oldpos.x;var a=this.pos.y-this.oldpos.y;if(this.oldpos.x<this.pos.x){this.oldpos.x=this.pos.x+b}else{if(this.oldpos.x>this.pos.x){this.oldpos.x=this.pos.x-b}}if(this.oldpos.y<this.pos.y){this.oldpos.y=this.pos.y+a}else{if(this.oldpos.y>this.pos.y){this.oldpos.y=this.pos.y-a}}},reportCollisionVsBody:function(e,c,b,a,h){var d=this.pos.x-this.oldpos.x;var g=this.pos.y-this.oldpos.y;var f=(d*b+g*a);if(this.body.immovable&&h.body.immovable){e*=0.5;c*=0.5;this.pos.add(e,c);this.oldpos.set(this.pos.x,this.pos.y);h.pos.subtract(e,c);h.oldpos.set(h.pos.x,h.pos.y);return}else{if(!this.body.immovable&&!h.body.immovable){e*=0.5;c*=0.5;this.pos.add(e,c);h.pos.subtract(e,c);if(f<0){this.reverse();h.reverse()}}else{if(!this.body.immovable){this.pos.subtract(e,c);if(f<0){this.reverse()}}else{if(!h.body.immovable){h.pos.subtract(e,c);if(f<0){h.reverse()}}}}}},collideWorldBounds:function(){var b=this.system.bounds.x-(this.pos.x-this.xw);if(0<b){this.reportCollisionVsWorld(b,0,1,0,null)}else{b=(this.pos.x+this.xw)-this.system.bounds.right;if(0<b){this.reportCollisionVsWorld(-b,0,-1,0,null)}}var a=this.system.bounds.y-(this.pos.y-this.yw);if(0<a){this.reportCollisionVsWorld(0,a,0,1,null)}else{a=(this.pos.y+this.yw)-this.system.bounds.bottom;if(0<a){this.reportCollisionVsWorld(0,-a,0,-1,null)}}},collideAABBVsAABB:function(e){var h=this.pos;var g=e;var f=g.pos.x;var d=g.pos.y;var b=g.xw;var m=g.yw;var n=h.x-f;var j=(b+this.xw)-Math.abs(n);if(0<j){var k=h.y-d;var i=(m+this.yw)-Math.abs(k);if(0<i){if(j<i){if(n<0){j*=-1;i=0}else{i=0}}else{if(k<0){j=0;i*=-1}else{j=0}}var a=Math.sqrt(j*j+i*i);this.reportCollisionVsBody(j,i,j/a,i/a,g);return Phaser.Physics.Ninja.AABB.COL_AXIS}}return false},collideAABBVsTile:function(e){var b=this.pos.x-e.pos.x;var d=(e.xw+this.xw)-Math.abs(b);if(0<d){var a=this.pos.y-e.pos.y;var c=(e.yw+this.yw)-Math.abs(a);if(0<c){if(d<c){if(b<0){d*=-1;c=0}else{c=0}}else{if(a<0){d=0;c*=-1}else{d=0}}return this.resolveTile(d,c,this,e)}}return false},resolveTile:function(b,d,a,c){if(0<c.id){return this.aabbTileProjections[c.type](b,d,a,c)}else{return false}},projAABB_Full:function(a,e,d,c){var b=Math.sqrt(a*a+e*e);d.reportCollisionVsWorld(a,e,a/b,e/b,c);return Phaser.Physics.Ninja.AABB.COL_AXIS},projAABB_Half:function(j,g,f,k){var i=k.signx;var h=k.signy;var d=(f.pos.x-(i*f.xw))-k.pos.x;var c=(f.pos.y-(h*f.yw))-k.pos.y;var e=(d*i)+(c*h);if(e<0){i*=-e;h*=-e;var b=Math.sqrt(i*i+h*h);var a=Math.sqrt(j*j+g*g);if(a<b){f.reportCollisionVsWorld(j,g,j/a,g/a,k);return Phaser.Physics.Ninja.AABB.COL_AXIS}else{f.reportCollisionVsWorld(i,h,k.signx,k.signy,k);return Phaser.Physics.Ninja.AABB.COL_OTHER}}return Phaser.Physics.Ninja.AABB.COL_NONE},projAABB_45Deg:function(l,j,f,m){var h=m.signx;var g=m.signy;var d=(f.pos.x-(h*f.xw))-m.pos.x;var c=(f.pos.y-(g*f.yw))-m.pos.y;var k=m.sx;var i=m.sy;var e=(d*k)+(c*i);if(e<0){k*=-e;i*=-e;var b=Math.sqrt(k*k+i*i);var a=Math.sqrt(l*l+j*j);if(a<b){f.reportCollisionVsWorld(l,j,l/a,j/a,m);return Phaser.Physics.Ninja.AABB.COL_AXIS}else{f.reportCollisionVsWorld(k,i,m.sx,m.sy);return Phaser.Physics.Ninja.AABB.COL_OTHER}}return Phaser.Physics.Ninja.AABB.COL_NONE},projAABB_22DegS:function(o,l,g,p){var i=p.signx;var h=p.signy;var n=g.pos.y-(h*g.yw);var j=p.pos.y-n;if(0<(j*h)){var d=(g.pos.x-(i*g.xw))-(p.pos.x+(i*p.xw));var c=(g.pos.y-(h*g.yw))-(p.pos.y-(h*p.yw));var m=p.sx;var k=p.sy;var e=(d*m)+(c*k);if(e<0){m*=-e;k*=-e;var b=Math.sqrt(m*m+k*k);var a=Math.sqrt(o*o+l*l);var f=Math.abs(j);if(a<b){if(f<a){g.reportCollisionVsWorld(0,j,0,j/f,p);return Phaser.Physics.Ninja.AABB.COL_OTHER}else{g.reportCollisionVsWorld(o,l,o/a,l/a,p);return Phaser.Physics.Ninja.AABB.COL_AXIS}}else{if(f<b){g.reportCollisionVsWorld(0,j,0,j/f,p);return Phaser.Physics.Ninja.AABB.COL_OTHER}else{g.reportCollisionVsWorld(m,k,p.sx,p.sy,p);return Phaser.Physics.Ninja.AABB.COL_OTHER}}}}return Phaser.Physics.Ninja.AABB.COL_NONE},projAABB_22DegB:function(l,j,f,m){var h=m.signx;var g=m.signy;var d=(f.pos.x-(h*f.xw))-(m.pos.x-(h*m.xw));var c=(f.pos.y-(g*f.yw))-(m.pos.y+(g*m.yw));var k=m.sx;var i=m.sy;var e=(d*k)+(c*i);if(e<0){k*=-e;i*=-e;var b=Math.sqrt(k*k+i*i);var a=Math.sqrt(l*l+j*j);if(a<b){f.reportCollisionVsWorld(l,j,l/a,j/a,m);return Phaser.Physics.Ninja.AABB.COL_AXIS}else{f.reportCollisionVsWorld(k,i,m.sx,m.sy,m);return Phaser.Physics.Ninja.AABB.COL_OTHER}}return Phaser.Physics.Ninja.AABB.COL_NONE},projAABB_67DegS:function(n,l,g,p){var i=p.signx;var h=p.signy;var o=g.pos.x-(i*g.xw);var j=p.pos.x-o;if(0<(j*i)){var d=(g.pos.x-(i*g.xw))-(p.pos.x-(i*p.xw));var c=(g.pos.y-(h*g.yw))-(p.pos.y+(h*p.yw));var m=p.sx;var k=p.sy;var e=(d*m)+(c*k);if(e<0){m*=-e;k*=-e;var b=Math.sqrt(m*m+k*k);var a=Math.sqrt(n*n+l*l);var f=Math.abs(j);if(a<b){if(f<a){g.reportCollisionVsWorld(j,0,j/f,0,p);return Phaser.Physics.Ninja.AABB.COL_OTHER}else{g.reportCollisionVsWorld(n,l,n/a,l/a,p);return Phaser.Physics.Ninja.AABB.COL_AXIS}}else{if(f<b){g.reportCollisionVsWorld(j,0,j/f,0,p);return Phaser.Physics.Ninja.AABB.COL_OTHER}else{g.reportCollisionVsWorld(m,k,p.sx,p.sy,p);return Phaser.Physics.Ninja.AABB.COL_OTHER}}}}return Phaser.Physics.Ninja.AABB.COL_NONE},projAABB_67DegB:function(l,j,f,m){var h=m.signx;var g=m.signy;var d=(f.pos.x-(h*f.xw))-(m.pos.x+(h*m.xw));var c=(f.pos.y-(g*f.yw))-(m.pos.y-(g*m.yw));var k=m.sx;var i=m.sy;var e=(d*k)+(c*i);if(e<0){k*=-e;i*=-e;var b=Math.sqrt(k*k+i*i);var a=Math.sqrt(l*l+j*j);if(a<b){f.reportCollisionVsWorld(l,j,l/a,j/a,m);return Phaser.Physics.Ninja.AABB.COL_AXIS}else{f.reportCollisionVsWorld(k,i,m.sx,m.sy,m);return Phaser.Physics.Ninja.AABB.COL_OTHER}}return Phaser.Physics.Ninja.AABB.COL_NONE},projAABB_Convex:function(l,k,e,m){var g=m.signx;var f=m.signy;var c=(e.pos.x-(g*e.xw))-(m.pos.x-(g*m.xw));var b=(e.pos.y-(f*e.yw))-(m.pos.y-(f*m.yw));var h=Math.sqrt(c*c+b*b);var j=m.xw*2;var i=Math.sqrt(j*j+0);var d=i-h;if(((g*c)<0)||((f*b)<0)){var a=Math.sqrt(l*l+k*k);e.reportCollisionVsWorld(l,k,l/a,k/a,m);return Phaser.Physics.Ninja.AABB.COL_AXIS}else{if(0<d){c/=h;b/=h;e.reportCollisionVsWorld(c*d,b*d,c,b,m);return Phaser.Physics.Ninja.AABB.COL_OTHER}}return Phaser.Physics.Ninja.AABB.COL_NONE},projAABB_Concave:function(l,k,e,m){var g=m.signx;var f=m.signy;var c=(m.pos.x+(g*m.xw))-(e.pos.x-(g*e.xw));var b=(m.pos.y+(f*m.yw))-(e.pos.y-(f*e.yw));var j=m.xw*2;var i=Math.sqrt(j*j+0);var h=Math.sqrt(c*c+b*b);var d=h-i;if(0<d){var a=Math.sqrt(l*l+k*k);if(a<d){e.reportCollisionVsWorld(l,k,l/a,k/a,m);return Phaser.Physics.Ninja.AABB.COL_AXIS}else{c/=h;b/=h;e.reportCollisionVsWorld(c*d,b*d,c,b,m);return Phaser.Physics.Ninja.AABB.COL_OTHER}}return Phaser.Physics.Ninja.AABB.COL_NONE},destroy:function(){this.body=null;this.system=null},render:function(b,c,g,a,d){var f=this.pos.x-this.xw-c;var e=this.pos.y-this.yw-g;if(d){b.fillStyle=a;b.fillRect(f,e,this.width,this.height)}else{b.strokeStyle=a;b.strokeRect(f,e,this.width,this.height)}}};Phaser.Physics.Ninja.Tile=function(c,b,f,e,a,d){if(typeof d==="undefined"){d=Phaser.Physics.Ninja.Tile.EMPTY}this.body=c;this.system=c.system;this.id=d;this.type=Phaser.Physics.Ninja.Tile.TYPE_EMPTY;this.pos=new Phaser.Point(b,f);this.oldpos=new Phaser.Point(b,f);if(this.id>1&&this.id<30){a=e}this.xw=Math.abs(e/2);this.yw=Math.abs(a/2);this.width=e;this.height=a;this.velocity=new Phaser.Point();this.signx=0;this.signy=0;this.sx=0;this.sy=0;this.body.gravityScale=0;this.body.collideWorldBounds=false;if(this.id>0){this.setType(this.id)}};Phaser.Physics.Ninja.Tile.prototype.constructor=Phaser.Physics.Ninja.Tile;Phaser.Physics.Ninja.Tile.prototype={integrate:function(){var b=this.pos.x;var a=this.pos.y;this.pos.x+=(this.body.drag*this.pos.x)-(this.body.drag*this.oldpos.x);this.pos.y+=(this.body.drag*this.pos.y)-(this.body.drag*this.oldpos.y)+(this.system.gravity*this.body.gravityScale);this.velocity.set(this.pos.x-b,this.pos.y-a);this.oldpos.set(b,a)},collideWorldBounds:function(){var b=this.system.bounds.x-(this.pos.x-this.xw);if(0<b){this.reportCollisionVsWorld(b,0,1,0,null)}else{b=(this.pos.x+this.xw)-this.system.bounds.right;if(0<b){this.reportCollisionVsWorld(-b,0,-1,0,null)}}var a=this.system.bounds.y-(this.pos.y-this.yw);if(0<a){this.reportCollisionVsWorld(0,a,0,1,null)}else{a=(this.pos.y+this.yw)-this.system.bounds.bottom;if(0<a){this.reportCollisionVsWorld(0,-a,0,-1,null)}}},reportCollisionVsWorld:function(g,f,e,d){var j=this.pos;var k=this.oldpos;var i=j.x-k.x;var h=j.y-k.y;var l=(i*e+h*d);var r=l*e;var q=l*d;var u=i-r;var t=h-q;var s,n,m,c,a;if(l<0){c=u*this.body.friction;a=t*this.body.friction;s=1+this.body.bounce;n=(r*s);m=(q*s);if(e===1){this.body.touching.left=true}else{if(e===-1){this.body.touching.right=true}}if(d===1){this.body.touching.up=true}else{if(d===-1){this.body.touching.down=true}}}else{n=m=c=a=0}j.x+=g;j.y+=f;k.x+=g+n+c;k.y+=f+m+a},setType:function(a){if(a===Phaser.Physics.Ninja.Tile.EMPTY){this.clear()}else{this.id=a;this.updateType()}return this},clear:function(){this.id=Phaser.Physics.Ninja.Tile.EMPTY;this.updateType()},destroy:function(){this.body=null;this.system=null},updateType:function(){if(this.id===0){this.type=Phaser.Physics.Ninja.Tile.TYPE_EMPTY;this.signx=0;this.signy=0;this.sx=0;this.sy=0;return true}if(this.id<Phaser.Physics.Ninja.Tile.TYPE_45DEG){this.type=Phaser.Physics.Ninja.Tile.TYPE_FULL;this.signx=0;this.signy=0;this.sx=0;this.sy=0}else{if(this.id<Phaser.Physics.Ninja.Tile.TYPE_CONCAVE){this.type=Phaser.Physics.Ninja.Tile.TYPE_45DEG;if(this.id==Phaser.Physics.Ninja.Tile.SLOPE_45DEGpn){this.signx=1;this.signy=-1;this.sx=this.signx/Math.SQRT2;this.sy=this.signy/Math.SQRT2}else{if(this.id==Phaser.Physics.Ninja.Tile.SLOPE_45DEGnn){this.signx=-1;this.signy=-1;this.sx=this.signx/Math.SQRT2;this.sy=this.signy/Math.SQRT2}else{if(this.id==Phaser.Physics.Ninja.Tile.SLOPE_45DEGnp){this.signx=-1;this.signy=1;this.sx=this.signx/Math.SQRT2;this.sy=this.signy/Math.SQRT2}else{if(this.id==Phaser.Physics.Ninja.Tile.SLOPE_45DEGpp){this.signx=1;this.signy=1;this.sx=this.signx/Math.SQRT2;this.sy=this.signy/Math.SQRT2}else{return false}}}}}else{if(this.id<Phaser.Physics.Ninja.Tile.TYPE_CONVEX){this.type=Phaser.Physics.Ninja.Tile.TYPE_CONCAVE;if(this.id==Phaser.Physics.Ninja.Tile.CONCAVEpn){this.signx=1;this.signy=-1;this.sx=0;this.sy=0}else{if(this.id==Phaser.Physics.Ninja.Tile.CONCAVEnn){this.signx=-1;this.signy=-1;this.sx=0;this.sy=0}else{if(this.id==Phaser.Physics.Ninja.Tile.CONCAVEnp){this.signx=-1;this.signy=1;this.sx=0;this.sy=0}else{if(this.id==Phaser.Physics.Ninja.Tile.CONCAVEpp){this.signx=1;this.signy=1;this.sx=0;this.sy=0}else{return false}}}}}else{if(this.id<Phaser.Physics.Ninja.Tile.TYPE_22DEGs){this.type=Phaser.Physics.Ninja.Tile.TYPE_CONVEX;if(this.id==Phaser.Physics.Ninja.Tile.CONVEXpn){this.signx=1;this.signy=-1;this.sx=0;this.sy=0}else{if(this.id==Phaser.Physics.Ninja.Tile.CONVEXnn){this.signx=-1;this.signy=-1;this.sx=0;this.sy=0}else{if(this.id==Phaser.Physics.Ninja.Tile.CONVEXnp){this.signx=-1;this.signy=1;this.sx=0;this.sy=0}else{if(this.id==Phaser.Physics.Ninja.Tile.CONVEXpp){this.signx=1;this.signy=1;this.sx=0;this.sy=0}else{return false}}}}}else{if(this.id<Phaser.Physics.Ninja.Tile.TYPE_22DEGb){this.type=Phaser.Physics.Ninja.Tile.TYPE_22DEGs;if(this.id==Phaser.Physics.Ninja.Tile.SLOPE_22DEGpnS){this.signx=1;this.signy=-1;var a=Math.sqrt(2*2+1*1);this.sx=(this.signx*1)/a;this.sy=(this.signy*2)/a}else{if(this.id==Phaser.Physics.Ninja.Tile.SLOPE_22DEGnnS){this.signx=-1;this.signy=-1;var a=Math.sqrt(2*2+1*1);this.sx=(this.signx*1)/a;this.sy=(this.signy*2)/a}else{if(this.id==Phaser.Physics.Ninja.Tile.SLOPE_22DEGnpS){this.signx=-1;this.signy=1;var a=Math.sqrt(2*2+1*1);this.sx=(this.signx*1)/a;this.sy=(this.signy*2)/a}else{if(this.id==Phaser.Physics.Ninja.Tile.SLOPE_22DEGppS){this.signx=1;this.signy=1;var a=Math.sqrt(2*2+1*1);this.sx=(this.signx*1)/a;this.sy=(this.signy*2)/a}else{return false}}}}}else{if(this.id<Phaser.Physics.Ninja.Tile.TYPE_67DEGs){this.type=Phaser.Physics.Ninja.Tile.TYPE_22DEGb;if(this.id==Phaser.Physics.Ninja.Tile.SLOPE_22DEGpnB){this.signx=1;this.signy=-1;var a=Math.sqrt(2*2+1*1);this.sx=(this.signx*1)/a;this.sy=(this.signy*2)/a}else{if(this.id==Phaser.Physics.Ninja.Tile.SLOPE_22DEGnnB){this.signx=-1;this.signy=-1;var a=Math.sqrt(2*2+1*1);this.sx=(this.signx*1)/a;this.sy=(this.signy*2)/a}else{if(this.id==Phaser.Physics.Ninja.Tile.SLOPE_22DEGnpB){this.signx=-1;this.signy=1;var a=Math.sqrt(2*2+1*1);this.sx=(this.signx*1)/a;this.sy=(this.signy*2)/a}else{if(this.id==Phaser.Physics.Ninja.Tile.SLOPE_22DEGppB){this.signx=1;this.signy=1;var a=Math.sqrt(2*2+1*1);this.sx=(this.signx*1)/a;this.sy=(this.signy*2)/a}else{return false}}}}}else{if(this.id<Phaser.Physics.Ninja.Tile.TYPE_67DEGb){this.type=Phaser.Physics.Ninja.Tile.TYPE_67DEGs;if(this.id==Phaser.Physics.Ninja.Tile.SLOPE_67DEGpnS){this.signx=1;this.signy=-1;var a=Math.sqrt(2*2+1*1);this.sx=(this.signx*2)/a;this.sy=(this.signy*1)/a}else{if(this.id==Phaser.Physics.Ninja.Tile.SLOPE_67DEGnnS){this.signx=-1;this.signy=-1;var a=Math.sqrt(2*2+1*1);this.sx=(this.signx*2)/a;this.sy=(this.signy*1)/a}else{if(this.id==Phaser.Physics.Ninja.Tile.SLOPE_67DEGnpS){this.signx=-1;this.signy=1;var a=Math.sqrt(2*2+1*1);this.sx=(this.signx*2)/a;this.sy=(this.signy*1)/a}else{if(this.id==Phaser.Physics.Ninja.Tile.SLOPE_67DEGppS){this.signx=1;this.signy=1;var a=Math.sqrt(2*2+1*1);this.sx=(this.signx*2)/a;this.sy=(this.signy*1)/a}else{return false}}}}}else{if(this.id<Phaser.Physics.Ninja.Tile.TYPE_HALF){this.type=Phaser.Physics.Ninja.Tile.TYPE_67DEGb;if(this.id==Phaser.Physics.Ninja.Tile.SLOPE_67DEGpnB){this.signx=1;this.signy=-1;var a=Math.sqrt(2*2+1*1);this.sx=(this.signx*2)/a;this.sy=(this.signy*1)/a}else{if(this.id==Phaser.Physics.Ninja.Tile.SLOPE_67DEGnnB){this.signx=-1;this.signy=-1;var a=Math.sqrt(2*2+1*1);this.sx=(this.signx*2)/a;this.sy=(this.signy*1)/a}else{if(this.id==Phaser.Physics.Ninja.Tile.SLOPE_67DEGnpB){this.signx=-1;this.signy=1;var a=Math.sqrt(2*2+1*1);this.sx=(this.signx*2)/a;this.sy=(this.signy*1)/a}else{if(this.id==Phaser.Physics.Ninja.Tile.SLOPE_67DEGppB){this.signx=1;this.signy=1;var a=Math.sqrt(2*2+1*1);this.sx=(this.signx*2)/a;this.sy=(this.signy*1)/a}else{return false}}}}}else{this.type=Phaser.Physics.Ninja.Tile.TYPE_HALF;if(this.id==Phaser.Physics.Ninja.Tile.HALFd){this.signx=0;this.signy=-1;this.sx=this.signx;this.sy=this.signy}else{if(this.id==Phaser.Physics.Ninja.Tile.HALFu){this.signx=0;this.signy=1;this.sx=this.signx;this.sy=this.signy}else{if(this.id==Phaser.Physics.Ninja.Tile.HALFl){this.signx=1;this.signy=0;this.sx=this.signx;this.sy=this.signy}else{if(this.id==Phaser.Physics.Ninja.Tile.HALFr){this.signx=-1;this.signy=0;this.sx=this.signx;this.sy=this.signy}else{return false}}}}}}}}}}}}}};Object.defineProperty(Phaser.Physics.Ninja.Tile.prototype,"x",{get:function(){return this.pos.x-this.xw},set:function(a){this.pos.x=a}});Object.defineProperty(Phaser.Physics.Ninja.Tile.prototype,"y",{get:function(){return this.pos.y-this.yw},set:function(a){this.pos.y=a}});Object.defineProperty(Phaser.Physics.Ninja.Tile.prototype,"bottom",{get:function(){return this.pos.y+this.yw}});Object.defineProperty(Phaser.Physics.Ninja.Tile.prototype,"right",{get:function(){return this.pos.x+this.xw}});Phaser.Physics.Ninja.Tile.EMPTY=0;Phaser.Physics.Ninja.Tile.FULL=1;Phaser.Physics.Ninja.Tile.SLOPE_45DEGpn=2;Phaser.Physics.Ninja.Tile.SLOPE_45DEGnn=3;Phaser.Physics.Ninja.Tile.SLOPE_45DEGnp=4;Phaser.Physics.Ninja.Tile.SLOPE_45DEGpp=5;Phaser.Physics.Ninja.Tile.CONCAVEpn=6;Phaser.Physics.Ninja.Tile.CONCAVEnn=7;Phaser.Physics.Ninja.Tile.CONCAVEnp=8;Phaser.Physics.Ninja.Tile.CONCAVEpp=9;Phaser.Physics.Ninja.Tile.CONVEXpn=10;Phaser.Physics.Ninja.Tile.CONVEXnn=11;Phaser.Physics.Ninja.Tile.CONVEXnp=12;Phaser.Physics.Ninja.Tile.CONVEXpp=13;Phaser.Physics.Ninja.Tile.SLOPE_22DEGpnS=14;Phaser.Physics.Ninja.Tile.SLOPE_22DEGnnS=15;Phaser.Physics.Ninja.Tile.SLOPE_22DEGnpS=16;Phaser.Physics.Ninja.Tile.SLOPE_22DEGppS=17;Phaser.Physics.Ninja.Tile.SLOPE_22DEGpnB=18;Phaser.Physics.Ninja.Tile.SLOPE_22DEGnnB=19;Phaser.Physics.Ninja.Tile.SLOPE_22DEGnpB=20;Phaser.Physics.Ninja.Tile.SLOPE_22DEGppB=21;Phaser.Physics.Ninja.Tile.SLOPE_67DEGpnS=22;Phaser.Physics.Ninja.Tile.SLOPE_67DEGnnS=23;Phaser.Physics.Ninja.Tile.SLOPE_67DEGnpS=24;Phaser.Physics.Ninja.Tile.SLOPE_67DEGppS=25;Phaser.Physics.Ninja.Tile.SLOPE_67DEGpnB=26;Phaser.Physics.Ninja.Tile.SLOPE_67DEGnnB=27;Phaser.Physics.Ninja.Tile.SLOPE_67DEGnpB=28;Phaser.Physics.Ninja.Tile.SLOPE_67DEGppB=29;Phaser.Physics.Ninja.Tile.HALFd=30;Phaser.Physics.Ninja.Tile.HALFr=31;Phaser.Physics.Ninja.Tile.HALFu=32;Phaser.Physics.Ninja.Tile.HALFl=33;Phaser.Physics.Ninja.Tile.TYPE_EMPTY=0;Phaser.Physics.Ninja.Tile.TYPE_FULL=1;Phaser.Physics.Ninja.Tile.TYPE_45DEG=2;Phaser.Physics.Ninja.Tile.TYPE_CONCAVE=6;Phaser.Physics.Ninja.Tile.TYPE_CONVEX=10;Phaser.Physics.Ninja.Tile.TYPE_22DEGs=14;Phaser.Physics.Ninja.Tile.TYPE_22DEGb=18;Phaser.Physics.Ninja.Tile.TYPE_67DEGs=22;Phaser.Physics.Ninja.Tile.TYPE_67DEGb=26;Phaser.Physics.Ninja.Tile.TYPE_HALF=30;Phaser.Physics.Ninja.Circle=function(c,b,d,a){this.body=c;this.system=c.system;this.pos=new Phaser.Point(b,d);this.oldpos=new Phaser.Point(b,d);this.radius=a;this.xw=a;this.yw=a;this.width=a*2;this.height=a*2;this.oH=0;this.oV=0;this.velocity=new Phaser.Point();this.circleTileProjections={};this.circleTileProjections[Phaser.Physics.Ninja.Tile.TYPE_FULL]=this.projCircle_Full;this.circleTileProjections[Phaser.Physics.Ninja.Tile.TYPE_45DEG]=this.projCircle_45Deg;this.circleTileProjections[Phaser.Physics.Ninja.Tile.TYPE_CONCAVE]=this.projCircle_Concave;this.circleTileProjections[Phaser.Physics.Ninja.Tile.TYPE_CONVEX]=this.projCircle_Convex;this.circleTileProjections[Phaser.Physics.Ninja.Tile.TYPE_22DEGs]=this.projCircle_22DegS;this.circleTileProjections[Phaser.Physics.Ninja.Tile.TYPE_22DEGb]=this.projCircle_22DegB;this.circleTileProjections[Phaser.Physics.Ninja.Tile.TYPE_67DEGs]=this.projCircle_67DegS;this.circleTileProjections[Phaser.Physics.Ninja.Tile.TYPE_67DEGb]=this.projCircle_67DegB;this.circleTileProjections[Phaser.Physics.Ninja.Tile.TYPE_HALF]=this.projCircle_Half};Phaser.Physics.Ninja.Circle.prototype.constructor=Phaser.Physics.Ninja.Circle;Phaser.Physics.Ninja.Circle.COL_NONE=0;Phaser.Physics.Ninja.Circle.COL_AXIS=1;Phaser.Physics.Ninja.Circle.COL_OTHER=2;Phaser.Physics.Ninja.Circle.prototype={integrate:function(){var b=this.pos.x;var a=this.pos.y;this.pos.x+=(this.body.drag*this.pos.x)-(this.body.drag*this.oldpos.x);this.pos.y+=(this.body.drag*this.pos.y)-(this.body.drag*this.oldpos.y)+(this.system.gravity*this.body.gravityScale);this.velocity.set(this.pos.x-b,this.pos.y-a);this.oldpos.set(b,a)},reportCollisionVsWorld:function(g,f,e,d){var j=this.pos;var k=this.oldpos;var i=j.x-k.x;var h=j.y-k.y;var l=(i*e+h*d);var r=l*e;var q=l*d;var u=i-r;var t=h-q;var s,n,m,c,a;if(l<0){c=u*this.body.friction;a=t*this.body.friction;s=1+this.body.bounce;n=(r*s);m=(q*s);if(e===1){this.body.touching.left=true}else{if(e===-1){this.body.touching.right=true}}if(d===1){this.body.touching.up=true}else{if(d===-1){this.body.touching.down=true}}}else{n=m=c=a=0}j.x+=g;j.y+=f;k.x+=g+n+c;k.y+=f+m+a},collideWorldBounds:function(){var b=this.system.bounds.x-(this.pos.x-this.radius);if(0<b){this.reportCollisionVsWorld(b,0,1,0,null)}else{b=(this.pos.x+this.radius)-this.system.bounds.right;if(0<b){this.reportCollisionVsWorld(-b,0,-1,0,null)}}var a=this.system.bounds.y-(this.pos.y-this.radius);if(0<a){this.reportCollisionVsWorld(0,a,0,1,null)}else{a=(this.pos.y+this.radius)-this.system.bounds.bottom;if(0<a){this.reportCollisionVsWorld(0,-a,0,-1,null)}}},collideCircleVsTile:function(f){var h=this.pos;var a=this.radius;var g=f;var e=g.pos.x;var d=g.pos.y;var b=g.xw;var l=g.yw;var m=h.x-e;var j=(b+a)-Math.abs(m);if(0<j){var k=h.y-d;var i=(l+a)-Math.abs(k);if(0<i){this.oH=0;this.oV=0;if(m<-b){this.oH=-1}else{if(b<m){this.oH=1}}if(k<-l){this.oV=-1}else{if(l<k){this.oV=1}}return this.resolveCircleTile(j,i,this.oH,this.oV,this,g)}}},resolveCircleTile:function(a,f,d,b,e,c){if(0<c.id){return this.circleTileProjections[c.type](a,f,d,b,e,c)}else{return false}},projCircle_Full:function(i,h,a,e,c,j){if(a===0){if(e===0){if(i<h){var l=c.pos.x-j.pos.x;if(l<0){c.reportCollisionVsWorld(-i,0,-1,0,j);return Phaser.Physics.Ninja.Circle.COL_AXIS}else{c.reportCollisionVsWorld(i,0,1,0,j);return Phaser.Physics.Ninja.Circle.COL_AXIS}}else{var k=c.pos.y-j.pos.y;if(k<0){c.reportCollisionVsWorld(0,-h,0,-1,j);return Phaser.Physics.Ninja.Circle.COL_AXIS}else{c.reportCollisionVsWorld(0,h,0,1,j);return Phaser.Physics.Ninja.Circle.COL_AXIS}}}else{c.reportCollisionVsWorld(0,h*e,0,e,j);return Phaser.Physics.Ninja.Circle.COL_AXIS}}else{if(e===0){c.reportCollisionVsWorld(i*a,0,a,0,j);return Phaser.Physics.Ninja.Circle.COL_AXIS}else{var g=j.pos.x+(a*j.xw);var f=j.pos.y+(e*j.yw);var l=c.pos.x-g;var k=c.pos.y-f;var d=Math.sqrt(l*l+k*k);var b=c.radius-d;if(0<b){if(d===0){l=a/Math.SQRT2;k=e/Math.SQRT2}else{l/=d;k/=d}c.reportCollisionVsWorld(l*b,k*b,l,k,j);return Phaser.Physics.Ninja.Circle.COL_OTHER}}}return Phaser.Physics.Ninja.Circle.COL_NONE},projCircle_45Deg:function(e,d,c,u,j,k){var h=k.signx;var f=k.signy;var q;if(c===0){if(u===0){var n=k.sx;var l=k.sy;var b=(j.pos.x-(n*j.radius))-k.pos.x;var a=(j.pos.y-(l*j.radius))-k.pos.y;var p=(b*n)+(a*l);if(p<0){n*=-p;l*=-p;if(e<d){q=e;d=0;if((j.pos.x-k.pos.x)<0){e*=-1}}else{q=d;e=0;if((j.pos.y-k.pos.y)<0){d*=-1}}var r=Math.sqrt(n*n+l*l);if(q<r){j.reportCollisionVsWorld(e,d,e/q,d/q,k);return Phaser.Physics.Ninja.Circle.COL_AXIS}else{j.reportCollisionVsWorld(n,l,k.sx,k.sy,k);return Phaser.Physics.Ninja.Circle.COL_OTHER}}}else{if((f*u)<0){j.reportCollisionVsWorld(0,d*u,0,u,k);return Phaser.Physics.Ninja.Circle.COL_AXIS}else{var n=k.sx;var l=k.sy;var b=j.pos.x-(k.pos.x-(h*k.xw));var a=j.pos.y-(k.pos.y+(u*k.yw));var v=(b*-l)+(a*n);if(0<(v*h*f)){var s=Math.sqrt(b*b+a*a);var w=j.radius-s;if(0<w){b/=s;a/=s;j.reportCollisionVsWorld(b*w,a*w,b,a,k);return Phaser.Physics.Ninja.Circle.COL_OTHER}}else{var p=(b*n)+(a*l);var w=j.radius-Math.abs(p);if(0<w){j.reportCollisionVsWorld(n*w,l*w,n,l,k);return Phaser.Physics.Ninja.Circle.COL_OTHER}}}}}else{if(u===0){if((h*c)<0){j.reportCollisionVsWorld(e*c,0,c,0,k);return Phaser.Physics.Ninja.Circle.COL_AXIS}else{var n=k.sx;var l=k.sy;var b=j.pos.x-(k.pos.x+(c*k.xw));var a=j.pos.y-(k.pos.y-(f*k.yw));var v=(b*-l)+(a*n);if((v*h*f)<0){var s=Math.sqrt(b*b+a*a);var w=j.radius-s;if(0<w){b/=s;a/=s;j.reportCollisionVsWorld(b*w,a*w,b,a,k);return Phaser.Physics.Ninja.Circle.COL_OTHER}}else{var p=(b*n)+(a*l);var w=j.radius-Math.abs(p);if(0<w){j.reportCollisionVsWorld(n*w,l*w,n,l,k);return Phaser.Physics.Ninja.Circle.COL_OTHER}}}}else{if(0<((h*c)+(f*u))){return Phaser.Physics.Ninja.Circle.COL_NONE}else{var o=k.pos.x+(c*k.xw);var m=k.pos.y+(u*k.yw);var i=j.pos.x-o;var g=j.pos.y-m;var s=Math.sqrt(i*i+g*g);var w=j.radius-s;if(0<w){if(s===0){i=c/Math.SQRT2;g=u/Math.SQRT2}else{i/=s;g/=s}j.reportCollisionVsWorld(i*w,g*w,i,g,k);return Phaser.Physics.Ninja.Circle.COL_OTHER}}}}return Phaser.Physics.Ninja.Circle.COL_NONE},projCircle_Concave:function(f,e,d,r,k,l){var i=l.signx;var g=l.signy;var o;if(d===0){if(r===0){var c=(l.pos.x+(i*l.xw))-k.pos.x;var a=(l.pos.y+(g*l.yw))-k.pos.y;var p=l.xw*2;var b=Math.sqrt(p*p+0);var q=Math.sqrt(c*c+a*a);var s=(q+k.radius)-b;if(0<s){if(f<e){o=f;e=0;if((k.pos.x-l.pos.x)<0){f*=-1}}else{o=e;f=0;if((k.pos.y-l.pos.y)<0){e*=-1}}if(o<s){k.reportCollisionVsWorld(f,e,f/o,e/o,l);return Phaser.Physics.Ninja.Circle.COL_AXIS}else{c/=q;a/=q;k.reportCollisionVsWorld(c*s,a*s,c,a,l);return Phaser.Physics.Ninja.Circle.COL_OTHER}}else{return Phaser.Physics.Ninja.Circle.COL_NONE}}else{if((g*r)<0){k.reportCollisionVsWorld(0,e*r,0,r,l);return Phaser.Physics.Ninja.Circle.COL_AXIS}else{var n=l.pos.x-(i*l.xw);var m=l.pos.y+(r*l.yw);var j=k.pos.x-n;var h=k.pos.y-m;var q=Math.sqrt(j*j+h*h);var s=k.radius-q;if(0<s){if(q===0){j=0;h=r}else{j/=q;h/=q}k.reportCollisionVsWorld(j*s,h*s,j,h,l);return Phaser.Physics.Ninja.Circle.COL_OTHER}}}}else{if(r===0){if((i*d)<0){k.reportCollisionVsWorld(f*d,0,d,0,l);return Phaser.Physics.Ninja.Circle.COL_AXIS}else{var n=l.pos.x+(d*l.xw);var m=l.pos.y-(g*l.yw);var j=k.pos.x-n;var h=k.pos.y-m;var q=Math.sqrt(j*j+h*h);var s=k.radius-q;if(0<s){if(q===0){j=d;h=0}else{j/=q;h/=q}k.reportCollisionVsWorld(j*s,h*s,j,h,l);return Phaser.Physics.Ninja.Circle.COL_OTHER}}}else{if(0<((i*d)+(g*r))){return Phaser.Physics.Ninja.Circle.COL_NONE}else{var n=l.pos.x+(d*l.xw);var m=l.pos.y+(r*l.yw);var j=k.pos.x-n;var h=k.pos.y-m;var q=Math.sqrt(j*j+h*h);var s=k.radius-q;if(0<s){if(q===0){j=d/Math.SQRT2;h=r/Math.SQRT2}else{j/=q;h/=q}k.reportCollisionVsWorld(j*s,h*s,j,h,l);return Phaser.Physics.Ninja.Circle.COL_OTHER}}}}return Phaser.Physics.Ninja.Circle.COL_NONE},projCircle_Convex:function(f,e,d,r,k,l){var i=l.signx;var g=l.signy;var o;if(d===0){if(r===0){var c=k.pos.x-(l.pos.x-(i*l.xw));var a=k.pos.y-(l.pos.y-(g*l.yw));var p=l.xw*2;var b=Math.sqrt(p*p+0);var q=Math.sqrt(c*c+a*a);var s=(b+k.radius)-q;if(0<s){if(f<e){o=f;e=0;if((k.pos.x-l.pos.x)<0){f*=-1}}else{o=e;f=0;if((k.pos.y-l.pos.y)<0){e*=-1}}if(o<s){k.reportCollisionVsWorld(f,e,f/o,e/o,l);return Phaser.Physics.Ninja.Circle.COL_AXIS}else{c/=q;a/=q;k.reportCollisionVsWorld(c*s,a*s,c,a,l);return Phaser.Physics.Ninja.Circle.COL_OTHER}}}else{if((g*r)<0){k.reportCollisionVsWorld(0,e*r,0,r,l);return Phaser.Physics.Ninja.Circle.COL_AXIS}else{var c=k.pos.x-(l.pos.x-(i*l.xw));var a=k.pos.y-(l.pos.y-(g*l.yw));var p=l.xw*2;var b=Math.sqrt(p*p+0);var q=Math.sqrt(c*c+a*a);var s=(b+k.radius)-q;if(0<s){c/=q;a/=q;k.reportCollisionVsWorld(c*s,a*s,c,a,l);return Phaser.Physics.Ninja.Circle.COL_OTHER}}}}else{if(r===0){if((i*d)<0){k.reportCollisionVsWorld(f*d,0,d,0,l);return Phaser.Physics.Ninja.Circle.COL_AXIS}else{var c=k.pos.x-(l.pos.x-(i*l.xw));var a=k.pos.y-(l.pos.y-(g*l.yw));var p=l.xw*2;var b=Math.sqrt(p*p+0);var q=Math.sqrt(c*c+a*a);var s=(b+k.radius)-q;if(0<s){c/=q;a/=q;k.reportCollisionVsWorld(c*s,a*s,c,a,l);return Phaser.Physics.Ninja.Circle.COL_OTHER}}}else{if(0<((i*d)+(g*r))){var c=k.pos.x-(l.pos.x-(i*l.xw));var a=k.pos.y-(l.pos.y-(g*l.yw));var p=l.xw*2;var b=Math.sqrt(p*p+0);var q=Math.sqrt(c*c+a*a);var s=(b+k.radius)-q;if(0<s){c/=q;a/=q;k.reportCollisionVsWorld(c*s,a*s,c,a,l);return Phaser.Physics.Ninja.Circle.COL_OTHER}}else{var n=l.pos.x+(d*l.xw);var m=l.pos.y+(r*l.yw);var j=k.pos.x-n;var h=k.pos.y-m;var q=Math.sqrt(j*j+h*h);var s=k.radius-q;if(0<s){if(q===0){j=d/Math.SQRT2;h=r/Math.SQRT2}else{j/=q;h/=q}k.reportCollisionVsWorld(j*s,h*s,j,h,l);return Phaser.Physics.Ninja.Circle.COL_OTHER}}}}return Phaser.Physics.Ninja.Circle.COL_NONE},projCircle_Half:function(e,d,c,z,j,k){var h=k.signx;var f=k.signy;var w=(c*h+z*f);if(0<w){return Phaser.Physics.Ninja.Circle.COL_NONE}else{if(c===0){if(z===0){var m=j.radius;var b=(j.pos.x-(h*m))-k.pos.x;var a=(j.pos.y-(f*m))-k.pos.y;var o=h;var l=f;var q=(b*o)+(a*l);if(q<0){o*=-q;l*=-q;var u=Math.sqrt(o*o+l*l);var s=Math.sqrt(e*e+d*d);if(s<u){j.reportCollisionVsWorld(e,d,e/s,d/s,k);return Phaser.Physics.Ninja.Circle.COL_AXIS}else{j.reportCollisionVsWorld(o,l,k.signx,k.signy);return Phaser.Physics.Ninja.Circle.COL_OTHER}return true}}else{if(w===0){var i=j.pos.x-k.pos.x;if((i*h)<0){j.reportCollisionVsWorld(0,d*z,0,z,k);return Phaser.Physics.Ninja.Circle.COL_AXIS}else{var g=j.pos.y-(k.pos.y+z*k.yw);var v=Math.sqrt(i*i+g*g);var A=j.radius-v;if(0<A){if(v===0){i=h/Math.SQRT2;g=z/Math.SQRT2}else{i/=v;g/=v}j.reportCollisionVsWorld(i*A,g*A,i,g,k);return Phaser.Physics.Ninja.Circle.COL_OTHER}}}else{j.reportCollisionVsWorld(0,d*z,0,z,k);return Phaser.Physics.Ninja.Circle.COL_AXIS}}}else{if(z===0){if(w===0){var g=j.pos.y-k.pos.y;if((g*f)<0){j.reportCollisionVsWorld(e*c,0,c,0,k);return Phaser.Physics.Ninja.Circle.COL_AXIS}else{var i=j.pos.x-(k.pos.x+c*k.xw);var v=Math.sqrt(i*i+g*g);var A=j.radius-v;if(0<A){if(v===0){i=h/Math.SQRT2;g=z/Math.SQRT2}else{i/=v;g/=v}j.reportCollisionVsWorld(i*A,g*A,i,g,k);return Phaser.Physics.Ninja.Circle.COL_OTHER}}}else{j.reportCollisionVsWorld(e*c,0,c,0,k);return Phaser.Physics.Ninja.Circle.COL_AXIS}}else{var p=k.pos.x+(c*k.xw);var n=k.pos.y+(z*k.yw);var i=j.pos.x-p;var g=j.pos.y-n;var v=Math.sqrt(i*i+g*g);var A=j.radius-v;if(0<A){if(v===0){i=c/Math.SQRT2;g=z/Math.SQRT2}else{i/=v;g/=v}j.reportCollisionVsWorld(i*A,g*A,i,g,k);return Phaser.Physics.Ninja.Circle.COL_OTHER}}}}return Phaser.Physics.Ninja.Circle.COL_NONE},projCircle_22DegS:function(e,d,c,w,j,k){var s;var h=k.signx;var f=k.signy;if(0<(f*w)){return Phaser.Physics.Ninja.Circle.COL_NONE}else{if(c===0){if(w===0){var o=k.sx;var l=k.sy;var m=j.radius;var b=j.pos.x-(k.pos.x-(h*k.xw));var a=j.pos.y-k.pos.y;var z=(b*-l)+(a*o);if(0<(z*h*f)){var v=Math.sqrt(b*b+a*a);var A=m-v;if(0<A){b/=v;a/=v;j.reportCollisionVsWorld(b*A,a*A,b,a,k);return Phaser.Physics.Ninja.Circle.COL_OTHER}}else{b-=m*o;a-=m*l;var q=(b*o)+(a*l);if(q<0){o*=-q;l*=-q;var u=Math.sqrt(o*o+l*l);if(e<d){s=e;d=0;if((j.pos.x-k.pos.x)<0){e*=-1}}else{s=d;e=0;if((j.pos.y-k.pos.y)<0){d*=-1}}if(s<u){j.reportCollisionVsWorld(e,d,e/s,d/s,k);return Phaser.Physics.Ninja.Circle.COL_AXIS}else{j.reportCollisionVsWorld(o,l,k.sx,k.sy,k);return Phaser.Physics.Ninja.Circle.COL_OTHER}}}}else{j.reportCollisionVsWorld(0,d*w,0,w,k);return Phaser.Physics.Ninja.Circle.COL_AXIS}}else{if(w===0){if((h*c)<0){var p=k.pos.x-(h*k.xw);var n=k.pos.y;var i=j.pos.x-p;var g=j.pos.y-n;if((g*f)<0){j.reportCollisionVsWorld(e*c,0,c,0,k);return Phaser.Physics.Ninja.Circle.COL_AXIS}else{var v=Math.sqrt(i*i+g*g);var A=j.radius-v;if(0<A){if(v===0){i=c/Math.SQRT2;g=w/Math.SQRT2}else{i/=v;g/=v}j.reportCollisionVsWorld(i*A,g*A,i,g,k);return Phaser.Physics.Ninja.Circle.COL_OTHER}}}else{var o=k.sx;var l=k.sy;var b=j.pos.x-(k.pos.x+(c*k.xw));var a=j.pos.y-(k.pos.y-(f*k.yw));var z=(b*-l)+(a*o);if((z*h*f)<0){var v=Math.sqrt(b*b+a*a);var A=j.radius-v;if(0<A){b/=v;a/=v;j.reportCollisionVsWorld(b*A,a*A,b,a,k);return Phaser.Physics.Ninja.Circle.COL_OTHER}}else{var q=(b*o)+(a*l);var A=j.radius-Math.abs(q);if(0<A){j.reportCollisionVsWorld(o*A,l*A,o,l,k);return Phaser.Physics.Ninja.Circle.COL_OTHER}}}}else{var p=k.pos.x+(c*k.xw);var n=k.pos.y+(w*k.yw);var i=j.pos.x-p;var g=j.pos.y-n;var v=Math.sqrt(i*i+g*g);var A=j.radius-v;if(0<A){if(v===0){i=c/Math.SQRT2;g=w/Math.SQRT2}else{i/=v;g/=v}j.reportCollisionVsWorld(i*A,g*A,i,g,k);return Phaser.Physics.Ninja.Circle.COL_OTHER}}}}return Phaser.Physics.Ninja.Circle.COL_NONE},projCircle_22DegB:function(e,d,c,z,j,k){var s;var h=k.signx;var f=k.signy;if(c===0){if(z===0){var o=k.sx;var l=k.sy;var m=j.radius;var b=(j.pos.x-(o*m))-(k.pos.x-(h*k.xw));var a=(j.pos.y-(l*m))-(k.pos.y+(f*k.yw));var q=(b*o)+(a*l);if(q<0){o*=-q;l*=-q;var u=Math.sqrt(o*o+l*l);if(e<d){s=e;d=0;if((j.pos.x-k.pos.x)<0){e*=-1}}else{s=d;e=0;if((j.pos.y-k.pos.y)<0){d*=-1}}if(s<u){j.reportCollisionVsWorld(e,d,e/s,d/s,k);return Phaser.Physics.Ninja.Circle.COL_AXIS}else{j.reportCollisionVsWorld(o,l,k.sx,k.sy,k);return Phaser.Physics.Ninja.Circle.COL_OTHER}}}else{if((f*z)<0){j.reportCollisionVsWorld(0,d*z,0,z,k);return Phaser.Physics.Ninja.Circle.COL_AXIS}else{var o=k.sx;var l=k.sy;var b=j.pos.x-(k.pos.x-(h*k.xw));var a=j.pos.y-(k.pos.y+(f*k.yw));var A=(b*-l)+(a*o);if(0<(A*h*f)){var v=Math.sqrt(b*b+a*a);var B=j.radius-v;if(0<B){b/=v;a/=v;j.reportCollisionVsWorld(b*B,a*B,b,a,k);return Phaser.Physics.Ninja.Circle.COL_OTHER}}else{var q=(b*o)+(a*l);var B=j.radius-Math.abs(q);if(0<B){j.reportCollisionVsWorld(o*B,l*B,o,l,k);return Phaser.Physics.Ninja.Circle.COL_OTHER}}}}}else{if(z===0){if((h*c)<0){j.reportCollisionVsWorld(e*c,0,c,0,k);return Phaser.Physics.Ninja.Circle.COL_AXIS}else{var b=j.pos.x-(k.pos.x+(h*k.xw));var a=j.pos.y-k.pos.y;if((a*f)<0){j.reportCollisionVsWorld(e*c,0,c,0,k);return Phaser.Physics.Ninja.Circle.COL_AXIS}else{var o=k.sx;var l=k.sy;var A=(b*-l)+(a*o);if((A*h*f)<0){var v=Math.sqrt(b*b+a*a);var B=j.radius-v;if(0<B){b/=v;a/=v;j.reportCollisionVsWorld(b*B,a*B,b,a,k);return Phaser.Physics.Ninja.Circle.COL_OTHER}}else{var q=(b*o)+(a*l);var B=j.radius-Math.abs(q);if(0<B){j.reportCollisionVsWorld(o*B,l*B,k.sx,k.sy,k);return Phaser.Physics.Ninja.Circle.COL_OTHER}}}}}else{if(0<((h*c)+(f*z))){var w=Math.sqrt(2*2+1*1);var o=(h*1)/w;var l=(f*2)/w;var m=j.radius;var b=(j.pos.x-(o*m))-(k.pos.x-(h*k.xw));var a=(j.pos.y-(l*m))-(k.pos.y+(f*k.yw));var q=(b*o)+(a*l);if(q<0){j.reportCollisionVsWorld(-o*q,-l*q,k.sx,k.sy,k);return Phaser.Physics.Ninja.Circle.COL_OTHER}return Phaser.Physics.Ninja.Circle.COL_NONE}else{var p=k.pos.x+(c*k.xw);var n=k.pos.y+(z*k.yw);var i=j.pos.x-p;var g=j.pos.y-n;var v=Math.sqrt(i*i+g*g);var B=j.radius-v;if(0<B){if(v===0){i=c/Math.SQRT2;g=z/Math.SQRT2}else{i/=v;g/=v}j.reportCollisionVsWorld(i*B,g*B,i,g,k);return Phaser.Physics.Ninja.Circle.COL_OTHER}}}}return Phaser.Physics.Ninja.Circle.COL_NONE},projCircle_67DegS:function(e,d,c,w,j,k){var h=k.signx;var f=k.signy;if(0<(h*c)){return Phaser.Physics.Ninja.Circle.COL_NONE}else{if(c===0){if(w===0){var s;var o=k.sx;var l=k.sy;var m=j.radius;var b=j.pos.x-k.pos.x;var a=j.pos.y-(k.pos.y-(f*k.yw));var z=(b*-l)+(a*o);if((z*h*f)<0){var v=Math.sqrt(b*b+a*a);var A=m-v;if(0<A){b/=v;a/=v;j.reportCollisionVsWorld(b*A,a*A,b,a,k);return Phaser.Physics.Ninja.Circle.COL_OTHER}}else{b-=m*o;a-=m*l;var q=(b*o)+(a*l);if(q<0){o*=-q;l*=-q;var u=Math.sqrt(o*o+l*l);if(e<d){s=e;d=0;if((j.pos.x-k.pos.x)<0){e*=-1}}else{s=d;e=0;if((j.pos.y-k.pos.y)<0){d*=-1}}if(s<u){j.reportCollisionVsWorld(e,d,e/s,d/s,k);return Phaser.Physics.Ninja.Circle.COL_AXIS}else{j.reportCollisionVsWorld(o,l,k.sx,k.sy,k);return Phaser.Physics.Ninja.Circle.COL_OTHER}}}}else{if((f*w)<0){var p=k.pos.x;var n=k.pos.y-(f*k.yw);var i=j.pos.x-p;var g=j.pos.y-n;if((i*h)<0){j.reportCollisionVsWorld(0,d*w,0,w,k);return Phaser.Physics.Ninja.Circle.COL_AXIS}else{var v=Math.sqrt(i*i+g*g);var A=j.radius-v;if(0<A){if(v===0){i=c/Math.SQRT2;g=w/Math.SQRT2}else{i/=v;g/=v}j.reportCollisionVsWorld(i*A,g*A,i,g,k);return Phaser.Physics.Ninja.Circle.COL_OTHER}}}else{var o=k.sx;var l=k.sy;var b=j.pos.x-(k.pos.x-(h*k.xw));var a=j.pos.y-(k.pos.y+(w*k.yw));var z=(b*-l)+(a*o);if(0<(z*h*f)){var v=Math.sqrt(b*b+a*a);var A=j.radius-v;if(0<A){b/=v;a/=v;j.reportCollisionVsWorld(b*A,a*A,b,a,k);return Phaser.Physics.Ninja.Circle.COL_OTHER}}else{var q=(b*o)+(a*l);var A=j.radius-Math.abs(q);if(0<A){j.reportCollisionVsWorld(o*A,l*A,k.sx,k.sy,k);return Phaser.Physics.Ninja.Circle.COL_OTHER}}}}}else{if(w===0){j.reportCollisionVsWorld(e*c,0,c,0,k);return Phaser.Physics.Ninja.Circle.COL_AXIS}else{var p=k.pos.x+(c*k.xw);var n=k.pos.y+(w*k.yw);var i=j.pos.x-p;var g=j.pos.y-n;var v=Math.sqrt(i*i+g*g);var A=j.radius-v;if(0<A){if(v===0){i=c/Math.SQRT2;g=w/Math.SQRT2}else{i/=v;g/=v}j.reportCollisionVsWorld(i*A,g*A,i,g,k);return Phaser.Physics.Ninja.Circle.COL_OTHER}}}}return Phaser.Physics.Ninja.Circle.COL_NONE},projCircle_67DegB:function(e,d,c,z,j,k){var h=k.signx;var f=k.signy;if(c===0){if(z===0){var s;var o=k.sx;var l=k.sy;var m=j.radius;var b=(j.pos.x-(o*m))-(k.pos.x+(h*k.xw));var a=(j.pos.y-(l*m))-(k.pos.y-(f*k.yw));var q=(b*o)+(a*l);if(q<0){o*=-q;l*=-q;var u=Math.sqrt(o*o+l*l);if(e<d){s=e;d=0;if((j.pos.x-k.pos.x)<0){e*=-1}}else{s=d;e=0;if((j.pos.y-k.pos.y)<0){d*=-1}}if(s<u){j.reportCollisionVsWorld(e,d,e/s,d/s,k);return Phaser.Physics.Ninja.Circle.COL_AXIS}else{j.reportCollisionVsWorld(o,l,k.sx,k.sy,k);return Phaser.Physics.Ninja.Circle.COL_OTHER}}}else{if((f*z)<0){j.reportCollisionVsWorld(0,d*z,0,z,k);return Phaser.Physics.Ninja.Circle.COL_AXIS}else{var b=j.pos.x-k.pos.x;var a=j.pos.y-(k.pos.y+(f*k.yw));if((b*h)<0){j.reportCollisionVsWorld(0,d*z,0,z,k);return Phaser.Physics.Ninja.Circle.COL_AXIS}else{var o=k.sx;var l=k.sy;var A=(b*-l)+(a*o);if(0<(A*h*f)){var v=Math.sqrt(b*b+a*a);var B=j.radius-v;if(0<B){b/=v;a/=v;j.reportCollisionVsWorld(b*B,a*B,b,a,k);return Phaser.Physics.Ninja.Circle.COL_OTHER}}else{var q=(b*o)+(a*l);var B=j.radius-Math.abs(q);if(0<B){j.reportCollisionVsWorld(o*B,l*B,o,l,k);return Phaser.Physics.Ninja.Circle.COL_OTHER}}}}}}else{if(z===0){if((h*c)<0){j.reportCollisionVsWorld(e*c,0,c,0,k);return Phaser.Physics.Ninja.Circle.COL_AXIS}else{var w=Math.sqrt(2*2+1*1);var o=(h*2)/w;var l=(f*1)/w;var b=j.pos.x-(k.pos.x+(h*k.xw));var a=j.pos.y-(k.pos.y-(f*k.yw));var A=(b*-l)+(a*o);if((A*h*f)<0){var v=Math.sqrt(b*b+a*a);var B=j.radius-v;if(0<B){b/=v;a/=v;j.reportCollisionVsWorld(b*B,a*B,b,a,k);return Phaser.Physics.Ninja.Circle.COL_OTHER}}else{var q=(b*o)+(a*l);var B=j.radius-Math.abs(q);if(0<B){j.reportCollisionVsWorld(o*B,l*B,k.sx,k.sy,k);return Phaser.Physics.Ninja.Circle.COL_OTHER}}}}else{if(0<((h*c)+(f*z))){var o=k.sx;var l=k.sy;var m=j.radius;var b=(j.pos.x-(o*m))-(k.pos.x+(h*k.xw));var a=(j.pos.y-(l*m))-(k.pos.y-(f*k.yw));var q=(b*o)+(a*l);if(q<0){j.reportCollisionVsWorld(-o*q,-l*q,k.sx,k.sy,k);return Phaser.Physics.Ninja.Circle.COL_OTHER}return Phaser.Physics.Ninja.Circle.COL_NONE}else{var p=k.pos.x+(c*k.xw);var n=k.pos.y+(z*k.yw);var i=j.pos.x-p;var g=j.pos.y-n;var v=Math.sqrt(i*i+g*g);var B=j.radius-v;if(0<B){if(v===0){i=c/Math.SQRT2;g=z/Math.SQRT2}else{i/=v;g/=v}j.reportCollisionVsWorld(i*B,g*B,i,g,k);return Phaser.Physics.Ninja.Circle.COL_OTHER}}}}return Phaser.Physics.Ninja.Circle.COL_NONE},destroy:function(){this.body=null;this.system=null},render:function(c,d,f,b,e){var a=this.pos.x-d;var g=this.pos.y-f;c.beginPath();c.arc(a,g,this.radius,0,2*Math.PI,false);if(e){c.fillStyle=b;c.fill()}else{c.strokeStyle=b;c.stroke()}}};!function(a){"object"==typeof exports?module.exports=a():"function"==typeof define&&define.amd?define("p2",(function(){return this.p2=a()})()):"undefined"!=typeof window?window.p2=a():"undefined"!=typeof global?self.p2=a():"undefined"!=typeof self&&(self.p2=a())}(function(){var d,b,a;return(function c(f,k,h){function g(n,l){if(!k[n]){if(!f[n]){var i=typeof require=="function"&&require;if(!l&&i){return i(n,!0)}if(e){return e(n,!0)}throw new Error("Cannot find module '"+n+"'")}var m=k[n]={exports:{}};f[n][0].call(m.exports,function(o){var p=f[n][1][o];return g(p?p:o)},m,m.exports,c,f,k,h)}return k[n].exports}var e=typeof require=="function"&&require;for(var j=0;j<h.length;j++){g(h[j])}return g})({1:[function(h,i,f){if(!e){var e=0.000001}if(!k){var k=(typeof Float32Array!=="undefined")?Float32Array:Array}var g={};g.setMatrixArrayType=function(l){k=l};if(typeof(f)!=="undefined"){f.glMatrix=g}var j={};j.create=function(){var l=new k(2);l[0]=0;l[1]=0;return l};j.clone=function(l){var m=new k(2);m[0]=l[0];m[1]=l[1];return m};j.fromValues=function(l,n){var m=new k(2);m[0]=l;m[1]=n;return m};j.copy=function(m,l){m[0]=l[0];m[1]=l[1];return m};j.set=function(m,l,n){m[0]=l;m[1]=n;return m};j.add=function(n,m,l){n[0]=m[0]+l[0];n[1]=m[1]+l[1];return n};j.subtract=function(n,m,l){n[0]=m[0]-l[0];n[1]=m[1]-l[1];return n};j.sub=j.subtract;j.multiply=function(n,m,l){n[0]=m[0]*l[0];n[1]=m[1]*l[1];return n};j.mul=j.multiply;j.divide=function(n,m,l){n[0]=m[0]/l[0];n[1]=m[1]/l[1];return n};j.div=j.divide;j.min=function(n,m,l){n[0]=Math.min(m[0],l[0]);n[1]=Math.min(m[1],l[1]);return n};j.max=function(n,m,l){n[0]=Math.max(m[0],l[0]);n[1]=Math.max(m[1],l[1]);return n};j.scale=function(n,m,l){n[0]=m[0]*l;n[1]=m[1]*l;return n};j.distance=function(n,m){var l=m[0]-n[0],o=m[1]-n[1];return Math.sqrt(l*l+o*o)};j.dist=j.distance;j.squaredDistance=function(n,m){var l=m[0]-n[0],o=m[1]-n[1];return l*l+o*o};j.sqrDist=j.squaredDistance;j.length=function(m){var l=m[0],n=m[1];return Math.sqrt(l*l+n*n)};j.len=j.length;j.squaredLength=function(m){var l=m[0],n=m[1];return l*l+n*n};j.sqrLen=j.squaredLength;j.negate=function(m,l){m[0]=-l[0];m[1]=-l[1];return m};j.normalize=function(o,n){var m=n[0],p=n[1];var l=m*m+p*p;if(l>0){l=1/Math.sqrt(l);o[0]=n[0]*l;o[1]=n[1]*l}return o};j.dot=function(m,l){return m[0]*l[0]+m[1]*l[1]};j.cross=function(n,m,l){var o=m[0]*l[1]-m[1]*l[0];n[0]=n[1]=0;n[2]=o;return n};j.lerp=function(n,m,l,o){var q=m[0],p=m[1];n[0]=q+o*(l[0]-q);n[1]=p+o*(l[1]-p);return n};j.transformMat2=function(p,o,n){var l=o[0],q=o[1];p[0]=n[0]*l+n[2]*q;p[1]=n[1]*l+n[3]*q;return p};j.transformMat2d=function(p,o,n){var l=o[0],q=o[1];p[0]=n[0]*l+n[2]*q+n[4];p[1]=n[1]*l+n[3]*q+n[5];return p};j.transformMat3=function(p,o,n){var l=o[0],q=o[1];p[0]=n[0]*l+n[3]*q+n[6];p[1]=n[1]*l+n[4]*q+n[7];return p};j.transformMat4=function(p,o,n){var l=o[0],q=o[1];p[0]=n[0]*l+n[4]*q+n[12];p[1]=n[1]*l+n[5]*q+n[13];return p};j.forEach=(function(){var l=j.create();return function(o,s,t,r,q,m){var p,n;if(!s){s=2}if(!t){t=0}if(r){n=Math.min((r*s)+t,o.length)}else{n=o.length}for(p=t;p<n;p+=s){l[0]=o[p];l[1]=o[p+1];q(l,l,m);o[p]=l[0];o[p+1]=l[1]}return o}})();j.str=function(l){return"vec2("+l[0]+", "+l[1]+")"};if(typeof(f)!=="undefined"){f.vec2=j}},{}],2:[function(g,h,f){var e=g("./Scalar");h.exports=i;function i(){}i.lineInt=function(m,l,q){q=q||0;var p=[0,0];var k,t,o,j,s,n,r;k=m[1][1]-m[0][1];t=m[0][0]-m[1][0];o=k*m[0][0]+t*m[0][1];j=l[1][1]-l[0][1];s=l[0][0]-l[1][0];n=j*l[0][0]+s*l[0][1];r=k*s-j*t;if(!e.eq(r,0,q)){p[0]=(s*o-t*n)/r;p[1]=(k*n-j*o)/r}return p};i.segmentsIntersect=function(m,l,k,j){var u=l[0]-m[0];var p=l[1]-m[1];var r=j[0]-k[0];var o=j[1]-k[1];if(r*p-o*u==0){return false}var q=(u*(k[1]-m[1])+p*(m[0]-k[0]))/(r*p-o*u);var n=(r*(m[1]-k[1])+o*(k[0]-m[0]))/(o*u-r*p);return(q>=0&&q<=1&&n>=0&&n<=1)}},{"./Scalar":5}],3:[function(h,i,g){i.exports=j;function j(){}j.area=function(l,k,m){return(((k[0]-l[0])*(m[1]-l[1]))-((m[0]-l[0])*(k[1]-l[1])))};j.left=function(l,k,m){return j.area(l,k,m)>0};j.leftOn=function(l,k,m){return j.area(l,k,m)>=0};j.right=function(l,k,m){return j.area(l,k,m)<0};j.rightOn=function(l,k,m){return j.area(l,k,m)<=0};var f=[],e=[];j.collinear=function(q,p,n,o){if(!o){return j.area(q,p,n)==0}else{var t=f,m=e;t[0]=p[0]-q[0];t[1]=p[1]-q[1];m[0]=n[0]-p[0];m[1]=n[1]-p[1];var k=t[0]*m[0]+t[1]*m[1],s=Math.sqrt(t[0]*t[0]+t[1]*t[1]),r=Math.sqrt(m[0]*m[0]+m[1]*m[1]),l=Math.acos(k/(s*r));return l<o}};j.sqdist=function(m,k){var n=k[0]-m[0];var l=k[1]-m[1];return n*n+l*l}},{}],4:[function(h,e,j){var i=h("./Line"),n=h("./Point"),k=h("./Scalar");e.exports=l;function l(){this.vertices=[]}l.prototype.at=function(p){var o=this.vertices,q=o.length;return o[p<0?p%q+q:p%q]};l.prototype.first=function(){return this.vertices[0]};l.prototype.last=function(){return this.vertices[this.vertices.length-1]};l.prototype.clear=function(){this.vertices.length=0};l.prototype.append=function(p,r,q){if(typeof(r)=="undefined"){throw new Error("From is not given!")}if(typeof(q)=="undefined"){throw new Error("To is not given!")}if(q-1<r){throw new Error("lol1")}if(q>p.vertices.length){throw new Error("lol2")}if(r<0){throw new Error("lol3")}for(var o=r;o<q;o++){this.vertices.push(p.vertices[o])}};l.prototype.makeCCW=function(){var q=0,o=this.vertices;for(var p=1;p<this.vertices.length;++p){if(o[p][1]<o[q][1]||(o[p][1]==o[q][1]&&o[p][0]>o[q][0])){q=p}}if(!n.left(this.at(q-1),this.at(q),this.at(q+1))){this.reverse()}};l.prototype.reverse=function(){var p=[];for(var o=0,q=this.vertices.length;o!==q;o++){p.push(this.vertices.pop())}this.vertices=p};l.prototype.isReflex=function(o){return n.right(this.at(o-1),this.at(o),this.at(o+1))};var g=[],f=[];l.prototype.canSee=function(s,q){var u,v,r=g,o=f;if(n.leftOn(this.at(s+1),this.at(s),this.at(q))&&n.rightOn(this.at(s-1),this.at(s),this.at(q))){return false}v=n.sqdist(this.at(s),this.at(q));for(var t=0;t!==this.vertices.length;++t){if((t+1)%this.vertices.length===s||t===s){continue}if(n.leftOn(this.at(s),this.at(q),this.at(t+1))&&n.rightOn(this.at(s),this.at(q),this.at(t))){r[0]=this.at(s);r[1]=this.at(q);o[0]=this.at(t);o[1]=this.at(t+1);u=i.lineInt(r,o);if(n.sqdist(this.at(s),u)<v){return false}}}return true};l.prototype.copy=function(r,q,t){var s=t||new l();s.clear();if(r<q){for(var o=r;o<=q;o++){s.vertices.push(this.vertices[o])}}else{for(var o=0;o<=q;o++){s.vertices.push(this.vertices[o])}for(var o=r;o<this.vertices.length;o++){s.vertices.push(this.vertices[o])}}return s};l.prototype.getCutEdges=function(){var r=[],v=[],s=[],u=new l();var t=Number.MAX_VALUE;for(var q=0;q<this.vertices.length;++q){if(this.isReflex(q)){for(var p=0;p<this.vertices.length;++p){if(this.canSee(q,p)){v=this.copy(q,p,u).getCutEdges();s=this.copy(p,q,u).getCutEdges();for(var o=0;o<s.length;o++){v.push(s[o])}if(v.length<t){r=v;t=v.length;r.push([this.at(q),this.at(p)])}}}}}return r};l.prototype.decomp=function(){var o=this.getCutEdges();if(o.length>0){return this.slice(o)}else{return[this]}};l.prototype.slice=function(q){if(q.length==0){return[this]}if(q instanceof Array&&q.length&&q[0] instanceof Array&&q[0].length==2&&q[0][0] instanceof Array){var p=[this];for(var s=0;s<q.length;s++){var t=q[s];for(var r=0;r<p.length;r++){var u=p[r];var o=u.slice(t);if(o){p.splice(r,1);p.push(o[0],o[1]);break}}}return p}else{var t=q;var s=this.vertices.indexOf(t[0]);var r=this.vertices.indexOf(t[1]);if(s!=-1&&r!=-1){return[this.copy(s,r),this.copy(r,s)]}else{return false}}};l.prototype.isSimple=function(){var q=this.vertices;for(var p=0;p<q.length-1;p++){for(var o=0;o<p-1;o++){if(i.segmentsIntersect(q[p],q[p+1],q[o],q[o+1])){return false}}}for(var p=1;p<q.length-2;p++){if(i.segmentsIntersect(q[0],q[q.length-1],q[p],q[p+1])){return false}}return true};function m(z,y,u,s,x){x=x||0;var p=y[1]-z[1];var w=z[0]-y[0];var r=(p*z[0])+(w*z[1]);var o=s[1]-u[1];var v=u[0]-s[0];var q=(o*u[0])+(v*u[1]);var t=(p*v)-(o*w);if(!k.eq(t,0,x)){return[((v*r)-(w*q))/t,((p*q)-(o*r))/t]}else{return[0,0]}}l.prototype.quickDecomp=function(y,u,x,K,L,q){L=L||100;q=q||0;K=K||25;y=typeof(y)!="undefined"?y:[];u=u||[];x=x||[];var D=[0,0],o=[0,0],C=[0,0];var A=0,H=0,J=0,s=0;var E=0,B=0,I=0;var w=new l(),r=new l();var t=this,z=this.vertices;if(z.length<3){return y}q++;if(q>L){console.warn("quickDecomp: max level ("+L+") reached.");return y}for(var G=0;G<this.vertices.length;++G){if(t.isReflex(G)){u.push(t.vertices[G]);A=H=Number.MAX_VALUE;for(var F=0;F<this.vertices.length;++F){if(n.left(t.at(G-1),t.at(G),t.at(F))&&n.rightOn(t.at(G-1),t.at(G),t.at(F-1))){C=m(t.at(G-1),t.at(G),t.at(F),t.at(F-1));if(n.right(t.at(G+1),t.at(G),C)){J=n.sqdist(t.vertices[G],C);if(J<H){H=J;o=C;B=F}}}if(n.left(t.at(G+1),t.at(G),t.at(F+1))&&n.rightOn(t.at(G+1),t.at(G),t.at(F))){C=m(t.at(G+1),t.at(G),t.at(F),t.at(F+1));if(n.left(t.at(G-1),t.at(G),C)){J=n.sqdist(t.vertices[G],C);if(J<A){A=J;D=C;E=F}}}}if(B==(E+1)%this.vertices.length){C[0]=(o[0]+D[0])/2;C[1]=(o[1]+D[1])/2;x.push(C);if(G<E){w.append(t,G,E+1);w.vertices.push(C);r.vertices.push(C);if(B!=0){r.append(t,B,t.vertices.length)}r.append(t,0,G+1)}else{if(G!=0){w.append(t,G,t.vertices.length)}w.append(t,0,E+1);w.vertices.push(C);r.vertices.push(C);r.append(t,B,G+1)}}else{if(B>E){E+=this.vertices.length}s=Number.MAX_VALUE;if(E<B){return y}for(var F=B;F<=E;++F){if(n.leftOn(t.at(G-1),t.at(G),t.at(F))&&n.rightOn(t.at(G+1),t.at(G),t.at(F))){J=n.sqdist(t.at(G),t.at(F));if(J<s){s=J;I=F%this.vertices.length}}}if(G<I){w.append(t,G,I+1);if(I!=0){r.append(t,I,z.length)}r.append(t,0,G+1)}else{if(G!=0){w.append(t,G,z.length)}w.append(t,0,I+1);r.append(t,I,G+1)}}if(w.vertices.length<r.vertices.length){w.quickDecomp(y,u,x,K,L,q);r.quickDecomp(y,u,x,K,L,q)}else{r.quickDecomp(y,u,x,K,L,q);w.quickDecomp(y,u,x,K,L,q)}return y}}y.push(this);return y};l.prototype.removeCollinearPoints=function(o){var p=0;for(var q=this.vertices.length-1;this.vertices.length>3&&q>=0;--q){if(n.collinear(this.at(q-1),this.at(q),this.at(q+1),o)){this.vertices.splice(q%this.vertices.length,1);q--;p++}}return p}},{"./Line":2,"./Point":3,"./Scalar":5}],5:[function(g,h,f){h.exports=e;function e(){}e.eq=function(k,i,j){j=j||0;return Math.abs(k-i)<j}},{}],6:[function(f,g,e){g.exports={Polygon:f("./Polygon"),Point:f("./Point")}},{"./Point":3,"./Polygon":4}],7:[function(f,g,e){g.exports={name:"p2",version:"0.5.0",description:"A JavaScript 2D physics engine.",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["p2.js","p2","physics","engine","2d"],main:"./src/p2.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/p2.js.git"},bugs:{url:"https://github.com/schteppe/p2.js/issues"},licenses:[{type:"MIT"}],devDependencies:{grunt:"~0.4.0","grunt-contrib-jshint":"~0.9.2","grunt-contrib-nodeunit":"~0.1.2","grunt-contrib-uglify":"~0.4.0","grunt-contrib-watch":"~0.5.0","grunt-browserify":"~2.0.1","z-schema":"~2.4.6"},dependencies:{"poly-decomp":"0.1.0","gl-matrix":"2.1.0"}}},{}],8:[function(f,h,e){var i=f("../math/vec2"),k=f("../utils/Utils");h.exports=j;function j(l){this.lowerBound=i.create();if(l&&l.lowerBound){i.copy(this.lowerBound,l.lowerBound)}this.upperBound=i.create();if(l&&l.upperBound){i.copy(this.upperBound,l.upperBound)}}var g=i.create();j.prototype.setFromPoints=function(s,m,v){var n=this.lowerBound,q=this.upperBound;i.set(n,Number.MAX_VALUE,Number.MAX_VALUE);i.set(q,-Number.MAX_VALUE,-Number.MAX_VALUE);for(var r=0;r<s.length;r++){var t=s[r];if(typeof(v)==="number"){i.rotate(g,t,v);t=g}for(var o=0;o<2;o++){if(t[o]>q[o]){q[o]=t[o]}if(t[o]<n[o]){n[o]=t[o]}}}if(m){i.add(this.lowerBound,this.lowerBound,m);i.add(this.upperBound,this.upperBound,m)}};j.prototype.copy=function(l){i.copy(this.lowerBound,l.lowerBound);i.copy(this.upperBound,l.upperBound)};j.prototype.extend=function(l){for(var m=0;m<2;m++){if(l.lowerBound[m]<this.lowerBound[m]){this.lowerBound[m]=l.lowerBound[m]}if(l.upperBound[m]>this.upperBound[m]){this.upperBound[m]=l.upperBound[m]}}};j.prototype.overlaps=function(n){var m=this.lowerBound,p=this.upperBound,l=n.lowerBound,o=n.upperBound;return((l[0]<=p[0]&&p[0]<=o[0])||(m[0]<=o[0]&&o[0]<=p[0]))&&((l[1]<=p[1]&&p[1]<=o[1])||(m[1]<=o[1]&&o[1]<=p[1]))}},{"../math/vec2":30,"../utils/Utils":47}],9:[function(g,h,f){var i=g("../math/vec2");var j=g("../objects/Body");h.exports=e;function e(l){this.type=l;this.result=[];this.world=null;this.boundingVolumeType=e.AABB}e.AABB=1;e.BOUNDING_CIRCLE=2;e.prototype.setWorld=function(l){this.world=l};e.prototype.getCollisionPairs=function(l){throw new Error("getCollisionPairs must be implemented in a subclass!")};var k=i.create();e.boundingRadiusCheck=function(o,n){i.sub(k,o.position,n.position);var m=i.squaredLength(k),l=o.boundingRadius+n.boundingRadius;return m<=l*l};e.aabbCheck=function(m,l){if(m.aabbNeedsUpdate){m.updateAABB()}if(l.aabbNeedsUpdate){l.updateAABB()}return m.aabb.overlaps(l.aabb)};e.prototype.boundingVolumeCheck=function(n,m){var l;switch(this.boundingVolumeType){case e.BOUNDING_CIRCLE:l=e.boundingRadiusCheck(n,m);break;case e.AABB:l=e.aabbCheck(n,m);break;default:throw new Error("Bounding volume type not recognized: "+this.boundingVolumeType)}return l};e.canCollide=function(m,l){if(m.motionState===j.STATIC&&l.motionState===j.STATIC){return false}if((m.motionState===j.KINEMATIC&&l.motionState===j.STATIC)||(m.motionState===j.STATIC&&l.motionState===j.KINEMATIC)){return false}if(m.motionState===j.KINEMATIC&&l.motionState===j.KINEMATIC){return false}if(m.sleepState===j.SLEEPING&&l.sleepState===j.SLEEPING){return false}if((m.sleepState===j.SLEEPING&&l.motionState===j.STATIC)||(l.sleepState===j.SLEEPING&&m.motionState===j.STATIC)){return false}return true};e.NAIVE=1;e.SAP=2},{"../math/vec2":30,"../objects/Body":31}],10:[function(g,f,j){var e=g("../shapes/Circle"),h=g("../shapes/Plane"),i=g("../shapes/Particle"),m=g("../collision/Broadphase"),k=g("../math/vec2"),l=g("../utils/Utils");f.exports=n;function n(o){m.apply(this);o=l.defaults(o,{xmin:-100,xmax:100,ymin:-100,ymax:100,nx:10,ny:10});this.xmin=o.xmin;this.ymin=o.ymin;this.xmax=o.xmax;this.ymax=o.ymax;this.nx=o.nx;this.ny=o.ny;this.binsizeX=(this.xmax-this.xmin)/this.nx;this.binsizeY=(this.ymax-this.ymin)/this.ny}n.prototype=new m();n.prototype.getCollisionPairs=function(G){var y=[],w=G.bodies,u=w.length,M=this.binsizeX,K=this.binsizeY,S=this.nx,R=this.ny,A=this.xmin,J=this.ymin,F=this.xmax,O=this.ymax;var H=[],P=S*R;for(var N=0;N<P;N++){H.push([])}var v=S/(F-A);var T=R/(O-J);for(var N=0;N!==u;N++){var r=w[N];var x=r.aabb;var t=Math.max(x.lowerBound[0],A);var s=Math.max(x.lowerBound[1],J);var W=Math.min(x.upperBound[0],F);var V=Math.min(x.upperBound[1],O);var p=Math.floor(v*(t-A));var E=Math.floor(T*(s-J));var o=Math.floor(v*(W-A));var D=Math.floor(T*(V-J));for(var L=p;L<=o;L++){for(var I=E;I<=D;I++){var C=L;var U=I;var z=C*(R-1)+U;if(z>=0&&z<P){H[z].push(r)}}}}for(var N=0;N!==P;N++){var B=H[N];for(var L=0,Q=B.length;L!==Q;L++){var r=B[L];for(var I=0;I!==L;I++){var q=B[I];if(m.canCollide(r,q)&&this.boundingVolumeCheck(r,q)){y.push(r,q)}}}}return y}},{"../collision/Broadphase":9,"../math/vec2":30,"../shapes/Circle":35,"../shapes/Particle":39,"../shapes/Plane":40,"../utils/Utils":47}],11:[function(g,f,k){var e=g("../shapes/Circle"),h=g("../shapes/Plane"),j=g("../shapes/Shape"),i=g("../shapes/Particle"),m=g("../collision/Broadphase"),l=g("../math/vec2");f.exports=n;function n(){m.call(this,m.NAIVE)}n.prototype=new m();n.prototype.getCollisionPairs=function(v){var r=v.bodies,o=this.result;o.length=0;for(var u=0,t=r.length;u!==t;u++){var q=r[u];for(var s=0;s<u;s++){var p=r[s];if(m.canCollide(q,p)&&this.boundingVolumeCheck(q,p)){o.push(q,p)}}}return o}},{"../collision/Broadphase":9,"../math/vec2":30,"../shapes/Circle":35,"../shapes/Particle":39,"../shapes/Plane":40,"../shapes/Shape":42}],12:[function(ap,aA,P){var ah=ap("../math/vec2"),ar=ah.sub,t=ah.add,y=ah.dot,ai=ap("../utils/Utils"),f=ap("../utils/TupleDictionary"),h=ap("../equations/Equation"),ax=ap("../equations/ContactEquation"),ag=ap("../equations/FrictionEquation"),af=ap("../shapes/Circle"),am=ap("../shapes/Convex"),M=ap("../shapes/Shape"),O=ap("../objects/Body"),J=ap("../shapes/Rectangle");aA.exports=av;var U=ah.fromValues(0,1);var s=ah.fromValues(0,0),r=ah.fromValues(0,0),p=ah.fromValues(0,0),n=ah.fromValues(0,0),m=ah.fromValues(0,0),l=ah.fromValues(0,0),k=ah.fromValues(0,0),j=ah.fromValues(0,0),i=ah.fromValues(0,0),F=ah.fromValues(0,0),E=ah.fromValues(0,0),D=ah.fromValues(0,0),C=ah.fromValues(0,0),B=ah.fromValues(0,0),A=ah.fromValues(0,0),z=ah.fromValues(0,0),x=ah.fromValues(0,0),w=ah.fromValues(0,0),az=[];function av(){this.contactEquations=[];this.frictionEquations=[];this.enableFriction=true;this.slipForce=10;this.frictionCoefficient=0.3;this.surfaceVelocity=0;this.reuseObjects=true;this.reusableContactEquations=[];this.reusableFrictionEquations=[];this.restitution=0;this.stiffness=h.DEFAULT_STIFFNESS;this.relaxation=h.DEFAULT_RELAXATION;this.frictionStiffness=h.DEFAULT_STIFFNESS;this.frictionRelaxation=h.DEFAULT_RELAXATION;this.collidingBodiesLastStep=new f()}av.prototype.collidedLastStep=function(aD,aC){var aF=aD.id|0,aE=aC.id|0;return !!this.collidingBodiesLastStep.get(aF,aE)};function v(aD){var aC=aD.keys.length;while(aC--){delete aD[aD.keys[aC]]}aD.keys.length=0}av.prototype.reset=function(aF){this.collidingBodiesLastStep.reset();for(var aE=0;aE!==this.contactEquations.length;aE++){var aK=this.contactEquations[aE],aI=aK.bodyA.id|0,aG=aK.bodyB.id|0;this.collidingBodiesLastStep.set(aI,aG,true)}if(this.reuseObjects){var aD=this.contactEquations,aC=this.frictionEquations,aH=this.reusableFrictionEquations,aJ=this.reusableContactEquations;ai.appendArray(aJ,aD);ai.appendArray(aH,aC)}this.contactEquations.length=this.frictionEquations.length=0};av.prototype.createContactEquation=function(aF,aE,aD,aC){var aG=this.reusableContactEquations.length?this.reusableContactEquations.pop():new ax(aF,aE);aG.bodyA=aF;aG.bodyB=aE;aG.shapeA=aD;aG.shapeB=aC;aG.restitution=this.restitution;aG.firstImpact=!this.collidedLastStep(aF,aE);aG.stiffness=this.stiffness;aG.relaxation=this.relaxation;aG.needsUpdate=true;aG.enabled=true;return aG};av.prototype.createFrictionEquation=function(aF,aE,aD,aC){var aG=this.reusableFrictionEquations.length?this.reusableFrictionEquations.pop():new ag(aF,aE);aG.bodyA=aF;aG.bodyB=aE;aG.shapeA=aD;aG.shapeB=aC;aG.setSlipForce(this.slipForce);aG.frictionCoefficient=this.frictionCoefficient;aG.relativeVelocity=this.surfaceVelocity;aG.enabled=true;aG.needsUpdate=true;aG.stiffness=this.frictionStiffness;aG.relaxation=this.frictionRelaxation;return aG};av.prototype.createFrictionFromContact=function(aD){var aC=this.createFrictionEquation(aD.bodyA,aD.bodyB,aD.shapeA,aD.shapeB);ah.copy(aC.contactPointA,aD.contactPointA);ah.copy(aC.contactPointB,aD.contactPointB);ah.rotate90cw(aC.t,aD.normalA);aC.contactEquation=aD;return aC};av.prototype[M.LINE|M.CONVEX]=av.prototype.convexLine=function(aD,aF,aJ,aK,aC,aE,aI,aH,aG){if(aG){return false}else{return 0}};av.prototype[M.LINE|M.RECTANGLE]=av.prototype.lineRectangle=function(aD,aF,aJ,aK,aC,aE,aI,aH,aG){if(aG){return false}else{return 0}};function L(aD,aC){ah.set(aD.vertices[0],-aC.length*0.5,-aC.radius);ah.set(aD.vertices[1],aC.length*0.5,-aC.radius);ah.set(aD.vertices[2],aC.length*0.5,aC.radius);ah.set(aD.vertices[3],-aC.length*0.5,aC.radius)}var g=new J(1,1),N=ah.create();av.prototype[M.CAPSULE|M.CONVEX]=av.prototype[M.CAPSULE|M.RECTANGLE]=av.prototype.convexCapsule=function(aH,aJ,aN,aO,aG,aI,aM,aL,aK){var aE=N;ah.set(aE,aI.length/2,0);ah.rotate(aE,aE,aL);ah.add(aE,aE,aM);var aF=this.circleConvex(aG,aI,aE,aL,aH,aJ,aN,aO,aK,aI.radius);ah.set(aE,-aI.length/2,0);ah.rotate(aE,aE,aL);ah.add(aE,aE,aM);var aD=this.circleConvex(aG,aI,aE,aL,aH,aJ,aN,aO,aK,aI.radius);if(aK&&(aF||aD)){return true}var aC=g;L(aC,aI);var aP=this.convexConvex(aH,aJ,aN,aO,aG,aC,aM,aL,aK);return aP+aF+aD};av.prototype[M.CAPSULE|M.LINE]=av.prototype.lineCapsule=function(aD,aF,aJ,aK,aC,aE,aI,aH,aG){if(aG){return false}else{return 0}};var K=ah.create();var I=ah.create();var an=new J(1,1);av.prototype[M.CAPSULE|M.CAPSULE]=av.prototype.capsuleCapsule=function(aG,aS,aK,aO,aF,aR,aJ,aM,aH){var aQ=K,aP=I;var aT=0;for(var aN=0;aN<2;aN++){ah.set(aQ,(aN==0?-1:1)*aS.length/2,0);ah.rotate(aQ,aQ,aO);ah.add(aQ,aQ,aK);for(var aL=0;aL<2;aL++){ah.set(aP,(aL==0?-1:1)*aR.length/2,0);ah.rotate(aP,aP,aM);ah.add(aP,aP,aJ);var aI=this.circleCircle(aG,aS,aQ,aO,aF,aR,aP,aM,aH,aS.radius,aR.radius);if(aH&&aI){return true}aT+=aI}}var aE=an;L(aE,aS);var aD=this.convexCapsule(aG,aE,aK,aO,aF,aR,aJ,aM,aH);if(aH&&aD){return true}aT+=aD;L(aE,aR);var aC=this.convexCapsule(aF,aE,aJ,aM,aG,aS,aK,aO,aH);if(aH&&aC){return true}aT+=aC;return aT};av.prototype[M.LINE|M.LINE]=av.prototype.lineLine=function(aD,aF,aJ,aK,aC,aE,aI,aH,aG){if(aG){return false}else{return 0}};av.prototype[M.PLANE|M.LINE]=av.prototype.planeLine=function(aO,aR,aW,aN,aE,aL,aS,aF,aD){var aI=s,aG=r,aX=p,aJ=n,aH=m,aY=l,aP=k,aK=j,aC=i,aV=az;numContacts=0;ah.set(aI,-aL.length/2,0);ah.set(aG,aL.length/2,0);ah.rotate(aX,aI,aF);ah.rotate(aJ,aG,aF);t(aX,aX,aS);t(aJ,aJ,aS);ah.copy(aI,aX);ah.copy(aG,aJ);ar(aH,aG,aI);ah.normalize(aY,aH);ah.rotate90cw(aC,aY);ah.rotate(aK,U,aN);aV[0]=aI;aV[1]=aG;for(var aQ=0;aQ<aV.length;aQ++){var aM=aV[aQ];ar(aP,aM,aW);var aT=y(aP,aK);if(aT<0){if(aD){return true}var aU=this.createContactEquation(aO,aE,aR,aL);numContacts++;ah.copy(aU.normalA,aK);ah.normalize(aU.normalA,aU.normalA);ah.scale(aP,aK,aT);ar(aU.contactPointA,aM,aP);ar(aU.contactPointA,aU.contactPointA,aO.position);ar(aU.contactPointB,aM,aS);t(aU.contactPointB,aU.contactPointB,aS);ar(aU.contactPointB,aU.contactPointB,aE.position);this.contactEquations.push(aU);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(aU))}}}return numContacts};av.prototype[M.PARTICLE|M.CAPSULE]=av.prototype.particleCapsule=function(aD,aF,aJ,aK,aC,aE,aI,aH,aG){return this.circleLine(aD,aF,aJ,aK,aC,aE,aI,aH,aG,aE.radius,0)};av.prototype[M.CIRCLE|M.LINE]=av.prototype.circleLine=function(bb,aR,aZ,aO,ba,aQ,aY,aM,aL,aP,aC){var a2=aQ,a3=aM,aK=ba,aN=aY,be=aZ,a8=bb,a6=aR,aP=aP||0,aC=typeof(aC)!="undefined"?aC:a6.radius,a4=s,aH=r,aI=p,aS=n,a0=m,aF=l,a5=k,aV=j,aU=i,aT=F,aJ=E,aG=D,aX=C,bf=B,a9=az;ah.set(aV,-a2.length/2,0);ah.set(aU,a2.length/2,0);ah.rotate(aT,aV,a3);ah.rotate(aJ,aU,a3);t(aT,aT,aN);t(aJ,aJ,aN);ah.copy(aV,aT);ah.copy(aU,aJ);ar(aF,aU,aV);ah.normalize(a5,aF);ah.rotate90cw(a0,a5);ar(aG,be,aV);var bc=y(aG,a0);ar(aS,aV,aN);ar(aX,be,aN);if(Math.abs(bc)<aC+aP){ah.scale(a4,a0,bc);ar(aI,be,a4);ah.scale(aH,a0,y(a0,aX));ah.normalize(aH,aH);ah.scale(aH,aH,aP);t(aI,aI,aH);var aW=y(a5,aI);var aE=y(a5,aV);var aD=y(a5,aU);if(aW>aE&&aW<aD){if(aL){return true}var bd=this.createContactEquation(a8,aK,aR,aQ);ah.scale(bd.normalA,a4,-1);ah.normalize(bd.normalA,bd.normalA);ah.scale(bd.contactPointA,bd.normalA,aC);t(bd.contactPointA,bd.contactPointA,be);ar(bd.contactPointA,bd.contactPointA,a8.position);ar(bd.contactPointB,aI,aN);t(bd.contactPointB,bd.contactPointB,aN);ar(bd.contactPointB,bd.contactPointB,aK.position);this.contactEquations.push(bd);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(bd))}return 1}}a9[0]=aV;a9[1]=aU;for(var a7=0;a7<a9.length;a7++){var a1=a9[a7];ar(aG,a1,be);if(ah.squaredLength(aG)<(aC+aP)*(aC+aP)){if(aL){return true}var bd=this.createContactEquation(a8,aK,aR,aQ);ah.copy(bd.normalA,aG);ah.normalize(bd.normalA,bd.normalA);ah.scale(bd.contactPointA,bd.normalA,aC);t(bd.contactPointA,bd.contactPointA,be);ar(bd.contactPointA,bd.contactPointA,a8.position);ar(bd.contactPointB,a1,aN);ah.scale(bf,bd.normalA,-aP);t(bd.contactPointB,bd.contactPointB,bf);t(bd.contactPointB,bd.contactPointB,aN);ar(bd.contactPointB,bd.contactPointB,aK.position);this.contactEquations.push(bd);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(bd))}return 1}}return 0};av.prototype[M.CIRCLE|M.CAPSULE]=av.prototype.circleCapsule=function(aD,aF,aJ,aK,aC,aE,aI,aH,aG){return this.circleLine(aD,aF,aJ,aK,aC,aE,aI,aH,aG,aE.radius)};av.prototype[M.CIRCLE|M.CONVEX]=av.prototype[M.CIRCLE|M.RECTANGLE]=av.prototype.circleConvex=function(be,aR,a3,aM,bd,aO,a1,aL,aJ,aC){var aZ=aO,a0=aL,aP=bd,aQ=a1,bh=a3,bc=be,a9=aR,aC=typeof(aC)=="number"?aC:a9.radius;var aV=s,aU=r,aD=p,a8=n,a5=m,aS=l,aY=k,a6=j,aH=i,aF=F,aI=E,ba=-1,aW=null,bf=D,a4=C,a7=B,aT=A,aX=z,aG=false,a2=Number.MAX_VALUE;var aK=0;verts=aZ.vertices;for(var bb=0;bb!==verts.length+1;bb++){var bl=verts[bb%verts.length],bk=verts[(bb+1)%verts.length];ah.rotate(aV,bl,a0);ah.rotate(aU,bk,a0);t(aV,aV,aQ);t(aU,aU,aQ);ar(aD,aU,aV);ah.normalize(a8,aD);ah.rotate90cw(a5,a8);ah.scale(a7,a5,-a9.radius);t(a7,a7,bh);if(e(a7,aZ,aQ,a0)){ah.sub(aT,aV,a7);var aN=Math.abs(ah.dot(aT,a5));if(aN<a2){ah.copy(aX,a7);a2=aN;ah.scale(a4,a5,aN);ah.add(a4,a4,a7);aG=true}}}if(aG){if(aJ){return true}var bg=this.createContactEquation(bc,aP,aR,aO);ah.sub(bg.normalA,aX,bh);ah.normalize(bg.normalA,bg.normalA);ah.scale(bg.contactPointA,bg.normalA,aC);t(bg.contactPointA,bg.contactPointA,bh);ar(bg.contactPointA,bg.contactPointA,bc.position);ar(bg.contactPointB,a4,aQ);t(bg.contactPointB,bg.contactPointB,aQ);ar(bg.contactPointB,bg.contactPointB,aP.position);this.contactEquations.push(bg);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(bg))}return 1}if(aC>0){for(var bb=0;bb<verts.length;bb++){var aE=verts[bb];ah.rotate(aI,aE,a0);t(aI,aI,aQ);ar(aF,aI,bh);if(ah.squaredLength(aF)<aC*aC){if(aJ){return true}var bg=this.createContactEquation(bc,aP,aR,aO);ah.copy(bg.normalA,aF);ah.normalize(bg.normalA,bg.normalA);ah.scale(bg.contactPointA,bg.normalA,aC);t(bg.contactPointA,bg.contactPointA,bh);ar(bg.contactPointA,bg.contactPointA,bc.position);ar(bg.contactPointB,aI,aQ);t(bg.contactPointB,bg.contactPointB,aQ);ar(bg.contactPointB,bg.contactPointB,aP.position);this.contactEquations.push(bg);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(bg))}return 1}}}return 0};var al=ah.create(),ak=ah.create(),ae=ah.create(),ad=ah.create();function e(aG,aC,aF,aM){var aJ=al,aI=ak,aE=ae,aD=ad,aP=aG,aO=aC.vertices,aK=null;for(var aH=0;aH!==aO.length+1;aH++){var aQ=aO[aH%aO.length],aN=aO[(aH+1)%aO.length];ah.rotate(aJ,aQ,aM);ah.rotate(aI,aN,aM);t(aJ,aJ,aF);t(aI,aI,aF);ar(aE,aJ,aP);ar(aD,aI,aP);var aL=ah.crossLength(aE,aD);if(aK===null){aK=aL}if(aL*aK<=0){return false}aK=aL}return true}av.prototype[M.PARTICLE|M.CONVEX]=av.prototype[M.PARTICLE|M.RECTANGLE]=av.prototype.particleConvex=function(bg,aR,a6,aK,bf,aO,a4,aJ,aH){var a1=aO,a2=aJ,aP=bf,aQ=a4,a0=a6,a3=bg,aZ=aR,aV=s,aU=r,aC=p,bb=n,a8=m,aS=l,bm=k,a9=j,aF=i,aD=F,aG=E,bc=-1,aX=null,bk=D,a7=C,aM=B,aL=A,ba=z,aT=x,aW=w,a5=Number.MAX_VALUE;var aI=0,aE=false,be=a1.vertices;if(!e(a0,a1,aQ,a2)){return 0}if(aH){return true}var aY=null;for(var bd=0;bd!==be.length+1;bd++){var bo=be[bd%be.length],bn=be[(bd+1)%be.length];ah.rotate(aV,bo,a2);ah.rotate(aU,bn,a2);t(aV,aV,aQ);t(aU,aU,aQ);ar(aC,aU,aV);ah.normalize(bb,aC);ah.rotate90cw(a8,bb);ar(aD,a0,aV);var bh=y(aD,a8);ar(aS,aV,aQ);ar(bm,a0,aQ);ah.sub(aT,aV,a0);var aN=Math.abs(ah.dot(aT,a8));if(aN<a5){a5=aN;ah.scale(a7,a8,aN);ah.add(a7,a7,a0);ah.copy(aW,a8);aE=true}}if(aE){var bl=this.createContactEquation(a3,aP,aR,aO);ah.scale(bl.normalA,aW,-1);ah.normalize(bl.normalA,bl.normalA);ah.set(bl.contactPointA,0,0);t(bl.contactPointA,bl.contactPointA,a0);ar(bl.contactPointA,bl.contactPointA,a3.position);ar(bl.contactPointB,a7,aQ);t(bl.contactPointB,bl.contactPointB,aQ);ar(bl.contactPointB,bl.contactPointB,aP.position);this.contactEquations.push(bl);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(bl))}return 1}return 0};av.prototype[M.CIRCLE]=av.prototype.circleCircle=function(aE,aV,aL,aQ,aC,aU,aK,aP,aG,aS,aR){var aF=aE,aO=aV,aI=aL,aD=aC,aN=aU,aH=aK,aM=s,aS=aS||aO.radius,aR=aR||aN.radius;ar(aM,aL,aK);var aJ=aS+aR;if(ah.squaredLength(aM)>aJ*aJ){return 0}if(aG){return true}var aT=this.createContactEquation(aF,aD,aV,aU);ar(aT.normalA,aH,aI);ah.normalize(aT.normalA,aT.normalA);ah.scale(aT.contactPointA,aT.normalA,aS);ah.scale(aT.contactPointB,aT.normalA,-aR);t(aT.contactPointA,aT.contactPointA,aI);ar(aT.contactPointA,aT.contactPointA,aF.position);t(aT.contactPointB,aT.contactPointB,aH);ar(aT.contactPointB,aT.contactPointB,aD.position);this.contactEquations.push(aT);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(aT))}return 1};av.prototype[M.PLANE|M.CONVEX]=av.prototype[M.PLANE|M.RECTANGLE]=av.prototype.planeConvex=function(aD,aX,aO,aS,aC,aW,aN,aR,aF){var aH=aC,a0=aN,aJ=aW,aE=aR,aM=aD,aT=aX,aZ=aO,aL=aS;var aG=s,aI=r,aP=p;var aY=0;ah.rotate(aI,U,aL);for(var aQ=0;aQ<aJ.vertices.length;aQ++){var aK=aJ.vertices[aQ];ah.rotate(aG,aK,aE);t(aG,aG,a0);ar(aP,aG,aZ);if(y(aP,aI)<=av.convexPrecision){if(aF){return true}aY++;var aV=this.createContactEquation(aM,aH,aT,aJ);ar(aP,aG,aZ);ah.copy(aV.normalA,aI);var aU=y(aP,aV.normalA);ah.scale(aP,aV.normalA,aU);ar(aV.contactPointB,aG,aH.position);ar(aV.contactPointA,aG,aP);ar(aV.contactPointA,aV.contactPointA,aM.position);this.contactEquations.push(aV);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(aV))}}}return aY};av.prototype.convexPlane=function(aD,aF,aJ,aK,aC,aE,aI,aH,aG){console.warn("Narrowphase.prototype.convexPlane is deprecated. Use planeConvex instead!");return this.planeConvex(aC,aE,aI,aH,aD,aF,aJ,aK,aG)};av.prototype[M.PARTICLE|M.PLANE]=av.prototype.particlePlane=function(aD,aU,aM,aP,aC,aT,aL,aO,aF){var aE=aD,aI=aU,aH=aM,aK=aC,aQ=aT,aV=aL,aJ=aO;var aN=s,aG=r;aJ=aJ||0;ar(aN,aH,aV);ah.rotate(aG,U,aJ);var aR=y(aN,aG);if(aR>0){return 0}if(aF){return true}var aS=this.createContactEquation(aK,aE,aT,aU);ah.copy(aS.normalA,aG);ah.scale(aN,aS.normalA,aR);ar(aS.contactPointA,aH,aN);ar(aS.contactPointA,aS.contactPointA,aK.position);ar(aS.contactPointB,aH,aE.position);this.contactEquations.push(aS);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(aS))}return 1};av.prototype[M.CIRCLE|M.PARTICLE]=av.prototype.circleParticle=function(aE,aG,aP,aQ,aD,aF,aL,aK,aH){var aI=aE,aJ=aG,aO=aP,aS=aD,aR=aF,aC=aL,aN=s;ar(aN,aC,aO);if(ah.squaredLength(aN)>aJ.radius*aJ.radius){return 0}if(aH){return true}var aM=this.createContactEquation(aI,aS,aG,aF);ah.copy(aM.normalA,aN);ah.normalize(aM.normalA,aM.normalA);ah.scale(aM.contactPointA,aM.normalA,aJ.radius);t(aM.contactPointA,aM.contactPointA,aO);ar(aM.contactPointA,aM.contactPointA,aI.position);ar(aM.contactPointB,aC,aS.position);this.contactEquations.push(aM);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(aM))}return 1};var aa=new af(1),au=ah.create(),at=ah.create(),aq=ah.create();av.prototype[M.PLANE|M.CAPSULE]=av.prototype.planeCapsule=function(aE,aG,aP,aQ,aD,aF,aM,aL,aH){var aK=au,aI=at,aC=aa,aO=aq;ah.set(aK,-aF.length/2,0);ah.rotate(aK,aK,aL);t(aK,aK,aM);ah.set(aI,aF.length/2,0);ah.rotate(aI,aI,aL);t(aI,aI,aM);aC.radius=aF.radius;var aN=this.circlePlane(aD,aC,aK,0,aE,aG,aP,aQ,aH),aJ=this.circlePlane(aD,aC,aI,0,aE,aG,aP,aQ,aH);if(aH){return aN||aJ}else{return aN+aJ}};av.prototype.capsulePlane=function(aD,aF,aJ,aK,aC,aE,aI,aH,aG){console.warn("Narrowphase.prototype.capsulePlane() is deprecated. Use .planeCapsule() instead!");return this.planeCapsule(aC,aE,aI,aH,aD,aF,aJ,aK,aG)};av.prototype[M.CIRCLE|M.PLANE]=av.prototype.circlePlane=function(aF,aV,aN,aR,aD,aU,aM,aQ,aG){var aI=aF,aC=aV,aE=aN,aL=aD,aO=aU,aW=aM,aK=aQ;aK=aK||0;var aH=s,aJ=r,aT=p;ar(aH,aE,aW);ah.rotate(aJ,U,aK);var aS=y(aJ,aH);if(aS>aC.radius){return 0}if(aG){return true}var aP=this.createContactEquation(aL,aI,aU,aV);ah.copy(aP.normalA,aJ);ah.scale(aP.contactPointB,aP.normalA,-aC.radius);t(aP.contactPointB,aP.contactPointB,aE);ar(aP.contactPointB,aP.contactPointB,aI.position);ah.scale(aT,aP.normalA,aS);ar(aP.contactPointA,aH,aT);t(aP.contactPointA,aP.contactPointA,aW);ar(aP.contactPointA,aP.contactPointA,aL.position);this.contactEquations.push(aP);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(aP))}return 1};av.convexPrecision=1e-7;av.prototype[M.CONVEX]=av.prototype[M.CONVEX|M.RECTANGLE]=av.prototype[M.RECTANGLE]=av.prototype.convexConvex=function(a9,aW,a2,aT,a8,aU,a1,aS,aR,ba){var aD=s,aQ=r,aP=p,aO=n,aI=m,aL=l,aY=k,aJ=j,aZ=i,a0=0,ba=ba||av.convexPrecision;var aK=av.findSeparatingAxis(aW,a2,aT,aU,a1,aS,aD);if(!aK){return 0}ar(aJ,a1,a2);if(y(aD,aJ)>0){ah.scale(aD,aD,-1)}var aX=av.getClosestEdge(aW,aT,aD,true),aV=av.getClosestEdge(aU,aS,aD);if(aX===-1||aV===-1){return 0}for(var a5=0;a5<2;a5++){var aN=aX,aM=aV,aH=aW,aF=aU,bg=a2,be=a1,aG=aT,aE=aS,bk=a9,bh=a8;if(a5===0){var a4;a4=aN;aN=aM;aM=a4;a4=aH;aH=aF;aF=a4;a4=bg;bg=be;be=a4;a4=aG;aG=aE;aE=a4;a4=bk;bk=bh;bh=a4}for(var a6=aM;a6<aM+2;a6++){var a3=aF.vertices[(a6+aF.vertices.length)%aF.vertices.length];ah.rotate(aQ,a3,aE);t(aQ,aQ,be);var aC=0;for(var a7=aN-1;a7<aN+2;a7++){var bf=aH.vertices[(a7+aH.vertices.length)%aH.vertices.length],bd=aH.vertices[(a7+1+aH.vertices.length)%aH.vertices.length];ah.rotate(aP,bf,aG);ah.rotate(aO,bd,aG);t(aP,aP,bg);t(aO,aO,bg);ar(aI,aO,aP);ah.rotate90cw(aZ,aI);ah.normalize(aZ,aZ);ar(aJ,aQ,aP);var bb=y(aZ,aJ);if(bb<=ba){aC++}}if(aC>=3){if(aR){return true}var bc=this.createContactEquation(bk,bh,aH,aF);a0++;var bf=aH.vertices[(aN)%aH.vertices.length],bd=aH.vertices[(aN+1)%aH.vertices.length];ah.rotate(aP,bf,aG);ah.rotate(aO,bd,aG);t(aP,aP,bg);t(aO,aO,bg);ar(aI,aO,aP);ah.rotate90cw(bc.normalA,aI);ah.normalize(bc.normalA,bc.normalA);ar(aJ,aQ,aP);var bb=y(bc.normalA,aJ);ah.scale(aY,bc.normalA,bb);ar(bc.contactPointA,aQ,bg);ar(bc.contactPointA,bc.contactPointA,aY);t(bc.contactPointA,bc.contactPointA,bg);ar(bc.contactPointA,bc.contactPointA,bk.position);ar(bc.contactPointB,aQ,be);t(bc.contactPointB,bc.contactPointB,be);ar(bc.contactPointB,bc.contactPointB,bh.position);this.contactEquations.push(bc);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(bc))}}}}return a0};var G=ah.fromValues(0,0);av.projectConvexOntoAxis=function(aC,aE,aK,aH,aO){var aJ=null,aF=null,aM,aL,aI=G;ah.rotate(aI,aH,-aK);for(var aG=0;aG<aC.vertices.length;aG++){aM=aC.vertices[aG];aL=y(aM,aI);if(aJ===null||aL>aJ){aJ=aL}if(aF===null||aL<aF){aF=aL}}if(aF>aJ){var aN=aF;aF=aJ;aJ=aN}var aD=y(aE,aH);ah.set(aO,aF+aD,aJ+aD)};var ab=ah.fromValues(0,0),Z=ah.fromValues(0,0),X=ah.fromValues(0,0),W=ah.fromValues(0,0),V=ah.fromValues(0,0),T=ah.fromValues(0,0);av.findSeparatingAxis=function(aM,aP,aE,aK,aN,aD,aW){var aF=null,aC=false,aH=false,aG=ab,aJ=Z,aI=X,aZ=W,aQ=V,aO=T;for(var aR=0;aR!==2;aR++){var aU=aM,aT=aE;if(aR===1){aU=aK;aT=aD}for(var aS=0;aS!==aU.vertices.length;aS++){ah.rotate(aJ,aU.vertices[aS],aT);ah.rotate(aI,aU.vertices[(aS+1)%aU.vertices.length],aT);ar(aG,aI,aJ);ah.rotate90cw(aZ,aG);ah.normalize(aZ,aZ);av.projectConvexOntoAxis(aM,aP,aE,aZ,aQ);av.projectConvexOntoAxis(aK,aN,aD,aZ,aO);var aY=aQ,aV=aO,aX=false;if(aQ[0]>aO[0]){aV=aQ;aY=aO;aX=true}var aL=aV[0]-aY[1];aC=(aL<=av.convexPrecision);if(aF===null||aL>aF){ah.copy(aW,aZ);aF=aL;aH=aC}}}return aH};var S=ah.fromValues(0,0),R=ah.fromValues(0,0),Q=ah.fromValues(0,0);av.getClosestEdge=function(aM,aE,aD,aH){var aI=S,aC=R,aK=Q;ah.rotate(aI,aD,-aE);if(aH){ah.scale(aI,aI,-1)}var aF=-1,aJ=aM.vertices.length;for(var aG=0;aG!==aJ;aG++){ar(aC,aM.vertices[(aG+1)%aJ],aM.vertices[aG%aJ]);ah.rotate90cw(aK,aC);ah.normalize(aK,aK);var aL=y(aK,aI);if(aF==-1||aL>maxDot){aF=aG%aJ;maxDot=aL}}return aF};var aj=ah.create(),ao=ah.create(),q=ah.create(),o=ah.create(),aB=ah.create(),H=ah.create(),ac=ah.create();av.prototype[M.CIRCLE|M.HEIGHTFIELD]=av.prototype.circleHeightfield=function(aI,aC,aS,aY,aL,aT,a1,aK,aF,aG){var a2=aT.data,aG=aG||aC.radius,aQ=aT.elementWidth,aU=ao,aJ=aj,aN=aB,aH=ac,aM=H,aE=q,aD=o;var aP=Math.floor((aS[0]-aG-a1[0])/aQ),aO=Math.ceil((aS[0]+aG-a1[0])/aQ);if(aP<0){aP=0}if(aO>=a2.length){aO=a2.length-1}var aX=a2[aP],aV=a2[aO];for(var aW=aP;aW<aO;aW++){if(a2[aW]<aV){aV=a2[aW]}if(a2[aW]>aX){aX=a2[aW]}}if(aS[1]-aG>aX){return aF?false:0}if(aS[1]+aG<aV){}var aR=false;for(var aW=aP;aW<aO;aW++){ah.set(aE,aW*aQ,a2[aW]);ah.set(aD,(aW+1)*aQ,a2[aW+1]);ah.add(aE,aE,a1);ah.add(aD,aD,a1);ah.sub(aM,aD,aE);ah.rotate(aM,aM,Math.PI/2);ah.normalize(aM,aM);ah.scale(aJ,aM,-aG);ah.add(aJ,aJ,aS);ah.sub(aU,aJ,aE);var aZ=ah.dot(aU,aM);if(aJ[0]>=aE[0]&&aJ[0]<aD[0]&&aZ<=0){if(aF){return true}aR=true;ah.scale(aU,aM,-aZ);ah.add(aN,aJ,aU);ah.copy(aH,aM);var a0=this.createContactEquation(aL,aI,aT,aC);ah.copy(a0.normalA,aH);ah.scale(a0.contactPointB,a0.normalA,-aG);t(a0.contactPointB,a0.contactPointB,aS);ar(a0.contactPointB,a0.contactPointB,aI.position);ah.copy(a0.contactPointA,aN);ah.sub(a0.contactPointA,a0.contactPointA,aL.position);this.contactEquations.push(a0);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(a0))}}}aR=false;if(aG>0){for(var aW=aP;aW<=aO;aW++){ah.set(aE,aW*aQ,a2[aW]);ah.add(aE,aE,a1);ah.sub(aU,aS,aE);if(ah.squaredLength(aU)<aG*aG){if(aF){return true}aR=true;var a0=this.createContactEquation(aL,aI,aT,aC);ah.copy(a0.normalA,aU);ah.normalize(a0.normalA,a0.normalA);ah.scale(a0.contactPointB,a0.normalA,-aG);t(a0.contactPointB,a0.contactPointB,aS);ar(a0.contactPointB,a0.contactPointB,aI.position);ar(a0.contactPointA,aE,a1);t(a0.contactPointA,a0.contactPointA,a1);ar(a0.contactPointA,a0.contactPointA,aL.position);this.contactEquations.push(a0);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(a0))}}}}if(aR){return 1}return 0};var ay=ah.create(),aw=ah.create(),Y=ah.create(),u=new am([ah.create(),ah.create(),ah.create(),ah.create()]);av.prototype[M.RECTANGLE|M.HEIGHTFIELD]=av.prototype[M.CONVEX|M.HEIGHTFIELD]=av.prototype.convexHeightfield=function(aH,aN,aG,aE,aJ,aQ,aW,aI,aF){var aX=aQ.data,aO=aQ.elementWidth,aD=ay,aC=aw,aR=Y,aV=u;var aM=Math.floor((aH.aabb.lowerBound[0]-aW[0])/aO),aL=Math.ceil((aH.aabb.upperBound[0]-aW[0])/aO);if(aM<0){aM=0}if(aL>=aX.length){aL=aX.length-1}var aU=aX[aM],aS=aX[aL];for(var aT=aM;aT<aL;aT++){if(aX[aT]<aS){aS=aX[aT]}if(aX[aT]>aU){aU=aX[aT]}}if(aH.aabb.lowerBound[1]>aU){return aF?false:0}var aP=false;var aY=0;for(var aT=aM;aT<aL;aT++){ah.set(aD,aT*aO,aX[aT]);ah.set(aC,(aT+1)*aO,aX[aT+1]);ah.add(aD,aD,aW);ah.add(aC,aC,aW);var aK=100;ah.set(aR,(aC[0]+aD[0])*0.5,(aC[1]+aD[1]-aK)*0.5);ah.sub(aV.vertices[0],aC,aR);ah.sub(aV.vertices[1],aD,aR);ah.copy(aV.vertices[2],aV.vertices[1]);ah.copy(aV.vertices[3],aV.vertices[0]);aV.vertices[2][1]-=aK;aV.vertices[3][1]-=aK;aY+=this.convexConvex(aH,aN,aG,aE,aJ,aV,aR,0,aF)}return aY}},{"../equations/ContactEquation":21,"../equations/Equation":22,"../equations/FrictionEquation":23,"../math/vec2":30,"../objects/Body":31,"../shapes/Circle":35,"../shapes/Convex":36,"../shapes/Rectangle":41,"../shapes/Shape":42,"../utils/TupleDictionary":46,"../utils/Utils":47}],13:[function(g,h,f){var j=g("../utils/Utils"),e=g("../collision/Broadphase");h.exports=i;function i(){e.call(this,e.SAP);this.axisList=[];this.world=null;this.axisIndex=0;var k=this.axisList;this._addBodyHandler=function(l){k.push(l.body)};this._removeBodyHandler=function(m){var l=k.indexOf(m.body);if(l!==-1){k.splice(l,1)}}}i.prototype=new e();i.prototype.setWorld=function(k){this.axisList.length=0;j.appendArray(this.axisList,k.bodies);k.off("addBody",this._addBodyHandler).off("removeBody",this._removeBodyHandler);k.on("addBody",this._addBodyHandler).on("removeBody",this._removeBodyHandler);this.world=k};i.sortAxisList=function(m,q){q=q|0;for(var p=1,k=m.length;p<k;p++){var n=m[p];for(var o=p-1;o>=0;o--){if(m[o].aabb.lowerBound[q]<=n.aabb.lowerBound[q]){break}m[o+1]=m[o]}m[o+1]=n}return m};i.prototype.getCollisionPairs=function(s){var k=this.axisList,w=this.result,v=this.axisIndex;w.length=0;var o=k.length;while(o--){var u=k[o];if(u.aabbNeedsUpdate){u.updateAABB()}}i.sortAxisList(k,v);for(var r=0,t=k.length|0;r!==t;r++){var p=k[r];for(var q=r+1;q<t;q++){var n=k[q];var m=(n.aabb.lowerBound[v]<=p.aabb.upperBound[v]);if(!m){break}if(e.canCollide(p,n)&&this.boundingVolumeCheck(p,n)){w.push(p,n)}}}return w}},{"../collision/Broadphase":9,"../utils/Utils":47}],14:[function(f,h,e){h.exports=g;var i=f("../utils/Utils");function g(m,l,k,j){this.type=k;j=i.defaults(j,{collideConnected:true,wakeUpBodies:true});this.equations=[];this.bodyA=m;this.bodyB=l;this.collideConnected=j.collideConnected;if(j.wakeUpBodies){if(m){m.wakeUp()}if(l){l.wakeUp()}}}g.prototype.update=function(){throw new Error("method update() not implmemented in this Constraint subclass!")};g.DISTANCE=1;g.GEAR=2;g.LOCK=3;g.PRISMATIC=4;g.REVOLUTE=5;g.prototype.setStiffness=function(k){var l=this.equations;for(var m=0;m!==l.length;m++){var j=l[m];j.stiffness=k;j.needsUpdate=true}};g.prototype.setRelaxation=function(m){var k=this.equations;for(var l=0;l!==k.length;l++){var j=k[l];j.relaxation=m;j.needsUpdate=true}}},{"../utils/Utils":47}],15:[function(g,e,h){var o=g("./Constraint"),j=g("../equations/Equation"),i=g("../math/vec2");e.exports=m;function m(s,q,p,A){A=A||{};o.call(this,s,q,o.DISTANCE,A);this.distance=p;this.localAnchorA=i.create();this.localAnchorB=i.create();var w=this.localAnchorA;var u=this.localAnchorB;var z;if(typeof(A.maxForce)==="undefined"){z=Number.MAX_VALUE}else{z=A.maxForce}var v=new j(s,q,-z,z);this.equations=[v];var n=i.create();var y=i.create();var x=i.create();var t=this;v.computeGq=function(){var D=this.bodyA,C=this.bodyB,B=D.position,r=C.position;i.rotate(y,w,D.angle);i.rotate(x,u,C.angle);i.add(n,B,x);i.sub(n,n,y);i.sub(n,n,B);i.sub(n,C.position,D.position);return i.length(n)-t.distance};this.setMaxForce(z)}m.prototype=new o();var f=i.create();var l=i.create();var k=i.create();m.prototype.update=function(){var s=this.equations[0],q=this.bodyA,p=this.bodyB,n=this.distance,u=q.position,t=p.position,w=s.G;i.rotate(l,this.localAnchorA,q.angle);i.rotate(k,this.localAnchorB,p.angle);var r=i.crossLength(l,f),v=i.crossLength(k,f);i.sub(f,p.position,q.position);i.normalize(f,f);w[0]=-f[0];w[1]=-f[1];w[3]=f[0];w[4]=f[1]};m.prototype.setMaxForce=function(n){var p=this.equations[0];p.minForce=-n;p.maxForce=n};m.prototype.getMaxForce=function(n){var p=this.equations[0];return p.maxForce}},{"../equations/Equation":22,"../math/vec2":30,"./Constraint":14}],16:[function(f,h,e){var g=f("./Constraint"),j=f("../equations/Equation"),k=f("../equations/AngleLockEquation"),i=f("../math/vec2");h.exports=l;function l(o,n,m){m=m||{};g.call(this,o,n,g.GEAR,m);this.equations=[new k(o,n,m)];this.angle=typeof(m.angle)==="number"?m.angle:0;this.ratio=typeof(m.ratio)==="number"?m.ratio:1;if(typeof(m.maxTorque)==="number"){this.setMaxTorque(m.maxTorque)}}l.prototype=new g();l.prototype.update=function(){var m=this.equations[0];if(m.ratio!==this.ratio){m.setRatio(this.ratio)}m.angle=this.angle};l.prototype.setMaxTorque=function(m){this.equations[0].setMaxTorque(m)};l.prototype.getMaxTorque=function(m){return this.equations[0].maxForce}},{"../equations/AngleLockEquation":20,"../equations/Equation":22,"../math/vec2":30,"./Constraint":14}],17:[function(i,h,k){var q=i("./Constraint"),m=i("../math/vec2"),n=i("../equations/Equation");h.exports=o;function o(A,w,I){I=I||{};q.call(this,A,w,q.LOCK,I);var G=(typeof(I.maxForce)==="undefined"?Number.MAX_VALUE:I.maxForce);var E=I.localOffsetB||m.fromValues(0,0);E=m.fromValues(E[0],E[1]);var z=I.localAngleB||0;var F=new n(A,w,-G,G),D=new n(A,w,-G,G),u=new n(A,w,-G,G);var v=m.create(),B=m.create(),C=this;F.computeGq=function(){m.rotate(v,C.localOffsetB,A.angle);m.sub(B,w.position,A.position);m.sub(B,B,v);return B[0]};D.computeGq=function(){m.rotate(v,C.localOffsetB,A.angle);m.sub(B,w.position,A.position);m.sub(B,B,v);return B[1]};var s=m.create(),H=m.create();u.computeGq=function(){m.rotate(s,C.localOffsetB,w.angle-C.localAngleB);m.scale(s,s,-1);m.sub(B,A.position,w.position);m.add(B,B,s);m.rotate(H,s,-Math.PI/2);m.normalize(H,H);return m.dot(B,H)};this.localOffsetB=E;this.localAngleB=z;this.equations.push(F,D,u);this.setMaxForce(G)}o.prototype=new q();o.prototype.setMaxForce=function(s){var l=this.equations;for(var r=0;r<this.equations.length;r++){l[r].maxForce=s;l[r].minForce=-s}};o.prototype.getMaxForce=function(){return this.equations[0].maxForce};var j=m.create();var e=m.create();var p=m.create();var g=m.fromValues(1,0);var f=m.fromValues(0,1);o.prototype.update=function(){var l=this.equations[0],u=this.equations[1],r=this.equations[2],t=this.bodyA,s=this.bodyB;m.rotate(j,this.localOffsetB,t.angle);m.rotate(e,this.localOffsetB,s.angle-this.localAngleB);m.scale(e,e,-1);m.rotate(p,e,Math.PI/2);m.normalize(p,p);l.G[0]=-1;l.G[1]=0;l.G[2]=-m.crossLength(j,g);l.G[3]=1;u.G[0]=0;u.G[1]=-1;u.G[2]=-m.crossLength(j,f);u.G[4]=1;r.G[0]=-p[0];r.G[1]=-p[1];r.G[3]=p[0];r.G[4]=p[1];r.G[5]=m.crossLength(e,p)}},{"../equations/Equation":22,"../math/vec2":30,"./Constraint":14}],18:[function(i,g,k){var s=i("./Constraint"),m=i("../equations/ContactEquation"),o=i("../equations/Equation"),n=i("../math/vec2"),e=i("../equations/RotationalLockEquation");g.exports=j;function j(x,w,J){J=J||{};s.call(this,x,w,s.PRISMATIC,J);var C=n.fromValues(0,0),y=n.fromValues(1,0),B=n.fromValues(0,0);if(J.localAnchorA){n.copy(C,J.localAnchorA)}if(J.localAxisA){n.copy(y,J.localAxisA)}if(J.localAnchorB){n.copy(B,J.localAnchorB)}this.localAnchorA=C;this.localAnchorB=B;this.localAxisA=y;var G=this.maxForce=typeof(J.maxForce)!="undefined"?J.maxForce:Number.MAX_VALUE;var I=new o(x,w,-G,G);var F=new n.create(),E=new n.create(),D=new n.create(),H=new n.create();I.computeGq=function(){return n.dot(D,H)};I.updateJacobian=function(){var L=this.G,K=x.position,t=w.position;n.rotate(F,C,x.angle);n.rotate(E,B,w.angle);n.add(D,t,E);n.sub(D,D,K);n.sub(D,D,F);n.rotate(H,y,x.angle+Math.PI/2);L[0]=-H[0];L[1]=-H[1];L[2]=-n.crossLength(F,H)+n.crossLength(H,D);L[3]=H[0];L[4]=H[1];L[5]=n.crossLength(E,H)};this.equations.push(I);if(!J.disableRotationalLock){var u=new e(x,w,-G,G);this.equations.push(u)}this.position=0;this.velocity=0;this.lowerLimitEnabled=typeof(J.lowerLimit)!=="undefined"?true:false;this.upperLimitEnabled=typeof(J.upperLimit)!=="undefined"?true:false;this.lowerLimit=typeof(J.lowerLimit)!=="undefined"?J.lowerLimit:0;this.upperLimit=typeof(J.upperLimit)!=="undefined"?J.upperLimit:1;this.upperLimitEquation=new m(x,w);this.lowerLimitEquation=new m(x,w);this.upperLimitEquation.minForce=this.lowerLimitEquation.minForce=0;this.upperLimitEquation.maxForce=this.lowerLimitEquation.maxForce=G;this.motorEquation=new o(x,w);this.motorEnabled=false;this.motorSpeed=0;var A=this;var z=this.motorEquation;var v=z.computeGW;z.computeGq=function(){return 0};z.computeGW=function(){var M=this.G,L=this.bodyA,K=this.bodyB,O=L.velocity,N=K.velocity,t=L.angularVelocity,P=K.angularVelocity;return this.transformedGmult(M,O,t,N,P)+A.motorSpeed}}j.prototype=new s();var r=n.create(),q=n.create(),p=n.create(),h=n.create(),f=n.create(),l=n.create();j.prototype.update=function(){var B=this.equations,H=B[0],w=this.upperLimit,E=this.lowerLimit,F=this.upperLimitEquation,A=this.lowerLimitEquation,u=this.bodyA,t=this.bodyB,v=this.localAxisA,z=this.localAnchorA,y=this.localAnchorB;H.updateJacobian();n.rotate(r,v,u.angle);n.rotate(h,z,u.angle);n.add(q,h,u.position);n.rotate(f,y,t.angle);n.add(p,f,t.position);var x=this.position=n.dot(p,r)-n.dot(q,r);if(this.motorEnabled){var D=this.motorEquation.G;D[0]=r[0];D[1]=r[1];D[2]=n.crossLength(r,f);D[3]=-r[0];D[4]=-r[1];D[5]=-n.crossLength(r,h)}if(this.upperLimitEnabled&&x>w){n.scale(F.normalA,r,-1);n.sub(F.contactPointA,q,u.position);n.sub(F.contactPointB,p,t.position);n.scale(l,r,w);n.add(F.contactPointA,F.contactPointA,l);if(B.indexOf(F)==-1){B.push(F)}}else{var C=B.indexOf(F);if(C!=-1){B.splice(C,1)}}if(this.lowerLimitEnabled&&x<E){n.scale(A.normalA,r,1);n.sub(A.contactPointA,q,u.position);n.sub(A.contactPointB,p,t.position);n.scale(l,r,E);n.sub(A.contactPointB,A.contactPointB,l);if(B.indexOf(A)==-1){B.push(A)}}else{var C=B.indexOf(A);if(C!=-1){B.splice(C,1)}}};j.prototype.enableMotor=function(){if(this.motorEnabled){return}this.equations.push(this.motorEquation);this.motorEnabled=true};j.prototype.disableMotor=function(){if(!this.motorEnabled){return}var t=this.equations.indexOf(this.motorEquation);this.equations.splice(t,1);this.motorEnabled=false}},{"../equations/ContactEquation":21,"../equations/Equation":22,"../equations/RotationalLockEquation":24,"../math/vec2":30,"./Constraint":14}],19:[function(l,j,n){var s=l("./Constraint"),q=l("../equations/Equation"),r=l("../equations/RotationalVelocityEquation"),f=l("../equations/RotationalLockEquation"),p=l("../math/vec2");j.exports=m;var k=p.create(),i=p.create(),h=p.fromValues(1,0),e=p.fromValues(0,1),o=p.create();function m(t,v,g,u,D){D=D||{};s.call(this,t,g,s.REVOLUTE,D);var C=this.maxForce=typeof(D.maxForce)!=="undefined"?D.maxForce:Number.MAX_VALUE;this.pivotA=p.fromValues(v[0],v[1]);this.pivotB=p.fromValues(u[0],u[1]);var z=this.equations=[new q(t,g,-C,C),new q(t,g,-C,C)];var B=z[0];var A=z[1];var w=this;B.computeGq=function(){p.rotate(k,w.pivotA,t.angle);p.rotate(i,w.pivotB,g.angle);p.add(o,g.position,i);p.sub(o,o,t.position);p.sub(o,o,k);return p.dot(o,h)};A.computeGq=function(){p.rotate(k,w.pivotA,t.angle);p.rotate(i,w.pivotB,g.angle);p.add(o,g.position,i);p.sub(o,o,t.position);p.sub(o,o,k);return p.dot(o,e)};A.minForce=B.minForce=-C;A.maxForce=B.maxForce=C;this.motorEquation=new r(t,g);this.motorEnabled=false;this.angle=0;this.lowerLimitEnabled=false;this.upperLimitEnabled=false;this.lowerLimit=0;this.upperLimit=0;this.upperLimitEquation=new f(t,g);this.lowerLimitEquation=new f(t,g);this.upperLimitEquation.minForce=0;this.lowerLimitEquation.maxForce=0}m.prototype=new s();m.prototype.update=function(){var t=this.bodyA,g=this.bodyB,w=this.pivotA,u=this.pivotB,C=this.equations,A=C[0],H=C[1],E=C[0],D=C[1],v=this.upperLimit,G=this.lowerLimit,I=this.upperLimitEquation,B=this.lowerLimitEquation;var z=this.angle=g.angle-t.angle;if(this.upperLimitEnabled&&z>v){I.angle=v;if(C.indexOf(I)==-1){C.push(I)}}else{var F=C.indexOf(I);if(F!=-1){C.splice(F,1)}}if(this.lowerLimitEnabled&&z<G){B.angle=G;if(C.indexOf(B)==-1){C.push(B)}}else{var F=C.indexOf(B);if(F!=-1){C.splice(F,1)}}p.rotate(k,w,t.angle);p.rotate(i,u,g.angle);E.G[0]=-1;E.G[1]=0;E.G[2]=-p.crossLength(k,h);E.G[3]=1;E.G[4]=0;E.G[5]=p.crossLength(i,h);D.G[0]=0;D.G[1]=-1;D.G[2]=-p.crossLength(k,e);D.G[3]=0;D.G[4]=1;D.G[5]=p.crossLength(i,e)};m.prototype.enableMotor=function(){if(this.motorEnabled){return}this.equations.push(this.motorEquation);this.motorEnabled=true};m.prototype.disableMotor=function(){if(!this.motorEnabled){return}var g=this.equations.indexOf(this.motorEquation);this.equations.splice(g,1);this.motorEnabled=false};m.prototype.motorIsEnabled=function(){return !!this.motorEnabled};m.prototype.setMotorSpeed=function(t){if(!this.motorEnabled){return}var g=this.equations.indexOf(this.motorEquation);this.equations[g].relativeVelocity=t};m.prototype.getMotorSpeed=function(){if(!this.motorEnabled){return false}return this.motorEquation.relativeVelocity}},{"../equations/Equation":22,"../equations/RotationalLockEquation":24,"../equations/RotationalVelocityEquation":25,"../math/vec2":30,"./Constraint":14}],20:[function(f,g,e){var i=f("./Equation"),h=f("../math/vec2");g.exports=j;function j(m,l,k){k=k||{};i.call(this,m,l,-Number.MAX_VALUE,Number.MAX_VALUE);this.angle=k.angle||0;this.ratio=typeof(k.ratio)==="number"?k.ratio:1;this.setRatio(this.ratio)}j.prototype=new i();j.prototype.constructor=j;j.prototype.computeGq=function(){return this.ratio*this.bodyA.angle-this.bodyB.angle+this.angle};j.prototype.setRatio=function(l){var k=this.G;k[2]=l;k[5]=-1;this.ratio=l};j.prototype.setMaxTorque=function(k){this.maxForce=k;this.minForce=-k}},{"../math/vec2":30,"./Equation":22}],21:[function(g,h,f){var j=g("./Equation"),i=g("../math/vec2");h.exports=e;function e(l,k){j.call(this,l,k,0,Number.MAX_VALUE);this.contactPointA=i.create();this.penetrationVec=i.create();this.contactPointB=i.create();this.normalA=i.create();this.restitution=0;this.firstImpact=false;this.shapeA=null;this.shapeB=null}e.prototype=new j();e.prototype.constructor=e;e.prototype.computeB=function(D,C,z){var m=this.bodyA,k=this.bodyB,r=this.contactPointA,q=this.contactPointB,v=m.position,u=k.position;var A=this.penetrationVec,w=this.normalA,p=this.G;var s=i.crossLength(r,w),l=i.crossLength(q,w);p[0]=-w[0];p[1]=-w[1];p[2]=-s;p[3]=w[0];p[4]=w[1];p[5]=l;i.add(A,u,q);i.sub(A,A,v);i.sub(A,A,r);var o,y;if(this.firstImpact&&this.restitution!==0){y=0;o=(1/C)*(1+this.restitution)*this.computeGW()}else{y=i.dot(w,A);o=this.computeGW()}var x=this.computeGiMf();var t=-y*D-o*C-z*x;return t}},{"../math/vec2":30,"./Equation":22}],22:[function(n,g,x){g.exports=j;var f=n("../math/vec2"),h=n("../utils/Utils"),q=n("../objects/Body");function j(C,B,z,A){this.minForce=typeof(z)==="undefined"?-Number.MAX_VALUE:z;this.maxForce=typeof(A)==="undefined"?Number.MAX_VALUE:A;this.bodyA=C;this.bodyB=B;this.stiffness=j.DEFAULT_STIFFNESS;this.relaxation=j.DEFAULT_RELAXATION;this.G=new h.ARRAY_TYPE(6);for(var y=0;y<6;y++){this.G[y]=0}this.offset=0;this.a=0;this.b=0;this.epsilon=0;this.timeStep=1/60;this.needsUpdate=true;this.multiplier=0;this.relativeVelocity=0;this.enabled=true}j.prototype.constructor=j;j.DEFAULT_STIFFNESS=1000000;j.DEFAULT_RELAXATION=4;j.prototype.update=function(){var y=this.stiffness,A=this.relaxation,z=this.timeStep;this.a=4/(z*(1+4*A));this.b=(4*A)/(1+4*A);this.epsilon=4/(z*z*y*(1+4*A));this.needsUpdate=false};function e(z,B,y,A,C){return z[0]*B[0]+z[1]*B[1]+z[2]*y+z[3]*A[0]+z[4]*A[1]+z[5]*C}j.prototype.computeB=function(A,y,B){var D=this.computeGW();var C=this.computeGq();var z=this.computeGiMf();return -C*A-D*y-z*B};var l=f.create(),k=f.create();j.prototype.computeGq=function(){var D=this.G,C=this.bodyA,A=this.bodyB,B=C.position,z=A.position,y=C.angle,E=A.angle;return e(D,l,y,k,E)+this.offset};j.prototype.computeGW=function(){var B=this.G,A=this.bodyA,z=this.bodyB,D=A.velocity,C=z.velocity,y=A.angularVelocity,E=z.angularVelocity;return e(B,D,y,C,E)+this.relativeVelocity};j.prototype.computeGWlambda=function(){var B=this.G,A=this.bodyA,z=this.bodyB,D=A.vlambda,C=z.vlambda,y=A.wlambda,E=z.wlambda;return e(B,D,y,C,E)};var s=f.create(),r=f.create();j.prototype.computeGiMf=function(){var B=this.bodyA,A=this.bodyB,J=B.force,z=B.angularForce,I=A.force,y=A.angularForce,D=t(B),C=t(A),F=u(B),E=u(A),H=this.G;f.scale(s,J,D);f.scale(r,I,C);return e(H,s,z*F,r,y*E)};function t(y){if(y.sleepState===q.SLEEPING){return 0}else{return y.invMass}}function u(y){if(y.sleepState===q.SLEEPING){return 0}else{return y.invInertia}}j.prototype.computeGiMGt=function(){var C=this.bodyA,A=this.bodyB,B=t(C),z=t(A),y=u(C),E=u(A),D=this.G;return D[0]*D[0]*B+D[1]*D[1]*B+D[2]*D[2]*y+D[3]*D[3]*z+D[4]*D[4]*z+D[5]*D[5]*E};var i=f.create(),w=f.create(),v=f.create(),p=f.create(),o=f.create(),m=f.create();j.prototype.addToWlambda=function(y){var A=this.bodyA,z=this.bodyB,M=i,E=w,D=v,H=p,F=o,C=t(A),B=t(z),K=u(A),J=u(z),I=m,L=this.G;E[0]=L[0];E[1]=L[1];D[0]=L[3];D[1]=L[4];f.scale(M,E,C*y);f.add(A.vlambda,A.vlambda,M);A.wlambda+=K*L[2]*y;f.scale(M,D,B*y);f.add(z.vlambda,z.vlambda,M);z.wlambda+=J*L[5]*y};j.prototype.computeInvC=function(y){return 1/(this.computeGiMGt()+y)}},{"../math/vec2":30,"../objects/Body":31,"../utils/Utils":47}],23:[function(f,h,e){var j=f("../math/vec2"),i=f("./Equation"),k=f("../utils/Utils");h.exports=g;function g(n,m,l){i.call(this,n,m,-l,l);this.contactPointA=j.create();this.contactPointB=j.create();this.t=j.create();this.contactEquation=null;this.shapeA=null;this.shapeB=null;this.frictionCoefficient=0.3}g.prototype=new i();g.prototype.constructor=g;g.prototype.setSlipForce=function(l){this.maxForce=l;this.minForce=-l};g.prototype.getSlipForce=function(){return this.maxForce};g.prototype.computeB=function(u,r,p){var o=this.bodyA,n=this.bodyB,v=this.contactPointA,s=this.contactPointB,x=this.t,w=this.G;w[0]=-x[0];w[1]=-x[1];w[2]=-j.crossLength(v,x);w[3]=x[0];w[4]=x[1];w[5]=j.crossLength(s,x);var q=this.computeGW(),l=this.computeGiMf();var m=-q*r-p*l;return m}},{"../math/vec2":30,"../utils/Utils":47,"./Equation":22}],24:[function(i,h,k){var n=i("./Equation"),m=i("../math/vec2");h.exports=f;function f(r,q,o){o=o||{};n.call(this,r,q,-Number.MAX_VALUE,Number.MAX_VALUE);this.angle=o.angle||0;var p=this.G;p[2]=1;p[5]=-1}f.prototype=new n();f.prototype.constructor=f;var l=m.create(),j=m.create(),g=m.fromValues(1,0),e=m.fromValues(0,1);f.prototype.computeGq=function(){m.rotate(l,g,this.bodyA.angle+this.angle);m.rotate(j,e,this.bodyB.angle);return m.dot(l,j)}},{"../math/vec2":30,"./Equation":22}],25:[function(f,g,e){var i=f("./Equation"),h=f("../math/vec2");g.exports=j;function j(l,k){i.call(this,l,k,-Number.MAX_VALUE,Number.MAX_VALUE);this.relativeVelocity=1;this.ratio=1}j.prototype=new i();j.prototype.constructor=j;j.prototype.computeB=function(m,k,o){var n=this.G;n[2]=-1;n[5]=this.ratio;var l=this.computeGiMf();var q=this.computeGW();var p=-q*k-o*l;return p}},{"../math/vec2":30,"./Equation":22}],26:[function(f,g,e){var h=function(){};g.exports=h;h.prototype={constructor:h,on:function(k,l,i){l.context=i||this;if(this._listeners===undefined){this._listeners={}}var j=this._listeners;if(j[k]===undefined){j[k]=[]}if(j[k].indexOf(l)===-1){j[k].push(l)}return this},has:function(j,k){if(this._listeners===undefined){return false}var i=this._listeners;if(k){if(i[j]!==undefined&&i[j].indexOf(k)!==-1){return true}}else{if(i[j]!==undefined){return true}}return false},off:function(k,l){if(this._listeners===undefined){return this}var j=this._listeners;var i=j[k].indexOf(l);if(i!==-1){j[k].splice(i,1)}return this},emit:function(o){if(this._listeners===undefined){return this}var n=this._listeners;var j=n[o.type];if(j!==undefined){o.target=this;for(var m=0,k=j.length;m<k;m++){var p=j[m];p.call(p.context,o)}}return this}}},{}],27:[function(g,h,f){var j=g("./Material");var i=g("../equations/Equation");h.exports=e;function e(m,l,k){k=k||{};if(!(m instanceof j)||!(l instanceof j)){throw new Error("First two arguments must be Material instances.")}this.id=e.idCounter++;this.materialA=m;this.materialB=l;this.friction=typeof(k.friction)!=="undefined"?Number(k.friction):0.3;this.restitution=typeof(k.restitution)!=="undefined"?Number(k.restitution):0;this.stiffness=typeof(k.stiffness)!=="undefined"?Number(k.stiffness):i.DEFAULT_STIFFNESS;this.relaxation=typeof(k.relaxation)!=="undefined"?Number(k.relaxation):i.DEFAULT_RELAXATION;this.frictionStiffness=typeof(k.frictionStiffness)!=="undefined"?Number(k.frictionStiffness):i.DEFAULT_STIFFNESS;this.frictionRelaxation=typeof(k.frictionRelaxation)!=="undefined"?Number(k.frictionRelaxation):i.DEFAULT_RELAXATION;this.surfaceVelocity=typeof(k.surfaceVelocity)!=="undefined"?Number(k.surfaceVelocity):0}e.idCounter=0},{"../equations/Equation":22,"./Material":28}],28:[function(f,g,e){g.exports=h;function h(){this.id=h.idCounter++}h.idCounter=0},{}],29:[function(g,h,f){var e={};e.GetArea=function(n){if(n.length<6){return 0}var j=n.length-2;var m=0;for(var k=0;k<j;k+=2){m+=(n[k+2]-n[k])*(n[k+1]+n[k+3])}m+=(n[0]-n[j])*(n[j+1]+n[1]);return -m*0.5};e.Triangulate=function(s){var t=s.length>>1;if(t<3){return[]}var B=[];var r=[];for(var z=0;z<t;z++){r.push(z)}var z=0;var w=t;while(w>3){var x=r[(z+0)%w];var v=r[(z+1)%w];var u=r[(z+2)%w];var q=s[2*x],m=s[2*x+1];var C=s[2*v],A=s[2*v+1];var l=s[2*u],k=s[2*u+1];var o=false;if(e._convex(q,m,C,A,l,k)){o=true;for(var y=0;y<w;y++){var D=r[y];if(D==x||D==v||D==u){continue}if(e._PointInTriangle(s[2*D],s[2*D+1],q,m,C,A,l,k)){o=false;break}}}if(o){B.push(x,v,u);r.splice((z+1)%w,1);w--;z=0}else{if(z++>3*w){break}}}B.push(r[0],r[1],r[2]);return B};e._PointInTriangle=function(y,x,s,r,F,E,o,m){var l=o-s;var k=m-r;var q=F-s;var p=E-r;var D=y-s;var B=x-r;var C=l*l+k*k;var A=l*q+k*p;var z=l*D+k*B;var j=q*q+p*p;var i=q*D+p*B;var n=1/(C*j-A*A);var w=(j*z-A*i)*n;var t=(C*i-A*z)*n;return(w>=0)&&(t>=0)&&(w+t<1)};e._convex=function(k,j,m,l,i,n){return(j-l)*(i-m)+(m-k)*(n-l)>=0};h.exports=e},{}],30:[function(f,g,e){var h=f("../../build/vec2").vec2;h.crossLength=function(j,i){return j[0]*i[1]-j[1]*i[0]};h.crossVZ=function(i,j,k){h.rotate(i,j,-Math.PI/2);h.scale(i,i,k);return i};h.crossZV=function(i,k,j){h.rotate(i,j,Math.PI/2);h.scale(i,i,k);return i};h.rotate=function(k,j,m){var o=Math.cos(m),l=Math.sin(m),i=j[0],n=j[1];k[0]=o*i-l*n;k[1]=l*i+o*n};h.rotate90cw=function(j,i){j[0]=i[1];j[1]=-i[0]};h.toLocalFrame=function(i,l,j,k){h.copy(i,l);h.sub(i,i,j);h.rotate(i,i,-k)};h.toGlobalFrame=function(i,l,j,k){h.copy(i,l);h.rotate(i,i,k);h.add(i,i,j)};h.centroid=function(k,j,i,l){h.add(k,j,i);h.add(k,k,l);h.scale(k,k,1/3);return k};g.exports=h},{"../../build/vec2":1}],31:[function(g,f,k){var n=g("../math/vec2"),m=g("poly-decomp"),h=g("../shapes/Convex"),i=g("../collision/AABB"),t=g("../events/EventEmitter");f.exports=p;function p(u){u=u||{};t.call(this);this.id=++p._idCounter;this.world=null;this.shapes=[];this.shapeOffsets=[];this.shapeAngles=[];this.mass=u.mass||0;this.invMass=0;this.inertia=0;this.invInertia=0;this.fixedRotation=!!u.fixedRotation||false;this.position=n.fromValues(0,0);if(u.position){n.copy(this.position,u.position)}this.interpolatedPosition=n.fromValues(0,0);this.interpolatedAngle=0;this.previousPosition=n.fromValues(0,0);this.previousAngle=0;this.velocity=n.fromValues(0,0);if(u.velocity){n.copy(this.velocity,u.velocity)}this.vlambda=n.fromValues(0,0);this.wlambda=0;this.angle=u.angle||0;this.angularVelocity=u.angularVelocity||0;this.force=n.create();if(u.force){n.copy(this.force,u.force)}this.angularForce=u.angularForce||0;this.damping=typeof(u.damping)=="number"?u.damping:0.1;this.angularDamping=typeof(u.angularDamping)=="number"?u.angularDamping:0.1;this.motionState=this.mass===0?p.STATIC:p.DYNAMIC;this.boundingRadius=0;this.aabb=new i();this.aabbNeedsUpdate=true;this.allowSleep=true;this.wantsToSleep=false;this.sleepState=p.AWAKE;this.sleepSpeedLimit=0.2;this.sleepTimeLimit=1;this.gravityScale=1;this.timeLastSleepy=0;this.concavePath=null;this.lastDampingScale=1;this.lastAngularDampingScale=1;this.lastDampingTimeStep=-1;this._wakeUpAfterNarrowphase=false;this.updateMassProperties()}p.prototype=new t();p._idCounter=0;p.prototype.setDensity=function(u){var v=this.getArea();this.mass=v*u;this.updateMassProperties()};p.prototype.getArea=function(){var u=0;for(var v=0;v<this.shapes.length;v++){u+=this.shapes[v].area}return u};var o=new i(),l=n.create();p.prototype.updateAABB=function(){var u=this.shapes,y=this.shapeOffsets,w=this.shapeAngles,B=u.length;for(var x=0;x!==B;x++){var v=u[x],A=l,z=w[x]+this.angle;n.rotate(A,y[x],this.angle);n.add(A,A,this.position);v.computeAABB(o,A,z);if(x===0){this.aabb.copy(o)}else{this.aabb.extend(o)}}this.aabbNeedsUpdate=false};p.prototype.updateBoundingRadius=function(){var v=this.shapes,z=this.shapeOffsets,B=v.length,u=0;for(var x=0;x!==B;x++){var w=v[x],A=n.length(z[x]),y=w.boundingRadius;if(A+y>u){u=A+y}}this.boundingRadius=u};p.prototype.addShape=function(u,w,v){v=v||0;if(w){w=n.fromValues(w[0],w[1])}else{w=n.fromValues(0,0)}this.shapes.push(u);this.shapeOffsets.push(w);this.shapeAngles.push(v);this.updateMassProperties();this.updateBoundingRadius();this.aabbNeedsUpdate=true};p.prototype.removeShape=function(v){var u=this.shapes.indexOf(v);if(u!==-1){this.shapes.splice(u,1);this.shapeOffsets.splice(u,1);this.shapeAngles.splice(u,1);this.aabbNeedsUpdate=true;return true}else{return false}};p.prototype.updateMassProperties=function(){if(this.motionState===p.STATIC||this.motionState===p.KINEMATIC){this.mass=Number.MAX_VALUE;this.invMass=0;this.inertia=Number.MAX_VALUE;this.invInertia=0}else{var w=this.shapes,B=w.length,u=this.mass/B,y=0;if(!this.fixedRotation){for(var z=0;z<B;z++){var x=w[z],v=n.squaredLength(this.shapeOffsets[z]),A=x.computeMomentOfInertia(u);y+=A+u*v}this.inertia=y;this.invInertia=y>0?1/y:0}else{this.inertia=Number.MAX_VALUE;this.invInertia=0}this.invMass=1/this.mass}};var j=n.create();p.prototype.applyForce=function(x,v){var w=j;n.sub(w,v,this.position);n.add(this.force,this.force,x);var u=n.crossLength(w,x);this.angularForce+=u};p.prototype.toLocalFrame=function(u,v){n.toLocalFrame(u,v,this.position,this.angle)};p.prototype.toWorldFrame=function(u,v){n.toGlobalFrame(u,v,this.position,this.angle)};p.prototype.fromPolygon=function(C,D){D=D||{};for(var x=this.shapes.length;x>=0;--x){this.removeShape(this.shapes[x])}var u=new m.Polygon();u.vertices=C;u.makeCCW();if(typeof(D.removeCollinearPoints)=="number"){u.removeCollinearPoints(D.removeCollinearPoints)}if(typeof(D.skipSimpleCheck)=="undefined"){if(!u.isSimple()){return false}}this.concavePath=u.vertices.slice(0);for(var x=0;x<this.concavePath.length;x++){var B=[0,0];n.copy(B,this.concavePath[x]);this.concavePath[x]=B}var y;if(D.optimalDecomp){y=u.decomp()}else{y=u.quickDecomp()}var A=n.create();for(var x=0;x!==y.length;x++){var z=new h(y[x].vertices);for(var w=0;w!==z.vertices.length;w++){var B=z.vertices[w];n.sub(B,B,z.centerOfMass)}n.scale(A,z.centerOfMass,1);z.updateTriangles();z.updateCenterOfMass();z.updateBoundingRadius();this.addShape(z,A)}this.adjustCenterOfMass();this.aabbNeedsUpdate=true;return true};var e=n.fromValues(0,0),s=n.fromValues(0,0),r=n.fromValues(0,0),q=n.fromValues(0,0);p.prototype.adjustCenterOfMass=function(){var A=s,y=r,u=q,v=0;n.set(y,0,0);for(var w=0;w!==this.shapes.length;w++){var x=this.shapes[w],z=this.shapeOffsets[w];n.scale(A,z,x.area);n.add(y,y,A);v+=x.area}n.scale(u,y,1/v);for(var w=0;w!==this.shapes.length;w++){var x=this.shapes[w],z=this.shapeOffsets[w];if(!z){z=this.shapeOffsets[w]=n.create()}n.sub(z,z,u)}n.add(this.position,this.position,u);for(var w=0;this.concavePath&&w<this.concavePath.length;w++){n.sub(this.concavePath[w],this.concavePath[w],u)}this.updateMassProperties();this.updateBoundingRadius()};p.prototype.setZeroForce=function(){n.set(this.force,0,0);this.angularForce=0};p.prototype.resetConstraintVelocity=function(){var u=this,v=u.vlambda;n.set(v,0,0);u.wlambda=0};p.prototype.addConstraintVelocity=function(){var u=this,w=u.velocity;n.add(w,w,u.vlambda);u.angularVelocity+=u.wlambda};p.prototype.applyDamping=function(w){if(this.motionState===p.DYNAMIC){if(w!==this.lastDampingTimeStep){this.lastDampingScale=Math.pow(1-this.damping,w);this.lastAngularDampingScale=Math.pow(1-this.angularDamping,w);this.lastDampingTimeStep=w}var u=this.velocity;n.scale(u,u,this.lastDampingScale);this.angularVelocity*=this.lastAngularDampingScale}};p.prototype.wakeUp=function(){var u=this.sleepState;this.sleepState=p.AWAKE;this.idleTime=0;if(u!==p.AWAKE){this.emit(p.wakeUpEvent)}};p.prototype.sleep=function(){this.sleepState=p.SLEEPING;this.angularVelocity=0;this.angularForce=0;n.set(this.velocity,0,0);n.set(this.force,0,0);this.emit(p.sleepEvent)};p.prototype.sleepTick=function(z,v,x){if(!this.allowSleep||this.motionState===p.SLEEPING){return}this.wantsToSleep=false;var w=this.sleepState,u=n.squaredLength(this.velocity)+Math.pow(this.angularVelocity,2),y=Math.pow(this.sleepSpeedLimit,2);if(u>=y){this.idleTime=0;this.sleepState=p.AWAKE}else{this.idleTime+=x;this.sleepState=p.SLEEPY}if(this.idleTime>this.sleepTimeLimit){if(!v){this.sleep()}else{this.wantsToSleep=true}}};p.prototype.getVelocityFromPosition=function(u,v){u=u||n.create();n.sub(u,this.position,this.previousPosition);n.scale(u,u,1/v);return u};p.prototype.getAngularVelocityFromPosition=function(u){return(this.angle-this.previousAngle)/u};p.sleepyEvent={type:"sleepy"};p.sleepEvent={type:"sleep"};p.wakeUpEvent={type:"wakeup"};p.DYNAMIC=1;p.STATIC=2;p.KINEMATIC=4;p.AWAKE=0;p.SLEEPY=1;p.SLEEPING=2},{"../collision/AABB":8,"../events/EventEmitter":26,"../math/vec2":30,"../shapes/Convex":36,"poly-decomp":6}],32:[function(g,f,j){var l=g("../math/vec2");var n=g("../utils/Utils");f.exports=e;function e(v,u,t){t=n.defaults(t,{restLength:1,stiffness:100,damping:1,localAnchorA:[0,0],localAnchorB:[0,0]});this.restLength=t.restLength;this.stiffness=t.stiffness;this.damping=t.damping;this.bodyA=v;this.bodyB=u;this.localAnchorA=l.create();l.copy(this.localAnchorA,t.localAnchorA);this.localAnchorB=l.create();l.copy(this.localAnchorB,t.localAnchorB);if(t.worldAnchorA){this.setWorldAnchorA(t.worldAnchorA)}if(t.worldAnchorB){this.setWorldAnchorB(t.worldAnchorB)}}e.prototype.setWorldAnchorA=function(t){this.bodyA.toLocalFrame(this.localAnchorA,t)};e.prototype.setWorldAnchorB=function(t){this.bodyB.toLocalFrame(this.localAnchorB,t)};e.prototype.getWorldAnchorA=function(t){this.bodyA.toWorldFrame(t,this.localAnchorA)};e.prototype.getWorldAnchorB=function(t){this.bodyB.toWorldFrame(t,this.localAnchorB)};var s=l.create(),i=l.create(),q=l.create(),h=l.create(),r=l.create(),p=l.create(),o=l.create(),m=l.create(),k=l.create();e.prototype.applyForce=function(){var y=this.stiffness,E=this.damping,w=this.restLength,x=this.bodyA,v=this.bodyB,t=s,A=i,K=q,C=h,z=k;var J=r,H=p,G=o,F=m;this.getWorldAnchorA(J);this.getWorldAnchorB(H);l.sub(G,J,x.position);l.sub(F,H,v.position);l.sub(t,H,J);var I=l.len(t);l.normalize(A,t);l.sub(K,v.velocity,x.velocity);l.crossZV(z,v.angularVelocity,F);l.add(K,K,z);l.crossZV(z,x.angularVelocity,G);l.sub(K,K,z);l.scale(C,A,-y*(I-w)-E*l.dot(K,A));l.sub(x.force,x.force,C);l.add(v.force,v.force,C);var D=l.crossLength(G,C);var B=l.crossLength(F,C);x.angularForce-=D;v.angularForce+=B}},{"../math/vec2":30,"../utils/Utils":47}],33:[function(f,g,e){g.exports={AABB:f("./collision/AABB"),AngleLockEquation:f("./equations/AngleLockEquation"),Body:f("./objects/Body"),Broadphase:f("./collision/Broadphase"),Capsule:f("./shapes/Capsule"),Circle:f("./shapes/Circle"),Constraint:f("./constraints/Constraint"),ContactEquation:f("./equations/ContactEquation"),ContactMaterial:f("./material/ContactMaterial"),Convex:f("./shapes/Convex"),DistanceConstraint:f("./constraints/DistanceConstraint"),Equation:f("./equations/Equation"),EventEmitter:f("./events/EventEmitter"),FrictionEquation:f("./equations/FrictionEquation"),GearConstraint:f("./constraints/GearConstraint"),GridBroadphase:f("./collision/GridBroadphase"),GSSolver:f("./solver/GSSolver"),Heightfield:f("./shapes/Heightfield"),Line:f("./shapes/Line"),LockConstraint:f("./constraints/LockConstraint"),Material:f("./material/Material"),Narrowphase:f("./collision/Narrowphase"),NaiveBroadphase:f("./collision/NaiveBroadphase"),Particle:f("./shapes/Particle"),Plane:f("./shapes/Plane"),RevoluteConstraint:f("./constraints/RevoluteConstraint"),PrismaticConstraint:f("./constraints/PrismaticConstraint"),Rectangle:f("./shapes/Rectangle"),RotationalVelocityEquation:f("./equations/RotationalVelocityEquation"),SAPBroadphase:f("./collision/SAPBroadphase"),Shape:f("./shapes/Shape"),Solver:f("./solver/Solver"),Spring:f("./objects/Spring"),Utils:f("./utils/Utils"),World:f("./world/World"),vec2:f("./math/vec2"),version:f("../package.json").version}},{"../package.json":7,"./collision/AABB":8,"./collision/Broadphase":9,"./collision/GridBroadphase":10,"./collision/NaiveBroadphase":11,"./collision/Narrowphase":12,"./collision/SAPBroadphase":13,"./constraints/Constraint":14,"./constraints/DistanceConstraint":15,"./constraints/GearConstraint":16,"./constraints/LockConstraint":17,"./constraints/PrismaticConstraint":18,"./constraints/RevoluteConstraint":19,"./equations/AngleLockEquation":20,"./equations/ContactEquation":21,"./equations/Equation":22,"./equations/FrictionEquation":23,"./equations/RotationalVelocityEquation":25,"./events/EventEmitter":26,"./material/ContactMaterial":27,"./material/Material":28,"./math/vec2":30,"./objects/Body":31,"./objects/Spring":32,"./shapes/Capsule":34,"./shapes/Circle":35,"./shapes/Convex":36,"./shapes/Heightfield":37,"./shapes/Line":38,"./shapes/Particle":39,"./shapes/Plane":40,"./shapes/Rectangle":41,"./shapes/Shape":42,"./solver/GSSolver":43,"./solver/Solver":44,"./utils/Utils":47,"./world/World":51}],34:[function(g,h,f){var k=g("./Shape"),i=g("../math/vec2");h.exports=e;function e(m,l){this.length=m||1;this.radius=l||1;k.call(this,k.CAPSULE)}e.prototype=new k();e.prototype.computeMomentOfInertia=function(m){var o=this.radius,l=this.length+o,n=o*2;return m*(n*n+l*l)/12};e.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius+this.length/2};e.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius+this.radius*2*this.length};var j=i.create();e.prototype.computeAABB=function(n,m,o){var l=this.radius;i.set(j,this.length,0);i.rotate(j,j,o);i.set(n.upperBound,Math.max(j[0]+l,-j[0]+l),Math.max(j[1]+l,-j[1]+l));i.set(n.lowerBound,Math.min(j[0]-l,-j[0]-l),Math.min(j[1]-l,-j[1]-l));i.add(n.lowerBound,n.lowerBound,m);i.add(n.upperBound,n.upperBound,m)}},{"../math/vec2":30,"./Shape":42}],35:[function(f,g,e){var j=f("./Shape"),i=f("../math/vec2");g.exports=h;function h(k){this.radius=k||1;j.call(this,j.CIRCLE)}h.prototype=new j();h.prototype.computeMomentOfInertia=function(k){var l=this.radius;return k*l*l/2};h.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius};h.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius};h.prototype.computeAABB=function(l,k,n){var m=this.radius;i.set(l.upperBound,m,m);i.set(l.lowerBound,-m,-m);if(k){i.add(l.lowerBound,l.lowerBound,k);i.add(l.upperBound,l.upperBound,k)}}},{"../math/vec2":30,"./Shape":42}],36:[function(h,f,m){var l=h("./Shape"),p=h("../math/vec2"),e=h("../math/polyk"),n=h("poly-decomp");f.exports=i;function i(x){this.vertices=[];for(var y=0;y<x.length;y++){var w=p.create();p.copy(w,x[y]);this.vertices.push(w)}this.centerOfMass=p.fromValues(0,0);this.triangles=[];if(this.vertices.length){this.updateTriangles();this.updateCenterOfMass()}this.boundingRadius=0;l.call(this,l.CONVEX);this.updateBoundingRadius();this.updateArea();if(this.area<0){throw new Error("Convex vertices must be given in conter-clockwise winding.")}}i.prototype=new l();i.prototype.updateTriangles=function(){this.triangles.length=0;var C=[];for(var z=0;z<this.vertices.length;z++){var w=this.vertices[z];C.push(w[0],w[1])}var B=e.Triangulate(C);for(var z=0;z<B.length;z+=3){var A=B[z],y=B[z+1],x=B[z+2];this.triangles.push([A,y,x])}};var k=p.create(),j=p.create(),s=p.create(),r=p.create(),q=p.create(),o=p.create(),u=p.create(),t=p.create(),g=p.create();i.prototype.updateCenterOfMass=function(){var z=this.triangles,G=this.vertices,H=this.centerOfMass,v=k,w=g,F=s,E=r,D=q,K=o,A=u,y=t,C=j;p.set(H,0,0);var J=0;for(var B=0;B!==z.length;B++){var I=z[B],F=G[I[0]],E=G[I[1]],D=G[I[2]];p.centroid(v,F,E,D);var x=i.triangleArea(F,E,D);J+=x;p.scale(C,v,x);p.add(H,H,C)}p.scale(H,H,1/J)};i.prototype.computeMomentOfInertia=function(A){var y=0,x=0,z=this.vertices.length;for(var v=z-1,w=0;w<z;v=w,w++){var E=this.vertices[v];var D=this.vertices[w];var C=Math.abs(p.crossLength(E,D));var B=p.dot(D,D)+p.dot(D,E)+p.dot(E,E);y+=C*B;x+=C}return(A/6)*(y/x)};i.prototype.updateBoundingRadius=function(){var y=this.vertices,w=0;for(var x=0;x!==y.length;x++){var v=p.squaredLength(y[x]);if(v>w){w=v}}this.boundingRadius=Math.sqrt(w)};i.triangleArea=function(w,v,x){return(((v[0]-w[0])*(x[1]-w[1]))-((x[0]-w[0])*(v[1]-w[1])))*0.5};i.prototype.updateArea=function(){this.updateTriangles();this.area=0;var A=this.triangles,C=this.vertices;for(var z=0;z!==A.length;z++){var y=A[z],x=C[y[0]],w=C[y[1]],B=C[y[2]];var v=i.triangleArea(x,w,B);this.area+=v}};i.prototype.computeAABB=function(w,v,x){w.setFromPoints(this.vertices,v,x)}},{"../math/polyk":29,"../math/vec2":30,"./Shape":42,"poly-decomp":6}],37:[function(f,h,e){var k=f("./Shape"),i=f("../math/vec2"),j=f("../utils/Utils");h.exports=g;function g(o,m){m=j.defaults(m,{maxValue:null,minValue:null,elementWidth:0.1});if(m.minValue===null||m.maxValue===null){m.maxValue=o[0];m.minValue=o[0];for(var n=0;n!==o.length;n++){var l=o[n];if(l>m.maxValue){m.maxValue=l}if(l<m.minValue){m.minValue=l}}}this.data=o;this.maxValue=m.maxValue;this.minValue=m.minValue;this.elementWidth=m.elementWidth;k.call(this,k.HEIGHTFIELD)}g.prototype=new k();g.prototype.computeMomentOfInertia=function(l){return Number.MAX_VALUE};g.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE};g.prototype.updateArea=function(){var n=this.data,m=0;for(var l=0;l<n.length-1;l++){m+=(n[l]+n[l+1])/2*this.elementWidth}this.area=m};g.prototype.computeAABB=function(m,l,n){m.upperBound[0]=this.elementWidth*this.data.length+l[0];m.upperBound[1]=this.maxValue+l[1];m.lowerBound[0]=l[0];m.lowerBound[1]=-Number.MAX_VALUE}},{"../math/vec2":30,"../utils/Utils":47,"./Shape":42}],38:[function(f,g,e){var j=f("./Shape"),i=f("../math/vec2");g.exports=k;function k(l){this.length=l||1;j.call(this,j.LINE)}k.prototype=new j();k.prototype.computeMomentOfInertia=function(l){return l*Math.pow(this.length,2)/12};k.prototype.updateBoundingRadius=function(){this.boundingRadius=this.length/2};var h=[i.create(),i.create()];k.prototype.computeAABB=function(o,m,p){var n=this.length;i.set(h[0],-n/2,0);i.set(h[1],n/2,0);o.setFromPoints(h,m,p)}},{"../math/vec2":30,"./Shape":42}],39:[function(g,h,f){var j=g("./Shape"),i=g("../math/vec2");h.exports=e;function e(){j.call(this,j.PARTICLE)}e.prototype=new j();e.prototype.computeMomentOfInertia=function(k){return 0};e.prototype.updateBoundingRadius=function(){this.boundingRadius=0};e.prototype.computeAABB=function(n,k,o){var m=this.length;i.copy(n.lowerBound,k);i.copy(n.upperBound,k)}},{"../math/vec2":30,"./Shape":42}],40:[function(f,g,e){var k=f("./Shape"),h=f("../math/vec2"),j=f("../utils/Utils");g.exports=i;function i(){k.call(this,k.PLANE)}i.prototype=new k();i.prototype.computeMomentOfInertia=function(l){return 0};i.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE};i.prototype.computeAABB=function(n,l,o){var m=0,p=h.set;if(typeof(o)=="number"){m=o%(2*Math.PI)}if(m==0){p(n.lowerBound,-Number.MAX_VALUE,-Number.MAX_VALUE);p(n.upperBound,Number.MAX_VALUE,0)}else{if(m==Math.PI/2){p(n.lowerBound,0,-Number.MAX_VALUE);p(n.upperBound,Number.MAX_VALUE,Number.MAX_VALUE)}else{if(m==Math.PI){p(n.lowerBound,-Number.MAX_VALUE,0);p(n.upperBound,Number.MAX_VALUE,Number.MAX_VALUE)}else{if(m==3*Math.PI/2){p(n.lowerBound,-Number.MAX_VALUE,-Number.MAX_VALUE);p(n.upperBound,0,Number.MAX_VALUE)}else{p(n.lowerBound,-Number.MAX_VALUE,-Number.MAX_VALUE);p(n.upperBound,Number.MAX_VALUE,Number.MAX_VALUE)}}}}h.add(n.lowerBound,n.lowerBound,l);h.add(n.upperBound,n.upperBound,l)};i.prototype.updateArea=function(){this.area=Number.MAX_VALUE}},{"../math/vec2":30,"../utils/Utils":47,"./Shape":42}],41:[function(h,e,m){var n=h("../math/vec2"),l=h("./Shape"),j=h("./Convex");e.exports=o;function o(q,p){q=q||1;p=p||1;var r=[n.fromValues(-q/2,-p/2),n.fromValues(q/2,-p/2),n.fromValues(q/2,p/2),n.fromValues(-q/2,p/2)];this.width=q;this.height=p;j.call(this,r);this.type=l.RECTANGLE}o.prototype=new j([]);o.prototype.computeMomentOfInertia=function(q){var p=this.width,r=this.height;return q*(r*r+p*p)/12};o.prototype.updateBoundingRadius=function(){var p=this.width,q=this.height;this.boundingRadius=Math.sqrt(p*p+q*q)/2};var k=n.create(),i=n.create(),g=n.create(),f=n.create();o.prototype.computeAABB=function(q,p,r){q.setFromPoints(this.vertices,p,r)};o.prototype.updateArea=function(){this.area=this.width*this.height}},{"../math/vec2":30,"./Convex":36,"./Shape":42}],42:[function(f,g,e){g.exports=h;function h(i){this.type=i;this.id=h.idCounter++;this.boundingRadius=0;this.collisionGroup=1;this.collisionMask=1;if(i){this.updateBoundingRadius()}this.material=null;this.area=0;this.sensor=false;this.updateArea()}h.idCounter=0;h.CIRCLE=1;h.PARTICLE=2;h.PLANE=4;h.CONVEX=8;h.LINE=16;h.RECTANGLE=32;h.CAPSULE=64;h.HEIGHTFIELD=128;h.prototype.computeMomentOfInertia=function(i){throw new Error("Shape.computeMomentOfInertia is not implemented in this Shape...")};h.prototype.updateBoundingRadius=function(){throw new Error("Shape.updateBoundingRadius is not implemented in this Shape...")};h.prototype.updateArea=function(){};h.prototype.computeAABB=function(j,i,k){}},{}],43:[function(g,e,h){var j=g("../math/vec2"),f=g("./Solver"),k=g("../utils/Utils"),m=g("../equations/FrictionEquation");e.exports=i;function i(n){f.call(this,n,f.GS);n=n||{};this.iterations=n.iterations||10;this.tolerance=n.tolerance||1e-10;this.arrayStep=30;this.lambda=new k.ARRAY_TYPE(this.arrayStep);this.Bs=new k.ARRAY_TYPE(this.arrayStep);this.invCs=new k.ARRAY_TYPE(this.arrayStep);this.useZeroRHS=false;this.frictionIterations=0;this.usedIterations=0}i.prototype=new f();function l(o){var n=o.length;while(n--){o[n]=+0}}i.prototype.solve=function(J,C){this.sortEquations();var G=0,r=this.iterations,y=this.frictionIterations,u=this.equations,p=u.length,F=Math.pow(this.tolerance*p,2),t=C.bodies,s=C.bodies.length,x=j.add,w=j.set,o=this.useZeroRHS,v=this.lambda;this.usedIterations=0;if(v.length<p){v=this.lambda=new k.ARRAY_TYPE(p+this.arrayStep);this.Bs=new k.ARRAY_TYPE(p+this.arrayStep);this.invCs=new k.ARRAY_TYPE(p+this.arrayStep)}l(v);var K=this.invCs,n=this.Bs,v=this.lambda;for(var H=0;H!==u.length;H++){var M=u[H];if(M.timeStep!==J||M.needsUpdate){M.timeStep=J;M.update()}n[H]=M.computeB(M.a,M.b,J);K[H]=M.computeInvC(M.epsilon)}var A,z,M,I,H,E;if(p!==0){for(H=0;H!==s;H++){t[H].resetConstraintVelocity()}if(y){for(G=0;G!==y;G++){I=0;for(E=0;E!==p;E++){M=u[E];if(M instanceof m){}var D=i.iterateEquation(E,M,M.epsilon,n,K,v,o,J,G);I+=Math.abs(D)}this.usedIterations++;if(I*I<=F){break}}i.updateMultipliers(u,v,1/J);for(E=0;E!==p;E++){var N=u[E];if(N instanceof m){var L=N.contactEquation.multiplier*N.frictionCoefficient;N.maxForce=L;N.minForce=-L}}}for(G=0;G!==r;G++){I=0;for(E=0;E!==p;E++){M=u[E];var D=i.iterateEquation(E,M,M.epsilon,n,K,v,o,J,G);I+=Math.abs(D)}this.usedIterations++;if(I*I<=F){break}}for(H=0;H!==s;H++){t[H].addConstraintVelocity()}i.updateMultipliers(u,v,1/J)}};i.updateMultipliers=function(n,q,p){var o=n.length;while(o--){n[o].multiplier=q[o]*p}};i.iterateEquation=function(t,D,E,n,u,x,C,r,y){var q=n[t],w=u[t],v=x[t],p=D.computeGWlambda();var A=D.maxForce,o=D.minForce;if(C){q=0}var s=w*(q-p-E*v);var z=v+s;if(z<o*r){s=o*r-v}else{if(z>A*r){s=A*r-v}}x[t]+=s;D.addToWlambda(s);return s}},{"../equations/FrictionEquation":23,"../math/vec2":30,"../utils/Utils":47,"./Solver":44}],44:[function(f,g,e){var j=f("../utils/Utils"),i=f("../events/EventEmitter");g.exports=k;function k(l,m){l=l||{};i.call(this);this.type=m;this.equations=[];this.equationSortFunction=l.equationSortFunction||false}k.prototype=new i();k.prototype.solve=function(l,m){throw new Error("Solver.solve should be implemented by subclasses!")};var h={bodies:[]};k.prototype.solveIsland=function(m,l){this.removeAllEquations();if(l.equations.length){this.addEquations(l.equations);h.bodies.length=0;l.getBodies(h.bodies);if(h.bodies.length){this.solve(m,h)}}};k.prototype.sortEquations=function(){if(this.equationSortFunction){this.equations.sort(this.equationSortFunction)}};k.prototype.addEquation=function(l){if(l.enabled){this.equations.push(l)}};k.prototype.addEquations=function(m){for(var n=0,o=m.length;n!==o;n++){var l=m[n];if(l.enabled){this.equations.push(l)}}};k.prototype.removeEquation=function(l){var m=this.equations.indexOf(l);if(m!==-1){this.equations.splice(m,1)}};k.prototype.removeAllEquations=function(){this.equations.length=0};k.GS=1;k.ISLAND=2},{"../events/EventEmitter":26,"../utils/Utils":47}],45:[function(g,h,e){var i=g("./TupleDictionary");var j=g("./Utils");h.exports=f;function f(){this.overlappingLastState=new i();this.overlappingCurrentState=new i();this.recordPool=[];this.tmpDict=new i();this.tmpArray1=[]}f.prototype.tick=function(){var o=this.overlappingLastState;var p=this.overlappingCurrentState;var m=p.keys.length;while(m--){var n=p.keys[m];this.recordPool.push(p.getByKey(n))}o.reset();o.copy(p);p.reset()};f.prototype.setOverlapping=function(r,o,q,m){var l=this.overlappingLastState;var p=this.overlappingCurrentState;if(!p.get(o.id,m.id)){var n;if(this.recordPool.length){n=this.recordPool.pop()}else{n=new k(r,o,q,m)}p.set(o.id,m.id,n)}};f.prototype.getNewOverlaps=function(l){return this.getDiff(this.overlappingLastState,this.overlappingCurrentState,l)};f.prototype.getEndOverlaps=function(l){return this.getDiff(this.overlappingCurrentState,this.overlappingLastState,l)};f.prototype.getDiff=function(o,m,u){var u=u||[];var s=o;var r=m;u.length=0;var p=r.keys.length;while(p--){var t=r.keys[p];var q=r.data[t];if(!q){throw new Error("Key "+t+" had no data!")}var n=s.data[t];if(!n){u.push(q)}}return u};f.prototype.isNewOverlap=function(n,m){var l=n.id|0,o=m.id|0;return !!!this.overlappingLastState.get(l,o)&&!!this.overlappingCurrentState.get(l,o)};f.prototype.getNewBodyOverlaps=function(l){this.tmpArray1.length=0;var m=this.getNewOverlaps(this.tmpArray1);return this.getBodyDiff(m,l)};f.prototype.getEndBodyOverlaps=function(l){this.tmpArray1.length=0;var m=this.getEndOverlaps(this.tmpArray1);return this.getBodyDiff(m,l)};f.prototype.getBodyDiff=function(q,m){m=m||[];var o=this.tmpDict;var n=q.length;while(n--){var p=q[n];o.set(p.bodyA.id|0,p.bodyB.id|0,p)}n=o.keys.length;while(n--){var p=o.keys[n];m.push(p.bodyA,p.bodyB)}o.reset();return m};function k(o,m,n,l){this.shapeA=m;this.shapeB=l;this.bodyA=o;this.bodyB=n}k.prototype.set=function(o,m,n,l){k.call(this,o,m,n,l)}},{"./TupleDictionary":46,"./Utils":47}],46:[function(f,g,e){var i=f("./Utils");g.exports=h;function h(){this.data=[];this.keys=[]}h.prototype.getKey=function(k,j){k=k|0;j=j|0;if((k|0)===(j|0)){return -1}return((k|0)>(j|0)?(k<<16)|(j&65535):(j<<16)|(k&65535))|0};h.prototype.getByKey=function(j){j=j|0;return this.data[j]};h.prototype.get=function(m,k){m=m|0;k=k|0;var l=this.getKey(m,k)|0;return this.data[l]};h.prototype.set=function(m,k,n){if(!n){throw new Error("No data!")}m=m|0;k=k|0;var l=this.getKey(m,k)|0;if(!this.get(m,k)){this.keys.push(l)}this.data[l]=n;return l};h.prototype.reset=function(){var n=this.data,m=this.keys;var j=m.length|0;while(j--){var k=m[j]|0;n[k]=undefined}m.length=0};h.prototype.copy=function(m){this.reset();i.appendArray(this.keys,m.keys);var j=m.keys.length|0;while(j--){var k=m.keys[j]|0;this.data[k]=m.data[k]}}},{"./Utils":47}],47:[function(f,g,e){g.exports=h;function h(){}h.appendArray=function(l,k){if(k.length<150000){l.push.apply(l,k)}else{for(var m=0,j=k.length;m!==j;++m){l.push(k[m])}}};h.splice=function(n,k,m){m=m||1;for(var l=k,j=n.length-m;l<j;l++){n[l]=n[l+m]}n.length=j};h.ARRAY_TYPE=window.Float32Array||Array;h.extend=function(j,i){for(var k in i){j[k]=i[k]}};h.defaults=function(i,k){i=i||{};for(var j in k){if(!(j in i)){i[j]=k[j]}}return i}},{}],48:[function(g,i,f){var j=g("../objects/Body");i.exports=h;function h(){this.equations=[];this.bodies=[]}h.prototype.reset=function(){this.equations.length=this.bodies.length=0};var e=[];h.prototype.getBodies=function(l){var m=l||[],n=this.equations;e.length=0;for(var o=0;o!==n.length;o++){var k=n[o];if(e.indexOf(k.bodyA.id)===-1){m.push(k.bodyA);e.push(k.bodyA.id)}if(e.indexOf(k.bodyB.id)===-1){m.push(k.bodyB);e.push(k.bodyB.id)}}return m};h.prototype.wantsToSleep=function(){for(var l=0;l<this.bodies.length;l++){var k=this.bodies[l];if(k.motionState===j.DYNAMIC&&!k.wantsToSleep){return false}}return true};h.prototype.sleep=function(){for(var l=0;l<this.bodies.length;l++){var k=this.bodies[l];k.sleep()}return true}},{"../objects/Body":31}],49:[function(f,h,e){var k=f("../math/vec2"),g=f("./Island"),j=f("./IslandNode"),l=f("../objects/Body");h.exports=i;function i(m){this._nodePool=[];this._islandPool=[];this.equations=[];this.islands=[];this.nodes=[];this.queue=[]}i.getUnvisitedNode=function(m){var n=m.length;for(var o=0;o!==n;o++){var p=m[o];if(!p.visited&&p.body.motionState===l.DYNAMIC){return p}}return false};i.prototype.visit=function(r,o,p){o.push(r.body);var n=r.equations.length;for(var q=0;q!==n;q++){var m=r.equations[q];if(p.indexOf(m)===-1){p.push(m)}}};i.prototype.bfs=function(o,n,p){var m=this.queue;m.length=0;m.push(o);o.visited=true;this.visit(o,n,p);while(m.length){var q=m.pop();var r;while((r=i.getUnvisitedNode(q.neighbors))){r.visited=true;this.visit(r,n,p);if(r.body.motionState===l.DYNAMIC){m.push(r)}}}};i.prototype.split=function(y){var m=y.bodies,o=this.nodes,n=this.equations;while(o.length){this._nodePool.push(o.pop())}for(var v=0;v!==m.length;v++){if(this._nodePool.length){var s=this._nodePool.pop();s.reset();s.body=m[v];o.push(s)}else{o.push(new j(m[v]))}}for(var t=0;t!==n.length;t++){var z=n[t],v=m.indexOf(z.bodyA),u=m.indexOf(z.bodyB),r=o[v],p=o[u];r.neighbors.push(p);p.neighbors.push(r);r.equations.push(z);p.equations.push(z)}var x=this.islands;while(x.length){var w=x.pop();w.reset();this._islandPool.push(w)}var q;while((q=i.getUnvisitedNode(o))){var w=this._islandPool.length?this._islandPool.pop():new g();this.bfs(q,w.bodies,w.equations);x.push(w)}return x}},{"../math/vec2":30,"../objects/Body":31,"./Island":48,"./IslandNode":50}],50:[function(f,g,e){g.exports=h;function h(i){this.body=i;this.neighbors=[];this.equations=[];this.visited=false}h.prototype.reset=function(){this.equations.length=0;this.neighbors.length=0;this.visited=false;this.body=null}},{}],51:[function(n,l,U){var O=n("../solver/GSSolver"),af=n("../solver/Solver"),S=n("../collision/NaiveBroadphase"),ab=n("../math/vec2"),X=n("../shapes/Circle"),E=n("../shapes/Rectangle"),G=n("../shapes/Convex"),m=n("../shapes/Line"),w=n("../shapes/Plane"),ae=n("../shapes/Capsule"),ac=n("../shapes/Particle"),D=n("../events/EventEmitter"),C=n("../objects/Body"),q=n("../shapes/Shape"),Y=n("../objects/Spring"),F=n("../material/Material"),v=n("../material/ContactMaterial"),N=n("../constraints/DistanceConstraint"),B=n("../constraints/Constraint"),M=n("../constraints/LockConstraint"),I=n("../constraints/RevoluteConstraint"),u=n("../constraints/PrismaticConstraint"),ad=n("../constraints/GearConstraint"),j=n("../../package.json"),i=n("../collision/Broadphase"),s=n("../collision/SAPBroadphase"),L=n("../collision/Narrowphase"),P=n("../utils/Utils"),e=n("../utils/OverlapKeeper"),f=n("./IslandManager");l.exports=z;if(typeof performance==="undefined"){performance={}}if(!performance.now){var k=Date.now();if(performance.timing&&performance.timing.navigationStart){k=performance.timing.navigationStart}performance.now=function(){return Date.now()-k}}function z(ah){D.apply(this);ah=ah||{};this.springs=[];this.bodies=[];this.disabledBodyCollisionPairs=[];this.solver=ah.solver||new O();this.narrowphase=new L(this);this.islandManager=new f();this.gravity=ab.fromValues(0,-9.78);if(ah.gravity){ab.copy(this.gravity,ah.gravity)}this.frictionGravity=ab.length(this.gravity)||10;this.useWorldGravityAsFrictionGravity=true;this.useFrictionGravityOnZeroGravity=true;this.doProfiling=ah.doProfiling||false;this.lastStepTime=0;this.broadphase=ah.broadphase||new S();this.broadphase.setWorld(this);this.constraints=[];this.defaultMaterial=new F();this.defaultContactMaterial=new v(this.defaultMaterial,this.defaultMaterial);this.lastTimeStep=1/60;this.applySpringForces=true;this.applyDamping=true;this.applyGravity=true;this.solveConstraints=true;this.contactMaterials=[];this.time=0;this.stepping=false;this.bodiesToBeRemoved=[];this.fixedStepTime=0;this.islandSplit=typeof(ah.islandSplit)!=="undefined"?!!ah.islandSplit:false;this.emitImpactEvent=true;this._constraintIdCounter=0;this._bodyIdCounter=0;this.postStepEvent={type:"postStep"};this.addBodyEvent={type:"addBody",body:null};this.removeBodyEvent={type:"removeBody",body:null};this.addSpringEvent={type:"addSpring",spring:null};this.impactEvent={type:"impact",bodyA:null,bodyB:null,shapeA:null,shapeB:null,contactEquation:null};this.postBroadphaseEvent={type:"postBroadphase",pairs:null};this.enableBodySleeping=false;this.enableIslandSleeping=false;this.beginContactEvent={type:"beginContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null,contactEquations:[]};this.endContactEvent={type:"endContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null};this.preSolveEvent={type:"preSolve",contactEquations:null,frictionEquations:null};this.overlappingShapesLastState={keys:[]};this.overlappingShapesCurrentState={keys:[]};this.overlapKeeper=new e()}z.prototype=new Object(D.prototype);z.prototype.addConstraint=function(ah){this.constraints.push(ah)};z.prototype.addContactMaterial=function(ah){this.contactMaterials.push(ah)};z.prototype.removeContactMaterial=function(ai){var ah=this.contactMaterials.indexOf(ai);if(ah!==-1){P.splice(this.contactMaterials,ah,1)}};z.prototype.getContactMaterial=function(al,ak){var aj=this.contactMaterials;for(var ai=0,am=aj.length;ai!==am;ai++){var ah=aj[ai];if((ah.materialA===al)&&(ah.materialB===ak)||(ah.materialA===ak)&&(ah.materialB===al)){return ah}}return false};z.prototype.removeConstraint=function(ai){var ah=this.constraints.indexOf(ai);if(ah!==-1){P.splice(this.constraints,ah,1)}};var aa=ab.create(),p=ab.create(),Z=ab.create(),h=ab.create(),T=ab.create(),t=ab.create(),W=ab.create(),K=ab.fromValues(0,0),y=ab.fromValues(0,0),g=ab.fromValues(0,0),H=ab.fromValues(0,0);z.prototype.step=function(ah,an,ai){ai=ai||10;an=an||0;if(an===0){this.internalStep(ah);this.time+=ah}else{var ap=Math.floor((this.time+an)/ah)-Math.floor(this.time/ah);ap=Math.min(ap,ai);for(var ak=0;ak!==ap;ak++){this.internalStep(ah)}this.time+=an;var al=this.time%ah;var am=al/ah;for(var aj=0;aj!==this.bodies.length;aj++){var ao=this.bodies[aj];if(ao.motionState!==C.STATIC&&ao.sleepState!==C.SLEEPING){ab.sub(H,ao.position,ao.previousPosition);ab.scale(H,H,am);ab.add(ao.interpolatedPosition,ao.position,H);ao.interpolatedAngle=ao.angle+(ao.angle-ao.previousAngle)*am}else{ab.copy(ao.interpolatedPosition,ao.position);ao.interpolatedAngle=ao.angle}}}};var A=[];z.prototype.internalStep=function(ap){this.stepping=true;var aN=this,an=this.doProfiling,aH=this.springs.length,aA=this.springs,a5=this.bodies,a2=this.gravity,aD=this.solver,ao=this.bodies.length,aM=this.broadphase,a6=this.narrowphase,al=this.constraints,aL,aK,aE=T,aY=t,aw=W,aJ=ab.scale,am=ab.add,a4=ab.rotate,aB=this.islandManager;this.lastTimeStep=ap;if(an){aL=performance.now()}if(this.useWorldGravityAsFrictionGravity){var ah=ab.length(this.gravity);if(ah===0&&this.useFrictionGravityOnZeroGravity){}else{this.frictionGravity=ah}}if(this.applyGravity){for(var a0=0;a0!==ao;a0++){var ba=a5[a0],aI=ba.force;if(ba.motionState!==C.DYNAMIC||ba.sleepState===C.SLEEPING){continue}ab.scale(aw,a2,ba.mass*ba.gravityScale);am(aI,aI,aw)}}if(this.applySpringForces){for(var a0=0;a0!==aH;a0++){var aQ=aA[a0];aQ.applyForce()}}if(this.applyDamping){for(var a0=0;a0!==ao;a0++){var ba=a5[a0];if(ba.motionState===C.DYNAMIC){ba.applyDamping(ap)}}}var az=aM.getCollisionPairs(this);var aT=this.disabledBodyCollisionPairs;for(var a0=aT.length-2;a0>=0;a0-=2){for(var aZ=az.length-2;aZ>=0;aZ-=2){if((aT[a0]===az[aZ]&&aT[a0+1]===az[aZ+1])||(aT[a0+1]===az[aZ]&&aT[a0]===az[aZ+1])){az.splice(aZ,2)}}}var ak=al.length;for(a0=0;a0!==ak;a0++){var a9=al[a0];if(!a9.collideConnected){for(var aZ=az.length-2;aZ>=0;aZ-=2){if((a9.bodyA===az[aZ]&&a9.bodyB===az[aZ+1])||(a9.bodyB===az[aZ]&&a9.bodyA===az[aZ+1])){az.splice(aZ,2)}}}}this.postBroadphaseEvent.pairs=az;this.emit(this.postBroadphaseEvent);a6.reset(this);for(var a0=0,aF=az.length;a0!==aF;a0+=2){var a3=az[a0],a1=az[a0+1];for(var aX=0,at=a3.shapes.length;aX!==at;aX++){var ay=a3.shapes[aX],aP=a3.shapeOffsets[aX],av=a3.shapeAngles[aX];for(var aV=0,ar=a1.shapes.length;aV!==ar;aV++){var ax=a1.shapes[aV],aO=a1.shapeOffsets[aV],au=a1.shapeAngles[aV];var aG=this.defaultContactMaterial;if(ay.material&&ax.material){var aS=this.getContactMaterial(ay.material,ax.material);if(aS){aG=aS}}this.runNarrowphase(a6,a3,ay,aP,av,a1,ax,aO,au,aG,this.frictionGravity)}}}for(var a0=0;a0!==ao;a0++){var aC=a5[a0];if(aC._wakeUpAfterNarrowphase){aC.wakeUp();aC._wakeUpAfterNarrowphase=false}}if(this.has("endContact")){this.overlapKeeper.getEndOverlaps(A);var a7=this.endContactEvent;var aV=A.length;while(aV--){var a8=A[aV];a7.shapeA=a8.shapeA;a7.shapeB=a8.shapeB;a7.bodyA=a8.bodyA;a7.bodyB=a8.bodyA;this.emit(a7)}}this.overlapKeeper.tick();var aq=this.preSolveEvent;aq.contactEquations=a6.contactEquations;aq.frictionEquations=a6.frictionEquations;this.emit(aq);var ak=al.length;for(a0=0;a0!==ak;a0++){al[a0].update()}if(a6.contactEquations.length||a6.frictionEquations.length||al.length){if(this.islandSplit){aB.equations.length=0;P.appendArray(aB.equations,a6.contactEquations);P.appendArray(aB.equations,a6.frictionEquations);for(a0=0;a0!==ak;a0++){P.appendArray(aB.equations,al[a0].equations)}aB.split(this);for(var a0=0;a0!==aB.islands.length;a0++){var aW=aB.islands[a0];if(aW.equations.length){aD.solveIsland(ap,aW)}}}else{aD.addEquations(a6.contactEquations);aD.addEquations(a6.frictionEquations);for(a0=0;a0!==ak;a0++){aD.addEquations(al[a0].equations)}if(this.solveConstraints){aD.solve(ap,this)}aD.removeAllEquations()}}for(var a0=0;a0!==ao;a0++){var aC=a5[a0];if(aC.sleepState!==C.SLEEPING&&aC.motionState!==C.STATIC){z.integrateBody(aC,ap)}}for(var a0=0;a0!==ao;a0++){a5[a0].setZeroForce()}if(an){aK=performance.now();aN.lastStepTime=aK-aL}if(this.emitImpactEvent&&this.has("impact")){var aR=this.impactEvent;for(var a0=0;a0!==a6.contactEquations.length;a0++){var aU=a6.contactEquations[a0];if(aU.firstImpact){aR.bodyA=aU.bodyA;aR.bodyB=aU.bodyB;aR.shapeA=aU.shapeA;aR.shapeB=aU.shapeB;aR.contactEquation=aU;this.emit(aR)}}}if(this.enableBodySleeping){for(a0=0;a0!==ao;a0++){a5[a0].sleepTick(this.time,false,ap)}}else{if(this.enableIslandSleeping&&this.islandSplit){for(a0=0;a0!==ao;a0++){a5[a0].sleepTick(this.time,true,ap)}for(var a0=0;a0<this.islandManager.islands.length;a0++){var aW=this.islandManager.islands[a0];if(aW.wantsToSleep()){aW.sleep()}}}}this.stepping=false;if(this.bodiesToBeRemoved.length){for(var a0=0;a0!==this.bodiesToBeRemoved.length;a0++){this.removeBody(this.bodiesToBeRemoved[a0])}this.bodiesToBeRemoved.length=0}this.emit(this.postStepEvent)};var o=ab.create();var J=ab.create();z.integrateBody=function(ah,ak){var ai=ah.invMass,al=ah.force,am=ah.position,aj=ah.velocity;ab.copy(ah.previousPosition,ah.position);ah.previousAngle=ah.angle;if(!ah.fixedRotation){ah.angularVelocity+=ah.angularForce*ah.invInertia*ak;ah.angle+=ah.angularVelocity*ak}ab.scale(o,al,ak*ai);ab.add(aj,o,aj);ab.scale(J,aj,ak);ab.add(am,am,J);ah.aabbNeedsUpdate=true};z.prototype.runNarrowphase=function(ah,am,aH,ax,aA,ak,aG,aw,az,ar,al){if(!((aH.collisionGroup&aG.collisionMask)!==0&&(aG.collisionGroup&aH.collisionMask)!==0)){return}ab.rotate(K,ax,am.angle);ab.rotate(y,aw,ak.angle);ab.add(K,K,am.position);ab.add(y,y,ak.position);var aF=aA+am.angle;var ao=az+ak.angle;ah.enableFriction=ar.friction>0;ah.frictionCoefficient=ar.friction;var an;if(am.motionState===C.STATIC||am.motionState===C.KINEMATIC){an=ak.mass}else{if(ak.motionState===C.STATIC||ak.motionState===C.KINEMATIC){an=am.mass}else{an=(am.mass*ak.mass)/(am.mass+ak.mass)}}ah.slipForce=ar.friction*al*an;ah.restitution=ar.restitution;ah.surfaceVelocity=ar.surfaceVelocity;ah.frictionStiffness=ar.frictionStiffness;ah.frictionRelaxation=ar.frictionRelaxation;ah.stiffness=ar.stiffness;ah.relaxation=ar.relaxation;var ap=ah[aH.type|aG.type],aJ=0;if(ap){var aB=aH.sensor||aG.sensor;var aE=ah.frictionEquations.length;if(aH.type<aG.type){aJ=ap.call(ah,am,aH,K,aF,ak,aG,y,ao,aB)}else{aJ=ap.call(ah,ak,aG,y,ao,am,aH,K,aF,aB)}var aI=ah.frictionEquations.length-aE;if(aJ){if(am.allowSleep&&am.motionState===C.DYNAMIC&&am.sleepState===C.SLEEPING&&ak.sleepState===C.AWAKE&&ak.motionState!==C.STATIC){var aq=ab.squaredLength(ak.velocity)+Math.pow(ak.angularVelocity,2);var au=Math.pow(ak.sleepSpeedLimit,2);if(aq>=au*2){am._wakeUpAfterNarrowphase=true}}if(ak.allowSleep&&ak.motionState===C.DYNAMIC&&ak.sleepState===C.SLEEPING&&am.sleepState===C.AWAKE&&am.motionState!==C.STATIC){var at=ab.squaredLength(am.velocity)+Math.pow(am.angularVelocity,2);var av=Math.pow(am.sleepSpeedLimit,2);if(at>=av*2){ak._wakeUpAfterNarrowphase=true}}this.overlapKeeper.setOverlapping(am,aH,ak,aG);if(this.has("beginContact")&&this.overlapKeeper.isNewOverlap(aH,aG)){var aD=this.beginContactEvent;aD.shapeA=aH;aD.shapeB=aG;aD.bodyA=am;aD.bodyB=ak;aD.contactEquations.length=0;if(typeof(aJ)==="number"){for(var ay=ah.contactEquations.length-aJ;ay<ah.contactEquations.length;ay++){aD.contactEquations.push(ah.contactEquations[ay])}}this.emit(aD)}if(typeof(aJ)==="number"&&aI>1){for(var ay=ah.frictionEquations.length-aI;ay<ah.frictionEquations.length;ay++){var aC=ah.frictionEquations[ay];aC.setSlipForce(aC.getSlipForce()/aI)}}}}};z.prototype.addSpring=function(ah){this.springs.push(ah);this.addSpringEvent.spring=ah;this.emit(this.addSpringEvent)};z.prototype.removeSpring=function(ai){var ah=this.springs.indexOf(ai);if(ah===-1){P.splice(this.springs,ah,1)}};z.prototype.addBody=function(ah){if(this.bodies.indexOf(ah)===-1){this.bodies.push(ah);ah.world=this;this.addBodyEvent.body=ah;this.emit(this.addBodyEvent)}};z.prototype.removeBody=function(ai){if(this.stepping){this.bodiesToBeRemoved.push(ai)}else{ai.world=null;var ah=this.bodies.indexOf(ai);if(ah!==-1){P.splice(this.bodies,ah,1);this.removeBodyEvent.body=ai;ai.resetConstraintVelocity();this.emit(this.removeBodyEvent)}}};z.prototype.getBodyById=function(ak){var ai=this.bodies;for(var aj=0;aj<ai.length;aj++){var ah=ai[aj];if(ah.id===ak){return ah}}return false};z.prototype.disableBodyCollision=function(ai,ah){this.disabledBodyCollisionPairs.push(ai,ah)};z.prototype.enableBodyCollision=function(ak,aj){var ai=this.disabledBodyCollisionPairs;for(var ah=0;ah<ai.length;ah+=2){if((ai[ah]===ak&&ai[ah+1]===aj)||(ai[ah+1]===ak&&ai[ah]===aj)){ai.splice(ah,2);return}}};function ag(ah){if(!ah){return ah}return[ah[0],ah[1]]}function x(ai,ah){for(var aj in ah){ai[aj]=ah[aj]}}function r(ah){return{id:ah.id,materialA:ah.materialA.id,materialB:ah.materialB.id,friction:ah.friction,restitution:ah.restitution,stiffness:ah.stiffness,relaxation:ah.relaxation,frictionStiffness:ah.frictionStiffness,frictionRelaxation:ah.frictionRelaxation}}z.prototype.toJSON=function(){var an=this;var av={p2:j.version,bodies:[],springs:[],solver:{},gravity:ag(an.gravity),broadphase:{},distanceConstraints:[],revoluteConstraints:[],prismaticConstraints:[],lockConstraints:[],gearConstraints:[],contactMaterials:[],materials:[],defaultContactMaterial:r(an.defaultContactMaterial),islandSplit:an.islandSplit,enableIslandSleeping:an.enableIslandSleeping,enableBodySleeping:an.enableBodySleeping};var am=av.solver,aj=an.solver;if(aj.type===af.GS){am.type="GSSolver";am.iterations=aj.iterations}var aB=av.broadphase,ai=an.broadphase;if(ai.type===i.NAIVE){aB.type="NaiveBroadphase"}else{if(ai.type===i.SAP){aB.type="SAPBroadphase"}else{console.error("Broadphase not supported: "+ai.type)}}for(var au=0;au!==an.springs.length;au++){var aj=an.springs[au];av.springs.push({bodyA:an.bodies.indexOf(aj.bodyA),bodyB:an.bodies.indexOf(aj.bodyB),stiffness:aj.stiffness,damping:aj.damping,restLength:aj.restLength,localAnchorA:ag(aj.localAnchorA),localAnchorB:ag(aj.localAnchorB)})}for(var au=0;au<an.constraints.length;au++){var aw=an.constraints[au];var aA={bodyA:an.bodies.indexOf(aw.bodyA),bodyB:an.bodies.indexOf(aw.bodyB),collideConnected:aw.collideConnected};switch(aw.type){case B.DISTANCE:x(aA,{distance:aw.distance,maxForce:aw.getMaxForce()});av.distanceConstraints.push(aA);break;case B.REVOLUTE:x(aA,{pivotA:ag(aw.pivotA),pivotB:ag(aw.pivotB),maxForce:aw.maxForce,motorSpeed:aw.getMotorSpeed()||0,motorEnabled:!!aw.getMotorSpeed(),lowerLimit:aw.lowerLimit,lowerLimitEnabled:aw.lowerLimitEnabled,upperLimit:aw.upperLimit,upperLimitEnabled:aw.upperLimitEnabled});av.revoluteConstraints.push(aA);break;case B.PRISMATIC:x(aA,{localAxisA:ag(aw.localAxisA),localAnchorA:ag(aw.localAnchorA),localAnchorB:ag(aw.localAnchorB),maxForce:aw.maxForce,upperLimitEnabled:aw.upperLimitEnabled,lowerLimitEnabled:aw.lowerLimitEnabled,upperLimit:aw.upperLimit,lowerLimit:aw.lowerLimit,motorEnabled:aw.motorEnabled,motorSpeed:aw.motorSpeed});av.prismaticConstraints.push(aA);break;case B.LOCK:x(aA,{localOffsetB:ag(aw.localOffsetB),localAngleB:aw.localAngleB,maxForce:aw.getMaxForce()});av.lockConstraints.push(aA);break;case B.GEAR:x(aA,{angle:aw.angle,ratio:aw.ratio,maxForce:aw.maxForce||1000000});av.gearConstraints.push(aA);break;default:console.error("Constraint not supported yet: ",aw.type);break}}for(var au=0;au!==an.bodies.length;au++){var ax=an.bodies[au],aq=ax.shapes,ap={id:ax.id,mass:ax.mass,angle:ax.angle,position:ag(ax.position),velocity:ag(ax.velocity),angularVelocity:ax.angularVelocity,force:ag(ax.force),motionState:ax.motionState,fixedRotation:ax.fixedRotation,circleShapes:[],planeShapes:[],particleShapes:[],lineShapes:[],rectangleShapes:[],convexShapes:[],capsuleShapes:[]};if(ax.concavePath){ap.concavePath=ax.concavePath}for(var at=0;at<aq.length;at++){var aj=aq[at],ak={};ak.offset=ag(ax.shapeOffsets[at]);ak.angle=ax.shapeAngles[at];ak.collisionGroup=aj.collisionGroup;ak.collisionMask=aj.collisionMask;ak.material=aj.material?aj.material.id:null;switch(aj.type){case q.CIRCLE:x(ak,{radius:aj.radius});ap.circleShapes.push(ak);break;case q.PLANE:ap.planeShapes.push(ak);break;case q.PARTICLE:ap.particleShapes.push(ak);break;case q.LINE:ak.length=aj.length;ap.lineShapes.push(ak);break;case q.RECTANGLE:x(ak,{width:aj.width,height:aj.height});ap.rectangleShapes.push(ak);break;case q.CONVEX:var az=[];for(var ar=0;ar<aj.vertices.length;ar++){az.push(ag(aj.vertices[ar]))}x(ak,{vertices:az});ap.convexShapes.push(ak);break;case q.CAPSULE:x(ak,{length:aj.length,radius:aj.radius});ap.capsuleShapes.push(ak);break;default:console.error("Shape type not supported yet!");break}}av.bodies.push(ap)}for(var au=0;au<an.contactMaterials.length;au++){var ah=an.contactMaterials[au];av.contactMaterials.push(r(ah))}var ay={};for(var au=0;au<an.contactMaterials.length;au++){var ah=an.contactMaterials[au];ay[ah.materialA.id+""]=ah.materialA;ay[ah.materialB.id+""]=ah.materialB}for(var al in ay){var ao=ay[parseInt(al)];av.materials.push({id:ao.id})}return av};z.prototype.fromJSON=function(ax){this.clear();if(!ax.p2){return false}var am=this;ab.copy(am.gravity,ax.gravity);am.islandSplit=ax.islandSplit;am.enableIslandSleeping=ax.enableIslandSleeping;am.enableBodySleeping=ax.enableBodySleeping;switch(ax.solver.type){case"GSSolver":var aq=ax.solver,an=new O();am.solver=an;an.iterations=aq.iterations;break;default:throw new Error("Solver type not recognized: "+ax.solver.type)}switch(ax.broadphase.type){case"NaiveBroadphase":am.broadphase=new S();break;case"SAPBroadphase":am.broadphase=new s();break}am.broadphase.setWorld(am);var ak=am.bodies;var ar={};for(var av=0;av!==ax.materials.length;av++){var aw=ax.materials[av];var at=new F();ar[aw.id+""]=at;at.id=aw.id}am.defaultMaterial.id=ax.defaultContactMaterial.materialA;for(var av=0;av!==ax.bodies.length;av++){var aB=ax.bodies[av];var az=new C({mass:aB.mass,position:aB.position,angle:aB.angle,velocity:aB.velocity,angularVelocity:aB.angularVelocity,force:aB.force,fixedRotation:aB.fixedRotation});az.id=aB.id;az.motionState=aB.motionState;for(var au=0;au<aB.circleShapes.length;au++){var an=aB.circleShapes[au];ah(az,new X(an.radius),an)}for(var au=0;au<aB.planeShapes.length;au++){var an=aB.planeShapes[au];ah(az,new w(),an)}for(var au=0;au<aB.particleShapes.length;au++){var an=aB.particleShapes[au];ah(az,new ac(),an)}for(var au=0;au<aB.lineShapes.length;au++){var an=aB.lineShapes[au];ah(az,new m(an.length),an)}for(var au=0;au<aB.rectangleShapes.length;au++){var an=aB.rectangleShapes[au];ah(az,new E(an.width,an.height),an)}for(var au=0;au<aB.convexShapes.length;au++){var an=aB.convexShapes[au];ah(az,new G(an.vertices),an)}for(var au=0;au<aB.capsuleShapes.length;au++){var an=aB.capsuleShapes[au];ah(az,new ae(an.length,an.radius),an)}function ah(aD,aF,aE){aF.collisionMask=aE.collisionMask;aF.collisionGroup=aE.collisionGroup;if(aE.material){aF.material=ar[aE.material+""]}aD.addShape(aF,aE.offset,aE.angle)}if(aB.concavePath){az.concavePath=aB.concavePath}am.addBody(az)}for(var av=0;av<ax.springs.length;av++){var aq=ax.springs[av];var aj=ak[aq.bodyA],ai=ak[aq.bodyB];if(!aj){this.error="instance.springs["+av+"] references instance.body["+aq.bodyA+"], which does not exist.";return false}if(!ai){this.error="instance.springs["+av+"] references instance.body["+aq.bodyB+"], which does not exist.";return false}var an=new Y(aj,ai,{stiffness:aq.stiffness,damping:aq.damping,restLength:aq.restLength,localAnchorA:aq.localAnchorA,localAnchorB:aq.localAnchorB});am.addSpring(an)}for(var av=0;av<ax.contactMaterials.length;av++){var aw=ax.contactMaterials[av],aC=ar[aw.materialA+""],aA=ar[aw.materialB+""];if(!aC){this.error="Reference to material id "+aw.materialA+": material not found";return false}if(!aA){this.error="Reference to material id "+aw.materialB+": material not found";return false}var al=new v(aC,aA,{friction:aw.friction,restitution:aw.restitution,stiffness:aw.stiffness,relaxation:aw.relaxation,frictionStiffness:aw.frictionStiffness,frictionRelaxation:aw.frictionRelaxation});al.id=aw.id;am.addContactMaterial(al)}var aw=ax.defaultContactMaterial,aC=am.defaultMaterial,aA=am.defaultMaterial;var al=new v(aC,aA,{friction:aw.friction,restitution:aw.restitution,stiffness:aw.stiffness,relaxation:aw.relaxation,frictionStiffness:aw.frictionStiffness,frictionRelaxation:aw.frictionRelaxation});al.id=aw.id;am.defaultContactMaterial=al;for(var av=0;av<ax.distanceConstraints.length;av++){var ay=ax.distanceConstraints[av];am.addConstraint(new N(ak[ay.bodyA],ak[ay.bodyB],ay.distance,{maxForce:ay.maxForce,collideConnected:ay.collideConnected}))}for(var av=0;av<ax.revoluteConstraints.length;av++){var ay=ax.revoluteConstraints[av];var ao=new I(ak[ay.bodyA],ay.pivotA,ak[ay.bodyB],ay.pivotB,{maxForce:ay.maxForce,collideConnected:ay.collideConnected});if(ay.motorEnabled){ao.enableMotor()}ao.setMotorSpeed(ay.motorSpeed);ao.lowerLimit=ay.lowerLimit;ao.upperLimit=ay.upperLimit;ao.lowerLimitEnabled=ay.lowerLimitEnabled;ao.upperLimitEnabled=ay.upperLimitEnabled;am.addConstraint(ao)}for(var av=0;av<ax.prismaticConstraints.length;av++){var ay=ax.prismaticConstraints[av],ap=new u(ak[ay.bodyA],ak[ay.bodyB],{maxForce:ay.maxForce,localAxisA:ay.localAxisA,localAnchorA:ay.localAnchorA,localAnchorB:ay.localAnchorB,collideConnected:ay.collideConnected});ap.motorSpeed=ay.motorSpeed;am.addConstraint(ap)}for(var av=0;av<ax.lockConstraints.length;av++){var ay=ax.lockConstraints[av];am.addConstraint(new M(ak[ay.bodyA],ak[ay.bodyB],{maxForce:ay.maxForce,localOffsetB:ay.localOffsetB,localAngleB:ay.localAngleB,collideConnected:ay.collideConnected}))}for(var av=0;av<ax.gearConstraints.length;av++){var ay=ax.gearConstraints[av];am.addConstraint(new ad(ak[ay.bodyA],ak[ay.bodyB],{maxForce:ay.maxForce,angle:ay.angle,ratio:ay.ratio,collideConnected:ay.collideConnected}))}return true};z.prototype.clear=function(){this.time=0;this.fixedStepTime=0;if(this.solver&&this.solver.equations.length){this.solver.removeAllEquations()}var al=this.constraints;for(var ak=al.length-1;ak>=0;ak--){this.removeConstraint(al[ak])}var ah=this.bodies;for(var ak=ah.length-1;ak>=0;ak--){this.removeBody(ah[ak])}var aj=this.springs;for(var ak=aj.length-1;ak>=0;ak--){this.removeSpring(aj[ak])}var ai=this.contactMaterials;for(var ak=ai.length-1;ak>=0;ak--){this.removeContactMaterial(ai[ak])}z.apply(this)};z.prototype.clone=function(){var ah=new z();ah.fromJSON(this.toJSON());return ah};var R=ab.create(),V=ab.fromValues(0,0),Q=ab.fromValues(0,0);z.prototype.hitTest=function(aj,am,ay){ay=ay||0;var ah=new C({position:aj}),au=new ac(),ar=aj,ai=0,an=R,ap=V,aA=Q;ah.addShape(au);var at=this.narrowphase,ao=[];for(var aw=0,al=am.length;aw!==al;aw++){var aB=am[aw];for(var av=0,ax=aB.shapes.length;av!==ax;av++){var aq=aB.shapes[av],ak=aB.shapeOffsets[av]||ap,az=aB.shapeAngles[av]||0;ab.rotate(an,ak,aB.angle);ab.add(an,an,aB.position);var aC=az+aB.angle;if((aq instanceof X&&at.circleParticle(aB,aq,an,aC,ah,au,ar,ai,true))||(aq instanceof G&&at.particleConvex(ah,au,ar,ai,aB,aq,an,aC,true))||(aq instanceof w&&at.particlePlane(ah,au,ar,ai,aB,aq,an,aC,true))||(aq instanceof ae&&at.particleCapsule(ah,au,ar,ai,aB,aq,an,aC,true))||(aq instanceof ac&&ab.squaredLength(ab.sub(aA,an,aj))<ay*ay)){ao.push(aB)}}}return ao};z.prototype.setGlobalEquationParameters=function(ak){ak=ak||{};for(var aj=0;aj!==this.constraints.length;aj++){var al=this.constraints[aj];for(var ai=0;ai!==al.equations.length;ai++){var ah=al.equations[ai];if(typeof(ak.stiffness)!=="undefined"){ah.stiffness=ak.stiffness}if(typeof(ak.relaxation)!=="undefined"){ah.relaxation=ak.relaxation}ah.needsUpdate=true}}for(var aj=0;aj!==this.contactMaterials.length;aj++){var al=this.contactMaterials[aj];if(typeof(ak.stiffness)!=="undefined"){al.stiffness=ak.stiffness;al.frictionStiffness=ak.stiffness}if(typeof(ak.relaxation)!=="undefined"){al.relaxation=ak.relaxation;al.frictionRelaxation=ak.relaxation}}var al=this.defaultContactMaterial;if(typeof(ak.stiffness)!=="undefined"){al.stiffness=ak.stiffness;al.frictionStiffness=ak.stiffness}if(typeof(ak.relaxation)!=="undefined"){al.relaxation=ak.relaxation;al.frictionRelaxation=ak.relaxation}};z.prototype.setGlobalStiffness=function(ah){this.setGlobalEquationParameters({stiffness:ah})};z.prototype.setGlobalRelaxation=function(ah){this.setGlobalEquationParameters({relaxation:ah})}},{"../../package.json":7,"../collision/Broadphase":9,"../collision/NaiveBroadphase":11,"../collision/Narrowphase":12,"../collision/SAPBroadphase":13,"../constraints/Constraint":14,"../constraints/DistanceConstraint":15,"../constraints/GearConstraint":16,"../constraints/LockConstraint":17,"../constraints/PrismaticConstraint":18,"../constraints/RevoluteConstraint":19,"../events/EventEmitter":26,"../material/ContactMaterial":27,"../material/Material":28,"../math/vec2":30,"../objects/Body":31,"../objects/Spring":32,"../shapes/Capsule":34,"../shapes/Circle":35,"../shapes/Convex":36,"../shapes/Line":38,"../shapes/Particle":39,"../shapes/Plane":40,"../shapes/Rectangle":41,"../shapes/Shape":42,"../solver/GSSolver":43,"../solver/Solver":44,"../utils/OverlapKeeper":45,"../utils/Utils":47,"./IslandManager":49}]},{},[33])(33)});p2.Body.prototype.parent=null;p2.Spring.prototype.parent=null;Phaser.Physics.P2=function(a,b){this.game=a;if(typeof b==="undefined"||!b.hasOwnProperty("gravity")||!b.hasOwnProperty("broadphase")){b={gravity:[0,0],broadphase:new p2.SAPBroadphase()}}this.world=new p2.World(b);this.frameRate=1/60;this.useElapsedTime=false;this.paused=false;this.materials=[];this.gravity=new Phaser.Physics.P2.InversePointProxy(this,this.world.gravity);this.walls={left:null,right:null,top:null,bottom:null};this.onBodyAdded=new Phaser.Signal();this.onBodyRemoved=new Phaser.Signal();this.onSpringAdded=new Phaser.Signal();this.onSpringRemoved=new Phaser.Signal();this.onConstraintAdded=new Phaser.Signal();this.onConstraintRemoved=new Phaser.Signal();this.onContactMaterialAdded=new Phaser.Signal();this.onContactMaterialRemoved=new Phaser.Signal();this.postBroadphaseCallback=null;this.callbackContext=null;this.onBeginContact=new Phaser.Signal();this.onEndContact=new Phaser.Signal();if(b.hasOwnProperty("mpx")&&b.hasOwnProperty("pxm")&&b.hasOwnProperty("mpxi")&&b.hasOwnProperty("pxmi")){this.mpx=b.mpx;this.mpxi=b.mpxi;this.pxm=b.pxm;this.pxmi=b.pxmi}this.world.on("beginContact",this.beginContactHandler,this);this.world.on("endContact",this.endContactHandler,this);this.collisionGroups=[];this.nothingCollisionGroup=new Phaser.Physics.P2.CollisionGroup(1);this.boundsCollisionGroup=new Phaser.Physics.P2.CollisionGroup(2);this.everythingCollisionGroup=new Phaser.Physics.P2.CollisionGroup(2147483648);this.boundsCollidesWith=[];this._toRemove=[];this._collisionGroupID=2;this.setBoundsToWorld(true,true,true,true,false)};Phaser.Physics.P2.prototype={removeBodyNextStep:function(a){this._toRemove.push(a)},preUpdate:function(){var a=this._toRemove.length;while(a--){this.removeBody(this._toRemove[a])}this._toRemove.length=0},enable:function(b,a,d){if(typeof a==="undefined"){a=false}if(typeof d==="undefined"){d=true}var c=1;if(Array.isArray(b)){c=b.length;while(c--){if(b[c] instanceof Phaser.Group){this.enable(b[c].children,a,d)}else{this.enableBody(b[c],a);if(d&&b[c].hasOwnProperty("children")&&b[c].children.length>0){this.enable(b[c],a,true)}}}}else{if(b instanceof Phaser.Group){this.enable(b.children,a,d)}else{this.enableBody(b,a);if(d&&b.hasOwnProperty("children")&&b.children.length>0){this.enable(b.children,a,true)}}}},enableBody:function(b,a){if(b.hasOwnProperty("body")&&b.body===null){b.body=new Phaser.Physics.P2.Body(this.game,b,b.x,b.y,1);b.body.debug=a;b.anchor.set(0.5)}},setImpactEvents:function(a){if(a){this.world.on("impact",this.impactHandler,this)}else{this.world.off("impact",this.impactHandler,this)}},setPostBroadphaseCallback:function(b,a){this.postBroadphaseCallback=b;this.callbackContext=a;if(b!==null){this.world.on("postBroadphase",this.postBroadphaseHandler,this)}else{this.world.off("postBroadphase",this.postBroadphaseHandler,this)}},postBroadphaseHandler:function(b){if(this.postBroadphaseCallback){var a=b.pairs.length;while(a-=2){if(b.pairs[a].parent&&b.pairs[a+1].parent&&!this.postBroadphaseCallback.call(this.callbackContext,b.pairs[a].parent,b.pairs[a+1].parent)){b.pairs.splice(a,2)}}}},impactHandler:function(e){if(e.bodyA.parent&&e.bodyB.parent){var d=e.bodyA.parent;var c=e.bodyB.parent;if(d._bodyCallbacks[e.bodyB.id]){d._bodyCallbacks[e.bodyB.id].call(d._bodyCallbackContext[e.bodyB.id],d,c,e.shapeA,e.shapeB)}if(c._bodyCallbacks[e.bodyA.id]){c._bodyCallbacks[e.bodyA.id].call(c._bodyCallbackContext[e.bodyA.id],c,d,e.shapeB,e.shapeA)}if(d._groupCallbacks[e.shapeB.collisionGroup]){d._groupCallbacks[e.shapeB.collisionGroup].call(d._groupCallbackContext[e.shapeB.collisionGroup],d,c,e.shapeA,e.shapeB)}if(c._groupCallbacks[e.shapeA.collisionGroup]){c._groupCallbacks[e.shapeA.collisionGroup].call(c._groupCallbackContext[e.shapeA.collisionGroup],c,d,e.shapeB,e.shapeA)}}},beginContactHandler:function(a){this.onBeginContact.dispatch(a.bodyA,a.bodyB,a.shapeA,a.shapeB,a.contactEquations);if(a.bodyA.parent){a.bodyA.parent.onBeginContact.dispatch(a.bodyB.parent,a.shapeA,a.shapeB,a.contactEquations)}if(a.bodyB.parent){a.bodyB.parent.onBeginContact.dispatch(a.bodyA.parent,a.shapeB,a.shapeA,a.contactEquations)}},endContactHandler:function(a){this.onEndContact.dispatch(a.bodyA,a.bodyB,a.shapeA,a.shapeB);if(a.bodyA.parent){a.bodyA.parent.onEndContact.dispatch(a.bodyB.parent,a.shapeA,a.shapeB)}if(a.bodyB.parent){a.bodyB.parent.onEndContact.dispatch(a.bodyA.parent,a.shapeB,a.shapeA)}},setBoundsToWorld:function(e,b,d,a,c){this.setBounds(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,e,b,d,a,c)},setWorldMaterial:function(c,e,b,d,a){if(typeof e==="undefined"){e=true}if(typeof b==="undefined"){b=true}if(typeof d==="undefined"){d=true}if(typeof a==="undefined"){a=true}if(e&&this.walls.left){this.walls.left.shapes[0].material=c}if(b&&this.walls.right){this.walls.right.shapes[0].material=c}if(d&&this.walls.top){this.walls.top.shapes[0].material=c}if(a&&this.walls.bottom){this.walls.bottom.shapes[0].material=c}},updateBoundsCollisionGroup:function(b){var a=this.everythingCollisionGroup.mask;if(typeof b==="undefined"){a=this.boundsCollisionGroup.mask}if(this.walls.left){this.walls.left.shapes[0].collisionGroup=a}if(this.walls.right){this.walls.right.shapes[0].collisionGroup=a}if(this.walls.top){this.walls.top.shapes[0].collisionGroup=a}if(this.walls.bottom){this.walls.bottom.shapes[0].collisionGroup=a}},setBounds:function(g,e,b,i,c,h,f,a,d){if(typeof c==="undefined"){c=true}if(typeof h==="undefined"){h=true}if(typeof f==="undefined"){f=true}if(typeof a==="undefined"){a=true}if(typeof d==="undefined"){d=true}if(this.walls.left){this.world.removeBody(this.walls.left)}if(this.walls.right){this.world.removeBody(this.walls.right)}if(this.walls.top){this.world.removeBody(this.walls.top)}if(this.walls.bottom){this.world.removeBody(this.walls.bottom)}if(c){this.walls.left=new p2.Body({mass:0,position:[this.pxmi(g),this.pxmi(e)],angle:1.5707963267948966});this.walls.left.addShape(new p2.Plane());if(d){this.walls.left.shapes[0].collisionGroup=this.boundsCollisionGroup.mask}this.world.addBody(this.walls.left)}if(h){this.walls.right=new p2.Body({mass:0,position:[this.pxmi(g+b),this.pxmi(e)],angle:-1.5707963267948966});this.walls.right.addShape(new p2.Plane());if(d){this.walls.right.shapes[0].collisionGroup=this.boundsCollisionGroup.mask}this.world.addBody(this.walls.right)}if(f){this.walls.top=new p2.Body({mass:0,position:[this.pxmi(g),this.pxmi(e)],angle:-3.141592653589793});this.walls.top.addShape(new p2.Plane());if(d){this.walls.top.shapes[0].collisionGroup=this.boundsCollisionGroup.mask}this.world.addBody(this.walls.top)}if(a){this.walls.bottom=new p2.Body({mass:0,position:[this.pxmi(g),this.pxmi(e+i)]});this.walls.bottom.addShape(new p2.Plane());if(d){this.walls.bottom.shapes[0].collisionGroup=this.boundsCollisionGroup.mask}this.world.addBody(this.walls.bottom)}},pause:function(){this.paused=true},resume:function(){this.paused=false},update:function(){if(this.paused){return}if(this.useElapsedTime){this.world.step(this.game.time.physicsElapsed)}else{this.world.step(this.frameRate)}},clear:function(){this.world.clear();this.world.off("beginContact",this.beginContactHandler,this);this.world.off("endContact",this.endContactHandler,this);this.postBroadphaseCallback=null;this.callbackContext=null;this.impactCallback=null;this.collisionGroups=[];this._toRemove=[];this._collisionGroupID=2;this.boundsCollidesWith=[]},destroy:function(){this.clear();this.game=null},addBody:function(a){if(a.data.world){return false}else{this.world.addBody(a.data);this.onBodyAdded.dispatch(a);return true}},removeBody:function(a){if(a.data.world==this.world){this.world.removeBody(a.data);this.onBodyRemoved.dispatch(a)}return a},addSpring:function(a){this.world.addSpring(a);this.onSpringAdded.dispatch(a);return a},removeSpring:function(a){this.world.removeSpring(a);this.onSpringRemoved.dispatch(a);return a},createDistanceConstraint:function(c,b,d,a){c=this.getBody(c);b=this.getBody(b);if(!c||!b){console.warn("Cannot create Constraint, invalid body objects given")}else{return this.addConstraint(new Phaser.Physics.P2.DistanceConstraint(this,c,b,d,a))}},createGearConstraint:function(d,b,c,a){d=this.getBody(d);b=this.getBody(b);if(!d||!b){console.warn("Cannot create Constraint, invalid body objects given")}else{return this.addConstraint(new Phaser.Physics.P2.GearConstraint(this,d,b,c,a))}},createRevoluteConstraint:function(e,d,c,b,a){e=this.getBody(e);c=this.getBody(c);if(!e||!c){console.warn("Cannot create Constraint, invalid body objects given")}else{return this.addConstraint(new Phaser.Physics.P2.RevoluteConstraint(this,e,d,c,b,a))}},createLockConstraint:function(e,b,d,c,a){e=this.getBody(e);b=this.getBody(b);if(!e||!b){console.warn("Cannot create Constraint, invalid body objects given")}else{return this.addConstraint(new Phaser.Physics.P2.LockConstraint(this,e,b,d,c,a))}},createPrismaticConstraint:function(g,f,c,b,a,d,e){g=this.getBody(g);f=this.getBody(f);if(!g||!f){console.warn("Cannot create Constraint, invalid body objects given")}else{return this.addConstraint(new Phaser.Physics.P2.PrismaticConstraint(this,g,f,c,b,a,d,e))}},addConstraint:function(a){this.world.addConstraint(a);this.onConstraintAdded.dispatch(a);return a},removeConstraint:function(a){this.world.removeConstraint(a);this.onConstraintRemoved.dispatch(a);return a},addContactMaterial:function(a){this.world.addContactMaterial(a);this.onContactMaterialAdded.dispatch(a);return a},removeContactMaterial:function(a){this.world.removeContactMaterial(a);this.onContactMaterialRemoved.dispatch(a);return a},getContactMaterial:function(b,a){return this.world.getContactMaterial(b,a)},setMaterial:function(c,a){var b=a.length;while(b--){a[b].setMaterial(c)}},createMaterial:function(b,a){b=b||"";var c=new Phaser.Physics.P2.Material(b);this.materials.push(c);if(typeof a!=="undefined"){a.setMaterial(c)}return c},createContactMaterial:function(d,c,b){if(typeof d==="undefined"){d=this.createMaterial()}if(typeof c==="undefined"){c=this.createMaterial()}var a=new Phaser.Physics.P2.ContactMaterial(d,c,b);return this.addContactMaterial(a)},getBodies:function(){var a=[];var b=this.world.bodies.length;while(b--){a.push(this.world.bodies[b].parent)}return a},getBody:function(a){if(a instanceof p2.Body){return a}else{if(a instanceof Phaser.Physics.P2.Body){return a.data}else{if(a.body&&a.body.type===Phaser.Physics.P2JS){return a.body.data}}}return null},getSprings:function(){var a=[];var b=this.world.springs.length;while(b--){a.push(this.world.springs[b].parent)}return a},getConstraints:function(){var a=[];var b=this.world.constraints.length;while(b--){a.push(this.world.constraints[b].parent)}return a},hitTest:function(e,c,b,g){if(typeof c==="undefined"){c=this.world.bodies}if(typeof b==="undefined"){b=5}if(typeof g==="undefined"){g=false}var a=[this.pxmi(e.x),this.pxmi(e.y)];var f=[];var d=c.length;while(d--){if(c[d] instanceof Phaser.Physics.P2.Body&&!(g&&c[d].data.motionState===p2.Body.STATIC)){f.push(c[d].data)}else{if(c[d] instanceof p2.Body&&c[d].parent&&!(g&&c[d].motionState===p2.Body.STATIC)){f.push(c[d])}else{if(c[d] instanceof Phaser.Sprite&&c[d].hasOwnProperty("body")&&!(g&&c[d].body.data.motionState===p2.Body.STATIC)){f.push(c[d].body.data)}}}}return this.world.hitTest(a,f,b)},toJSON:function(){return this.world.toJSON()},createCollisionGroup:function(b){var a=Math.pow(2,this._collisionGroupID);if(this.walls.left){this.walls.left.shapes[0].collisionMask=this.walls.left.shapes[0].collisionMask|a}if(this.walls.right){this.walls.right.shapes[0].collisionMask=this.walls.right.shapes[0].collisionMask|a}if(this.walls.top){this.walls.top.shapes[0].collisionMask=this.walls.top.shapes[0].collisionMask|a}if(this.walls.bottom){this.walls.bottom.shapes[0].collisionMask=this.walls.bottom.shapes[0].collisionMask|a}this._collisionGroupID++;var c=new Phaser.Physics.P2.CollisionGroup(a);this.collisionGroups.push(c);if(b){this.setCollisionGroup(b,c)}return c},setCollisionGroup:function(a,c){if(a instanceof Phaser.Group){for(var b=0;b<a.total;b++){if(a.children[b]["body"]&&a.children[b]["body"].type===Phaser.Physics.P2JS){a.children[b].body.setCollisionGroup(c)}}}else{a.body.setCollisionGroup(c)}},createSpring:function(d,c,a,g,e,i,h,f,b){d=this.getBody(d);c=this.getBody(c);if(!d||!c){console.warn("Cannot create Spring, invalid body objects given")}else{return this.addSpring(new Phaser.Physics.P2.Spring(this,d,c,a,g,e,i,h,f,b))}},createBody:function(c,h,e,f,d,g){if(typeof f==="undefined"){f=false}var b=new Phaser.Physics.P2.Body(this.game,null,c,h,e);if(g){var a=b.addPolygon(d,g);if(!a){return false}}if(f){this.world.addBody(b.data)}return b},createParticle:function(c,h,e,f,d,g){if(typeof f==="undefined"){f=false}var b=new Phaser.Physics.P2.Body(this.game,null,c,h,e);if(g){var a=b.addPolygon(d,g);if(!a){return false}}if(f){this.world.addBody(b.data)}return b},convertCollisionObjects:function(h,f,g){if(typeof g==="undefined"){g=true}var c=[];for(var e=0,b=h.collision[f].length;e<b;e++){var d=h.collision[f][e];var a=this.createBody(d.x,d.y,0,g,{},d.polyline);if(a){c.push(a)}}return c},clearTilemapLayerBodies:function(c,b){b=c.getLayer(b);var a=c.layers[b].bodies.length;while(a--){c.layers[b].bodies[a].destroy()}c.layers[b].bodies.length=0},convertTilemap:function(a,f,c,j){f=a.getLayer(f);if(typeof c==="undefined"){c=true}if(typeof j==="undefined"){j=true}this.clearTilemapLayerBodies(a,f);var b=0;var m=0;var k=0;for(var i=0,d=a.layers[f].height;i<d;i++){b=0;for(var l=0,n=a.layers[f].width;l<n;l++){var g=a.layers[f].data[i][l];if(g&&g.index>-1&&g.collides){if(j){var o=a.getTileRight(f,l,i);if(b===0){m=g.x*g.width;k=g.y*g.height;b=g.width}if(o&&o.collides){b+=g.width}else{var e=this.createBody(m,k,0,false);e.addRectangle(b,g.height,b/2,g.height/2,0);if(c){this.addBody(e)}a.layers[f].bodies.push(e);b=0}}else{var e=this.createBody(g.x*g.width,g.y*g.height,0,false);e.addRectangle(g.width,g.height,g.width/2,g.height/2,0);if(c){this.addBody(e)}a.layers[f].bodies.push(e)}}}}return a.layers[f].bodies},mpx:function(a){return a*=20},pxm:function(a){return a*0.05},mpxi:function(a){return a*=-20},pxmi:function(a){return a*-0.05}};Object.defineProperty(Phaser.Physics.P2.prototype,"friction",{get:function(){return this.world.defaultContactMaterial.friction},set:function(a){this.world.defaultContactMaterial.friction=a}});Object.defineProperty(Phaser.Physics.P2.prototype,"defaultFriction",{get:function(){return this.world.defaultContactMaterial.friction},set:function(a){this.world.defaultContactMaterial.friction=a}});Object.defineProperty(Phaser.Physics.P2.prototype,"restitution",{get:function(){return this.world.defaultContactMaterial.restitution},set:function(a){this.world.defaultContactMaterial.restitution=a}});Object.defineProperty(Phaser.Physics.P2.prototype,"defaultRestitution",{get:function(){return this.world.defaultContactMaterial.restitution},set:function(a){this.world.defaultContactMaterial.restitution=a}});Object.defineProperty(Phaser.Physics.P2.prototype,"contactMaterial",{get:function(){return this.world.defaultContactMaterial},set:function(a){this.world.defaultContactMaterial=a}});Object.defineProperty(Phaser.Physics.P2.prototype,"applySpringForces",{get:function(){return this.world.applySpringForces},set:function(a){this.world.applySpringForces=a}});Object.defineProperty(Phaser.Physics.P2.prototype,"applyDamping",{get:function(){return this.world.applyDamping},set:function(a){this.world.applyDamping=a}});Object.defineProperty(Phaser.Physics.P2.prototype,"applyGravity",{get:function(){return this.world.applyGravity},set:function(a){this.world.applyGravity=a}});Object.defineProperty(Phaser.Physics.P2.prototype,"solveConstraints",{get:function(){return this.world.solveConstraints},set:function(a){this.world.solveConstraints=a}});Object.defineProperty(Phaser.Physics.P2.prototype,"time",{get:function(){return this.world.time}});Object.defineProperty(Phaser.Physics.P2.prototype,"emitImpactEvent",{get:function(){return this.world.emitImpactEvent},set:function(a){this.world.emitImpactEvent=a}});Object.defineProperty(Phaser.Physics.P2.prototype,"enableBodySleeping",{get:function(){return this.world.enableBodySleeping},set:function(a){this.world.enableBodySleeping=a}});Object.defineProperty(Phaser.Physics.P2.prototype,"total",{get:function(){return this.world.bodies.length}});Phaser.Physics.P2.FixtureList=function(a){if(!Array.isArray(a)){a=[a]}this.rawList=a;this.init();this.parse(this.rawList)};Phaser.Physics.P2.FixtureList.prototype={init:function(){this.namedFixtures={};this.groupedFixtures=[];this.allFixtures=[]},setCategory:function(b,a){var c=function(d){d.collisionGroup=b};this.getFixtures(a).forEach(c)},setMask:function(b,a){var c=function(d){d.collisionMask=b};this.getFixtures(a).forEach(c)},setSensor:function(b,a){var c=function(d){d.sensor=b};this.getFixtures(a).forEach(c)},setMaterial:function(b,a){var c=function(d){d.material=b};this.getFixtures(a).forEach(c)},getFixtures:function(c){var b=[];if(c){if(!(c instanceof Array)){c=[c]}var a=this;c.forEach(function(d){if(a.namedFixtures[d]){b.push(a.namedFixtures[d])}});return this.flatten(b)}else{return this.allFixtures}},getFixtureByKey:function(a){return this.namedFixtures[a]},getGroup:function(a){return this.groupedFixtures[a]},parse:function(){var b,d,c,a;c=this.rawList;a=[];for(b in c){d=c[b];if(!isNaN(b-0)){this.groupedFixtures[b]=this.groupedFixtures[b]||[];this.groupedFixtures[b]=this.groupedFixtures[b].concat(d)}else{this.namedFixtures[b]=this.flatten(d)}a.push(this.allFixtures=this.flatten(this.groupedFixtures))}},flatten:function(c){var a,b;a=[];b=arguments.callee;c.forEach(function(d){return Array.prototype.push.apply(a,(Array.isArray(d)?b(d):[d]))});return a}};Phaser.Physics.P2.PointProxy=function(b,a){this.world=b;this.destination=a};Phaser.Physics.P2.PointProxy.prototype.constructor=Phaser.Physics.P2.PointProxy;Object.defineProperty(Phaser.Physics.P2.PointProxy.prototype,"x",{get:function(){return this.destination[0]},set:function(a){this.destination[0]=this.world.pxm(a)}});Object.defineProperty(Phaser.Physics.P2.PointProxy.prototype,"y",{get:function(){return this.destination[1]},set:function(a){this.destination[1]=this.world.pxm(a)}});Phaser.Physics.P2.InversePointProxy=function(b,a){this.world=b;this.destination=a};Phaser.Physics.P2.InversePointProxy.prototype.constructor=Phaser.Physics.P2.InversePointProxy;Object.defineProperty(Phaser.Physics.P2.InversePointProxy.prototype,"x",{get:function(){return this.destination[0]},set:function(a){this.destination[0]=this.world.pxm(-a)}});Object.defineProperty(Phaser.Physics.P2.InversePointProxy.prototype,"y",{get:function(){return this.destination[1]},set:function(a){this.destination[1]=this.world.pxm(-a)}});Phaser.Physics.P2.Body=function(b,d,a,e,c){d=d||null;a=a||0;e=e||0;if(typeof c==="undefined"){c=1}this.game=b;this.world=b.physics.p2;this.sprite=d;this.type=Phaser.Physics.P2JS;this.offset=new Phaser.Point();this.data=new p2.Body({position:[this.world.pxmi(a),this.world.pxmi(e)],mass:c});this.data.parent=this;this.velocity=new Phaser.Physics.P2.InversePointProxy(this.world,this.data.velocity);this.force=new Phaser.Physics.P2.InversePointProxy(this.world,this.data.force);this.gravity=new Phaser.Point();this.onBeginContact=new Phaser.Signal();this.onEndContact=new Phaser.Signal();this.collidesWith=[];this.removeNextStep=false;this.debugBody=null;this._collideWorldBounds=true;this._bodyCallbacks={};this._bodyCallbackContext={};this._groupCallbacks={};this._groupCallbackContext={};if(d){this.setRectangleFromSprite(d);if(d.exists){this.game.physics.p2.addBody(this)}}};Phaser.Physics.P2.Body.prototype={createBodyCallback:function(b,d,a){var c=-1;if(b.id){c=b.id}else{if(b.body){c=b.body.id}}if(c>-1){if(d===null){delete (this._bodyCallbacks[c]);delete (this._bodyCallbackContext[c])}else{this._bodyCallbacks[c]=d;this._bodyCallbackContext[c]=a}}},createGroupCallback:function(b,c,a){if(c===null){delete (this._groupCallbacks[b.mask]);delete (this._groupCallbacksContext[b.mask])}else{this._groupCallbacks[b.mask]=c;this._groupCallbackContext[b.mask]=a}},getCollisionMask:function(){var a=0;if(this._collideWorldBounds){a=this.game.physics.p2.boundsCollisionGroup.mask}for(var b=0;b<this.collidesWith.length;b++){a=a|this.collidesWith[b].mask}return a},updateCollisionMask:function(b){var a=this.getCollisionMask();if(typeof b==="undefined"){for(var c=this.data.shapes.length-1;c>=0;c--){this.data.shapes[c].collisionMask=a}}else{b.collisionMask=a}},setCollisionGroup:function(d,b){var a=this.getCollisionMask();if(typeof b==="undefined"){for(var c=this.data.shapes.length-1;c>=0;c--){this.data.shapes[c].collisionGroup=d.mask;this.data.shapes[c].collisionMask=a}}else{b.collisionGroup=d.mask;b.collisionMask=a}},clearCollision:function(b,d,a){if(typeof a==="undefined"){for(var c=this.data.shapes.length-1;c>=0;c--){if(b){this.data.shapes[c].collisionGroup=null}if(d){this.data.shapes[c].collisionMask=null}}}else{if(b){a.collisionGroup=null}if(d){a.collisionMask=null}}if(b){this.collidesWith.length=0}},collides:function(e,f,c,b){if(Array.isArray(e)){for(var d=0;d<e.length;d++){if(this.collidesWith.indexOf(e[d])===-1){this.collidesWith.push(e[d]);if(f){this.createGroupCallback(e[d],f,c)}}}}else{if(this.collidesWith.indexOf(e)===-1){this.collidesWith.push(e);if(f){this.createGroupCallback(e,f,c)}}}var a=this.getCollisionMask();if(typeof b==="undefined"){for(var d=this.data.shapes.length-1;d>=0;d--){this.data.shapes[d].collisionMask=a}}else{b.collisionMask=a}},adjustCenterOfMass:function(){this.data.adjustCenterOfMass()},applyDamping:function(a){this.data.applyDamping(a)},applyForce:function(c,b,a){this.data.applyForce(c,[this.world.pxmi(b),this.world.pxmi(a)])},setZeroForce:function(){this.data.setZeroForce()},setZeroRotation:function(){this.data.angularVelocity=0},setZeroVelocity:function(){this.data.velocity[0]=0;this.data.velocity[1]=0},setZeroDamping:function(){this.data.damping=0;this.data.angularDamping=0},toLocalFrame:function(a,b){return this.data.toLocalFrame(a,b)},toWorldFrame:function(a,b){return this.data.toWorldFrame(a,b)},rotateLeft:function(a){this.data.angularVelocity=this.world.pxm(-a)},rotateRight:function(a){this.data.angularVelocity=this.world.pxm(a)},moveForward:function(b){var a=this.world.pxmi(-b);var c=this.data.angle+Math.PI/2;this.data.velocity[0]=a*Math.cos(c);this.data.velocity[1]=a*Math.sin(c)},moveBackward:function(b){var a=this.world.pxmi(-b);var c=this.data.angle+Math.PI/2;this.data.velocity[0]=-(a*Math.cos(c));this.data.velocity[1]=-(a*Math.sin(c))},thrust:function(b){var a=this.world.pxmi(-b);var c=this.data.angle+Math.PI/2;this.data.force[0]+=a*Math.cos(c);this.data.force[1]+=a*Math.sin(c)},reverse:function(b){var a=this.world.pxmi(-b);var c=this.data.angle+Math.PI/2;this.data.force[0]-=a*Math.cos(c);this.data.force[1]-=a*Math.sin(c)},moveLeft:function(a){this.data.velocity[0]=this.world.pxmi(-a)},moveRight:function(a){this.data.velocity[0]=this.world.pxmi(a)},moveUp:function(a){this.data.velocity[1]=this.world.pxmi(-a)},moveDown:function(a){this.data.velocity[1]=this.world.pxmi(a)},preUpdate:function(){if(this.removeNextStep){this.removeFromWorld();this.removeNextStep=false}},postUpdate:function(){this.sprite.x=this.world.mpxi(this.data.position[0]);this.sprite.y=this.world.mpxi(this.data.position[1]);if(!this.fixedRotation){this.sprite.rotation=this.data.angle}},reset:function(a,d,c,b){if(typeof c==="undefined"){c=false}if(typeof b==="undefined"){b=false}this.setZeroForce();this.setZeroVelocity();this.setZeroRotation();if(c){this.setZeroDamping()}if(b){this.mass=1}this.x=a;this.y=d},addToWorld:function(){if(this.game.physics.p2._toRemove){for(var a=0;a<this.game.physics.p2._toRemove.length;a++){if(this.game.physics.p2._toRemove[a]===this){this.game.physics.p2._toRemove.splice(a,1)}}}if(this.data.world!==this.game.physics.p2.world){this.game.physics.p2.addBody(this)}},removeFromWorld:function(){if(this.data.world===this.game.physics.p2.world){this.game.physics.p2.removeBodyNextStep(this)}},destroy:function(){this.removeFromWorld();this.clearShapes();this._bodyCallbacks={};this._bodyCallbackContext={};this._groupCallbacks={};this._groupCallbackContext={};if(this.debugBody){this.debugBody.destroy()}this.debugBody=null;this.sprite=null},clearShapes:function(){var a=this.data.shapes.length;while(a--){this.data.removeShape(this.data.shapes[a])}this.shapeChanged()},addShape:function(b,a,d,c){if(typeof a==="undefined"){a=0}if(typeof d==="undefined"){d=0}if(typeof c==="undefined"){c=0}this.data.addShape(b,[this.world.pxmi(a),this.world.pxmi(d)],c);this.shapeChanged();return b},addCircle:function(b,a,e,d){var c=new p2.Circle(this.world.pxm(b));return this.addShape(c,a,e,d)},addRectangle:function(e,b,a,f,d){var c=new p2.Rectangle(this.world.pxm(e),this.world.pxm(b));return this.addShape(c,a,f,d)},addPlane:function(a,d,c){var b=new p2.Plane();return this.addShape(b,a,d,c)},addParticle:function(a,d,c){var b=new p2.Particle();return this.addShape(b,a,d,c)},addLine:function(d,a,e,c){var b=new p2.Line(this.world.pxm(d));return this.addShape(b,a,e,c)},addCapsule:function(e,b,a,f,d){var c=new p2.Capsule(this.world.pxm(e),b);return this.addShape(c,a,f,d)},addPolygon:function(d,f){d=d||{};if(!Array.isArray(f)){f=Array.prototype.slice.call(arguments,1)}var h=[];if(f.length===1&&Array.isArray(f[0])){h=f[0].slice(0)}else{if(Array.isArray(f[0])){h=f[0].slice(0)}else{if(typeof f[0]==="number"){for(var e=0,c=f.length;e<c;e+=2){h.push([f[e],f[e+1]])}}}}var b=h.length-1;if(h[b][0]===h[0][0]&&h[b][1]===h[0][1]){h.pop()}for(var g=0;g<h.length;g++){h[g][0]=this.world.pxmi(h[g][0]);h[g][1]=this.world.pxmi(h[g][1])}var a=this.data.fromPolygon(h,d);this.shapeChanged();return a},removeShape:function(b){var a=this.data.removeShape(b);this.shapeChanged();return a},setCircle:function(b,a,d,c){this.clearShapes();return this.addCircle(b,a,d,c)},setRectangle:function(d,b,a,e,c){if(typeof d==="undefined"){d=16}if(typeof b==="undefined"){b=16}this.clearShapes();return this.addRectangle(d,b,a,e,c)},setRectangleFromSprite:function(a){if(typeof a==="undefined"){a=this.sprite}this.clearShapes();return this.addRectangle(a.width,a.height,0,0,a.rotation)},setMaterial:function(c,a){if(typeof a==="undefined"){for(var b=this.data.shapes.length-1;b>=0;b--){this.data.shapes[b].material=c}}else{a.material=c}},shapeChanged:function(){if(this.debugBody){this.debugBody.draw()}},addPhaserPolygon:function(d,b){var f=this.game.cache.getPhysicsData(d,b);var g=[];for(var c=0;c<f.length;c++){var e=f[c];var a=this.addFixture(e);g[e.filter.group]=g[e.filter.group]||[];g[e.filter.group]=g[e.filter.group].concat(a);if(e.fixtureKey){g[e.fixtureKey]=a}}this.data.aabbNeedsUpdate=true;this.shapeChanged();return g},addFixture:function(a){var e=[];if(a.circle){var h=new p2.Circle(this.world.pxm(a.circle.radius));h.collisionGroup=a.filter.categoryBits;h.collisionMask=a.filter.maskBits;h.sensor=a.isSensor;var d=p2.vec2.create();d[0]=this.world.pxmi(a.circle.position[0]-this.sprite.width/2);d[1]=this.world.pxmi(a.circle.position[1]-this.sprite.height/2);this.data.addShape(h,d);e.push(h)}else{var k=a.polygons;var l=p2.vec2.create();for(var f=0;f<k.length;f++){var b=k[f];var g=[];for(var n=0;n<b.length;n+=2){g.push([this.world.pxmi(b[n]),this.world.pxmi(b[n+1])])}var h=new p2.Convex(g);for(var c=0;c!==h.vertices.length;c++){var m=h.vertices[c];p2.vec2.sub(m,m,h.centerOfMass)}p2.vec2.scale(l,h.centerOfMass,1);l[0]-=this.world.pxmi(this.sprite.width/2);l[1]-=this.world.pxmi(this.sprite.height/2);h.updateTriangles();h.updateCenterOfMass();h.updateBoundingRadius();h.collisionGroup=a.filter.categoryBits;h.collisionMask=a.filter.maskBits;h.sensor=a.isSensor;this.data.addShape(h,l);e.push(h)}}return e},loadPolygon:function(l,a){var d=this.game.cache.getPhysicsData(l,a);var h=p2.vec2.create();for(var e=0;e<d.length;e++){var f=[];for(var m=0;m<d[e].shape.length;m+=2){f.push([this.world.pxmi(d[e].shape[m]),this.world.pxmi(d[e].shape[m+1])])}var g=new p2.Convex(f);for(var b=0;b!==g.vertices.length;b++){var k=g.vertices[b];p2.vec2.sub(k,k,g.centerOfMass)}p2.vec2.scale(h,g.centerOfMass,1);h[0]-=this.world.pxmi(this.sprite.width/2);h[1]-=this.world.pxmi(this.sprite.height/2);g.updateTriangles();g.updateCenterOfMass();g.updateBoundingRadius();this.data.addShape(g,h)}this.data.aabbNeedsUpdate=true;this.shapeChanged();return true},loadData:function(b,a){var c=this.game.cache.getPhysicsData(b,a);if(c&&c.shape){this.mass=c.density;return this.loadPolygon(b,a)}}};Phaser.Physics.P2.Body.prototype.constructor=Phaser.Physics.P2.Body;Phaser.Physics.P2.Body.DYNAMIC=1;Phaser.Physics.P2.Body.STATIC=2;Phaser.Physics.P2.Body.KINEMATIC=4;Object.defineProperty(Phaser.Physics.P2.Body.prototype,"static",{get:function(){return(this.data.motionState===Phaser.Physics.P2.Body.STATIC)},set:function(a){if(a&&this.data.motionState!==Phaser.Physics.P2.Body.STATIC){this.data.motionState=Phaser.Physics.P2.Body.STATIC;this.mass=0}else{if(!a&&this.data.motionState===Phaser.Physics.P2.Body.STATIC){this.data.motionState=Phaser.Physics.P2.Body.DYNAMIC;if(this.mass===0){this.mass=1}}}}});Object.defineProperty(Phaser.Physics.P2.Body.prototype,"dynamic",{get:function(){return(this.data.motionState===Phaser.Physics.P2.Body.DYNAMIC)},set:function(a){if(a&&this.data.motionState!==Phaser.Physics.P2.Body.DYNAMIC){this.data.motionState=Phaser.Physics.P2.Body.DYNAMIC;if(this.mass===0){this.mass=1}}else{if(!a&&this.data.motionState===Phaser.Physics.P2.Body.DYNAMIC){this.data.motionState=Phaser.Physics.P2.Body.STATIC;this.mass=0}}}});Object.defineProperty(Phaser.Physics.P2.Body.prototype,"kinematic",{get:function(){return(this.data.motionState===Phaser.Physics.P2.Body.KINEMATIC)},set:function(a){if(a&&this.data.motionState!==Phaser.Physics.P2.Body.KINEMATIC){this.data.motionState=Phaser.Physics.P2.Body.KINEMATIC;this.mass=4}else{if(!a&&this.data.motionState===Phaser.Physics.P2.Body.KINEMATIC){this.data.motionState=Phaser.Physics.P2.Body.STATIC;this.mass=0}}}});Object.defineProperty(Phaser.Physics.P2.Body.prototype,"allowSleep",{get:function(){return this.data.allowSleep},set:function(a){if(a!==this.data.allowSleep){this.data.allowSleep=a}}});Object.defineProperty(Phaser.Physics.P2.Body.prototype,"angle",{get:function(){return Phaser.Math.wrapAngle(Phaser.Math.radToDeg(this.data.angle))},set:function(a){this.data.angle=Phaser.Math.degToRad(Phaser.Math.wrapAngle(a))}});Object.defineProperty(Phaser.Physics.P2.Body.prototype,"angularDamping",{get:function(){return this.data.angularDamping},set:function(a){this.data.angularDamping=a}});Object.defineProperty(Phaser.Physics.P2.Body.prototype,"angularForce",{get:function(){return this.data.angularForce},set:function(a){this.data.angularForce=a}});Object.defineProperty(Phaser.Physics.P2.Body.prototype,"angularVelocity",{get:function(){return this.data.angularVelocity},set:function(a){this.data.angularVelocity=a}});Object.defineProperty(Phaser.Physics.P2.Body.prototype,"damping",{get:function(){return this.data.damping},set:function(a){this.data.damping=a}});Object.defineProperty(Phaser.Physics.P2.Body.prototype,"fixedRotation",{get:function(){return this.data.fixedRotation},set:function(a){if(a!==this.data.fixedRotation){this.data.fixedRotation=a}}});Object.defineProperty(Phaser.Physics.P2.Body.prototype,"inertia",{get:function(){return this.data.inertia},set:function(a){this.data.inertia=a}});Object.defineProperty(Phaser.Physics.P2.Body.prototype,"mass",{get:function(){return this.data.mass},set:function(a){if(a!==this.data.mass){this.data.mass=a;this.data.updateMassProperties()}}});Object.defineProperty(Phaser.Physics.P2.Body.prototype,"motionState",{get:function(){return this.data.motionState},set:function(a){if(a!==this.data.motionState){this.data.motionState=a}}});Object.defineProperty(Phaser.Physics.P2.Body.prototype,"rotation",{get:function(){return this.data.angle},set:function(a){this.data.angle=a}});Object.defineProperty(Phaser.Physics.P2.Body.prototype,"sleepSpeedLimit",{get:function(){return this.data.sleepSpeedLimit},set:function(a){this.data.sleepSpeedLimit=a}});Object.defineProperty(Phaser.Physics.P2.Body.prototype,"x",{get:function(){return this.world.mpxi(this.data.position[0])},set:function(a){this.data.position[0]=this.world.pxmi(a)}});Object.defineProperty(Phaser.Physics.P2.Body.prototype,"y",{get:function(){return this.world.mpxi(this.data.position[1])},set:function(a){this.data.position[1]=this.world.pxmi(a)}});Object.defineProperty(Phaser.Physics.P2.Body.prototype,"id",{get:function(){return this.data.id}});Object.defineProperty(Phaser.Physics.P2.Body.prototype,"debug",{get:function(){return(this.debugBody!==null)},set:function(a){if(a&&!this.debugBody){this.debugBody=new Phaser.Physics.P2.BodyDebug(this.game,this.data)}else{if(!a&&this.debugBody){this.debugBody.destroy();this.debugBody=null}}}});Object.defineProperty(Phaser.Physics.P2.Body.prototype,"collideWorldBounds",{get:function(){return this._collideWorldBounds},set:function(a){if(a&&!this._collideWorldBounds){this._collideWorldBounds=true;this.updateCollisionMask()}else{if(!a&&this._collideWorldBounds){this._collideWorldBounds=false;this.updateCollisionMask()}}}});Phaser.Physics.P2.BodyDebug=function(b,a,d){Phaser.Group.call(this,b);var c={pixelsPerLengthUnit:20,debugPolygons:false,lineWidth:1,alpha:0.5};this.settings=Phaser.Utils.extend(c,d);this.ppu=this.settings.pixelsPerLengthUnit;this.ppu=-1*this.ppu;this.body=a;this.canvas=new Phaser.Graphics(b);this.canvas.alpha=this.settings.alpha;this.add(this.canvas);this.draw()};Phaser.Physics.P2.BodyDebug.prototype=Object.create(Phaser.Group.prototype);Phaser.Physics.P2.BodyDebug.prototype.constructor=Phaser.Physics.P2.BodyDebug;Phaser.Utils.extend(Phaser.Physics.P2.BodyDebug.prototype,{update:function(){this.updateSpriteTransform()},updateSpriteTransform:function(){this.position.x=this.body.position[0]*this.ppu;this.position.y=this.body.position[1]*this.ppu;return this.rotation=this.body.angle},draw:function(){var d,a,h,o,m,p,b,n,k,s,r,q,g,f,e;n=this.body;s=this.canvas;s.clear();h=parseInt(this.randomPastelHex(),16);p=16711680;b=this.lineWidth;if(n instanceof p2.Body&&n.shapes.length){var c=n.shapes.length;o=0;while(o!==c){a=n.shapes[o];k=n.shapeOffsets[o];d=n.shapeAngles[o];k=k||0;d=d||0;if(a instanceof p2.Circle){this.drawCircle(s,k[0]*this.ppu,k[1]*this.ppu,d,a.radius*this.ppu,h,b)}else{if(a instanceof p2.Convex){q=[];g=p2.vec2.create();for(m=f=0,e=a.vertices.length;0<=e?f<e:f>e;m=0<=e?++f:--f){r=a.vertices[m];p2.vec2.rotate(g,r,d);q.push([(g[0]+k[0])*this.ppu,-(g[1]+k[1])*this.ppu])}this.drawConvex(s,q,a.triangles,p,h,b,this.settings.debugPolygons,[k[0]*this.ppu,-k[1]*this.ppu])}else{if(a instanceof p2.Plane){this.drawPlane(s,k[0]*this.ppu,-k[1]*this.ppu,h,p,b*5,b*10,b*10,this.ppu*100,d)}else{if(a instanceof p2.Line){this.drawLine(s,a.length*this.ppu,p,b)}else{if(a instanceof p2.Rectangle){this.drawRectangle(s,k[0]*this.ppu,-k[1]*this.ppu,d,a.width*this.ppu,a.height*this.ppu,p,h,b)}}}}}o++}}},drawRectangle:function(f,j,i,b,k,d,c,a,e){if(typeof e==="undefined"){e=1}if(typeof c==="undefined"){c=0}f.lineStyle(e,c,1);f.beginFill(a);f.drawRect(j-k/2,i-d/2,k,d)},drawCircle:function(e,c,h,f,b,d,a){if(typeof a==="undefined"){a=1}if(typeof d==="undefined"){d=16777215}e.lineStyle(a,0,1);e.beginFill(d,1);e.drawCircle(c,h,-b);e.endFill();e.moveTo(c,h);e.lineTo(c+b*Math.cos(-f),h+b*Math.sin(-f))},drawLine:function(d,b,c,a){if(typeof a==="undefined"){a=1}if(typeof c==="undefined"){c=0}d.lineStyle(a*5,c,1);d.moveTo(-b/2,0);d.lineTo(b/2,0)},drawConvex:function(r,u,o,p,f,a,n,h){var k,q,m,d,b,l,t,s,j,e,c;if(typeof a==="undefined"){a=1}if(typeof p==="undefined"){p=0}if(!n){r.lineStyle(a,p,1);r.beginFill(f);q=0;while(q!==u.length){m=u[q];l=m[0];j=m[1];if(q===0){r.moveTo(l,-j)}else{r.lineTo(l,-j)}q++}r.endFill();if(u.length>2){r.moveTo(u[u.length-1][0],-u[u.length-1][1]);return r.lineTo(u[0][0],-u[0][1])}}else{k=[16711680,65280,255];q=0;while(q!==u.length+1){d=u[q%u.length];b=u[(q+1)%u.length];t=d[0];e=d[1];s=b[0];c=b[1];r.lineStyle(a,k[q%k.length],1);r.moveTo(t,-e);r.lineTo(s,-c);r.drawCircle(t,-e,a*2);q++}r.lineStyle(a,0,1);return r.drawCircle(h[0],h[1],a*2)}},drawPath:function(s,l,o,d,a){var t,q,n,m,c,b,h,e,r,p,k,j,f;if(typeof a==="undefined"){a=1}if(typeof o==="undefined"){o=0}s.lineStyle(a,o,1);if(typeof d==="number"){s.beginFill(d)}n=null;m=null;q=0;while(q<l.length){k=l[q];j=k[0];f=k[1];if(j!==n||f!==m){if(q===0){s.moveTo(j,f)}else{c=n;b=m;h=j;e=f;r=l[(q+1)%l.length][0];p=l[(q+1)%l.length][1];t=((h-c)*(p-b))-((r-c)*(e-b));if(t!==0){s.lineTo(j,f)}}n=j;m=f}q++}if(typeof d==="number"){s.endFill()}if(l.length>2&&typeof d==="number"){s.moveTo(l[l.length-1][0],l[l.length-1][1]);s.lineTo(l[0][0],l[0][1])}},drawPlane:function(i,d,c,f,m,j,h,a,b,e){var l,n,k;if(typeof j==="undefined"){j=1}if(typeof f==="undefined"){f=16777215}i.lineStyle(j,m,11);i.beginFill(f);l=b;i.moveTo(d,-c);n=d+Math.cos(e)*this.game.width;k=c+Math.sin(e)*this.game.height;i.lineTo(n,-k);i.moveTo(d,-c);n=d+Math.cos(e)*-this.game.width;k=c+Math.sin(e)*-this.game.height;i.lineTo(n,-k)},randomPastelHex:function(){var a,c,b,d;b=[255,255,255];d=Math.floor(Math.random()*256);c=Math.floor(Math.random()*256);a=Math.floor(Math.random()*256);d=Math.floor((d+3*b[0])/4);c=Math.floor((c+3*b[1])/4);a=Math.floor((a+3*b[2])/4);return this.rgbToHex(d,c,a)},rgbToHex:function(d,c,a){return this.componentToHex(d)+this.componentToHex(c)+this.componentToHex(a)},componentToHex:function(b){var a;a=b.toString(16);if(a.len===2){return a}else{return a+"0"}}});Phaser.Physics.P2.Spring=function(g,e,c,a,h,f,j,i,d,b){this.game=g.game;this.world=g;if(typeof a==="undefined"){a=1}if(typeof h==="undefined"){h=100}if(typeof f==="undefined"){f=1}a=g.pxm(a);var k={restLength:a,stiffness:h,damping:f};if(typeof j!=="undefined"&&j!==null){k.worldAnchorA=[g.pxm(j[0]),g.pxm(j[1])]}if(typeof i!=="undefined"&&i!==null){k.worldAnchorB=[g.pxm(i[0]),g.pxm(i[1])]}if(typeof d!=="undefined"&&d!==null){k.localAnchorA=[g.pxm(d[0]),g.pxm(d[1])]}if(typeof b!=="undefined"&&b!==null){k.localAnchorB=[g.pxm(b[0]),g.pxm(b[1])]}p2.Spring.call(this,e,c,k)};Phaser.Physics.P2.Spring.prototype=Object.create(p2.Spring.prototype);Phaser.Physics.P2.Spring.prototype.constructor=Phaser.Physics.P2.Spring;Phaser.Physics.P2.Material=function(a){this.name=a;p2.Material.call(this)};Phaser.Physics.P2.Material.prototype=Object.create(p2.Material.prototype);Phaser.Physics.P2.Material.prototype.constructor=Phaser.Physics.P2.Material;Phaser.Physics.P2.ContactMaterial=function(c,b,a){p2.ContactMaterial.call(this,c,b,a)};Phaser.Physics.P2.ContactMaterial.prototype=Object.create(p2.ContactMaterial.prototype);Phaser.Physics.P2.ContactMaterial.prototype.constructor=Phaser.Physics.P2.ContactMaterial;Phaser.Physics.P2.CollisionGroup=function(a){this.mask=a};Phaser.Physics.P2.DistanceConstraint=function(a,d,c,e,b){if(typeof e==="undefined"){e=100}this.game=a.game;this.world=a;e=a.pxm(e);p2.DistanceConstraint.call(this,d,c,e,{maxForce:b})};Phaser.Physics.P2.DistanceConstraint.prototype=Object.create(p2.DistanceConstraint.prototype);Phaser.Physics.P2.DistanceConstraint.prototype.constructor=Phaser.Physics.P2.DistanceConstraint;Phaser.Physics.P2.GearConstraint=function(c,f,d,e,b){if(typeof e==="undefined"){e=0}if(typeof b==="undefined"){b=1}this.game=c.game;this.world=c;var a={angle:e,ratio:b};p2.GearConstraint.call(this,f,d,a)};Phaser.Physics.P2.GearConstraint.prototype=Object.create(p2.GearConstraint.prototype);Phaser.Physics.P2.GearConstraint.prototype.constructor=Phaser.Physics.P2.GearConstraint;Phaser.Physics.P2.LockConstraint=function(b,g,d,f,e,c){if(typeof f==="undefined"){f=[0,0]}if(typeof e==="undefined"){e=0}if(typeof c==="undefined"){c=Number.MAX_VALUE}this.game=b.game;this.world=b;f=[b.pxm(f[0]),b.pxm(f[1])];var a={localOffsetB:f,localAngleB:e,maxForce:c};p2.LockConstraint.call(this,g,d,a)};Phaser.Physics.P2.LockConstraint.prototype=Object.create(p2.LockConstraint.prototype);Phaser.Physics.P2.LockConstraint.prototype.constructor=Phaser.Physics.P2.LockConstraint;Phaser.Physics.P2.PrismaticConstraint=function(g,e,d,f,c,a,b,h){if(typeof f==="undefined"){f=true}if(typeof c==="undefined"){c=[0,0]}if(typeof a==="undefined"){a=[0,0]}if(typeof b==="undefined"){b=[0,0]}if(typeof h==="undefined"){h=Number.MAX_VALUE}this.game=g.game;this.world=g;c=[g.pxmi(c[0]),g.pxmi(c[1])];a=[g.pxmi(a[0]),g.pxmi(a[1])];var i={localAnchorA:c,localAnchorB:a,localAxisA:b,maxForce:h,disableRotationalLock:!f};p2.PrismaticConstraint.call(this,e,d,i)};Phaser.Physics.P2.PrismaticConstraint.prototype=Object.create(p2.PrismaticConstraint.prototype);Phaser.Physics.P2.PrismaticConstraint.prototype.constructor=Phaser.Physics.P2.PrismaticConstraint;Phaser.Physics.P2.RevoluteConstraint=function(a,f,e,d,c,b){if(typeof b==="undefined"){b=Number.MAX_VALUE}this.game=a.game;this.world=a;e=[a.pxmi(e[0]),a.pxmi(e[1])];c=[a.pxmi(c[0]),a.pxmi(c[1])];p2.RevoluteConstraint.call(this,f,e,d,c,{maxForce:b})};Phaser.Physics.P2.RevoluteConstraint.prototype=Object.create(p2.RevoluteConstraint.prototype);Phaser.Physics.P2.RevoluteConstraint.prototype.constructor=Phaser.Physics.P2.RevoluteConstraint;var Adventurous={};Adventurous.flags={};Adventurous.speeches={};Adventurous.options={mute:false,soundVolume:1,musicVolume:0.5,voiceEnabled:true,textSpeed:0.5};Adventurous.Boot=function(a){};Adventurous.Boot.prototype={preload:function(){this.load.image("preloader_background","images/preloader_background.gif");this.load.image("preloader_bar","images/preloader_bar.gif");this.load.text("conversations","text/conversations.txt");this.load.text("interactions","text/interactions.txt");this.load.text("observations","text/observations.txt");this.load.text("combinations","text/combinations.txt");this.load.text("speeches","text/speeches.txt");this.load.text("scenes","text/scenes.txt");this.load.text("preload","text/preload.txt")},create:function(){if(game.device.firefox){Adventurous.Constants.BROWSER_LABEL_Y_OFFSET=4}this.game.input.maxPointers=1;if(this.game.device.desktop){this.game.stage.scale.pageAlignHorizontally=true}else{this.game.stage.scaleMode=Phaser.StageScaleMode.SHOW_ALL;this.game.stage.scale.minWidth=480;this.game.stage.scale.minHeight=260;this.game.stage.scale.maxWidth=1024;this.game.stage.scale.maxHeight=768;this.game.stage.scale.forceLandscape=true;this.game.stage.scale.pageAlignHorizontally=true;this.game.stage.scale.setScreenSize(true)}this.game.state.start("Preloader")}};Adventurous.Constants={GAME_NAME:"The Secret of Gargoyle Manor",LOCALSTORAGE_KEY:"Adventurous_The Secret of Gargoyle Manor_localStorage",HAS_VOICE:false,MAIN_MENU_MUSIC:"goblinking",MENU_BUTTON_SOUND:"button",TILE_SIZE:16,INVERSE_TILE_SIZE:1/16,WALKABLE_TILES:[2],SCALE_STEP:0.1,DEFAULT_MOVE_SPEED:125,LABEL_STYLE:{font:"17px AdventurousFont",fill:"#ffffee",align:"center"},LABEL_SHADOW_STYLE:{font:"17px AdventurousFont",fill:"#000011",align:"center"},LABEL_SHADOW_OFFSET_X:1,LABEL_SHADOW_OFFSET_Y:1,DIALOGUE_LABEL_STYLE:{font:"17px AdventurousFont",fill:"#ffffee",align:"left",wordWrapWidth:600,wordWrap:true},SELECTED_DIALOGUE_LABEL_STYLE:{font:"17px AdventurousFont",fill:"#ffff77",align:"left",wordWrapWidth:600,wordWrap:true},DISABLED_LABEL_STYLE:{font:"17px AdventurousFont",fill:"#dddddd",align:"left",wordWrapWidth:600,wordWrap:true},MAIN_MENU_LABEL_STYLE:{font:"17px AdventurousFont",fill:"#000000",align:"left",wordWrapWidth:600,wordWrap:true},SELECTED_MAIN_MENU_LABEL_STYLE:{font:"17px AdventurousFont",fill:"#F6F699",align:"left",wordWrapWidth:600,wordWrap:true},LINE_HEIGHT:25,LMB:0,MMB:1,RMB:2,PLAYER_NAME:"player",DIALOGUE_BACKGROUND_IMAGE_NAME:"dialogue_background",INVENTORY_BACKGROUND_IMAGE_NAME:"inventory_background",INVENTORY_PADDING:65,INVENTORY_MARGIN:30,TITLE_IMAGE_NAME:"title_background",DIALOGUE_BACKGROUND_OPACITY:0.9,ACTION_TALK:"Talk",ACTION_REMARK:"Remark",ACTION_PICK_UP:"Pickup",ACTION_STOP:"Stop",ACTION_SOUND:"Sound",ACTION_MUSIC:"Music",ACTION_SET_ALIAS:"Alias",ACTION_DROP:"Drop",ACTION_HIDE:"Hide",ACTION_SHOW:"Show",ACTION_ANIMATE:"Animate",ACTION_WAIT:"Wait",ACTION_SCENE:"Scene",ACTION_WALK:"Walk",ACTION_MOVE:"Move",ACTION_FACE:"Face",ACTION_RELOCATE:"Relocate",ACTION_STOP_ROUTINE:"StopRoutine",ACTION_START_ROUTINE:"StartRoutine",ACTION_SET_FLAG:"setFlag",ACTION_FADEOUT:"Fade Out",ACTION_FADEIN:"Fade In",ACTION_MAIN_MENU:"MainMenu",ACTION_CONV_HIDE_CHOICE:"conv_hideChoice",ACTION_CONV_RESET_CHOICES:"conv_resetChoices",ACTION_CONV_QUIT:"conv_quit",ACTION_CONV_NODE:"conv_node",OFFSTAGE_SCENE:"<offstage>",ON_ENTER:"Enter",ON_EXIT:"Exit",ANIM_IDLE:"idle",INVENTORY_ITEM_SIZE:75,DIALOGUE_DEFAULT_WPM:120,DIALOGUE_MIN_TIME:2000,PAUSE_MENU_FIRST_ITEM_Y_POS:60,PAUSE_MENU_LINE_HEIGHT:60,MAIN_MENU_FIRST_ITEM_Y_POS:175,MAIN_MENU_LINE_HEIGHT:50,PAUSE_MENU_WIDTH:256,BROWSER_LABEL_Y_OFFSET:0,HELP_TEXT:'This game is very simple\nto play!\n\nLEFT CLICK to use things.\n\nRIGHT CLICK to look at\nthings.\n\nTo open your inventory,\npress the "i" key.\n\nHave fun!',CREDITS_TEXT:'THE SECRET OF GARGOYLE MANOR\nan entertainment software from Skyfort Games\n\nMusic:\n    "The Path of the Goblin King", "Life of Riley", "Industrial Music Box"\n    by Kevin MacLeod (incompetech.com)\n    Licensed under Creative Commons: By Attribution 3.0\n    http://creativecommons.org/licenses/by/3.0/\n\nSound effects:\n    #GameAudioGDC bundle from sonniss.com\n    Wind sound effect by medialint at freesound.org\n\nFonts from dafont.com:\n    Alte Haas Grotesk Bold by yann le coroller\n\nCreated with the Adventurous Engine (adventurous.website.site)'};Adventurous.Preloader=function(a){this.background=null;this.preloadBar=null;this.ready=false};Adventurous.Preloader.prototype={preload:function(){this.background=this.add.sprite(0,0,"preloader_background");this.preloadBar=this.add.sprite(0,0,"preloader_bar");this.preloadBar.y=game.height-this.preloadBar.height;this.load.setPreloadSprite(this.preloadBar);var a=JSON.parse(game.cache.getText("preload"));this.loadFiles(a.list)},create:function(){this.game.state.start("MainMenu")},loadFiles:function(f){for(var d=0;d<f.length;d++){var c=f[d].name;var e=f[d].type;switch(e){case"text":this.load.text(c,"text/"+c+".txt");break;case"image":this.load.image(c,"images/"+c+f[d].ext);break;case"spritesheet":this.load.spritesheet(c,"images/"+c+f[d].ext,parseInt(f[d].width),parseInt(f[d].height));break;case"audio":var a=[];for(var b=0;b<f[d].ext.length;b++){a[b]="audio/"+c+f[d].ext[b]}this.load.audio(c,a);break;case"tilemap":this.load.tilemap(c,"maps/"+c+".json",null,Phaser.Tilemap.TILED_JSON);break;default:console.debug("ERROR: Adventurous.Preloader.loadFiles(list) -- unrecognized file type "+e);break}}}};Adventurous.MainMenu=function(a){this.playButton};Adventurous.MainMenu.prototype={create:function(){this.background=this.add.sprite(0,0,"title_background");this.creditsBackground=this.add.sprite(0,0,"credits_background");this.creditsBackground.visible=false;this.menuGroup=game.add.group();this.helpLabel=game.add.text(game.width/2,Adventurous.Constants.MAIN_MENU_FIRST_ITEM_Y_POS+Adventurous.Constants.BROWSER_LABEL_Y_OFFSET,"How to Play",Adventurous.Constants.MAIN_MENU_LABEL_STYLE);this.helpLabel.x-=Math.floor(this.helpLabel.width/2);this.menuGroup.add(this.helpLabel);this.playLabel=game.add.text(game.width/2,this.helpLabel.y+Adventurous.Constants.MAIN_MENU_LINE_HEIGHT,"New Game",Adventurous.Constants.MAIN_MENU_LABEL_STYLE);this.playLabel.x-=Math.floor(this.playLabel.width/2);this.menuGroup.add(this.playLabel);this.loadLabel=game.add.text(game.width/2,this.playLabel.y+Adventurous.Constants.MAIN_MENU_LINE_HEIGHT,"Load Game",Adventurous.Constants.MAIN_MENU_LABEL_STYLE);this.loadLabel.x-=Math.floor(this.loadLabel.width/2);this.menuGroup.add(this.loadLabel);this.optionsLabel=game.add.text(game.width/2,this.loadLabel.y+Adventurous.Constants.MAIN_MENU_LINE_HEIGHT,"Options",Adventurous.Constants.MAIN_MENU_LABEL_STYLE);this.optionsLabel.x-=Math.floor(this.optionsLabel.width/2);this.menuGroup.add(this.optionsLabel);this.creditsLabel=game.add.text(game.width/2,this.optionsLabel.y+Adventurous.Constants.MAIN_MENU_LINE_HEIGHT,"Credits",Adventurous.Constants.MAIN_MENU_LABEL_STYLE);this.creditsLabel.x-=Math.floor(this.creditsLabel.width/2);this.menuGroup.add(this.creditsLabel);this.creditsText=game.add.text(10,10,Adventurous.Constants.CREDITS_TEXT,Adventurous.Constants.MAIN_MENU_LABEL_STYLE);this.creditsText.visible=false;this.creditsButton=new Adventurous.Button(game.width/2,game.height-Adventurous.Constants.MAIN_MENU_LINE_HEIGHT,"OK","mainMenu_button",Adventurous.Constants.MAIN_MENU_LABEL_STYLE,Adventurous.Constants.SELECTED_MAIN_MENU_LABEL_STYLE);this.creditsButton.buttonGroup.visible=false;this.pauseMenu=new Adventurous.PauseMenu();this.cursor=new Adventurous.Cursor();game.input.onDown.add(this.mouseDown,this);game.antialias=true;Phaser.Canvas.setSmoothingEnabled(game.renderer.context,true);if(Adventurous.backgroundMusic==null){Adventurous.backgroundMusic=this.game.add.audio(Adventurous.Constants.MAIN_MENU_MUSIC);Adventurous.backgroundMusic.volume=Adventurous.options.musicVolume;Adventurous.backgroundMusic.loop=true;Adventurous.backgroundMusic.play()}},mouseDown:function(c){if(c.button==Adventurous.Constants.LMB){if(this.pauseMenu.background.visible){if(this.pauseMenu.helpGroup.visible){if(Adventurous.Util.isMouseOverObject(this.pauseMenu.helpButtons[0].background)){this.hidePauseMenu()}}else{if(this.pauseMenu.savegameGroup.visible){this.pauseMenu.handleSaveGameButtonClicks(true)}else{if(this.pauseMenu.optionsGroup.visible){this.pauseMenu.handleOptionsButtonClicks(true)}}}}else{if(this.menuGroup.visible){for(var b=0;b<this.menuGroup.length;b++){var a=this.menuGroup.getAt(b);if(Adventurous.Util.isMouseOverObject(a)){this.selectOption(a.text)}}}else{if(this.creditsButton.buttonGroup.visible){if(Adventurous.Util.isMouseOverObject(this.creditsButton.background)){this.menuGroup.visible=true;this.background.visible=true;this.creditsBackground.visible=false;this.creditsText.visible=false;this.creditsButton.buttonGroup.visible=false}}}}}},hidePauseMenu:function(){var a=game.add.audio(Adventurous.Constants.MENU_BUTTON_SOUND);a.volume=Adventurous.options.soundVolume;a.play();this.pauseMenu.background.visible=false;this.pauseMenu.helpGroup.visible=false},selectOption:function(a){switch(a){case"How to Play":this.pauseMenu.background.visible=true;this.pauseMenu.showGroup(this.pauseMenu.helpGroup);break;case"New Game":this.startGame();break;case"Load Game":this.pauseMenu.background.visible=true;this.pauseMenu.showLoadGame();break;case"Options":this.pauseMenu.background.visible=true;this.pauseMenu.showGroup(this.pauseMenu.optionsGroup);break;case"Credits":this.menuGroup.visible=false;this.background.visible=false;this.creditsBackground.visible=true;this.creditsText.visible=true;this.creditsButton.buttonGroup.visible=true;break;default:break}},updateLabels:function(){if(this.menuGroup.visible){for(var b=0;b<this.menuGroup.length;b++){var a=this.menuGroup.getAt(b);if(Adventurous.Util.isMouseOverObject(a)){a.setStyle(Adventurous.Constants.SELECTED_MAIN_MENU_LABEL_STYLE)}else{a.setStyle(Adventurous.Constants.MAIN_MENU_LABEL_STYLE)}}}},update:function(){this.cursor.update();this.updateLabels();this.pauseMenu.update();this.creditsButton.updateLabel()},loadGame:function(a){Adventurous.gameToLoad=a;this.game.state.start("Game")},startGame:function(){Adventurous.gameToLoad=null;Adventurous.flags={};this.game.state.start("Game")}};Adventurous.Game=function(a){this.game;this.add;this.camera;this.cache;this.input;this.load;this.math;this.sound;this.stage;this.time;this.tweens;this.world;this.particles;this.physics;this.rnd;this.scene;this.thingsGroup;this.dialogueGroup;this.dialogueGroupStartIndex=0;this.dialogueUpButton;this.dialogueDownButton;this.currentConversation;this.player;this.startingItems;this.inventory;this.cursor;this.activeEffects;this.thingUnderMouse;this.nextScene;this.entrance;this.bitmapData};Adventurous.Game.prototype={create:function(){currentState=this;this.triggerAreas=new Array();this.activeEffects=null;this.nextScene=null;Adventurous.Loader.init(this);this.thingsGroup=game.add.group();this.dialogueGroup=game.add.group();this.dialogueGroup.visible=false;this.dialogueUpButton=this.add.button(0,0,"dialogue_up",this.dialogueUp,this,1,0,1);this.dialogueDownButton=this.add.button(0,0,"dialogue_down",this.dialogueDown,this,1,0,1);this.dialogueUpButton.visible=false;this.dialogueDownButton.visible=false;this.player=Adventurous.thingsMap[Adventurous.Constants.PLAYER_NAME];this.startingItems=new Array();this.inventory=new Adventurous.Inventory(this.startingItems);this.pauseMenu=new Adventurous.PauseMenu();this.cursor=new Adventurous.Cursor();game.input.onDown.add(this.mouseDown,this);if(Adventurous.gameToLoad!=null){Adventurous.Util.load(Adventurous.gameToLoad);Adventurous.gameToLoad=null}else{this.showScene(Adventurous.startingScene,"start")}},mouseDown:function(g){if(this.pauseMenu.background.visible){this.pauseMenu.mouseDown(g)}else{if(this.inventory.background.visible){this.inventory.mouseDown(g)}else{if(this.activeEffects!=null){for(var b=0;b<this.activeEffects.effects.length;b++){var c=this.activeEffects.effects[b];if(c.type==Adventurous.Constants.ACTION_REMARK&&c.target!=null){c.target.stopTalking()}}}else{if(this.currentConversation!=null){for(var b=3;b<this.dialogueGroup.length;b++){var a=this.dialogueGroup.getAt(b);if(Adventurous.Util.isMouseOverObject(a)){this.currentConversation.choose(b-3+this.dialogueGroupStartIndex);this.currentConversation.doDialogue();this.updateDialogueOptions()}}}else{if(this.thingUnderMouse!=null){if(g.button==Adventurous.Constants.LMB){if(this.thingUnderMouse.usableZone!=null){if(this.thingUnderMouse.usableZone=="any"){this.player.stopTalking();this.player.destinationThing=this.thingUnderMouse;if(this.cursor.item==null){this.player.useThing()}else{this.player.useThing(this.cursor.item.name)}}else{var d=this.player.getNearestTile(this.thingUnderMouse.usableZone);if(d!=null){var e=this.scene.findPath(this.player,Adventurous.Constants.TILE_SIZE*(d.x+0.5),Adventurous.Constants.TILE_SIZE*(d.y+0.5));this.player.stopTalking();this.player.followPath(e,this.thingUnderMouse)}}}}else{if(g.button==Adventurous.Constants.RMB){if(this.cursor.item==null){this.player.stopTalking();this.player.stopMoving(true);this.thingUnderMouse.label.visible=false;this.player.face(this.thingUnderMouse);this.player.say(this.thingUnderMouse.observations.next())}else{this.cursor.setItem(null)}}}}else{if(this.cursor.item!=null&&g.button==Adventurous.Constants.RMB){this.cursor.setItem(null)}else{var f=this.scene.map.getTileWorldXY(g.x,g.y,Adventurous.Constants.TILE_SIZE,Adventurous.Constants.TILE_SIZE);if(Adventurous.Constants.WALKABLE_TILES.indexOf(f.index)!=-1){var e=this.scene.findPath(this.player,g.x,g.y);this.player.stopTalking();this.player.followPath(e,null)}}}}}}}},update:function(){if(this.pauseMenu.background.visible){this.pauseMenu.update()}else{if(this.inventory.background.visible){this.inventory.update()}else{if(this.nextScene!=null){this.showScene(this.nextScene,this.entrance);this.nextScene=null;this.entrance=null}else{this.player.update();this.thingsGroup.sort("y");for(var a=0;a<this.scene.things.length;a++){if(this.scene.things[a].isBackground){this.thingsGroup.removeChild(this.scene.things[a].sprite);this.thingsGroup.addChildAt(this.scene.things[a].sprite,0)}else{if(this.scene.things[a].isForeground){this.thingsGroup.removeChild(this.scene.things[a].sprite);this.thingsGroup.add(this.scene.things[a].sprite)}}}this.scene.update();this.updateScales();if(this.activeEffects!=null){this.activeEffects.update()}else{if(this.conversationToStart!=null){this.startConversation(this.conversationToStart);this.conversationToStart=null}else{if(this.currentConversation!=null){this.dialogueGroup.visible=true;this.updateConversation()}else{this.getThingUnderMouse()}}}if(this.player.readyToUseSomething()){if(this.cursor.item==null){this.player.useThing()}else{this.player.useThing(this.cursor.item.name)}}}}}this.cursor.update()},updateConversation:function(){for(var b=3;b<this.dialogueGroup.length;b++){var a=this.dialogueGroup.getAt(b);if(Adventurous.Util.isMouseOverObject(a)){a.setStyle(Adventurous.Constants.SELECTED_DIALOGUE_LABEL_STYLE)}else{a.setStyle(Adventurous.Constants.DIALOGUE_LABEL_STYLE)}}},updateScales:function(){this.player.updateScale();for(var a=0;a<this.scene.things.length;a++){this.scene.things[a].updateScale()}},getThingUnderMouse:function(){this.thingUnderMouse=null;for(var c=0;c<this.scene.things.length;c++){var b=this.scene.things[c];if(b.isVisible()&&!b.isNoninteractive&&Phaser.Rectangle.contains(b.sprite.body,game.input.mousePointer.x,game.input.mousePointer.y)){if(this.thingUnderMouse==null||this.scene.things[c].sprite.body.bottom>this.thingUnderMouse.sprite.body.bottom){var a=b.bitmapData.getPixel(game.input.mousePointer.x-b.sprite.body.x,game.input.mousePointer.y-b.sprite.body.y).a;if(a>0){this.thingUnderMouse=this.scene.things[c]}}}}if(this.thingUnderMouse!=null){if(this.cursor.item!=null){if(this.thingUnderMouse.usableZone!=null&&this.thingUnderMouse.usableZone.length>0){this.thingUnderMouse.setLabelUseText(this.cursor.item.name);if(!this.player.talking){this.thingUnderMouse.showLabel(this.thingUnderMouse.label)}}}else{this.thingUnderMouse.setLabelUseText("");if(!this.player.talking){this.thingUnderMouse.showLabel(this.thingUnderMouse.label)}}}},startConversation:function(a){this.currentConversation=Adventurous.conversations[a];this.dialogueGroup.visible=false;this.currentConversation.doDialogue();this.updateDialogueOptions()},endConversation:function(){if(this.currentConversation!=null){this.currentConversation.quit();this.currentConversation=null;this.dialogueGroup.visible=false}},updateDialogueOptions:function(){this.dialogueGroup.removeAll();var g=this.currentConversation.getChoices().length;var e=game.add.sprite(0,0,Adventurous.Constants.DIALOGUE_BACKGROUND_IMAGE_NAME);e.y=game.world.height-e.height;e.alpha=Adventurous.Constants.DIALOGUE_BACKGROUND_OPACITY;this.dialogueGroup.add(e);var a=this.dialogueGroupStartIndex>0;var h=false;var f=e.y+10;for(var d=this.dialogueGroupStartIndex;d<g;d++){var b=this.currentConversation.getChoice(d);var c=game.add.text(e.x+this.dialogueUpButton.width+20,f,Adventurous.speeches[b.speech].text,Adventurous.Constants.DIALOGUE_LABEL_STYLE);f+=c.height+5;if(f>game.height){game.world.remove(c);h=true;break}else{this.dialogueGroup.add(c)}}this.dialogueUpButton.x=10;this.dialogueUpButton.y=e.y+10;this.dialogueDownButton.x=10;this.dialogueDownButton.y=game.height-10-this.dialogueDownButton.height;this.dialogueUpButton.visible=a;this.dialogueDownButton.visible=h;this.dialogueGroup.addAt(this.dialogueUpButton,1);this.dialogueGroup.addAt(this.dialogueDownButton,1)},dialogueUp:function(a){this.dialogueGroupStartIndex--;this.dialogueDownButton.frame=0;this.dialogueUpButton.frame=0;this.updateDialogueOptions()},dialogueDown:function(a){this.dialogueGroupStartIndex++;this.dialogueDownButton.frame=0;this.dialogueUpButton.frame=0;this.updateDialogueOptions()},quitGame:function(a){},freeze:function(){this.player.freeze();for(var a=0;a<this.scene.things.length;a++){this.scene.things[a].freeze()}if(currentState.activeEffects!=null){for(var a=0;a<this.activeEffects.effects.length;a++){var b=this.activeEffects.effects[a];if(b.type==Adventurous.Constants.ACTION_SOUND&&b.audioClip!=null&&b.audioClip.isPlaying){b.audioClip.pause()}}}},unfreeze:function(){this.player.unfreeze();for(var a=0;a<this.scene.things.length;a++){this.scene.things[a].unfreeze()}if(currentState.activeEffects!=null){for(var a=0;a<this.activeEffects.effects.length;a++){var b=this.activeEffects.effects[a];if(b.type==Adventurous.Constants.ACTION_SOUND&&b.audioClip!=null&&b.audioClip.paused){b.audioClip.resume()}}}},showScene:function(d,f){this.player.stopMoving();for(var e=0;e<Adventurous.thingsArray.length;e++){Adventurous.thingsArray[e].hide()}if(this.scene!=null){this.scene.hide()}this.scene=Adventurous.scenes[d];this.scene.show();this.thingsGroup.removeAll();this.player.show();this.thingsGroup.add(this.player.sprite);this.thingsGroup.bringToTop(this.player.sprite);for(var e=0;e<this.scene.things.length;e++){if(this.scene.things[e].startHidden!=true&&this.scene.things[e].hasBeenHidden!=true){this.scene.things[e].show()}this.thingsGroup.add(this.scene.things[e].sprite);this.thingsGroup.bringToTop(this.scene.things[e].sprite)}this.dialogueGroup.removeAll();for(var e=0;e<this.scene.things.length;e++){if(this.scene.things[e].label!=null){this.scene.things[e].bringLabelsToTop()}}this.player.bringLabelsToTop();this.pauseMenu.bringToTop();if(f!=null){var b=this.scene.entrances[f];if(b!=null){this.player.setPosition(parseInt(b.x),parseInt(b.y));if(b.onEntry!=null){for(var e=0;e<b.onEntry.length;e++){if(Adventurous.Util.areConditionsMet(b.onEntry[e].conditions)){this.activeEffects=new Adventurous.Effects(this.player,b.onEntry[e].effects);var a=b.onEntry[e].preEffects;if(a!=null){for(var c=0;c<a.length;c++){this.activeEffects.applyEffect(a[c])}}break}}}}}this.inventory.enabled=true},switchToScene:function(b,a){if(this.thingUnderMouse!=null){this.thingUnderMouse.label.visible=false}this.nextScene=b;this.entrance=a},toSaveObject:function(){var b={};b.currentScene=this.scene.name;b.scenes=new Array();for(var a in Adventurous.scenes){b.scenes[b.scenes.length]=Adventurous.scenes[a].toSaveObject()}b.player=this.player.toSaveObject();b.inventory=this.inventory.toSaveObject();return b},loadFromObject:function(b){Adventurous.flags=b.flags;Adventurous.options=b.options;this.pauseMenu.soundVolumeSlider.setValue(Adventurous.options.soundVolume);this.pauseMenu.musicVolumeSlider.setValue(Adventurous.options.musicVolume);this.pauseMenu.textSpeedSlider.setValue(Adventurous.options.textSpeed);if(Adventurous.Constants.HAS_VOICE){this.pauseMenu.voiceToggleButton.setSelected(Adventurous.options.hasVoice)}for(var a=0;a<b.data.scenes.length;a++){Adventurous.scenes[b.data.scenes[a].name].loadFromObject(b.data.scenes[a])}this.showScene(b.data.currentScene);this.player.loadFromObject(b.data.player);this.inventory.loadFromObject(b.data.inventory);this.cursor.reload()}};Adventurous.Scene=function(f){this.name=f.name;if(f.scales!=null){this.scales=f.scales}if(this.name!=Adventurous.Constants.OFFSTAGE_SCENE){this.background=game.add.sprite(0,0,this.name);game.physics.enable(this.background,Phaser.Physics.ARCADE,true);this.map=game.add.tilemap(this.name);var d=[];for(var e=0;e<this.map.layers[0].data.length;e++){var b=this.map.layers[0].data[e];var a=[];for(var c=0;c<b.length;c++){a[a.length]=b[c].index}d[e]=a}this.graph=new Graph(d)}else{this.background=game.add.sprite(0,0)}this.things=new Array();this.triggerAreas=new Array();this.exits=new Array();this.entrances={};this.init(f);GraphNodeType.WALL=1;GraphNodeType.OPEN=2;Adventurous.scenes[this.name]=this;this.hide()};Adventurous.Scene.prototype={update:function(){for(var a=0;a<this.triggerAreas.length;a++){this.triggerAreas[a].update()}for(var a=0;a<this.exits.length;a++){this.exits[a].update()}for(var a=0;a<this.things.length;a++){this.things[a].update()}},findPath:function(g,f,e){var j=Math.floor(f/Adventurous.Constants.TILE_SIZE);var h=Math.floor(e/Adventurous.Constants.TILE_SIZE);var a=this.graph.nodes[g.getTileY()][g.getTileX()];var b=this.graph.nodes[h][j];var k=astar.search(this.graph.nodes,a,b,true);k.splice(0,0,a);k=this.smoothPath(k);var d=new Array(k.length);d[0]=new Phaser.Point(g.sprite.x,g.sprite.y);if(k.length==1){d[1]=new Phaser.Point(f,e)}else{for(var c=1;c<k.length;c++){if(c!=k.length-1){d[c]=new Phaser.Point((k[c].y+0.5)*Adventurous.Constants.TILE_SIZE,(k[c].x+0.5)*Adventurous.Constants.TILE_SIZE)}else{d[c]=new Phaser.Point(f,e)}}}return d},smoothPath:function(c){var b=true;while(b){b=false;for(var a=1;a<c.length-1;a++){if(this.lineOfSight(c[a-1].y,c[a-1].x,c[a+1].y,c[a+1].x)){c.splice(a,1);a--;b=true}}}return c},lineOfSight:function(d,f,b,e){var a=new Phaser.Point(d,f);var c=new Phaser.Point(b-d,e-f).normalize();c.x=c.x*0.25;c.y=c.y*0.25;var g=false;while(!g){a.x+=c.x;a.y+=c.y;if(Adventurous.Constants.WALKABLE_TILES.indexOf(this.map.getTile(Math.floor(a.x),Math.floor(a.y)).index)==-1){return false}g=((b==d)||(b>d&&a.x>=b)||(b<d&&a.x<=b))&&((e==f)||(e>f&&a.y>=e)||(e<f&&a.y<=e))}return true},init:function(c){if(c.things!=null){for(var b=0;b<c.things.length;b++){var a=new Adventurous.Thing(c.things[b]);Adventurous.thingsMap[a.name]=a;Adventurous.thingsArray[Adventurous.thingsArray.length]=a;if(a.name!=Adventurous.Constants.PLAYER_NAME){this.things[this.things.length]=a}else{Adventurous.startingScene=this.name}}}if(c.triggerAreas!=null){for(var b=0;b<c.triggerAreas.length;b++){this.triggerAreas[b]=new Adventurous.TriggerArea(c.triggerAreas[b])}}if(c.entrances!=null){for(var b=0;b<c.entrances.length;b++){this.entrances[c.entrances[b].name]=c.entrances[b]}}},hide:function(){this.background.visible=false;for(var a=0;a<this.things.length;a++){this.things[a].stopTalking()}},show:function(){this.background.visible=true},toSaveObject:function(){var b={};b.name=this.name;b.things=[];for(var a=0;a<this.things.length;a++){b.things[b.things.length]=this.things[a].toSaveObject()}return b},loadFromObject:function(b){this.things=new Array();for(var a=0;a<b.things.length;a++){Adventurous.thingsMap[b.things[a].name].loadFromObject(b.things[a]);this.things[this.things.length]=Adventurous.thingsMap[b.things[a].name]}}};Adventurous.Thing=function(g){this.name=g.name;this.walks=g.walks;this.imageName=g.image;this.alias=g.alias;if(this.imageName==null){this.imageName=this.name}this.sprite=game.add.sprite(parseInt(g.x),parseInt(g.y),this.imageName);game.physics.enable(this.sprite,Phaser.Physics.ARCADE,true);if(this.sprite.width%2!=0){this.sprite.x-=0.5}this.oldFrame=0;this.bitmapData=game.add.bitmapData(this.sprite.width,this.sprite.height);this.refreshBitmapData();if(g.anims!=null){for(var d=0;d<g.anims.length;d++){var e=g.anims[d];var f=1;if(e.fps!=null){f=e.fps}var c=false;if(e.loop!=null){c=e.loop}this.sprite.animations.add(e.name,e.frames,f,c)}if(this.walks){this.sprite.animations.play(Adventurous.Constants.ANIM_IDLE+"S")}else{this.sprite.animations.play(Adventurous.Constants.ANIM_IDLE)}}this.sprite.anchor.x=0.5;this.sprite.anchor.y=1;this.sprite.body.y-=this.sprite.height;this.sprite.body.x-=this.sprite.width/2;this.isInventoryItem=g.isInventoryItem;this.MOVE_SPEED=Adventurous.Constants.DEFAULT_MOVE_SPEED;if(g.speed!=null){this.MOVE_SPEED=g.speed}this.CURRENT_MOVE_SPEED=this.MOVE_SPEED;this.moveSpeed=this.MOVE_SPEED;this.observations=Adventurous.observations[this.name];this.interactions=Adventurous.interactions[this.name];if(this.observations==null){this.observations=new Adventurous.Observations(null)}if(this.interactions==null){this.interactions=new Adventurous.Interactions(null,this.name)}this.usableZone=new Array();if(g.usableZone=="near"){var b=Math.floor(this.sprite.body.x/Adventurous.Constants.TILE_SIZE);var a=Math.floor(this.sprite.body.y/Adventurous.Constants.TILE_SIZE);while(a*Adventurous.Constants.TILE_SIZE<=this.sprite.body.bottom){while(b*Adventurous.Constants.TILE_SIZE<=this.sprite.body.right){this.usableZone[this.usableZone.length]=new Phaser.Point(b,a);b+=1}b=Math.floor(this.sprite.body.x/Adventurous.Constants.TILE_SIZE);a+=1}}else{if(g.usableZone=="any"){this.usableZone="any"}else{if(g.usableZone!=null){for(var d=0;d<g.usableZone.length;d++){this.usableZone[d]=new Phaser.Point(parseInt(g.usableZone[d].x),parseInt(g.usableZone[d].y))}}}}this.waypoints;this.destination=null;this.destinationThing=null;this.dialogueLabelColor=g.dialogueLabelColor;if(this.dialogueLabelColor!=null){this.dialogueLabelShadowColor=g.dialogueLabelShadowColor;if(this.dialogueLabelShadowColor==null){this.dialogueLabelShadowColor="#000000"}}this.createLabel();this.showLabelCountdown=0;this.talking=false;this.currentSpeech=null;this.tempVelocityX;this.tempVelocityY;this.startHidden=g.startHidden;this.hasBeenHidden=false;this.isBackground=g.isBackground;this.isForeground=g.isForeground;this.isNoninteractive=g.isNoninteractive;this.isScalable=g.isScalable;this.routines={};if(g.routines!=null){for(var d=0;d<g.routines.length;d++){if(g.routines[d].name!=null){this.routines[g.routines[d].name]=g.routines[d]}}}this.startingRoutine=g.startingRoutine;this.automateWalkAnimation=true;this.talkTime=0;this.dialogueTime=Adventurous.Constants.dialogueTime;this.hide()};Adventurous.Thing.prototype={update:function(){if(this.startingRoutine!=null){this.startRoutine(this.startingRoutine);this.startingRoutine=null}if(this.sprite.frame!=this.oldFrame){this.refreshBitmapData()}var a=this.dialogueLabel;if(a==null||!a.visible){a=this.label}if(a!=null&&a.visible){if(this.showLabelCountdown>0){if(--this.showLabelCountdown==0){a.alpha=1}}this.positionLabel(a);if(!this.talking){a.visible=false}else{if(!this.currentSpeech.audio.isPlaying){if(this.talkTime>this.dialogueTime){this.stopTalking()}else{this.talkTime+=game.time.elapsed}}}}if(this.destination!=null){var c=(this.sprite.body.velocity.x>0&&this.sprite.x>=this.destination.x)||(this.sprite.body.velocity.x<0&&this.sprite.x<=this.destination.x);var b=(this.sprite.body.velocity.y>0&&this.sprite.y>=this.destination.y)||(this.sprite.body.velocity.y<0&&this.sprite.y<=this.destination.y);if(c){this.sprite.body.velocity.x=0;this.sprite.body.prev.x=this.sprite.body.x;this.sprite.x=this.destination.x}if(b){this.sprite.body.velocity.y=0;this.sprite.body.prev.y=this.sprite.body.y;this.sprite.y=this.destination.y}if(this.sprite.body.velocity.x==0&&this.sprite.body.velocity.y==0){this.destination=null;this.nextWaypoint()}}else{if(this.activeRoutine!=null){this.activeRoutine.update()}}if(this.loadFramesDelay>0){this.loadFramesDelay-=1}},followPath:function(b,a){this.waypoints=b;this.destinationThing=a;this.nextWaypoint()},moveTo:function(a,c){if(typeof(c)=="undefined"){c=this.moveSpeed}var b=new Phaser.Point(a.x-this.sprite.x,a.y-this.sprite.y).normalize();this.sprite.body.velocity.x=b.x*c;this.sprite.body.velocity.y=b.y*c;if(this.automateWalkAnimation){this.sprite.animations.play("walk"+this.getAnimationDirection())}this.destination=a},getAnimationDirection:function(){this.dirAnim="";if(Math.abs(this.sprite.body.velocity.x)>=Math.abs(this.sprite.body.velocity.y)){if(this.sprite.body.velocity.x>0){this.dirAnim+="E"}else{if(this.sprite.body.velocity.x<0){this.dirAnim+="W"}}}else{if(this.sprite.body.velocity.y>0){this.dirAnim="S"}else{if(this.sprite.body.velocity.y<0){this.dirAnim="N"}}}return this.dirAnim},face:function(c){var b=this.sprite.animations.currentAnim.name;if(b.indexOf("walk")==0||b.indexOf("idle")==0){var a=c.sprite.x-this.sprite.x;var d=c.sprite.y-this.sprite.y;if(Math.abs(a)>=Math.abs(d)){if(a>=0){this.dirAnim="E"}else{this.dirAnim="W"}}else{if(d>=0){this.dirAnim="S"}else{this.dirAnim="N"}}this.sprite.play(Adventurous.Constants.ANIM_IDLE+this.dirAnim)}},getFacing:function(){var a="";if(this.dirAnim!=null&&this.dirAnim!=""){a=this.dirAnim}else{var b=this.sprite.animations.currentAnim.name;if(b!=null&&b.length>0){switch(b[b.length-1]){case"N":case"S":case"E":case"W":a=b[b.length-1];break;default:a=""}}}return a},nextWaypoint:function(){if(this.waypoints.length>0){this.moveTo(this.waypoints[0]);this.waypoints.splice(0,1)}else{if(this.automateWalkAnimation){this.sprite.animations.play(Adventurous.Constants.ANIM_IDLE+this.getFacing())}else{this.automateWalkAnimation=true}}},getTileX:function(){return Math.floor(this.sprite.x/Adventurous.Constants.TILE_SIZE)},getTileY:function(){return Math.floor(this.sprite.y/Adventurous.Constants.TILE_SIZE)},setScale:function(b){if(b!=this.sprite.scale.x){var a=b/this.sprite.scale.x;this.sprite.body.velocity.x*=a;this.sprite.body.velocity.y*=a}this.sprite.scale.x=b;this.sprite.scale.y=b;this.moveSpeed=this.CURRENT_MOVE_SPEED*b},createInventoryIcon:function(a){if(this.isInventoryItem){this.icon=game.add.sprite(0,0,this.imageName+"_inv");game.physics.enable(this.icon,Phaser.Physics.ARCADE,true);this.icon.visible=false}else{this.icon=null}},createLabel:function(){this.label=game.add.group();this.label.add(game.add.text(Adventurous.Constants.LABEL_SHADOW_OFFSET_X,Adventurous.Constants.LABEL_SHADOW_OFFSET_Y,this.getDisplayName(),Adventurous.Constants.LABEL_SHADOW_STYLE));this.label.add(game.add.text(0,0,this.getDisplayName(),Adventurous.Constants.LABEL_STYLE));this.label.getAt(0).anchor.x=0;this.label.getAt(1).anchor.x=0;this.label.visible=false;if(this.dialogueLabelColor!=null){var a={font:"17px AdventurousFont",fill:this.dialogueLabelColor,align:"center"};var b={font:"17px AdventurousFont",fill:this.dialogueLabelShadowColor,align:"center"};this.dialogueLabel=game.add.group();this.dialogueLabel.add(game.add.text(Adventurous.Constants.LABEL_SHADOW_OFFSET_X,Adventurous.Constants.LABEL_SHADOW_OFFSET_Y,"",b));this.dialogueLabel.add(game.add.text(0,0,"",a));this.dialogueLabel.getAt(0).anchor.x=0;this.dialogueLabel.getAt(1).anchor.x=0;this.dialogueLabel.visible=false}else{this.dialogueLabel=null}},setLabelText:function(b,a){if(a!=null&&a.length==2&&b!=a.getAt(0).text){this.showLabelCountdown=2;a.alpha=0;a.getAt(0).setText(b);a.getAt(1).setText(b)}},setLabelUseText:function(a){this.setLabelText(this.interactions.getUseText(a,this.getDisplayName()),this.label)},getNearestTile:function(a){var d=-1;var c=null;for(var b=0;b<a.length;b++){var e=Phaser.Math.distance(this.getTileX(),this.getTileY(),a[b].x,a[b].y);if(c==null||e<d){d=e;c=a[b]}}return c},showLabel:function(a){a.visible=true;this.positionLabel(a)},getDepth:function(){return game.world.children.indexOf(this.sprite)},readyToUseSomething:function(){return this.destination==null&&this.destinationThing!=null},useThing:function(a){if(!this.destinationThing.interactions.use(this,a)){this.say(Adventurous.speeches.default_no_use)}this.destinationThing=null},say:function(a,b){this.animBeforeTalking=this.sprite.animations.currentAnim.name;if(b==null){if(this.animBeforeTalking.indexOf("idle")==-1&&this.animBeforeTalking.indexOf("walk")==-1){b=this.animBeforeTalking+"Talk"}else{b="say"+this.getFacing()}}this.talking=true;this.currentSpeech=a;if(this.dialogueLabel!=null){this.setLabelText('"'+a.text+'"',this.dialogueLabel);this.showLabel(this.dialogueLabel)}else{this.setLabelText('"'+a.text+'"',this.label);this.showLabel(this.label)}if(game.cache.getKeys(Phaser.Cache.SOUND).indexOf(a.audio.name)!=-1){a.audio.play("",0,Adventurous.options.soundVolume)}this.talkTime=0;this.dialogueTime=Adventurous.Util.calculateDialogueMinTime(a.text);this.destinationThing=null;if(b!=null&&this.sprite.animations.getAnimation(Adventurous.Constants.ANIM_IDLE+this.getFacing())!=null){this.sprite.animations.play(b)}},stopTalking:function(){this.talkTime=0;if(this.currentSpeech){this.currentSpeech.audio.stop()}this.talking=false;if(this.dialogueLabel!=null){this.dialogueLabel.visible=false;this.setLabelText("",this.dialogueLabel)}this.label.visible=false;this.setLabelText(this.getDisplayName(),this.label);this.sprite.animations.play(this.animBeforeTalking);this.animBeforeTalking=null},getDisplayName:function(){if(this.alias!=null&&this.alias!=""){return this.alias}else{return this.name}},stopMoving:function(a){this.sprite.body.velocity.x=0;this.sprite.body.velocity.y=0;this.sprite.x=Phaser.Math.roundTo(this.sprite.x);this.sprite.y=Phaser.Math.roundTo(this.sprite.y);this.sprite.body.prev.x=this.sprite.body.x;this.sprite.body.prev.y=this.sprite.body.y;this.waypoints=null;this.destination=null;this.destinationThing=null;var b=this.sprite.animations.currentAnim.name;if(a!=true||b.indexOf("walk")==0||b.indexOf("idle")==0){if(this.sprite.animations.getAnimation(Adventurous.Constants.ANIM_IDLE+this.getFacing())){this.sprite.animations.play(Adventurous.Constants.ANIM_IDLE+this.getFacing())}else{this.sprite.animations.play(Adventurous.Constants.ANIM_IDLE)}}},positionLabel:function(b){var d="center";var a=this.sprite.body.center.x-b.getAt(0).width/2;var c=this.sprite.body.y-b.getAt(0).height*1.25+Adventurous.Constants.BROWSER_LABEL_Y_OFFSET;if(a<5){a=5;d="left"}else{if(a>game.world.width-5-b.getAt(0).width){a=game.world.width-5-b.getAt(0).width;d="right"}}if(c<b.getAt(0).height){c=b.getAt(0).height}a=Math.floor(a);c=Math.floor(c);b.getAt(0).align=d;b.getAt(1).align=d;b.x=a;b.y=c},setPosition:function(a,b){this.sprite.x=a;this.sprite.y=b;this.positionLabel(this.label);if(this.dialogueLabel!=null){this.positionLabel(this.dialogueLabel)}},freeze:function(){this.tempVelocityX=this.sprite.body.velocity.x;this.tempVelocityY=this.sprite.body.velocity.y;this.sprite.body.velocity.x=0;this.sprite.body.prev.x=this.sprite.body.x;this.sprite.body.velocity.y=0;this.sprite.body.prev.y=this.sprite.body.y;if(!this.talking){this.label.visible=false;if(this.dialogueLabel!=null){this.dialogueLabel.visible=false}}if(this.currentSpeech){this.currentSpeech.audio.pause()}if(this.sprite.animations.currentAnim){this.sprite.animations.paused=true}},unfreeze:function(){this.sprite.body.velocity.x=this.tempVelocityX;this.sprite.body.velocity.y=this.tempVelocityY;if(this.currentSpeech){this.currentSpeech.audio.resume()}if(this.sprite.animations.currentAnim){this.sprite.animations.paused=false}},hide:function(){this.hidden=true;this.sprite.alpha=0},show:function(){this.hidden=false;this.sprite.alpha=1},isVisible:function(){return this.sprite.alpha>0},isStandingIn:function(a){return !(this.loadFramesDelay>0)&&a.contains(this.sprite.body.center.x,this.sprite.body.bottom)},refreshBitmapData:function(){this.oldFrame=this.sprite.frame;this.bitmapData.clear();this.bitmapData.draw(this.sprite);this.bitmapData.update()},startRoutine:function(a){if(this.routines[a]!=null){this.activeRoutine=new Adventurous.Effects(this,this.routines[a].effects,this.routines[a].name,true,true)}},stopRoutine:function(){this.stopMoving();if(this.talking){this.stopTalking()}this.activeRoutine=null},updateScale:function(){if(this.isScalable){if(currentState.scene.scales!=null){var j=0;var c=0;var e=1;var a=game.height;for(var f=0;f<currentState.scene.scales.length;f++){var d=currentState.scene.scales[f];if(d.y>c&&d.y<=this.sprite.y){j=d.scale;c=d.y}if(d.y<a&&d.y>=this.sprite.y){e=d.scale;a=d.y}}var b=e-j;var h=a-c;var g=j+b*(this.sprite.y-c)/h;this.setScale(g)}else{this.setScale(1)}}},toSaveObject:function(){var b={};b.name=this.name;b.alias=this.alias;b.waypoints=this.waypoints;b.destination=this.destination;if(this.destinationThing!=null){b.destinationThing=this.destinationThing.name}b.talking=this.talking;b.tempVelocityX=this.tempVelocityX;b.tempVelocityY=this.tempVelocityY;b.velocityX=this.sprite.body.velocity.x;b.velocityY=this.sprite.body.velocity.y;var a=Math.floor(this.sprite.x);var c=Math.floor(this.sprite.y);if(this.sprite.width%2!=0){a+=0.5}b.x=a;b.y=c;b.automateWalkAnimation=this.automateWalkAnimation;b.alpha=this.sprite.alpha;b.hidden=this.hidden;b.hasBeenHidden=this.hasBeenHidden;b.dirAnim=this.dirAnim;if(this.sprite.animations.currentAnim!=null){b.anim=this.sprite.animations.currentAnim.name}return b},loadFromObject:function(a){this.alias=a.alias;this.waypoints=a.waypoints;this.destination=a.destination;if(a.destinationThing!=null){this.destinationThing=Adventurous.thingsMap[a.destinationThing]}this.talking=a.talking;this.tempVelocityX=a.tempVelocityX;this.tempVelocityY=a.tempVelocityY;this.sprite.body.velocity.x=a.velocityX;this.sprite.body.velocity.y=a.velocityY;this.sprite.x=a.x;this.sprite.y=a.y;this.loadFramesDelay=2;this.automateWalkAnimation=a.automateWalkAnimation;this.hidden=a.hidden;this.hasBeenHidden=a.hasBeenHidden;this.sprite.alpha=a.alpha;this.dirAnim=a.dirAnim;if(a.anim!=null){this.sprite.animations.play(a.anim)}},bringLabelsToTop:function(){if(this.label!=null){game.world.bringToTop(this.label)}if(this.dialogueLabel!=null){game.world.bringToTop(this.dialogueLabel)}}};Adventurous.TriggerArea=function(a){this.name=a.name;this.rect=new Phaser.Rectangle(parseInt(a.x),parseInt(a.y),parseInt(a.w),parseInt(a.h));this.overlapsPlayer=false;this.conditions=a.conditions;this.interactions=Adventurous.interactions[this.name]};Adventurous.TriggerArea.prototype={update:function(){if(currentState.activeEffects==null&&Adventurous.Util.areConditionsMet(this.conditions)){for(var b=0;b<this.interactions.withItem[""].interactions.length;b++){var a=this.interactions.withItem[""].interactions[b];switch(a.when){case Adventurous.Constants.ON_ENTER:if(this.playerJustEntered()){if(Adventurous.Util.areConditionsMet(a.conditions)){currentState.activeEffects=new Adventurous.Effects(currentState.player,a.effects,this.name);currentState.cursor.hide()}}break;case Adventurous.Constants.ON_EXIT:if(this.playerJustExited()){if(Adventurous.Util.areConditionsMet(a.conditions)){currentState.activeEffects=new Adventurous.Effects(currentState.player,a.effects,this.name);currentState.cursor.hide()}}break}}}},playerJustEntered:function(){if(!this.overlapsPlayer){this.overlapsPlayer=currentState.player.isStandingIn(this.rect);return this.overlapsPlayer}else{return false}},playerJustExited:function(){if(this.overlapsPlayer){this.overlapsPlayer=currentState.player.isStandingIn(this.rect);return !this.overlapsPlayer}else{return false}}};Adventurous.Speech=function(b,a){this.text=b;this.audio=a};Adventurous.Inventory=function(b){this.background=game.add.sprite(game.width/2,game.height/2,"inventory_background");game.physics.enable(this.background,Phaser.Physics.ARCADE,true);this.background.anchor.x=0.5;this.background.anchor.y=0.5;this.background.visible=false;this.talking=false;this.currentSpeech=null;this.borderThickness=Adventurous.Constants.INVENTORY_PADDING;this.columns=Math.floor((this.background.width-2*this.borderThickness)/Adventurous.Constants.INVENTORY_ITEM_SIZE);this.rows=Math.floor((this.background.height-2*this.borderThickness)/Adventurous.Constants.INVENTORY_ITEM_SIZE);this.inventoryKey=game.input.keyboard.addKey(Phaser.Keyboard.I);this.inventoryKey.onDown.add(this.toggleInventory,this);this.iconGroup=game.add.group();this.items=new Array();for(var a=0;a<b.length;a++){if(b[a].isInventoryItem){this.addItem(b[a],null,false)}}this.organizeIcons();this.itemUnderMouse=null;this.label=game.add.group();this.label.add(game.add.text(Adventurous.Constants.LABEL_SHADOW_OFFSET_X,Adventurous.Constants.LABEL_SHADOW_OFFSET_Y,"",Adventurous.Constants.LABEL_SHADOW_STYLE));this.label.add(game.add.text(0,0,"",Adventurous.Constants.LABEL_STYLE));this.label.getAt(0).anchor.x=0.5;this.label.getAt(1).anchor.x=0.5;this.label.visible=false;this.enabled=false;this.talkTime=0;this.itemsPerRow=Math.floor((this.background.width-Adventurous.Constants.INVENTORY_PADDING*2)/Adventurous.Constants.INVENTORY_ITEM_SIZE)};Adventurous.Inventory.prototype={update:function(){if(this.background.visible){this.getItemUnderMouse();if(this.talking){if(!this.currentSpeech.audio.isPlaying){if(this.talkTime>Adventurous.Constants.DIALOGUE_MIN_TIME){this.labelReady=false;this.stopTalking()}else{this.talkTime+=game.time.elapsed}}}else{if(this.itemUnderMouse==null||this.itemUnderMouse==currentState.cursor.item){this.labelReady=false;this.label.visible=false}else{if(this.labelReady){if(!this.label.visible){this.label.visible=true}else{this.positionLabel()}}else{this.label.y=-9999;this.labelReady=true;if(currentState.cursor.item!=null){this.setLabelUseText(currentState.cursor.item.name)}else{this.setLabelText(this.itemUnderMouse.name)}}}}if(currentState.cursor.item!=null&&!this.isMouseInInventory()){this.label.visible=false;this.toggleInventory()}}},toggleInventory:function(){if(this.enabled&&currentState.activeEffects==null&&!currentState.pauseMenu.background.visible){this.background.visible=!this.background.visible;for(var a=0;a<this.items.length;a++){this.items[a].icon.visible=this.background.visible}if(!this.background.visible){this.label.visible=false;currentState.unfreeze()}else{currentState.freeze()}}},addItem:function(c,b,a){if(c.icon==null){c.createInventoryIcon()}if(b!=null){this.items.splice(b,0,c)}else{this.items.push(c)}if(a!=false){this.organizeIcons()}},removeItem:function(b,a){this.items.splice(this.items.indexOf(b),1);if(currentState.cursor.item==b){currentState.cursor.setItem(null)}if(a!=false){this.organizeIcons()}},organizeIcons:function(){this.iconGroup.removeAll();for(var a=0;a<this.items.length;a++){var c=this.items[a];var b=a%this.columns;var d=Math.floor(a/this.itemsPerRow);c.hide();c.icon.x=this.background.x-this.background.width/2+this.borderThickness+b*Adventurous.Constants.INVENTORY_ITEM_SIZE;c.icon.y=this.background.y-this.background.height/2+this.borderThickness+d*Adventurous.Constants.INVENTORY_ITEM_SIZE;c.icon.visible=this.background.visible;this.iconGroup.add(c.icon)}},mouseDown:function(a){if(!this.isMouseInInventory()){this.toggleInventory()}else{if(a.button==Adventurous.Constants.LMB){if(this.itemUnderMouse!=null){if(currentState.cursor.item!=null){this.stopTalking();this.combineItems()}else{currentState.cursor.setItem(this.itemUnderMouse)}}}else{if(a.button==Adventurous.Constants.RMB){if(currentState.cursor.item!=null){currentState.cursor.setItem(null)}else{if(this.itemUnderMouse!=null){this.stopTalking();this.say(this.itemUnderMouse.observations.next())}}}}}},getItemUnderMouse:function(){this.itemUnderMouse=null;for(var a=0;a<this.items.length;a++){if(Phaser.Rectangle.contains(this.items[a].icon.body,game.input.mousePointer.x,game.input.mousePointer.y)){this.itemUnderMouse=this.items[a]}}},hasItem:function(a){for(var b=0;b<this.items.length;b++){if(a==this.items[b].name){return true}}return false},combineItems:function(){if(this.itemUnderMouse!=null&&currentState.cursor.item!=null&&this.itemUnderMouse!=currentState.cursor.item){var b=Adventurous.combinations[this.itemUnderMouse.name];if(b!=null&&b[currentState.cursor.item.name]!=null){var c=b[currentState.cursor.item.name];if(c.result!=null){var a=Adventurous.thingsMap[c.result];this.addItem(a,this.items.indexOf(this.itemUnderMouse),false);this.removeItem(this.itemUnderMouse,false);this.removeItem(currentState.cursor.item,false);this.itemUnderMouse=null;currentState.cursor.setItem(null);this.organizeIcons();this.itemUnderMouse=a;this.itemUnderMouse.icon.body.x=this.itemUnderMouse.icon.x;this.itemUnderMouse.icon.body.y=this.itemUnderMouse.icon.y}if(c.speech!=null){this.say(Adventurous.speeches[c.speech])}}else{this.say(Adventurous.speeches.default_no_use)}}},say:function(a){this.talking=true;this.currentSpeech=a;this.setLabelText('"'+a.text+'"');this.positionLabel();this.label.visible=true;if(game.cache.getKeys(Phaser.Cache.SOUND).indexOf(a.audio.name)!=-1){a.audio.play("",0,Adventurous.options.soundVolume)}a.audio.startTime=game.time.now},stopTalking:function(){this.talkTime=0;if(this.currentSpeech){this.currentSpeech.audio.stop()}this.talking=false;this.label.visible=false},setLabelText:function(a){this.label.getAt(0).setText(a);this.label.getAt(1).setText(a)},setLabelUseText:function(a){this.setLabelText(this.itemUnderMouse.interactions.getUseText(a,this.itemUnderMouse.getDisplayName()))},positionLabel:function(){this.label.x=Math.floor(Math.min(this.background.body.x+this.background.width-this.label.getAt(0).width/2,Math.max(this.background.body.x+this.label.getAt(0).width/2,this.itemUnderMouse.icon.body.center.x)));this.label.y=Math.floor(this.itemUnderMouse.icon.body.y-this.label.getAt(0).height*1.25);if(this.label.getAt(0).width%2==1){this.label.x+=0.5}},isMouseInInventory:function(){var a=0;var b=0;if(currentState.cursor.item!=null){a=currentState.cursor.sprite.width;b=currentState.cursor.sprite.height}var c=new Phaser.Rectangle(this.background.body.x+Adventurous.Constants.INVENTORY_MARGIN,this.background.body.y+Adventurous.Constants.INVENTORY_MARGIN,this.background.body.width-Adventurous.Constants.INVENTORY_MARGIN*2-a,this.background.body.height-Adventurous.Constants.INVENTORY_MARGIN*2-b);return(Phaser.Rectangle.contains(c,game.input.mousePointer.x,game.input.mousePointer.y))},toSaveObject:function(){var b={};b.items=new Array();for(var a=0;a<this.items.length;a++){b.items[a]=this.items[a].name}return b},loadFromObject:function(b){this.items=new Array();for(var a=0;a<b.items.length;a++){this.addItem(Adventurous.thingsMap[b.items[a]],null,false)}this.organizeIcons()}};Adventurous.Button=function(a,f,c,b,e,d){this.buttonGroup=game.add.group();this.background=game.add.sprite(a,f,b);this.background.animations.add("normal",[0]);this.background.animations.add("highlight",[1]);this.background.x-=Math.floor(this.background.width/2);this.normalStyle=e;this.highlightStyle=d;this.label=game.add.text(a,f+Adventurous.Constants.BROWSER_LABEL_Y_OFFSET,c,e);this.label.x-=Math.floor(this.label.width/2);this.label.x+=3;this.label.y+=3;this.buttonGroup.add(this.background);this.buttonGroup.add(this.label)};Adventurous.Button.prototype={updateLabel:function(){if(Adventurous.Util.isMouseOverObject(this.background)){this.label.setStyle(this.highlightStyle);this.background.animations.play("highlight")}else{this.label.setStyle(this.normalStyle);this.background.animations.play("normal")}}};Adventurous.Slider=function(a,c,b){this.dragging=false;this.value=b;this.prevX=-1;this.sliderGroup=game.add.group();this.background=game.add.sprite(a,c,"slider_bg");this.slider=game.add.sprite(this.background.x+b*this.background.width,c,"slider");this.slider.x-=Math.floor(this.slider.width/2);this.slider.x=Math.min(this.background.x+this.background.width-this.slider.width,Math.max(this.slider.x,this.background.x));this.sliderGroup.add(this.background);this.sliderGroup.add(this.slider);game.input.onDown.add(this.mouseDown,this);game.input.onUp.add(this.mouseUp,this)};Adventurous.Slider.prototype={update:function(){if(this.dragging){this.slider.x+=(game.input.mousePointer.x-this.prevX);this.slider.x=Math.min(this.background.x+this.background.width-this.slider.width,Math.max(this.slider.x,this.background.x));this.prevX=game.input.mousePointer.x}},mouseDown:function(){if(this.sliderGroup.visible){if(Adventurous.Util.isMouseOverObject(this.slider)){this.dragging=true;this.prevX=game.input.mousePointer.x}else{this.dragging=false}}},mouseUp:function(){this.dragging=false;this.value=(this.slider.x-this.background.x)/(this.background.width-this.slider.width)},hide:function(){this.sliderGroup.visible=false},show:function(){this.sliderGroup.visible=true},setValue:function(a){this.slider.x=this.background.x+a*this.background.width;this.slider.x-=Math.floor(this.slider.width/2);this.slider.x=Math.min(this.background.x+this.background.width-this.slider.width,Math.max(this.slider.x,this.background.x))}};Adventurous.ToggleButton=function(a,c,b){this.selected=b;this.justChanged=false;this.sprite=game.add.sprite(a,c,"toggle_button");this.sprite.animations.add("off",[0]);this.sprite.animations.add("on",[1]);if(this.selected){this.sprite.animations.play("on")}else{this.sprite.animations.play("off")}game.input.onDown.add(this.mouseDown,this);this.enabled=true};Adventurous.ToggleButton.prototype={mouseDown:function(){if(this.sprite.visible&&this.sprite.parent.visible&&this.enabled){if(Adventurous.Util.isMouseOverObject(this.sprite)){this.toggle()}}},toggle:function(){var a=game.add.audio(Adventurous.Constants.MENU_BUTTON_SOUND);a.volume=Adventurous.options.soundVolume;a.play();this.justChanged=true;this.selected=!this.selected;if(this.selected){this.sprite.animations.play("on")}else{this.sprite.animations.play("off")}},setSelected:function(b,a){if(a!=true){this.justChanged=true}this.selected=b;if(this.selected){this.sprite.animations.play("on")}else{this.sprite.animations.play("off")}},hide:function(){this.sprite.visible=false},show:function(){this.sprite.visible=true}};Adventurous.PauseMenu=function(){this.background=game.add.sprite(game.width/2,game.height/2,"pause_menu_background");game.physics.enable(this.background,Phaser.Physics.ARCADE,true);this.background.anchor.x=0.5;this.background.anchor.y=0.5;this.background.visible=false;this.enabled=false;this.menuButtons=[];this.menuGroup=game.add.group();this.menuGroup.visible=false;this.escapeKey=game.input.keyboard.addKey(Phaser.Keyboard.ESC);this.escapeKey.onDown.add(this.togglePauseMenu,this);var c=Adventurous.Constants.PAUSE_MENU_FIRST_ITEM_Y_POS;var b=new Adventurous.Button(this.background.x,c,"Continue","pauseMenu_button",Adventurous.Constants.DIALOGUE_LABEL_STYLE,Adventurous.Constants.SELECTED_DIALOGUE_LABEL_STYLE);this.menuButtons[this.menuButtons.length]=b;this.menuGroup.add(b.buttonGroup);c+=Adventurous.Constants.PAUSE_MENU_LINE_HEIGHT;b=new Adventurous.Button(this.background.x,c,"Save Game","pauseMenu_button",Adventurous.Constants.DIALOGUE_LABEL_STYLE,Adventurous.Constants.SELECTED_DIALOGUE_LABEL_STYLE);this.saveButton=b;this.menuButtons[this.menuButtons.length]=b;this.menuGroup.add(b.buttonGroup);c+=Adventurous.Constants.PAUSE_MENU_LINE_HEIGHT;b=new Adventurous.Button(this.background.x,c,"Load Game","pauseMenu_button",Adventurous.Constants.DIALOGUE_LABEL_STYLE,Adventurous.Constants.SELECTED_DIALOGUE_LABEL_STYLE);this.menuButtons[this.menuButtons.length]=b;this.menuGroup.add(b.buttonGroup);c+=Adventurous.Constants.PAUSE_MENU_LINE_HEIGHT;b=new Adventurous.Button(this.background.x,c,"Options","pauseMenu_button",Adventurous.Constants.DIALOGUE_LABEL_STYLE,Adventurous.Constants.SELECTED_DIALOGUE_LABEL_STYLE);this.menuButtons[this.menuButtons.length]=b;this.menuGroup.add(b.buttonGroup);c+=Adventurous.Constants.PAUSE_MENU_LINE_HEIGHT;b=new Adventurous.Button(this.background.x,c,"Help","pauseMenu_button",Adventurous.Constants.DIALOGUE_LABEL_STYLE,Adventurous.Constants.SELECTED_DIALOGUE_LABEL_STYLE);this.menuButtons[this.menuButtons.length]=b;this.menuGroup.add(b.buttonGroup);c+=Adventurous.Constants.PAUSE_MENU_LINE_HEIGHT;b=new Adventurous.Button(this.background.x,c,"Quit","pauseMenu_button",Adventurous.Constants.DIALOGUE_LABEL_STYLE,Adventurous.Constants.SELECTED_DIALOGUE_LABEL_STYLE);this.menuButtons[this.menuButtons.length]=b;this.menuGroup.add(b.buttonGroup);this.helpButtons=[];this.helpGroup=game.add.group();this.helpGroup.visible=false;c=Adventurous.Constants.PAUSE_MENU_FIRST_ITEM_Y_POS;var a=game.add.text(this.background.x,c,Adventurous.Constants.HELP_TEXT,Adventurous.Constants.DIALOGUE_LABEL_STYLE);a.x-=Math.floor(a.width/2);this.helpGroup.add(a);c=this.background.height-c-Adventurous.Constants.PAUSE_MENU_LINE_HEIGHT;b=new Adventurous.Button(this.background.x,c,"OK","pauseMenu_button",Adventurous.Constants.DIALOGUE_LABEL_STYLE,Adventurous.Constants.SELECTED_DIALOGUE_LABEL_STYLE);this.helpButtons[this.helpButtons.length]=b;this.helpGroup.add(b.buttonGroup);this.optionsButtons=[];this.optionsGroup=game.add.group();this.optionsGroup.visible=false;c=Adventurous.Constants.PAUSE_MENU_FIRST_ITEM_Y_POS;a=game.add.text(this.background.x+5,c,"Sound Volume:",Adventurous.Constants.DIALOGUE_LABEL_STYLE);a.x-=a.width;this.optionsGroup.add(a);this.soundVolumeSlider=new Adventurous.Slider(a.x+a.width+10,c,Adventurous.options.soundVolume);this.optionsGroup.add(this.soundVolumeSlider.sliderGroup);c+=Adventurous.Constants.PAUSE_MENU_LINE_HEIGHT;a=game.add.text(this.background.x+5,c,"Music Volume:",Adventurous.Constants.DIALOGUE_LABEL_STYLE);a.x-=a.width;this.optionsGroup.add(a);this.musicVolumeSlider=new Adventurous.Slider(a.x+a.width+10,c,Adventurous.options.musicVolume);this.optionsGroup.add(this.musicVolumeSlider.sliderGroup);if(Adventurous.Constants.HAS_VOICE){c+=Adventurous.Constants.PAUSE_MENU_LINE_HEIGHT;a=game.add.text(this.background.x+5,c,"Voice:",Adventurous.Constants.DIALOGUE_LABEL_STYLE);a.x-=a.width;this.voiceToggleButton=new Adventurous.ToggleButton(a.x+a.width+10,c,Adventurous.options.voiceEnabled);this.optionsGroup.add(a);this.optionsGroup.add(this.voiceToggleButton.sprite)}c+=Adventurous.Constants.PAUSE_MENU_LINE_HEIGHT;this.textSpeedLabel=game.add.text(this.background.x+5,c,"Text Speed:",Adventurous.Constants.DIALOGUE_LABEL_STYLE);this.textSpeedLabel.x-=this.textSpeedLabel.width;this.textSpeedSlider=new Adventurous.Slider(this.textSpeedLabel.x+this.textSpeedLabel.width+10,c,Adventurous.options.textSpeed);this.optionsGroup.add(this.textSpeedLabel);this.optionsGroup.add(this.textSpeedSlider.sliderGroup);if(Adventurous.Constants.HAS_VOICE&&Adventurous.options.voiceEnabled){this.textSpeedLabel.setStyle(Adventurous.Constants.DISABLED_LABEL_STYLE);this.textSpeedSlider.hide()}c=this.background.height-Adventurous.Constants.PAUSE_MENU_FIRST_ITEM_Y_POS-Adventurous.Constants.PAUSE_MENU_LINE_HEIGHT;b=new Adventurous.Button(this.background.x,c,"OK","pauseMenu_button",Adventurous.Constants.DIALOGUE_LABEL_STYLE,Adventurous.Constants.SELECTED_DIALOGUE_LABEL_STYLE);this.optionsButtons[this.optionsButtons.length]=b;this.optionsGroup.add(b.buttonGroup);this.savegameButtons=[];this.savegameGroup=game.add.group();this.savegameGroup.visible=false;c=Adventurous.Constants.PAUSE_MENU_FIRST_ITEM_Y_POS;this.savegameToggle1=new Adventurous.ToggleButton(this.background.x+10,c,true);this.savegameToggle1.sprite.x-=Math.floor(Adventurous.Constants.PAUSE_MENU_WIDTH/2);this.savegameLabel1=game.add.text(this.savegameToggle1.sprite.x+this.savegameToggle1.sprite.width+10,c,"Save Slot A\nempty",Adventurous.Constants.SELECTED_DIALOGUE_LABEL_STYLE);this.savegameGroup.add(this.savegameLabel1);this.savegameGroup.add(this.savegameToggle1.sprite);c+=Adventurous.Constants.PAUSE_MENU_LINE_HEIGHT*2;this.savegameToggle2=new Adventurous.ToggleButton(this.background.x+10,c,false);this.savegameToggle2.sprite.x-=Math.floor(Adventurous.Constants.PAUSE_MENU_WIDTH/2);this.savegameLabel2=game.add.text(this.savegameToggle2.sprite.x+this.savegameToggle2.sprite.width+10,c,"Save Slot B\nempty",Adventurous.Constants.DIALOGUE_LABEL_STYLE);this.savegameGroup.add(this.savegameLabel2);this.savegameGroup.add(this.savegameToggle2.sprite);c+=Adventurous.Constants.PAUSE_MENU_LINE_HEIGHT*2;this.savegameToggle3=new Adventurous.ToggleButton(this.background.x+10,c,false);this.savegameToggle3.sprite.x-=Math.floor(Adventurous.Constants.PAUSE_MENU_WIDTH/2);this.savegameLabel3=game.add.text(this.savegameToggle3.sprite.x+this.savegameToggle2.sprite.width+10,c,"Save Slot C\nempty",Adventurous.Constants.DIALOGUE_LABEL_STYLE);this.savegameGroup.add(this.savegameLabel3);this.savegameGroup.add(this.savegameToggle3.sprite);c=this.background.height-Adventurous.Constants.PAUSE_MENU_FIRST_ITEM_Y_POS-10;b=new Adventurous.Button(this.background.x,c,"Save","pauseMenu_button",Adventurous.Constants.DIALOGUE_LABEL_STYLE,Adventurous.Constants.SELECTED_DIALOGUE_LABEL_STYLE);b.background.x-=Math.floor(b.background.width/2+5);b.label.x-=Math.floor(b.background.width/2+5);this.savegameButtons[this.savegameButtons.length]=b;this.savegameGroup.add(b.buttonGroup);c=this.background.height-Adventurous.Constants.PAUSE_MENU_FIRST_ITEM_Y_POS-10;b=new Adventurous.Button(this.background.x,c,"Cancel","pauseMenu_button",Adventurous.Constants.DIALOGUE_LABEL_STYLE,Adventurous.Constants.SELECTED_DIALOGUE_LABEL_STYLE);this.savegameButtons[this.savegameButtons.length]=b;b.background.x+=Math.floor(b.background.width/2+5);b.label.x+=Math.floor(b.background.width/2+5);this.savegameGroup.add(b.buttonGroup);this.savegameToggle1.enabled=false;this.savegameToggle2.enabled=true;this.savegameToggle3.enabled=true};Adventurous.PauseMenu.prototype={update:function(){if(this.background.visible){this.updateButtons()}},mouseDown:function(c){if(c.button==Adventurous.Constants.LMB){if(this.menuGroup.visible){for(var b=0;b<this.menuButtons.length;b++){var a=this.menuButtons[b];if(this.cursorWasHidden&&a==this.saveButton){continue}if(Adventurous.Util.isMouseOverObject(a.background)){this.selectOption(a.label.text)}}}else{if(this.helpGroup.visible){var d=this.helpButtons[0];if(Adventurous.Util.isMouseOverObject(d.background)){this.showGroup(this.menuGroup)}}else{if(this.optionsGroup.visible){this.handleOptionsButtonClicks()}else{if(this.savegameGroup.visible){this.handleSaveGameButtonClicks()}}}}}},togglePauseMenu:function(){if(currentState!=null){if(!currentState.inventory.background.visible&&currentState.currentConversation==null){var a=game.add.audio(Adventurous.Constants.MENU_BUTTON_SOUND);a.volume=Adventurous.options.soundVolume;a.play();if(this.background.visible){if(this.cursorWasHidden){currentState.cursor.hide()}this.background.visible=false;this.hideGroups();currentState.unfreeze()}else{this.cursorWasHidden=!currentState.cursor.sprite.visible;currentState.cursor.setItem(null);if(this.cursorWasHidden){this.saveButton.label.setStyle(Adventurous.Constants.DISABLED_LABEL_STYLE)}else{this.saveButton.label.setStyle(Adventurous.Constants.DIALOGUE_LABEL_STYLE)}currentState.cursor.show();this.background.visible=true;this.showGroup(this.menuGroup);currentState.freeze()}}else{if(currentState.inventory.background.visible){currentState.inventory.toggleInventory()}}}},updateButtons:function(){if(this.menuGroup.visible){for(var b=0;b<this.menuButtons.length;b++){var a=this.menuButtons[b];if(this.cursorWasHidden&&a==this.saveButton){continue}a.updateLabel()}}else{if(this.helpGroup.visible){var c=this.helpButtons[0];c.updateLabel()}else{if(this.optionsGroup.visible){this.soundVolumeSlider.update();this.musicVolumeSlider.update();this.textSpeedSlider.update();var c=this.optionsButtons[0];c.updateLabel();if(this.voiceToggleButton!=null&&this.voiceToggleButton.justChanged){this.voiceToggleButton.justChanged=false;if(this.voiceToggleButton.selected){this.textSpeedLabel.setStyle(Adventurous.Constants.DISABLED_LABEL_STYLE);this.textSpeedSlider.hide()}else{this.textSpeedLabel.setStyle(Adventurous.Constants.DIALOGUE_LABEL_STYLE);this.textSpeedSlider.show()}}}else{if(this.savegameGroup.visible){if(this.savegameToggle1.justChanged){this.savegameToggle1.justChanged=false;this.savegameToggle1.enabled=false;this.savegameLabel1.setStyle(Adventurous.Constants.SELECTED_DIALOGUE_LABEL_STYLE);if(this.savegameLabel2.style!=Adventurous.Constants.DISABLED_LABEL_STYLE){this.savegameToggle2.enabled=true;this.savegameLabel2.setStyle(Adventurous.Constants.DIALOGUE_LABEL_STYLE);this.savegameToggle2.setSelected(false,true)}if(this.savegameLabel3.style!=Adventurous.Constants.DISABLED_LABEL_STYLE){this.savegameToggle3.enabled=true;this.savegameToggle3.setSelected(false,true);this.savegameLabel3.setStyle(Adventurous.Constants.DIALOGUE_LABEL_STYLE)}}else{if(this.savegameToggle2.justChanged){this.savegameToggle2.justChanged=false;this.savegameToggle2.enabled=false;this.savegameLabel2.setStyle(Adventurous.Constants.SELECTED_DIALOGUE_LABEL_STYLE);if(this.savegameLabel1.style!=Adventurous.Constants.DISABLED_LABEL_STYLE){this.savegameToggle1.enabled=true;this.savegameToggle1.setSelected(false,true);this.savegameLabel1.setStyle(Adventurous.Constants.DIALOGUE_LABEL_STYLE)}if(this.savegameLabel3.style!=Adventurous.Constants.DISABLED_LABEL_STYLE){this.savegameToggle3.enabled=true;this.savegameToggle3.setSelected(false,true);this.savegameLabel3.setStyle(Adventurous.Constants.DIALOGUE_LABEL_STYLE)}}else{if(this.savegameToggle3.justChanged){this.savegameToggle3.justChanged=false;this.savegameToggle3.enabled=false;this.savegameLabel3.setStyle(Adventurous.Constants.SELECTED_DIALOGUE_LABEL_STYLE);if(this.savegameLabel1.style!=Adventurous.Constants.DISABLED_LABEL_STYLE){this.savegameToggle1.enabled=true;this.savegameToggle1.setSelected(false,true);this.savegameLabel1.setStyle(Adventurous.Constants.DIALOGUE_LABEL_STYLE)}if(this.savegameLabel2.style!=Adventurous.Constants.DISABLED_LABEL_STYLE){this.savegameToggle2.enabled=true;this.savegameToggle2.setSelected(false,true);this.savegameLabel2.setStyle(Adventurous.Constants.DIALOGUE_LABEL_STYLE)}}}}for(var b=0;b<this.savegameButtons.length;b++){this.savegameButtons[b].updateLabel()}}}}}},selectOption:function(b){switch(b){case"Continue":this.togglePauseMenu();break;case"Save Game":var c=localStorage.getItem(Adventurous.Constants.LOCALSTORAGE_KEY);if(c!=null){c=JSON.parse(c);if(c.saves["1"]!=null){this.savegameLabel1.text="Save Slot A\n"+c.saves["1"].timestamp}if(c.saves["2"]!=null){this.savegameLabel2.text="Save Slot B\n"+c.saves["2"].timestamp}if(c.saves["3"]!=null){this.savegameLabel3.text="Save Slot C\n"+c.saves["3"].timestamp}}this.savegameLabel1.setStyle(Adventurous.Constants.DIALOGUE_LABEL_STYLE);this.savegameLabel2.setStyle(Adventurous.Constants.DIALOGUE_LABEL_STYLE);this.savegameLabel3.setStyle(Adventurous.Constants.DIALOGUE_LABEL_STYLE);this.savegameToggle1.setSelected(true,false);this.savegameToggle2.setSelected(false,true);this.savegameToggle3.setSelected(false,true);this.savegameButtons[0].label.text="Save";this.showGroup(this.savegameGroup);break;case"Load Game":this.showLoadGame();break;case"Options":this.showGroup(this.optionsGroup);break;case"Help":this.showGroup(this.helpGroup);break;case"Quit":var a=game.add.audio(Adventurous.Constants.MENU_BUTTON_SOUND);a.volume=Adventurous.options.soundVolume;a.play();game.state.start("MainMenu");break;default:break}},handleOptionsButtonClicks:function(b){var c=this.optionsButtons[0];if(Adventurous.Util.isMouseOverObject(c.background)){Adventurous.options.musicVolume=this.musicVolumeSlider.value;Adventurous.options.soundVolume=this.soundVolumeSlider.value;if(Adventurous.backgroundMusic!=null){Adventurous.backgroundMusic.volume=Adventurous.options.musicVolume}if(this.voiceToggleButton!=null){Adventurous.options.voiceEnabled=this.voiceToggleButton.selected;if(!this.voiceToggleButton.selected){Adventurous.options.textSpeed=this.textSpeedSlider.value}}else{Adventurous.options.textSpeed=this.textSpeedSlider.value}if(b==true){var a=game.add.audio(Adventurous.Constants.MENU_BUTTON_SOUND);a.volume=Adventurous.options.soundVolume;a.play();this.hideGroups();this.background.visible=false}else{this.showGroup(this.menuGroup)}}},handleSaveGameButtonClicks:function(b){var e=this.savegameButtons[0];var d=this.savegameButtons[1];if(Adventurous.Util.isMouseOverObject(e.background)){var c=null;if(this.savegameToggle1.selected){c="1"}else{if(this.savegameToggle2.selected){c="2"}else{if(this.savegameToggle3.selected){c="3"}}}if(e.label.text=="Save"){Adventurous.Util.save(c);this.togglePauseMenu()}else{if(e.label.text=="Load"){if(c!=null){Adventurous.gameToLoad=c;game.state.start("Game");this.togglePauseMenu()}}}}else{if(Adventurous.Util.isMouseOverObject(d.background)){if(b==true){var a=game.add.audio(Adventurous.Constants.MENU_BUTTON_SOUND);a.volume=Adventurous.options.soundVolume;a.play();this.hideGroups();this.background.visible=false}else{this.togglePauseMenu()}}}},showLoadGame:function(){var a=localStorage.getItem(Adventurous.Constants.LOCALSTORAGE_KEY);if(a!=null){this.savegameToggle1.setSelected(false,true);this.savegameToggle2.setSelected(false,true);this.savegameToggle3.setSelected(false,true);this.savegameLabel1.setStyle(Adventurous.Constants.DIALOGUE_LABEL_STYLE);this.savegameLabel2.setStyle(Adventurous.Constants.DIALOGUE_LABEL_STYLE);this.savegameLabel3.setStyle(Adventurous.Constants.DIALOGUE_LABEL_STYLE);a=JSON.parse(a);if(a.saves["1"]!=null){this.savegameToggle1.enabled=true;this.savegameLabel1.text="Save Slot A\n"+a.saves["1"].timestamp}else{this.savegameToggle1.enabled=false;this.savegameLabel1.setStyle(Adventurous.Constants.DISABLED_LABEL_STYLE)}if(a.saves["2"]!=null){this.savegameToggle2.enabled=true;this.savegameLabel2.text="Save Slot B\n"+a.saves["2"].timestamp}else{this.savegameToggle2.enabled=false;this.savegameLabel2.setStyle(Adventurous.Constants.DISABLED_LABEL_STYLE)}if(a.saves["3"]!=null){this.savegameToggle2.enabled=true;this.savegameLabel3.text="Save Slot C\n"+a.saves["3"].timestamp}else{this.savegameToggle3.enabled=false;this.savegameLabel3.setStyle(Adventurous.Constants.DISABLED_LABEL_STYLE)}}else{this.savegameToggle1.setSelected(false,true);this.savegameToggle2.setSelected(false,true);this.savegameToggle3.setSelected(false,true);this.savegameToggle1.enabled=false;this.savegameToggle2.enabled=false;this.savegameToggle3.enabled=false;this.savegameLabel1.setStyle(Adventurous.Constants.DISABLED_LABEL_STYLE);this.savegameLabel2.setStyle(Adventurous.Constants.DISABLED_LABEL_STYLE);this.savegameLabel3.setStyle(Adventurous.Constants.DISABLED_LABEL_STYLE)}this.savegameButtons[0].label.text="Load";this.showGroup(this.savegameGroup)},bringToTop:function(){game.world.bringToTop(this.background);game.world.bringToTop(this.menuGroup);game.world.bringToTop(this.helpGroup);game.world.bringToTop(this.optionsGroup);game.world.bringToTop(this.savegameGroup)},hideGroups:function(){this.menuGroup.visible=false;this.helpGroup.visible=false;this.optionsGroup.visible=false;this.savegameGroup.visible=false},showGroup:function(b){var a=game.add.audio(Adventurous.Constants.MENU_BUTTON_SOUND);a.volume=Adventurous.options.soundVolume;a.play();this.hideGroups();b.visible=true}};Adventurous.Cursor=function(){this.sprite=game.add.sprite(game.input.mousePointer.x,game.input.mousePointer.y,"cursor");this.item=null};Adventurous.Cursor.prototype={update:function(){this.sprite.x=game.input.mousePointer.x;this.sprite.y=game.input.mousePointer.y},setItem:function(a){this.item=a;this.sprite.destroy();if(a!=null){this.sprite=game.add.sprite(game.input.mousePointer.x,game.input.mousePointer.y,this.item.imageName+"_cursor")}else{this.sprite=game.add.sprite(game.input.mousePointer.x,game.input.mousePointer.y,"cursor")}},hide:function(){this.sprite.visible=false},show:function(){this.sprite.visible=true},reload:function(){this.setItem(this.item)}};Adventurous.Conversation=function(c,a){this.name=a;this.parent=null;this.nodes={};for(var b=0;b<c.nodes.length;b++){this.nodes[c.nodes[b].name]=c.nodes[b].conversation;this.addParentReferences(c.nodes[b].conversation)}this.root=this.nodes.start;this.current=this.nodes.start;this.latestChoice=null};Adventurous.Conversation.prototype={addParentReferences:function(c){if(c.choices!=null){for(var b=0;b<c.choices.length;b++){var a=c.choices[b];if(a.conversation!=null){a.conversation.parent=c;this.addParentReferences(a.conversation)}}}},choose:function(a){if(this.current.choices!=null&&this.current.choices.length>a){currentState.dialogueGroup.visible=false;this.latestChoice=this.getChoice(a);this.current=this.latestChoice.conversation}else{console.debug("ERROR: Adventurous.Conversation.choose(index) -- index out of range")}},doDialogue:function(){if(this.current.dialogues!=null){for(var b=0;b<this.current.dialogues.length;b++){var a=this.current.dialogues[b];if(Adventurous.Util.areConditionsMet(a.conditions)){currentState.activeEffects=new Adventurous.Effects(currentState.player,a.effects,this.name);break}}}else{}},getChoices:function(){var c=new Array();if(this.current.choices==null){this.current=this.current.parent}for(var b=0;b<this.current.choices.length;b++){var a=this.current.choices[b];if(a.hidden!=true){if(Adventurous.Util.areConditionsMet(a.conditions)){c[c.length]=this.current.choices[b]}}}return c},getChoice:function(a){var b=this.getChoices();if(a<b.length){return b[a]}else{console.debug("ERROR: Adventurous.Conversation.getChoice(index) -- index out of range");return null}},quit:function(){this.current=this.root}};Adventurous.Interactions=function(d,a){this.user=null;this.effects=null;this.effectIndex=null;this.withItem={};if(d!=null){this.name=d.name;for(var b=0;b<d.list.length;b++){var c="";if(d.list[b].withItem!=null){c=d.list[b].withItem}this.withItem[c]=d.list[b]}}else{this.name=a}};Adventurous.Interactions.prototype={update:function(){this.processEffects()},getUseText:function(c,b){var d="Use";var a="With";if(c!=null&&c.length>0){if(this.withItem[c]!=null){if(this.withItem[c].verb!=null){d=this.withItem[c].verb}if(this.withItem[c].preposition!=null){a=this.withItem[c].preposition}}return d+" "+c+" "+a+" "+b}else{return b}},use:function(a,d){if(d==null){d=""}if(this.withItem[d]!=null){var e=this.withItem[d].interactions;for(var c=0;c<e.length;c++){var b=e[c];if(Adventurous.Util.areConditionsMet(b.conditions)){currentState.activeEffects=new Adventurous.Effects(a,b.effects,this.name);return true}}}return false}};Adventurous.Effects=function(b,e,c,d,a){this.user=b;this.name=c;this.effects=e;this.isRoutine=d;this.loop=a;this.start();if(!d){currentState.cursor.hide()}};Adventurous.Effects.prototype={update:function(){this.processEffects()},start:function(){this.effectIndex=0;this.applyEffect(this.effects[0])},processEffects:function(){var a=this.effects[this.effectIndex];if(this.effectIsFinished(a)){if(this.effectIndex==this.effects.length-1){if(this.isRoutine){if(this.loop){this.start()}else{this.user.activeRoutine=null}}else{this.user=null;this.effects=null;currentState.activeEffects=null;currentState.cursor.show()}}else{this.effectIndex++;this.applyEffect(this.effects[this.effectIndex])}}},applyEffect:function(d){switch(d.type){case Adventurous.Constants.ACTION_REMARK:this.assignTargetToEffect(d,this.user);var a=Adventurous.speeches[d.speech];if(a==null){console.log("ERROR: Adventurous.Interactions.applyEffects() -- missing speech '"+d.speech+"'")}else{var e=null;if(d.animation!=null){e=d.animation;if(d.directional){e+=d.target.getFacing()}}d.target.say(a,e)}break;case Adventurous.Constants.ACTION_PICK_UP:if(d.name!=null){this.assignTargetToEffect(d,Adventurous.thingsMap[d.name])}else{this.assignTargetToEffect(d,Adventurous.thingsMap[this.name])}var b=currentState.thingsGroup.getIndex(d.target.sprite);if(b!=-1){currentState.thingsGroup.removeChild(d.target.sprite)}for(var c in Adventurous.scenes){var b=Adventurous.scenes[c].things.indexOf(d.target);if(b!=-1){Adventurous.scenes[c].things.splice(b,1);break}}Adventurous.scenes[Adventurous.Constants.OFFSTAGE_SCENE].things[Adventurous.scenes[Adventurous.Constants.OFFSTAGE_SCENE].things.length]=d.target;currentState.inventory.addItem(d.target);break;case Adventurous.Constants.ACTION_DROP:if(d.name!=null){this.assignTargetToEffect(d,Adventurous.thingsMap[d.name])}else{this.assignTargetToEffect(d,Adventurous.thingsMap[this.name])}currentState.inventory.removeItem(d.target);break;case Adventurous.Constants.ACTION_SOUND:d.audioClip=game.add.audio(d.name);d.audioClip.volume=Adventurous.options.soundVolume;if(d.loop!=null){d.audioClip.loop=d.loop}else{d.audioClip.loop=false}d.audioClip.play();break;case Adventurous.Constants.ACTION_MUSIC:if(d.time==null){d.time=1000}if(Adventurous.backgroundMusic!=null){d.startingVolume=Adventurous.backgroundMusic.volume}break;case Adventurous.Constants.ACTION_HIDE:this.assignTargetToEffect(d,this.user.destinationThing);d.target.hide();d.target.hasBeenHidden=true;break;case Adventurous.Constants.ACTION_SHOW:this.assignTargetToEffect(d,this.user.destinationThing);d.target.show();d.target.hasBeenHidden=false;break;case Adventurous.Constants.ACTION_ANIMATE:this.assignTargetToEffect(d,this.user.destinationThing);var e=d.animation;if(d.directional){e+=d.target.getFacing()}if(d.target.sprite.animations._anims[e]!=null){d.target.sprite.animations.play(e,null)}else{console.debug("ERROR: Interactions.applyEffect(effect) -- nonexistent animation name '"+e+"' for Thing named '"+d.target.name+"'.")}break;case Adventurous.Constants.ACTION_FACE:this.assignTargetToEffect(d,this.user.destinationThing);if(d.dir!=null){d.target.dirAnim=d.dir}else{if(d.thing!=null){d.target.face(Adventurous.thingsMap[d.thing])}}if(d.target.sprite.animations._anims["idle"+d.dir]!=null){d.target.sprite.animations.play("idle"+d.dir,null)}else{console.debug("ERROR: Interactions.applyEffect(effect) -- no directional idle animation for Thing named '"+d.target.name+"'.")}break;case Adventurous.Constants.ACTION_WAIT:d.timer=parseFloat(d.time);break;case Adventurous.Constants.ACTION_STOP:this.assignTargetToEffect(d,null);d.target.stopMoving();break;case Adventurous.Constants.ACTION_SET_ALIAS:this.assignTargetToEffect(d,null);d.target.alias=d.alias;break;case Adventurous.Constants.ACTION_SCENE:currentState.switchToScene(d.scene,d.entrance);break;case Adventurous.Constants.ACTION_FADEOUT:this.assignTargetToEffect(d,this.user.destinationThing);d.target.show();d.target.sprite.alpha=1;d.target.hasBeenHidden=true;break;case Adventurous.Constants.ACTION_FADEIN:this.assignTargetToEffect(d,this.user.destinationThing);d.target.show();d.target.sprite.alpha=0;break;case Adventurous.Constants.ACTION_TALK:if(d.name!=null){currentState.conversationToStart=d.name}else{currentState.conversationToStart=this.name}break;case Adventurous.Constants.ACTION_WALK:this.assignTargetToEffect(d,null);if(d.target!=null){var g=currentState.scene.map.getTileWorldXY(d.x,d.y,Adventurous.Constants.TILE_SIZE,Adventurous.Constants.TILE_SIZE);if(Adventurous.Constants.WALKABLE_TILES.indexOf(g.index)!=-1){var f=currentState.scene.findPath(d.target,d.x,d.y);if(d.speed!=null){d.target.CURRENT_MOVE_SPEED=d.speed;d.target.moveSpeed=d.target.CURRENT_MOVE_SPEED*d.target.sprite.scale.x}d.target.followPath(f,null)}}break;case Adventurous.Constants.ACTION_MOVE:this.assignTargetToEffect(d,null);if(d.target!=null){var f=[];f[0]=new Phaser.Point(d.target.sprite.x,d.target.sprite.y);f[1]=new Phaser.Point(d.x,d.y);d.target.automateWalkAnimation=false;if(d.speed!=null){d.target.CURRENT_MOVE_SPEED=d.speed;d.target.moveSpeed=d.target.CURRENT_MOVE_SPEED*d.target.sprite.scale.x}d.target.followPath(f,null)}break;case Adventurous.Constants.ACTION_RELOCATE:this.assignTargetToEffect(d,this.user.destinationThing);if(d.target!=null){if(d.scene!=null){for(var c in Adventurous.scenes){var b=Adventurous.scenes[c].things.indexOf(d.target);if(b!=-1){Adventurous.scenes[c].things.splice(b,1);break}}Adventurous.scenes[d.scene].things[Adventurous.scenes[d.scene].things.length]=d.target}if(d.x!=null&&d.y!=null){d.target.setPosition(d.x,d.y)}else{if(d.x!=null){d.target.setPosition(d.x,d.target.sprite.y)}else{if(d.y!=null){d.target.setPosition(d.target.sprite.x,d.y)}}}}break;case Adventurous.Constants.ACTION_SET_FLAG:Adventurous.flags[d.name]=d.val;break;case Adventurous.Constants.ACTION_CONV_HIDE_CHOICE:if(currentState.currentConversation!=null&&currentState.currentConversation.latestChoice!=null){currentState.currentConversation.latestChoice.hidden=true;if(currentState.dialogueGroupStartIndex>0){currentState.dialogueUp()}else{currentState.updateDialogueOptions()}}break;case Adventurous.Constants.ACTION_CONV_RESET_CHOICES:if(currentState.currentConversation!=null){currentState.currentConversation.current.choices.forEach(function(h){h.hidden=false});currentState.updateDialogueOptions()}break;case Adventurous.Constants.ACTION_CONV_NODE:if(currentState.currentConversation!=null){currentState.currentConversation.current=currentState.currentConversation.nodes[d.name];currentState.currentConversation.doDialogue();if(currentState.currentConversation!=null&&currentState.currentConversation.current.choices!=null){currentState.updateDialogueOptions()}}break;case Adventurous.Constants.ACTION_STOP_ROUTINE:this.assignTargetToEffect(d,null);if(d.target!=null){d.target.stopRoutine()}break;case Adventurous.Constants.ACTION_START_ROUTINE:this.assignTargetToEffect(d,null);if(d.target!=null){d.target.startRoutine(d.routine)}break;case Adventurous.Constants.ACTION_CONV_QUIT:currentState.endConversation();break;case Adventurous.Constants.ACTION_MAIN_MENU:game.state.start("MainMenu");break}},assignTargetToEffect:function(b,a){if(b.name!=null&&Adventurous.thingsMap[b.name]!=null){b.target=Adventurous.thingsMap[b.name]}else{b.target=a}if(this.user!=b.target){if(b.target.activeRoutine!=null){b.target.stopRoutine()}}return b.target},effectIsFinished:function(a){if((a.wait!=false)||a.type==Adventurous.Constants.ACTION_WAIT){switch(a.type){case Adventurous.Constants.ACTION_REMARK:return !a.target.talking;break;case Adventurous.Constants.ACTION_ANIMATE:if(a.directional!=true&&a.target.sprite.animations._anims[a.animation]==null){return true}else{if(a.directional&&a.target.sprite.animations._anims[a.animation+a.target.getFacing()]==null){return true}else{return a.target.sprite.animations.currentAnim.loop||a.target.sprite.animations.currentAnim.isFinished}}break;case Adventurous.Constants.ACTION_WAIT:a.timer-=currentState.time.elapsed;return a.timer<=0;break;case Adventurous.Constants.ACTION_WALK:if(a.target.destination==null){a.target.CURRENT_MOVE_SPEED=a.target.MOVE_SPEED;a.target.moveSpeed=a.target.CURRENT_MOVE_SPEED*a.target.sprite.scale.x}return a.target.destination==null;break;case Adventurous.Constants.ACTION_MOVE:if(a.target.destination==null){a.target.CURRENT_MOVE_SPEED=a.target.MOVE_SPEED;a.target.moveSpeed=a.target.CURRENT_MOVE_SPEED*a.target.sprite.scale.x}return a.target.destination==null;break;case Adventurous.Constants.ACTION_FADEOUT:a.target.sprite.alpha-=currentState.time.elapsed/a.time;if(a.target.sprite.alpha<=0){a.target.sprite.alpha=0;return true}else{return false}break;case Adventurous.Constants.ACTION_FADEIN:a.target.sprite.alpha+=currentState.time.elapsed/a.time;if(a.target.sprite.alpha>=1){a.target.sprite.alpha=1;return true}else{return false}break;case Adventurous.Constants.ACTION_SOUND:if(a.audioClip.loop!=true){return !a.audioClip.isPlaying}else{return true}break;case Adventurous.Constants.ACTION_MUSIC:if(Adventurous.backgroundMusic==null){Adventurous.backgroundMusic=game.add.audio(a.name);Adventurous.backgroundMusic.volume=Adventurous.options.musicVolume;Adventurous.backgroundMusic.loop=true;Adventurous.backgroundMusic.play();return true}else{if(Adventurous.backgroundMusic.name==a.name){return true}else{Adventurous.backgroundMusic.volume-=a.startingVolume*(currentState.time.elapsed/a.time);if(Adventurous.backgroundMusic.volume<=0){Adventurous.backgroundMusic.stop();Adventurous.backgroundMusic=game.add.audio(a.name);Adventurous.backgroundMusic.volume=Adventurous.options.musicVolume;Adventurous.backgroundMusic.loop=true;Adventurous.backgroundMusic.play();return true}else{return false}}}break;default:return true;break}}else{return true}}};Adventurous.Observations=function(b){if(b!=null){this.list=b.list;for(var a=0;a<this.list.length;a++){this.list[a].i=0}}else{this.list=new Array();this.list[0]={};this.list[0].i=0;this.list[0].speeches=["default_observation"]}};Adventurous.Observations.prototype={next:function(){for(var d=0;d<this.list.length;d++){var b=this.list[d];if(Adventurous.Util.areConditionsMet(b.conditions)){var c=b.speeches[b.i];b.i=(b.i+1)%b.speeches.length;var a=Adventurous.speeches[c];if(a==null){console.log("ERROR: Adventurous.Observations.next() -- missing speech '"+c+"'")}return a}}return null}};Adventurous.Util={areConditionsMet:function(b){if(b){for(var a=0;a<b.length;a++){if(!this.isConditionMet(b[a])){return false}}}return true},isConditionMet:function(a){switch(a.type){case"flagTrue":return(Adventurous.flags[a.name]==true);break;case"flagFalse":return(Adventurous.flags[a.name]!=true);break;case"hasNotItem":return(!currentState.inventory.hasItem(a.name));break;case"hasItem":return(currentState.inventory.hasItem(a.name));break}},isMouseOverObject:function(a){return(game.input.mousePointer.x>=a.x-a.width*a.anchor.x&&game.input.mousePointer.x<=a.x+a.width-a.width*a.anchor.x&&game.input.mousePointer.y>=a.y&&game.input.mousePointer.y<=a.y+a.height)},calculateDialogueMinTime:function(b){var c=Adventurous.options.textSpeed+0.5;var a=c*Adventurous.Constants.DIALOGUE_DEFAULT_WPM;if(b==null){return 0}else{return Math.max(b.split(" ").length*60*1000/a,Adventurous.Constants.DIALOGUE_MIN_TIME)}},save:function(a){var e={};e.flags=Adventurous.flags;e.options=Adventurous.options;e.data=currentState.toSaveObject();var b=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var j=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];var c=new Date();var g=j[c.getDay()]+" "+b[c.getMonth()]+" "+c.getDate()+", "+c.getFullYear();var i=c.getHours();var d=c.getMinutes();if(d<10){d="0"+d}var h="am";if(i>11){h="pm"}if(c.getHours()>12){i-=12}g+="\n"+i+":"+d+h;e.timestamp=g;if(Adventurous.backgroundMusic!=null){e.backgroundMusic=Adventurous.backgroundMusic.name}var f=localStorage.getItem(Adventurous.Constants.LOCALSTORAGE_KEY);if(f==null){f={};f.saves={};f.options={}}else{f=JSON.parse(f)}f.saves[a]=e;localStorage.setItem(Adventurous.Constants.LOCALSTORAGE_KEY,JSON.stringify(f))},load:function(a){var c=localStorage.getItem(Adventurous.Constants.LOCALSTORAGE_KEY);if(c!=null){c=JSON.parse(c);if(c!=null&&c.saves!=null&&c.saves[a]!=null){var b=c.saves[a];if(b.backgroundMusic!=null){if(Adventurous.backgroundMusic==null||Adventurous.backgroundMusic.name!=b.backgroundMusic){if(Adventurous.backgroundMusic!=null){Adventurous.backgroundMusic.stop()}Adventurous.backgroundMusic=game.add.audio(b.backgroundMusic);Adventurous.backgroundMusic.volume=Adventurous.options.musicVolume;Adventurous.backgroundMusic.loop=true;Adventurous.backgroundMusic.play()}}currentState.loadFromObject(b)}}}};Adventurous.scenes={};Adventurous.thingsArray=new Array();Adventurous.thingsMap={};Adventurous.conversations={};Adventurous.interactions={};Adventurous.observations={};Adventurous.combinations={};Adventurous.startingScene="";Adventurous.Loader={init:function(a){this.initSpeeches();this.initConversations();this.initInteractions();this.initObservations();this.initCombinations();this.initScenesAndThings()},initSpeeches:function(){var b=JSON.parse(game.cache.getText("speeches"));for(var c=0;c<b.list.length;c++){var a=b.list[c];if(a.audio==null){a.audio=a.name}Adventurous.speeches[a.name]=new Adventurous.Speech(a.text,game.add.audio(a.audio))}},initConversations:function(){var c=JSON.parse(game.cache.getText("conversations"));var b=c.list;for(var a=0;a<b.length;a++){Adventurous.conversations[b[a].name]=new Adventurous.Conversation(b[a],b[a].name)}},initInteractions:function(){var c=JSON.parse(game.cache.getText("interactions"));var b=c.list;for(var a=0;a<b.length;a++){Adventurous.interactions[b[a].name]=new Adventurous.Interactions(b[a])}},initObservations:function(){var c=JSON.parse(game.cache.getText("observations"));var b=c.list;for(var a=0;a<b.length;a++){Adventurous.observations[b[a].name]=new Adventurous.Observations(b[a])}},initCombinations:function(){var g=JSON.parse(game.cache.getText("combinations"));var e=g.list;for(var c=0;c<e.length;c++){var f=e[c].itemA;var d=e[c].itemB;var b=e[c].speech;var a=e[c].result;if(Adventurous.combinations[f]==null){Adventurous.combinations[f]={}}if(Adventurous.combinations[d]==null){Adventurous.combinations[d]={}}Adventurous.combinations[f][d]={};Adventurous.combinations[f][d].speech=b;Adventurous.combinations[f][d].result=a;Adventurous.combinations[d][f]={};Adventurous.combinations[d][f].speech=b;Adventurous.combinations[d][f].result=a}},initScenesAndThings:function(){var d=JSON.parse(game.cache.getText("scenes"));var a={};var e={};var c=d.list;for(var b=0;b<c.length;b++){Adventurous.scenes[c[b].name]=new Adventurous.Scene(c[b])}}};